(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function gS(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var by={exports:{}},Xf={};var C1;function $U(){if(C1)return Xf;C1=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,r,s){var o=null;if(s!==void 0&&(o=""+s),r.key!==void 0&&(o=""+r.key),"key"in r){s={};for(var u in r)u!=="key"&&(s[u]=r[u])}else s=r;return r=s.ref,{$$typeof:i,type:n,key:o,ref:r!==void 0?r:null,props:s}}return Xf.Fragment=e,Xf.jsx=t,Xf.jsxs=t,Xf}var N1;function jU(){return N1||(N1=1,by.exports=$U()),by.exports}var _t=jU(),Sy={exports:{}},Ut={};var D1;function XU(){if(D1)return Ut;D1=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),g=Symbol.iterator;function _(O){return O===null||typeof O!="object"?null:(O=g&&O[g]||O["@@iterator"],typeof O=="function"?O:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,b={};function x(O,Y,ue){this.props=O,this.context=Y,this.refs=b,this.updater=ue||v}x.prototype.isReactComponent={},x.prototype.setState=function(O,Y){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,Y,"setState")},x.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function M(){}M.prototype=x.prototype;function E(O,Y,ue){this.props=O,this.context=Y,this.refs=b,this.updater=ue||v}var w=E.prototype=new M;w.constructor=E,T(w,x.prototype),w.isPureReactComponent=!0;var C=Array.isArray;function N(){}var D={H:null,A:null,T:null,S:null},U=Object.prototype.hasOwnProperty;function R(O,Y,ue){var Ne=ue.ref;return{$$typeof:i,type:O,key:Y,ref:Ne!==void 0?Ne:null,props:ue}}function P(O,Y){return R(O.type,Y,O.props)}function I(O){return typeof O=="object"&&O!==null&&O.$$typeof===i}function H(O){var Y={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(ue){return Y[ue]})}var X=/\/+/g;function J(O,Y){return typeof O=="object"&&O!==null&&O.key!=null?H(""+O.key):Y.toString(36)}function ne(O){switch(O.status){case"fulfilled":return O.value;case"rejected":throw O.reason;default:switch(typeof O.status=="string"?O.then(N,N):(O.status="pending",O.then(function(Y){O.status==="pending"&&(O.status="fulfilled",O.value=Y)},function(Y){O.status==="pending"&&(O.status="rejected",O.reason=Y)})),O.status){case"fulfilled":return O.value;case"rejected":throw O.reason}}throw O}function G(O,Y,ue,Ne,Z){var W=typeof O;(W==="undefined"||W==="boolean")&&(O=null);var ie=!1;if(O===null)ie=!0;else switch(W){case"bigint":case"string":case"number":ie=!0;break;case"object":switch(O.$$typeof){case i:case e:ie=!0;break;case d:return ie=O._init,G(ie(O._payload),Y,ue,Ne,Z)}}if(ie)return Z=Z(O),ie=Ne===""?"."+J(O,0):Ne,C(Z)?(ue="",ie!=null&&(ue=ie.replace(X,"$&/")+"/"),G(Z,Y,ue,"",function(ze){return ze})):Z!=null&&(I(Z)&&(Z=P(Z,ue+(Z.key==null||O&&O.key===Z.key?"":(""+Z.key).replace(X,"$&/")+"/")+ie)),Y.push(Z)),1;ie=0;var Le=Ne===""?".":Ne+":";if(C(O))for(var ke=0;ke<O.length;ke++)Ne=O[ke],W=Le+J(Ne,ke),ie+=G(Ne,Y,ue,W,Z);else if(ke=_(O),typeof ke=="function")for(O=ke.call(O),ke=0;!(Ne=O.next()).done;)Ne=Ne.value,W=Le+J(Ne,ke++),ie+=G(Ne,Y,ue,W,Z);else if(W==="object"){if(typeof O.then=="function")return G(ne(O),Y,ue,Ne,Z);throw Y=String(O),Error("Objects are not valid as a React child (found: "+(Y==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":Y)+"). If you meant to render a collection of children, use an array instead.")}return ie}function z(O,Y,ue){if(O==null)return O;var Ne=[],Z=0;return G(O,Ne,"","",function(W){return Y.call(ue,W,Z++)}),Ne}function q(O){if(O._status===-1){var Y=O._result;Y=Y(),Y.then(function(ue){(O._status===0||O._status===-1)&&(O._status=1,O._result=ue)},function(ue){(O._status===0||O._status===-1)&&(O._status=2,O._result=ue)}),O._status===-1&&(O._status=0,O._result=Y)}if(O._status===1)return O._result.default;throw O._result}var ce=typeof reportError=="function"?reportError:function(O){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof O=="object"&&O!==null&&typeof O.message=="string"?String(O.message):String(O),error:O});if(!window.dispatchEvent(Y))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",O);return}console.error(O)},xe={map:z,forEach:function(O,Y,ue){z(O,function(){Y.apply(this,arguments)},ue)},count:function(O){var Y=0;return z(O,function(){Y++}),Y},toArray:function(O){return z(O,function(Y){return Y})||[]},only:function(O){if(!I(O))throw Error("React.Children.only expected to receive a single React element child.");return O}};return Ut.Activity=p,Ut.Children=xe,Ut.Component=x,Ut.Fragment=t,Ut.Profiler=r,Ut.PureComponent=E,Ut.StrictMode=n,Ut.Suspense=c,Ut.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,Ut.__COMPILER_RUNTIME={__proto__:null,c:function(O){return D.H.useMemoCache(O)}},Ut.cache=function(O){return function(){return O.apply(null,arguments)}},Ut.cacheSignal=function(){return null},Ut.cloneElement=function(O,Y,ue){if(O==null)throw Error("The argument must be a React element, but you passed "+O+".");var Ne=T({},O.props),Z=O.key;if(Y!=null)for(W in Y.key!==void 0&&(Z=""+Y.key),Y)!U.call(Y,W)||W==="key"||W==="__self"||W==="__source"||W==="ref"&&Y.ref===void 0||(Ne[W]=Y[W]);var W=arguments.length-2;if(W===1)Ne.children=ue;else if(1<W){for(var ie=Array(W),Le=0;Le<W;Le++)ie[Le]=arguments[Le+2];Ne.children=ie}return R(O.type,Z,Ne)},Ut.createContext=function(O){return O={$$typeof:o,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null},O.Provider=O,O.Consumer={$$typeof:s,_context:O},O},Ut.createElement=function(O,Y,ue){var Ne,Z={},W=null;if(Y!=null)for(Ne in Y.key!==void 0&&(W=""+Y.key),Y)U.call(Y,Ne)&&Ne!=="key"&&Ne!=="__self"&&Ne!=="__source"&&(Z[Ne]=Y[Ne]);var ie=arguments.length-2;if(ie===1)Z.children=ue;else if(1<ie){for(var Le=Array(ie),ke=0;ke<ie;ke++)Le[ke]=arguments[ke+2];Z.children=Le}if(O&&O.defaultProps)for(Ne in ie=O.defaultProps,ie)Z[Ne]===void 0&&(Z[Ne]=ie[Ne]);return R(O,W,Z)},Ut.createRef=function(){return{current:null}},Ut.forwardRef=function(O){return{$$typeof:u,render:O}},Ut.isValidElement=I,Ut.lazy=function(O){return{$$typeof:d,_payload:{_status:-1,_result:O},_init:q}},Ut.memo=function(O,Y){return{$$typeof:h,type:O,compare:Y===void 0?null:Y}},Ut.startTransition=function(O){var Y=D.T,ue={};D.T=ue;try{var Ne=O(),Z=D.S;Z!==null&&Z(ue,Ne),typeof Ne=="object"&&Ne!==null&&typeof Ne.then=="function"&&Ne.then(N,ce)}catch(W){ce(W)}finally{Y!==null&&ue.types!==null&&(Y.types=ue.types),D.T=Y}},Ut.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},Ut.use=function(O){return D.H.use(O)},Ut.useActionState=function(O,Y,ue){return D.H.useActionState(O,Y,ue)},Ut.useCallback=function(O,Y){return D.H.useCallback(O,Y)},Ut.useContext=function(O){return D.H.useContext(O)},Ut.useDebugValue=function(){},Ut.useDeferredValue=function(O,Y){return D.H.useDeferredValue(O,Y)},Ut.useEffect=function(O,Y){return D.H.useEffect(O,Y)},Ut.useEffectEvent=function(O){return D.H.useEffectEvent(O)},Ut.useId=function(){return D.H.useId()},Ut.useImperativeHandle=function(O,Y,ue){return D.H.useImperativeHandle(O,Y,ue)},Ut.useInsertionEffect=function(O,Y){return D.H.useInsertionEffect(O,Y)},Ut.useLayoutEffect=function(O,Y){return D.H.useLayoutEffect(O,Y)},Ut.useMemo=function(O,Y){return D.H.useMemo(O,Y)},Ut.useOptimistic=function(O,Y){return D.H.useOptimistic(O,Y)},Ut.useReducer=function(O,Y,ue){return D.H.useReducer(O,Y,ue)},Ut.useRef=function(O){return D.H.useRef(O)},Ut.useState=function(O){return D.H.useState(O)},Ut.useSyncExternalStore=function(O,Y,ue){return D.H.useSyncExternalStore(O,Y,ue)},Ut.useTransition=function(){return D.H.useTransition()},Ut.version="19.2.4",Ut}var L1;function _S(){return L1||(L1=1,Sy.exports=XU()),Sy.exports}var vn=_S();const YU=gS(vn);var Ty={exports:{}},Yf={},My={exports:{}},Ey={};var P1;function KU(){return P1||(P1=1,(function(i){function e(G,z){var q=G.length;G.push(z);e:for(;0<q;){var ce=q-1>>>1,xe=G[ce];if(0<r(xe,z))G[ce]=z,G[q]=xe,q=ce;else break e}}function t(G){return G.length===0?null:G[0]}function n(G){if(G.length===0)return null;var z=G[0],q=G.pop();if(q!==z){G[0]=q;e:for(var ce=0,xe=G.length,O=xe>>>1;ce<O;){var Y=2*(ce+1)-1,ue=G[Y],Ne=Y+1,Z=G[Ne];if(0>r(ue,q))Ne<xe&&0>r(Z,ue)?(G[ce]=Z,G[Ne]=q,ce=Ne):(G[ce]=ue,G[Y]=q,ce=Y);else if(Ne<xe&&0>r(Z,q))G[ce]=Z,G[Ne]=q,ce=Ne;else break e}}return z}function r(G,z){var q=G.sortIndex-z.sortIndex;return q!==0?q:G.id-z.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var o=Date,u=o.now();i.unstable_now=function(){return o.now()-u}}var c=[],h=[],d=1,p=null,g=3,_=!1,v=!1,T=!1,b=!1,x=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;function w(G){for(var z=t(h);z!==null;){if(z.callback===null)n(h);else if(z.startTime<=G)n(h),z.sortIndex=z.expirationTime,e(c,z);else break;z=t(h)}}function C(G){if(T=!1,w(G),!v)if(t(c)!==null)v=!0,N||(N=!0,H());else{var z=t(h);z!==null&&ne(C,z.startTime-G)}}var N=!1,D=-1,U=5,R=-1;function P(){return b?!0:!(i.unstable_now()-R<U)}function I(){if(b=!1,N){var G=i.unstable_now();R=G;var z=!0;try{e:{v=!1,T&&(T=!1,M(D),D=-1),_=!0;var q=g;try{t:{for(w(G),p=t(c);p!==null&&!(p.expirationTime>G&&P());){var ce=p.callback;if(typeof ce=="function"){p.callback=null,g=p.priorityLevel;var xe=ce(p.expirationTime<=G);if(G=i.unstable_now(),typeof xe=="function"){p.callback=xe,w(G),z=!0;break t}p===t(c)&&n(c),w(G)}else n(c);p=t(c)}if(p!==null)z=!0;else{var O=t(h);O!==null&&ne(C,O.startTime-G),z=!1}}break e}finally{p=null,g=q,_=!1}z=void 0}}finally{z?H():N=!1}}}var H;if(typeof E=="function")H=function(){E(I)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,J=X.port2;X.port1.onmessage=I,H=function(){J.postMessage(null)}}else H=function(){x(I,0)};function ne(G,z){D=x(function(){G(i.unstable_now())},z)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(G){G.callback=null},i.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<G?Math.floor(1e3/G):5},i.unstable_getCurrentPriorityLevel=function(){return g},i.unstable_next=function(G){switch(g){case 1:case 2:case 3:var z=3;break;default:z=g}var q=g;g=z;try{return G()}finally{g=q}},i.unstable_requestPaint=function(){b=!0},i.unstable_runWithPriority=function(G,z){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var q=g;g=G;try{return z()}finally{g=q}},i.unstable_scheduleCallback=function(G,z,q){var ce=i.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?ce+q:ce):q=ce,G){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=q+xe,G={id:d++,callback:z,priorityLevel:G,startTime:q,expirationTime:xe,sortIndex:-1},q>ce?(G.sortIndex=q,e(h,G),t(c)===null&&G===t(h)&&(T?(M(D),D=-1):T=!0,ne(C,q-ce))):(G.sortIndex=xe,e(c,G),v||_||(v=!0,N||(N=!0,H()))),G},i.unstable_shouldYield=P,i.unstable_wrapCallback=function(G){var z=g;return function(){var q=g;g=z;try{return G.apply(this,arguments)}finally{g=q}}}})(Ey)),Ey}var U1;function QU(){return U1||(U1=1,My.exports=KU()),My.exports}var Ay={exports:{}},Zi={};var O1;function ZU(){if(O1)return Zi;O1=1;var i=_S();function e(c){var h="https://react.dev/errors/"+c;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)h+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+c+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function s(c,h,d){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:p==null?null:""+p,children:c,containerInfo:h,implementation:d}}var o=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(c,h){if(c==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Zi.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Zi.createPortal=function(c,h){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return s(c,h,null,d)},Zi.flushSync=function(c){var h=o.T,d=n.p;try{if(o.T=null,n.p=2,c)return c()}finally{o.T=h,n.p=d,n.d.f()}},Zi.preconnect=function(c,h){typeof c=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,n.d.C(c,h))},Zi.prefetchDNS=function(c){typeof c=="string"&&n.d.D(c)},Zi.preinit=function(c,h){if(typeof c=="string"&&h&&typeof h.as=="string"){var d=h.as,p=u(d,h.crossOrigin),g=typeof h.integrity=="string"?h.integrity:void 0,_=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;d==="style"?n.d.S(c,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:p,integrity:g,fetchPriority:_}):d==="script"&&n.d.X(c,{crossOrigin:p,integrity:g,fetchPriority:_,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Zi.preinitModule=function(c,h){if(typeof c=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var d=u(h.as,h.crossOrigin);n.d.M(c,{crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&n.d.M(c)},Zi.preload=function(c,h){if(typeof c=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var d=h.as,p=u(d,h.crossOrigin);n.d.L(c,d,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Zi.preloadModule=function(c,h){if(typeof c=="string")if(h){var d=u(h.as,h.crossOrigin);n.d.m(c,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else n.d.m(c)},Zi.requestFormReset=function(c){n.d.r(c)},Zi.unstable_batchedUpdates=function(c,h){return c(h)},Zi.useFormState=function(c,h,d){return o.H.useFormState(c,h,d)},Zi.useFormStatus=function(){return o.H.useHostTransitionStatus()},Zi.version="19.2.4",Zi}var B1;function JU(){if(B1)return Ay.exports;B1=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Ay.exports=ZU(),Ay.exports}var F1;function eO(){if(F1)return Yf;F1=1;var i=QU(),e=_S(),t=JU();function n(a){var l="https://react.dev/errors/"+a;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)l+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+a+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function s(a){var l=a,f=a;if(a.alternate)for(;l.return;)l=l.return;else{a=l;do l=a,(l.flags&4098)!==0&&(f=l.return),a=l.return;while(a)}return l.tag===3?f:null}function o(a){if(a.tag===13){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function u(a){if(a.tag===31){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function c(a){if(s(a)!==a)throw Error(n(188))}function h(a){var l=a.alternate;if(!l){if(l=s(a),l===null)throw Error(n(188));return l!==a?null:a}for(var f=a,m=l;;){var y=f.return;if(y===null)break;var S=y.alternate;if(S===null){if(m=y.return,m!==null){f=m;continue}break}if(y.child===S.child){for(S=y.child;S;){if(S===f)return c(y),a;if(S===m)return c(y),l;S=S.sibling}throw Error(n(188))}if(f.return!==m.return)f=y,m=S;else{for(var A=!1,B=y.child;B;){if(B===f){A=!0,f=y,m=S;break}if(B===m){A=!0,m=y,f=S;break}B=B.sibling}if(!A){for(B=S.child;B;){if(B===f){A=!0,f=S,m=y;break}if(B===m){A=!0,m=S,f=y;break}B=B.sibling}if(!A)throw Error(n(189))}}if(f.alternate!==m)throw Error(n(190))}if(f.tag!==3)throw Error(n(188));return f.stateNode.current===f?a:l}function d(a){var l=a.tag;if(l===5||l===26||l===27||l===6)return a;for(a=a.child;a!==null;){if(l=d(a),l!==null)return l;a=a.sibling}return null}var p=Object.assign,g=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),M=Symbol.for("react.consumer"),E=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),U=Symbol.for("react.lazy"),R=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),I=Symbol.iterator;function H(a){return a===null||typeof a!="object"?null:(a=I&&a[I]||a["@@iterator"],typeof a=="function"?a:null)}var X=Symbol.for("react.client.reference");function J(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===X?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case T:return"Fragment";case x:return"Profiler";case b:return"StrictMode";case C:return"Suspense";case N:return"SuspenseList";case R:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case v:return"Portal";case E:return a.displayName||"Context";case M:return(a._context.displayName||"Context")+".Consumer";case w:var l=a.render;return a=a.displayName,a||(a=l.displayName||l.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case D:return l=a.displayName||null,l!==null?l:J(a.type)||"Memo";case U:l=a._payload,a=a._init;try{return J(a(l))}catch{}}return null}var ne=Array.isArray,G=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,z=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q={pending:!1,data:null,method:null,action:null},ce=[],xe=-1;function O(a){return{current:a}}function Y(a){0>xe||(a.current=ce[xe],ce[xe]=null,xe--)}function ue(a,l){xe++,ce[xe]=a.current,a.current=l}var Ne=O(null),Z=O(null),W=O(null),ie=O(null);function Le(a,l){switch(ue(W,l),ue(Z,a),ue(Ne,null),l.nodeType){case 9:case 11:a=(a=l.documentElement)&&(a=a.namespaceURI)?ZA(a):0;break;default:if(a=l.tagName,l=l.namespaceURI)l=ZA(l),a=JA(l,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Y(Ne),ue(Ne,a)}function ke(){Y(Ne),Y(Z),Y(W)}function ze(a){a.memoizedState!==null&&ue(ie,a);var l=Ne.current,f=JA(l,a.type);l!==f&&(ue(Z,a),ue(Ne,f))}function ht(a){Z.current===a&&(Y(Ne),Y(Z)),ie.current===a&&(Y(ie),Wf._currentValue=q)}var nn,Pt;function wt(a){if(nn===void 0)try{throw Error()}catch(f){var l=f.stack.trim().match(/\n( *(at )?)/);nn=l&&l[1]||"",Pt=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+nn+a+Pt}var qt=!1;function Mt(a,l){if(!a||qt)return"";qt=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(l){var Ce=function(){throw Error()};if(Object.defineProperty(Ce.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ce,[])}catch(_e){var pe=_e}Reflect.construct(a,[],Ce)}else{try{Ce.call()}catch(_e){pe=_e}a.call(Ce.prototype)}}else{try{throw Error()}catch(_e){pe=_e}(Ce=a())&&typeof Ce.catch=="function"&&Ce.catch(function(){})}}catch(_e){if(_e&&pe&&typeof _e.stack=="string")return[_e.stack,pe.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var S=m.DetermineComponentFrameRoot(),A=S[0],B=S[1];if(A&&B){var $=A.split(`
`),fe=B.split(`
`);for(y=m=0;m<$.length&&!$[m].includes("DetermineComponentFrameRoot");)m++;for(;y<fe.length&&!fe[y].includes("DetermineComponentFrameRoot");)y++;if(m===$.length||y===fe.length)for(m=$.length-1,y=fe.length-1;1<=m&&0<=y&&$[m]!==fe[y];)y--;for(;1<=m&&0<=y;m--,y--)if($[m]!==fe[y]){if(m!==1||y!==1)do if(m--,y--,0>y||$[m]!==fe[y]){var Me=`
`+$[m].replace(" at new "," at ");return a.displayName&&Me.includes("<anonymous>")&&(Me=Me.replace("<anonymous>",a.displayName)),Me}while(1<=m&&0<=y);break}}}finally{qt=!1,Error.prepareStackTrace=f}return(f=a?a.displayName||a.name:"")?wt(f):""}function un(a,l){switch(a.tag){case 26:case 27:case 5:return wt(a.type);case 16:return wt("Lazy");case 13:return a.child!==l&&l!==null?wt("Suspense Fallback"):wt("Suspense");case 19:return wt("SuspenseList");case 0:case 15:return Mt(a.type,!1);case 11:return Mt(a.type.render,!1);case 1:return Mt(a.type,!0);case 31:return wt("Activity");default:return""}}function K(a){try{var l="",f=null;do l+=un(a,f),f=a,a=a.return;while(a);return l}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var jn=Object.prototype.hasOwnProperty,en=i.unstable_scheduleCallback,mn=i.unstable_cancelCallback,lt=i.unstable_shouldYield,V=i.unstable_requestPaint,L=i.unstable_now,re=i.unstable_getCurrentPriorityLevel,Ee=i.unstable_ImmediatePriority,Pe=i.unstable_UserBlockingPriority,Se=i.unstable_NormalPriority,ft=i.unstable_LowPriority,He=i.unstable_IdlePriority,st=i.log,At=i.unstable_setDisableYieldValue,Be=null,Fe=null;function Je(a){if(typeof st=="function"&&At(a),Fe&&typeof Fe.setStrictMode=="function")try{Fe.setStrictMode(Be,a)}catch{}}var Ke=Math.clz32?Math.clz32:te,We=Math.log,Gt=Math.LN2;function te(a){return a>>>=0,a===0?32:31-(We(a)/Gt|0)|0}var $e=256,Ie=262144,Qe=4194304;function Oe(a){var l=a&42;if(l!==0)return l;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function De(a,l,f){var m=a.pendingLanes;if(m===0)return 0;var y=0,S=a.suspendedLanes,A=a.pingedLanes;a=a.warmLanes;var B=m&134217727;return B!==0?(m=B&~S,m!==0?y=Oe(m):(A&=B,A!==0?y=Oe(A):f||(f=B&~a,f!==0&&(y=Oe(f))))):(B=m&~S,B!==0?y=Oe(B):A!==0?y=Oe(A):f||(f=m&~a,f!==0&&(y=Oe(f)))),y===0?0:l!==0&&l!==y&&(l&S)===0&&(S=y&-y,f=l&-l,S>=f||S===32&&(f&4194048)!==0)?l:y}function Ve(a,l){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&l)===0}function Rt(a,l){switch(a){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bn(){var a=Qe;return Qe<<=1,(Qe&62914560)===0&&(Qe=4194304),a}function rn(a){for(var l=[],f=0;31>f;f++)l.push(a);return l}function Qi(a,l){a.pendingLanes|=l,l!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Ms(a,l,f,m,y,S){var A=a.pendingLanes;a.pendingLanes=f,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=f,a.entangledLanes&=f,a.errorRecoveryDisabledLanes&=f,a.shellSuspendCounter=0;var B=a.entanglements,$=a.expirationTimes,fe=a.hiddenUpdates;for(f=A&~f;0<f;){var Me=31-Ke(f),Ce=1<<Me;B[Me]=0,$[Me]=-1;var pe=fe[Me];if(pe!==null)for(fe[Me]=null,Me=0;Me<pe.length;Me++){var _e=pe[Me];_e!==null&&(_e.lane&=-536870913)}f&=~Ce}m!==0&&Vp(a,m,0),S!==0&&y===0&&a.tag!==0&&(a.suspendedLanes|=S&~(A&~l))}function Vp(a,l,f){a.pendingLanes|=l,a.suspendedLanes&=~l;var m=31-Ke(l);a.entangledLanes|=l,a.entanglements[m]=a.entanglements[m]|1073741824|f&261930}function tf(a,l){var f=a.entangledLanes|=l;for(a=a.entanglements;f;){var m=31-Ke(f),y=1<<m;y&l|a[m]&l&&(a[m]|=l),f&=~y}}function Nu(a,l){var f=l&-l;return f=(f&42)!==0?1:nf(f),(f&(a.suspendedLanes|l))!==0?0:f}function nf(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Du(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function rf(){var a=z.p;return a!==0?a:(a=window.event,a===void 0?32:S1(a.type))}function qs(a,l){var f=z.p;try{return z.p=a,l()}finally{z.p=f}}var is=Math.random().toString(36).slice(2),fi="__reactFiber$"+is,Pi="__reactProps$"+is,Es="__reactContainer$"+is,Lu="__reactEvents$"+is,Pu="__reactListeners$"+is,Hp="__reactHandles$"+is,sf="__reactResources$"+is,vl="__reactMarker$"+is;function af(a){delete a[fi],delete a[Pi],delete a[Lu],delete a[Pu],delete a[Hp]}function vo(a){var l=a[fi];if(l)return l;for(var f=a.parentNode;f;){if(l=f[Es]||f[fi]){if(f=l.alternate,l.child!==null||f!==null&&f.child!==null)for(a=a1(a);a!==null;){if(f=a[fi])return f;a=a1(a)}return l}a=f,f=a.parentNode}return null}function yo(a){if(a=a[fi]||a[Es]){var l=a.tag;if(l===5||l===6||l===13||l===31||l===26||l===27||l===3)return a}return null}function yl(a){var l=a.tag;if(l===5||l===26||l===27||l===6)return a.stateNode;throw Error(n(33))}function xo(a){var l=a[sf];return l||(l=a[sf]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function F(a){a[vl]=!0}var se=new Set,me={};function de(a,l){le(a,l),le(a+"Capture",l)}function le(a,l){for(me[a]=l,a=0;a<l.length;a++)se.add(l[a])}var qe=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),tt={},je={};function it(a){return jn.call(je,a)?!0:jn.call(tt,a)?!1:qe.test(a)?je[a]=!0:(tt[a]=!0,!1)}function at(a,l,f){if(it(l))if(f===null)a.removeAttribute(l);else{switch(typeof f){case"undefined":case"function":case"symbol":a.removeAttribute(l);return;case"boolean":var m=l.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){a.removeAttribute(l);return}}a.setAttribute(l,""+f)}}function xt(a,l,f){if(f===null)a.removeAttribute(l);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(l);return}a.setAttribute(l,""+f)}}function ot(a,l,f,m){if(m===null)a.removeAttribute(f);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(f);return}a.setAttributeNS(l,f,""+m)}}function St(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function cn(a){var l=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function Xn(a,l,f){var m=Object.getOwnPropertyDescriptor(a.constructor.prototype,l);if(!a.hasOwnProperty(l)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var y=m.get,S=m.set;return Object.defineProperty(a,l,{configurable:!0,get:function(){return y.call(this)},set:function(A){f=""+A,S.call(this,A)}}),Object.defineProperty(a,l,{enumerable:m.enumerable}),{getValue:function(){return f},setValue:function(A){f=""+A},stopTracking:function(){a._valueTracker=null,delete a[l]}}}}function kn(a){if(!a._valueTracker){var l=cn(a)?"checked":"value";a._valueTracker=Xn(a,l,""+a[l])}}function gn(a){if(!a)return!1;var l=a._valueTracker;if(!l)return!0;var f=l.getValue(),m="";return a&&(m=cn(a)?a.checked?"true":"false":a.value),a=m,a!==f?(l.setValue(a),!0):!1}function mt(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var hn=/[\n"\\]/g;function Nt(a){return a.replace(hn,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function Ui(a,l,f,m,y,S,A,B){a.name="",A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?a.type=A:a.removeAttribute("type"),l!=null?A==="number"?(l===0&&a.value===""||a.value!=l)&&(a.value=""+St(l)):a.value!==""+St(l)&&(a.value=""+St(l)):A!=="submit"&&A!=="reset"||a.removeAttribute("value"),l!=null?Oi(a,A,St(l)):f!=null?Oi(a,A,St(f)):m!=null&&a.removeAttribute("value"),y==null&&S!=null&&(a.defaultChecked=!!S),y!=null&&(a.checked=y&&typeof y!="function"&&typeof y!="symbol"),B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?a.name=""+St(B):a.removeAttribute("name")}function Ta(a,l,f,m,y,S,A,B){if(S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(a.type=S),l!=null||f!=null){if(!(S!=="submit"&&S!=="reset"||l!=null)){kn(a);return}f=f!=null?""+St(f):"",l=l!=null?""+St(l):f,B||l===a.value||(a.value=l),a.defaultValue=l}m=m??y,m=typeof m!="function"&&typeof m!="symbol"&&!!m,a.checked=B?a.checked:!!m,a.defaultChecked=!!m,A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(a.name=A),kn(a)}function Oi(a,l,f){l==="number"&&mt(a.ownerDocument)===a||a.defaultValue===""+f||(a.defaultValue=""+f)}function rs(a,l,f,m){if(a=a.options,l){l={};for(var y=0;y<f.length;y++)l["$"+f[y]]=!0;for(f=0;f<a.length;f++)y=l.hasOwnProperty("$"+a[f].value),a[f].selected!==y&&(a[f].selected=y),y&&m&&(a[f].defaultSelected=!0)}else{for(f=""+St(f),l=null,y=0;y<a.length;y++){if(a[y].value===f){a[y].selected=!0,m&&(a[y].defaultSelected=!0);return}l!==null||a[y].disabled||(l=a[y])}l!==null&&(l.selected=!0)}}function Sn(a,l,f){if(l!=null&&(l=""+St(l),l!==a.value&&(a.value=l),f==null)){a.defaultValue!==l&&(a.defaultValue=l);return}a.defaultValue=f!=null?""+St(f):""}function Bi(a,l,f,m){if(l==null){if(m!=null){if(f!=null)throw Error(n(92));if(ne(m)){if(1<m.length)throw Error(n(93));m=m[0]}f=m}f==null&&(f=""),l=f}f=St(l),a.defaultValue=f,m=a.textContent,m===f&&m!==""&&m!==null&&(a.value=m),kn(a)}function Si(a,l){if(l){var f=a.firstChild;if(f&&f===a.lastChild&&f.nodeType===3){f.nodeValue=l;return}}a.textContent=l}var Fi=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ii(a,l,f){var m=l.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?m?a.setProperty(l,""):l==="float"?a.cssFloat="":a[l]="":m?a.setProperty(l,f):typeof f!="number"||f===0||Fi.has(l)?l==="float"?a.cssFloat=f:a[l]=(""+f).trim():a[l]=f+"px"}function Uu(a,l,f){if(l!=null&&typeof l!="object")throw Error(n(62));if(a=a.style,f!=null){for(var m in f)!f.hasOwnProperty(m)||l!=null&&l.hasOwnProperty(m)||(m.indexOf("--")===0?a.setProperty(m,""):m==="float"?a.cssFloat="":a[m]="");for(var y in l)m=l[y],l.hasOwnProperty(y)&&f[y]!==m&&Ii(a,y,m)}else for(var S in l)l.hasOwnProperty(S)&&Ii(a,S,l[S])}function As(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var VL=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),HL=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Wp(a){return HL.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function Ma(){}var v0=null;function y0(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Ou=null,Bu=null;function QT(a){var l=yo(a);if(l&&(a=l.stateNode)){var f=a[Pi]||null;e:switch(a=l.stateNode,l.type){case"input":if(Ui(a,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),l=f.name,f.type==="radio"&&l!=null){for(f=a;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+Nt(""+l)+'"][type="radio"]'),l=0;l<f.length;l++){var m=f[l];if(m!==a&&m.form===a.form){var y=m[Pi]||null;if(!y)throw Error(n(90));Ui(m,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(l=0;l<f.length;l++)m=f[l],m.form===a.form&&gn(m)}break e;case"textarea":Sn(a,f.value,f.defaultValue);break e;case"select":l=f.value,l!=null&&rs(a,!!f.multiple,l,!1)}}}var x0=!1;function ZT(a,l,f){if(x0)return a(l,f);x0=!0;try{var m=a(l);return m}finally{if(x0=!1,(Ou!==null||Bu!==null)&&(Dm(),Ou&&(l=Ou,a=Bu,Bu=Ou=null,QT(l),a)))for(l=0;l<a.length;l++)QT(a[l])}}function of(a,l){var f=a.stateNode;if(f===null)return null;var m=f[Pi]||null;if(m===null)return null;f=m[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(a=a.type,m=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!m;break e;default:a=!1}if(a)return null;if(f&&typeof f!="function")throw Error(n(231,l,typeof f));return f}var Ea=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),b0=!1;if(Ea)try{var lf={};Object.defineProperty(lf,"passive",{get:function(){b0=!0}}),window.addEventListener("test",lf,lf),window.removeEventListener("test",lf,lf)}catch{b0=!1}var bo=null,S0=null,qp=null;function JT(){if(qp)return qp;var a,l=S0,f=l.length,m,y="value"in bo?bo.value:bo.textContent,S=y.length;for(a=0;a<f&&l[a]===y[a];a++);var A=f-a;for(m=1;m<=A&&l[f-m]===y[S-m];m++);return qp=y.slice(a,1<m?1-m:void 0)}function $p(a){var l=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&l===13&&(a=13)):a=l,a===10&&(a=13),32<=a||a===13?a:0}function jp(){return!0}function eM(){return!1}function xr(a){function l(f,m,y,S,A){this._reactName=f,this._targetInst=y,this.type=m,this.nativeEvent=S,this.target=A,this.currentTarget=null;for(var B in a)a.hasOwnProperty(B)&&(f=a[B],this[B]=f?f(S):S[B]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?jp:eM,this.isPropagationStopped=eM,this}return p(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=jp)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=jp)},persist:function(){},isPersistent:jp}),l}var xl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xp=xr(xl),uf=p({},xl,{view:0,detail:0}),WL=xr(uf),T0,M0,cf,Yp=p({},uf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:A0,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==cf&&(cf&&a.type==="mousemove"?(T0=a.screenX-cf.screenX,M0=a.screenY-cf.screenY):M0=T0=0,cf=a),T0)},movementY:function(a){return"movementY"in a?a.movementY:M0}}),tM=xr(Yp),qL=p({},Yp,{dataTransfer:0}),$L=xr(qL),jL=p({},uf,{relatedTarget:0}),E0=xr(jL),XL=p({},xl,{animationName:0,elapsedTime:0,pseudoElement:0}),YL=xr(XL),KL=p({},xl,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),QL=xr(KL),ZL=p({},xl,{data:0}),nM=xr(ZL),JL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nP(a){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(a):(a=tP[a])?!!l[a]:!1}function A0(){return nP}var iP=p({},uf,{key:function(a){if(a.key){var l=JL[a.key]||a.key;if(l!=="Unidentified")return l}return a.type==="keypress"?(a=$p(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?eP[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:A0,charCode:function(a){return a.type==="keypress"?$p(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?$p(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),rP=xr(iP),sP=p({},Yp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),iM=xr(sP),aP=p({},uf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:A0}),oP=xr(aP),lP=p({},xl,{propertyName:0,elapsedTime:0,pseudoElement:0}),uP=xr(lP),cP=p({},Yp,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),hP=xr(cP),fP=p({},xl,{newState:0,oldState:0}),dP=xr(fP),pP=[9,13,27,32],w0=Ea&&"CompositionEvent"in window,hf=null;Ea&&"documentMode"in document&&(hf=document.documentMode);var mP=Ea&&"TextEvent"in window&&!hf,rM=Ea&&(!w0||hf&&8<hf&&11>=hf),sM=" ",aM=!1;function oM(a,l){switch(a){case"keyup":return pP.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function lM(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Fu=!1;function gP(a,l){switch(a){case"compositionend":return lM(l);case"keypress":return l.which!==32?null:(aM=!0,sM);case"textInput":return a=l.data,a===sM&&aM?null:a;default:return null}}function _P(a,l){if(Fu)return a==="compositionend"||!w0&&oM(a,l)?(a=JT(),qp=S0=bo=null,Fu=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return rM&&l.locale!=="ko"?null:l.data;default:return null}}var vP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uM(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l==="input"?!!vP[a.type]:l==="textarea"}function cM(a,l,f,m){Ou?Bu?Bu.push(m):Bu=[m]:Ou=m,l=Im(l,"onChange"),0<l.length&&(f=new Xp("onChange","change",null,f,m),a.push({event:f,listeners:l}))}var ff=null,df=null;function yP(a){$A(a,0)}function Kp(a){var l=yl(a);if(gn(l))return a}function hM(a,l){if(a==="change")return l}var fM=!1;if(Ea){var R0;if(Ea){var C0="oninput"in document;if(!C0){var dM=document.createElement("div");dM.setAttribute("oninput","return;"),C0=typeof dM.oninput=="function"}R0=C0}else R0=!1;fM=R0&&(!document.documentMode||9<document.documentMode)}function pM(){ff&&(ff.detachEvent("onpropertychange",mM),df=ff=null)}function mM(a){if(a.propertyName==="value"&&Kp(df)){var l=[];cM(l,df,a,y0(a)),ZT(yP,l)}}function xP(a,l,f){a==="focusin"?(pM(),ff=l,df=f,ff.attachEvent("onpropertychange",mM)):a==="focusout"&&pM()}function bP(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Kp(df)}function SP(a,l){if(a==="click")return Kp(l)}function TP(a,l){if(a==="input"||a==="change")return Kp(l)}function MP(a,l){return a===l&&(a!==0||1/a===1/l)||a!==a&&l!==l}var zr=typeof Object.is=="function"?Object.is:MP;function pf(a,l){if(zr(a,l))return!0;if(typeof a!="object"||a===null||typeof l!="object"||l===null)return!1;var f=Object.keys(a),m=Object.keys(l);if(f.length!==m.length)return!1;for(m=0;m<f.length;m++){var y=f[m];if(!jn.call(l,y)||!zr(a[y],l[y]))return!1}return!0}function gM(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function _M(a,l){var f=gM(a);a=0;for(var m;f;){if(f.nodeType===3){if(m=a+f.textContent.length,a<=l&&m>=l)return{node:f,offset:l-a};a=m}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=gM(f)}}function vM(a,l){return a&&l?a===l?!0:a&&a.nodeType===3?!1:l&&l.nodeType===3?vM(a,l.parentNode):"contains"in a?a.contains(l):a.compareDocumentPosition?!!(a.compareDocumentPosition(l)&16):!1:!1}function yM(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var l=mt(a.document);l instanceof a.HTMLIFrameElement;){try{var f=typeof l.contentWindow.location.href=="string"}catch{f=!1}if(f)a=l.contentWindow;else break;l=mt(a.document)}return l}function N0(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l&&(l==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||l==="textarea"||a.contentEditable==="true")}var EP=Ea&&"documentMode"in document&&11>=document.documentMode,Iu=null,D0=null,mf=null,L0=!1;function xM(a,l,f){var m=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;L0||Iu==null||Iu!==mt(m)||(m=Iu,"selectionStart"in m&&N0(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),mf&&pf(mf,m)||(mf=m,m=Im(D0,"onSelect"),0<m.length&&(l=new Xp("onSelect","select",null,l,f),a.push({event:l,listeners:m}),l.target=Iu)))}function bl(a,l){var f={};return f[a.toLowerCase()]=l.toLowerCase(),f["Webkit"+a]="webkit"+l,f["Moz"+a]="moz"+l,f}var zu={animationend:bl("Animation","AnimationEnd"),animationiteration:bl("Animation","AnimationIteration"),animationstart:bl("Animation","AnimationStart"),transitionrun:bl("Transition","TransitionRun"),transitionstart:bl("Transition","TransitionStart"),transitioncancel:bl("Transition","TransitionCancel"),transitionend:bl("Transition","TransitionEnd")},P0={},bM={};Ea&&(bM=document.createElement("div").style,"AnimationEvent"in window||(delete zu.animationend.animation,delete zu.animationiteration.animation,delete zu.animationstart.animation),"TransitionEvent"in window||delete zu.transitionend.transition);function Sl(a){if(P0[a])return P0[a];if(!zu[a])return a;var l=zu[a],f;for(f in l)if(l.hasOwnProperty(f)&&f in bM)return P0[a]=l[f];return a}var SM=Sl("animationend"),TM=Sl("animationiteration"),MM=Sl("animationstart"),AP=Sl("transitionrun"),wP=Sl("transitionstart"),RP=Sl("transitioncancel"),EM=Sl("transitionend"),AM=new Map,U0="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");U0.push("scrollEnd");function ws(a,l){AM.set(a,l),de(l,[a])}var Qp=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},ss=[],Gu=0,O0=0;function Zp(){for(var a=Gu,l=O0=Gu=0;l<a;){var f=ss[l];ss[l++]=null;var m=ss[l];ss[l++]=null;var y=ss[l];ss[l++]=null;var S=ss[l];if(ss[l++]=null,m!==null&&y!==null){var A=m.pending;A===null?y.next=y:(y.next=A.next,A.next=y),m.pending=y}S!==0&&wM(f,y,S)}}function Jp(a,l,f,m){ss[Gu++]=a,ss[Gu++]=l,ss[Gu++]=f,ss[Gu++]=m,O0|=m,a.lanes|=m,a=a.alternate,a!==null&&(a.lanes|=m)}function B0(a,l,f,m){return Jp(a,l,f,m),em(a)}function Tl(a,l){return Jp(a,null,null,l),em(a)}function wM(a,l,f){a.lanes|=f;var m=a.alternate;m!==null&&(m.lanes|=f);for(var y=!1,S=a.return;S!==null;)S.childLanes|=f,m=S.alternate,m!==null&&(m.childLanes|=f),S.tag===22&&(a=S.stateNode,a===null||a._visibility&1||(y=!0)),a=S,S=S.return;return a.tag===3?(S=a.stateNode,y&&l!==null&&(y=31-Ke(f),a=S.hiddenUpdates,m=a[y],m===null?a[y]=[l]:m.push(l),l.lane=f|536870912),S):null}function em(a){if(50<Ff)throw Ff=0,qv=null,Error(n(185));for(var l=a.return;l!==null;)a=l,l=a.return;return a.tag===3?a.stateNode:null}var ku={};function CP(a,l,f,m){this.tag=a,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gr(a,l,f,m){return new CP(a,l,f,m)}function F0(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Aa(a,l){var f=a.alternate;return f===null?(f=Gr(a.tag,l,a.key,a.mode),f.elementType=a.elementType,f.type=a.type,f.stateNode=a.stateNode,f.alternate=a,a.alternate=f):(f.pendingProps=l,f.type=a.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=a.flags&65011712,f.childLanes=a.childLanes,f.lanes=a.lanes,f.child=a.child,f.memoizedProps=a.memoizedProps,f.memoizedState=a.memoizedState,f.updateQueue=a.updateQueue,l=a.dependencies,f.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},f.sibling=a.sibling,f.index=a.index,f.ref=a.ref,f.refCleanup=a.refCleanup,f}function RM(a,l){a.flags&=65011714;var f=a.alternate;return f===null?(a.childLanes=0,a.lanes=l,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=f.childLanes,a.lanes=f.lanes,a.child=f.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=f.memoizedProps,a.memoizedState=f.memoizedState,a.updateQueue=f.updateQueue,a.type=f.type,l=f.dependencies,a.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),a}function tm(a,l,f,m,y,S){var A=0;if(m=a,typeof a=="function")F0(a)&&(A=1);else if(typeof a=="string")A=UU(a,f,Ne.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case R:return a=Gr(31,f,l,y),a.elementType=R,a.lanes=S,a;case T:return Ml(f.children,y,S,l);case b:A=8,y|=24;break;case x:return a=Gr(12,f,l,y|2),a.elementType=x,a.lanes=S,a;case C:return a=Gr(13,f,l,y),a.elementType=C,a.lanes=S,a;case N:return a=Gr(19,f,l,y),a.elementType=N,a.lanes=S,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case E:A=10;break e;case M:A=9;break e;case w:A=11;break e;case D:A=14;break e;case U:A=16,m=null;break e}A=29,f=Error(n(130,a===null?"null":typeof a,"")),m=null}return l=Gr(A,f,l,y),l.elementType=a,l.type=m,l.lanes=S,l}function Ml(a,l,f,m){return a=Gr(7,a,m,l),a.lanes=f,a}function I0(a,l,f){return a=Gr(6,a,null,l),a.lanes=f,a}function CM(a){var l=Gr(18,null,null,0);return l.stateNode=a,l}function z0(a,l,f){return l=Gr(4,a.children!==null?a.children:[],a.key,l),l.lanes=f,l.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},l}var NM=new WeakMap;function as(a,l){if(typeof a=="object"&&a!==null){var f=NM.get(a);return f!==void 0?f:(l={value:a,source:l,stack:K(l)},NM.set(a,l),l)}return{value:a,source:l,stack:K(l)}}var Vu=[],Hu=0,nm=null,gf=0,os=[],ls=0,So=null,$s=1,js="";function wa(a,l){Vu[Hu++]=gf,Vu[Hu++]=nm,nm=a,gf=l}function DM(a,l,f){os[ls++]=$s,os[ls++]=js,os[ls++]=So,So=a;var m=$s;a=js;var y=32-Ke(m)-1;m&=~(1<<y),f+=1;var S=32-Ke(l)+y;if(30<S){var A=y-y%5;S=(m&(1<<A)-1).toString(32),m>>=A,y-=A,$s=1<<32-Ke(l)+y|f<<y|m,js=S+a}else $s=1<<S|f<<y|m,js=a}function G0(a){a.return!==null&&(wa(a,1),DM(a,1,0))}function k0(a){for(;a===nm;)nm=Vu[--Hu],Vu[Hu]=null,gf=Vu[--Hu],Vu[Hu]=null;for(;a===So;)So=os[--ls],os[ls]=null,js=os[--ls],os[ls]=null,$s=os[--ls],os[ls]=null}function LM(a,l){os[ls++]=$s,os[ls++]=js,os[ls++]=So,$s=l.id,js=l.overflow,So=a}var zi=null,Wn=null,Zt=!1,To=null,us=!1,V0=Error(n(519));function Mo(a){var l=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw _f(as(l,a)),V0}function PM(a){var l=a.stateNode,f=a.type,m=a.memoizedProps;switch(l[fi]=a,l[Pi]=m,f){case"dialog":jt("cancel",l),jt("close",l);break;case"iframe":case"object":case"embed":jt("load",l);break;case"video":case"audio":for(f=0;f<zf.length;f++)jt(zf[f],l);break;case"source":jt("error",l);break;case"img":case"image":case"link":jt("error",l),jt("load",l);break;case"details":jt("toggle",l);break;case"input":jt("invalid",l),Ta(l,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":jt("invalid",l);break;case"textarea":jt("invalid",l),Bi(l,m.value,m.defaultValue,m.children)}f=m.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||l.textContent===""+f||m.suppressHydrationWarning===!0||KA(l.textContent,f)?(m.popover!=null&&(jt("beforetoggle",l),jt("toggle",l)),m.onScroll!=null&&jt("scroll",l),m.onScrollEnd!=null&&jt("scrollend",l),m.onClick!=null&&(l.onclick=Ma),l=!0):l=!1,l||Mo(a,!0)}function UM(a){for(zi=a.return;zi;)switch(zi.tag){case 5:case 31:case 13:us=!1;return;case 27:case 3:us=!0;return;default:zi=zi.return}}function Wu(a){if(a!==zi)return!1;if(!Zt)return UM(a),Zt=!0,!1;var l=a.tag,f;if((f=l!==3&&l!==27)&&((f=l===5)&&(f=a.type,f=!(f!=="form"&&f!=="button")||ay(a.type,a.memoizedProps)),f=!f),f&&Wn&&Mo(a),UM(a),l===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));Wn=s1(a)}else if(l===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));Wn=s1(a)}else l===27?(l=Wn,Io(a.type)?(a=hy,hy=null,Wn=a):Wn=l):Wn=zi?hs(a.stateNode.nextSibling):null;return!0}function El(){Wn=zi=null,Zt=!1}function H0(){var a=To;return a!==null&&(Mr===null?Mr=a:Mr.push.apply(Mr,a),To=null),a}function _f(a){To===null?To=[a]:To.push(a)}var W0=O(null),Al=null,Ra=null;function Eo(a,l,f){ue(W0,l._currentValue),l._currentValue=f}function Ca(a){a._currentValue=W0.current,Y(W0)}function q0(a,l,f){for(;a!==null;){var m=a.alternate;if((a.childLanes&l)!==l?(a.childLanes|=l,m!==null&&(m.childLanes|=l)):m!==null&&(m.childLanes&l)!==l&&(m.childLanes|=l),a===f)break;a=a.return}}function $0(a,l,f,m){var y=a.child;for(y!==null&&(y.return=a);y!==null;){var S=y.dependencies;if(S!==null){var A=y.child;S=S.firstContext;e:for(;S!==null;){var B=S;S=y;for(var $=0;$<l.length;$++)if(B.context===l[$]){S.lanes|=f,B=S.alternate,B!==null&&(B.lanes|=f),q0(S.return,f,a),m||(A=null);break e}S=B.next}}else if(y.tag===18){if(A=y.return,A===null)throw Error(n(341));A.lanes|=f,S=A.alternate,S!==null&&(S.lanes|=f),q0(A,f,a),A=null}else A=y.child;if(A!==null)A.return=y;else for(A=y;A!==null;){if(A===a){A=null;break}if(y=A.sibling,y!==null){y.return=A.return,A=y;break}A=A.return}y=A}}function qu(a,l,f,m){a=null;for(var y=l,S=!1;y!==null;){if(!S){if((y.flags&524288)!==0)S=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var A=y.alternate;if(A===null)throw Error(n(387));if(A=A.memoizedProps,A!==null){var B=y.type;zr(y.pendingProps.value,A.value)||(a!==null?a.push(B):a=[B])}}else if(y===ie.current){if(A=y.alternate,A===null)throw Error(n(387));A.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(a!==null?a.push(Wf):a=[Wf])}y=y.return}a!==null&&$0(l,a,f,m),l.flags|=262144}function im(a){for(a=a.firstContext;a!==null;){if(!zr(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function wl(a){Al=a,Ra=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Gi(a){return OM(Al,a)}function rm(a,l){return Al===null&&wl(a),OM(a,l)}function OM(a,l){var f=l._currentValue;if(l={context:l,memoizedValue:f,next:null},Ra===null){if(a===null)throw Error(n(308));Ra=l,a.dependencies={lanes:0,firstContext:l},a.flags|=524288}else Ra=Ra.next=l;return f}var NP=typeof AbortController<"u"?AbortController:function(){var a=[],l=this.signal={aborted:!1,addEventListener:function(f,m){a.push(m)}};this.abort=function(){l.aborted=!0,a.forEach(function(f){return f()})}},DP=i.unstable_scheduleCallback,LP=i.unstable_NormalPriority,di={$$typeof:E,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function j0(){return{controller:new NP,data:new Map,refCount:0}}function vf(a){a.refCount--,a.refCount===0&&DP(LP,function(){a.controller.abort()})}var yf=null,X0=0,$u=0,ju=null;function PP(a,l){if(yf===null){var f=yf=[];X0=0,$u=Qv(),ju={status:"pending",value:void 0,then:function(m){f.push(m)}}}return X0++,l.then(BM,BM),l}function BM(){if(--X0===0&&yf!==null){ju!==null&&(ju.status="fulfilled");var a=yf;yf=null,$u=0,ju=null;for(var l=0;l<a.length;l++)(0,a[l])()}}function UP(a,l){var f=[],m={status:"pending",value:null,reason:null,then:function(y){f.push(y)}};return a.then(function(){m.status="fulfilled",m.value=l;for(var y=0;y<f.length;y++)(0,f[y])(l)},function(y){for(m.status="rejected",m.reason=y,y=0;y<f.length;y++)(0,f[y])(void 0)}),m}var FM=G.S;G.S=function(a,l){xA=L(),typeof l=="object"&&l!==null&&typeof l.then=="function"&&PP(a,l),FM!==null&&FM(a,l)};var Rl=O(null);function Y0(){var a=Rl.current;return a!==null?a:Un.pooledCache}function sm(a,l){l===null?ue(Rl,Rl.current):ue(Rl,l.pool)}function IM(){var a=Y0();return a===null?null:{parent:di._currentValue,pool:a}}var Xu=Error(n(460)),K0=Error(n(474)),am=Error(n(542)),om={then:function(){}};function zM(a){return a=a.status,a==="fulfilled"||a==="rejected"}function GM(a,l,f){switch(f=a[f],f===void 0?a.push(l):f!==l&&(l.then(Ma,Ma),l=f),l.status){case"fulfilled":return l.value;case"rejected":throw a=l.reason,VM(a),a;default:if(typeof l.status=="string")l.then(Ma,Ma);else{if(a=Un,a!==null&&100<a.shellSuspendCounter)throw Error(n(482));a=l,a.status="pending",a.then(function(m){if(l.status==="pending"){var y=l;y.status="fulfilled",y.value=m}},function(m){if(l.status==="pending"){var y=l;y.status="rejected",y.reason=m}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw a=l.reason,VM(a),a}throw Nl=l,Xu}}function Cl(a){try{var l=a._init;return l(a._payload)}catch(f){throw f!==null&&typeof f=="object"&&typeof f.then=="function"?(Nl=f,Xu):f}}var Nl=null;function kM(){if(Nl===null)throw Error(n(459));var a=Nl;return Nl=null,a}function VM(a){if(a===Xu||a===am)throw Error(n(483))}var Yu=null,xf=0;function lm(a){var l=xf;return xf+=1,Yu===null&&(Yu=[]),GM(Yu,a,l)}function bf(a,l){l=l.props.ref,a.ref=l!==void 0?l:null}function um(a,l){throw l.$$typeof===g?Error(n(525)):(a=Object.prototype.toString.call(l),Error(n(31,a==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":a)))}function HM(a){function l(ae,Q){if(a){var he=ae.deletions;he===null?(ae.deletions=[Q],ae.flags|=16):he.push(Q)}}function f(ae,Q){if(!a)return null;for(;Q!==null;)l(ae,Q),Q=Q.sibling;return null}function m(ae){for(var Q=new Map;ae!==null;)ae.key!==null?Q.set(ae.key,ae):Q.set(ae.index,ae),ae=ae.sibling;return Q}function y(ae,Q){return ae=Aa(ae,Q),ae.index=0,ae.sibling=null,ae}function S(ae,Q,he){return ae.index=he,a?(he=ae.alternate,he!==null?(he=he.index,he<Q?(ae.flags|=67108866,Q):he):(ae.flags|=67108866,Q)):(ae.flags|=1048576,Q)}function A(ae){return a&&ae.alternate===null&&(ae.flags|=67108866),ae}function B(ae,Q,he,we){return Q===null||Q.tag!==6?(Q=I0(he,ae.mode,we),Q.return=ae,Q):(Q=y(Q,he),Q.return=ae,Q)}function $(ae,Q,he,we){var gt=he.type;return gt===T?Me(ae,Q,he.props.children,we,he.key):Q!==null&&(Q.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===U&&Cl(gt)===Q.type)?(Q=y(Q,he.props),bf(Q,he),Q.return=ae,Q):(Q=tm(he.type,he.key,he.props,null,ae.mode,we),bf(Q,he),Q.return=ae,Q)}function fe(ae,Q,he,we){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==he.containerInfo||Q.stateNode.implementation!==he.implementation?(Q=z0(he,ae.mode,we),Q.return=ae,Q):(Q=y(Q,he.children||[]),Q.return=ae,Q)}function Me(ae,Q,he,we,gt){return Q===null||Q.tag!==7?(Q=Ml(he,ae.mode,we,gt),Q.return=ae,Q):(Q=y(Q,he),Q.return=ae,Q)}function Ce(ae,Q,he){if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return Q=I0(""+Q,ae.mode,he),Q.return=ae,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case _:return he=tm(Q.type,Q.key,Q.props,null,ae.mode,he),bf(he,Q),he.return=ae,he;case v:return Q=z0(Q,ae.mode,he),Q.return=ae,Q;case U:return Q=Cl(Q),Ce(ae,Q,he)}if(ne(Q)||H(Q))return Q=Ml(Q,ae.mode,he,null),Q.return=ae,Q;if(typeof Q.then=="function")return Ce(ae,lm(Q),he);if(Q.$$typeof===E)return Ce(ae,rm(ae,Q),he);um(ae,Q)}return null}function pe(ae,Q,he,we){var gt=Q!==null?Q.key:null;if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return gt!==null?null:B(ae,Q,""+he,we);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case _:return he.key===gt?$(ae,Q,he,we):null;case v:return he.key===gt?fe(ae,Q,he,we):null;case U:return he=Cl(he),pe(ae,Q,he,we)}if(ne(he)||H(he))return gt!==null?null:Me(ae,Q,he,we,null);if(typeof he.then=="function")return pe(ae,Q,lm(he),we);if(he.$$typeof===E)return pe(ae,Q,rm(ae,he),we);um(ae,he)}return null}function _e(ae,Q,he,we,gt){if(typeof we=="string"&&we!==""||typeof we=="number"||typeof we=="bigint")return ae=ae.get(he)||null,B(Q,ae,""+we,gt);if(typeof we=="object"&&we!==null){switch(we.$$typeof){case _:return ae=ae.get(we.key===null?he:we.key)||null,$(Q,ae,we,gt);case v:return ae=ae.get(we.key===null?he:we.key)||null,fe(Q,ae,we,gt);case U:return we=Cl(we),_e(ae,Q,he,we,gt)}if(ne(we)||H(we))return ae=ae.get(he)||null,Me(Q,ae,we,gt,null);if(typeof we.then=="function")return _e(ae,Q,he,lm(we),gt);if(we.$$typeof===E)return _e(ae,Q,he,rm(Q,we),gt);um(Q,we)}return null}function rt(ae,Q,he,we){for(var gt=null,an=null,ut=Q,kt=Q=0,Qt=null;ut!==null&&kt<he.length;kt++){ut.index>kt?(Qt=ut,ut=null):Qt=ut.sibling;var on=pe(ae,ut,he[kt],we);if(on===null){ut===null&&(ut=Qt);break}a&&ut&&on.alternate===null&&l(ae,ut),Q=S(on,Q,kt),an===null?gt=on:an.sibling=on,an=on,ut=Qt}if(kt===he.length)return f(ae,ut),Zt&&wa(ae,kt),gt;if(ut===null){for(;kt<he.length;kt++)ut=Ce(ae,he[kt],we),ut!==null&&(Q=S(ut,Q,kt),an===null?gt=ut:an.sibling=ut,an=ut);return Zt&&wa(ae,kt),gt}for(ut=m(ut);kt<he.length;kt++)Qt=_e(ut,ae,kt,he[kt],we),Qt!==null&&(a&&Qt.alternate!==null&&ut.delete(Qt.key===null?kt:Qt.key),Q=S(Qt,Q,kt),an===null?gt=Qt:an.sibling=Qt,an=Qt);return a&&ut.forEach(function(Ho){return l(ae,Ho)}),Zt&&wa(ae,kt),gt}function Tt(ae,Q,he,we){if(he==null)throw Error(n(151));for(var gt=null,an=null,ut=Q,kt=Q=0,Qt=null,on=he.next();ut!==null&&!on.done;kt++,on=he.next()){ut.index>kt?(Qt=ut,ut=null):Qt=ut.sibling;var Ho=pe(ae,ut,on.value,we);if(Ho===null){ut===null&&(ut=Qt);break}a&&ut&&Ho.alternate===null&&l(ae,ut),Q=S(Ho,Q,kt),an===null?gt=Ho:an.sibling=Ho,an=Ho,ut=Qt}if(on.done)return f(ae,ut),Zt&&wa(ae,kt),gt;if(ut===null){for(;!on.done;kt++,on=he.next())on=Ce(ae,on.value,we),on!==null&&(Q=S(on,Q,kt),an===null?gt=on:an.sibling=on,an=on);return Zt&&wa(ae,kt),gt}for(ut=m(ut);!on.done;kt++,on=he.next())on=_e(ut,ae,kt,on.value,we),on!==null&&(a&&on.alternate!==null&&ut.delete(on.key===null?kt:on.key),Q=S(on,Q,kt),an===null?gt=on:an.sibling=on,an=on);return a&&ut.forEach(function(qU){return l(ae,qU)}),Zt&&wa(ae,kt),gt}function Nn(ae,Q,he,we){if(typeof he=="object"&&he!==null&&he.type===T&&he.key===null&&(he=he.props.children),typeof he=="object"&&he!==null){switch(he.$$typeof){case _:e:{for(var gt=he.key;Q!==null;){if(Q.key===gt){if(gt=he.type,gt===T){if(Q.tag===7){f(ae,Q.sibling),we=y(Q,he.props.children),we.return=ae,ae=we;break e}}else if(Q.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===U&&Cl(gt)===Q.type){f(ae,Q.sibling),we=y(Q,he.props),bf(we,he),we.return=ae,ae=we;break e}f(ae,Q);break}else l(ae,Q);Q=Q.sibling}he.type===T?(we=Ml(he.props.children,ae.mode,we,he.key),we.return=ae,ae=we):(we=tm(he.type,he.key,he.props,null,ae.mode,we),bf(we,he),we.return=ae,ae=we)}return A(ae);case v:e:{for(gt=he.key;Q!==null;){if(Q.key===gt)if(Q.tag===4&&Q.stateNode.containerInfo===he.containerInfo&&Q.stateNode.implementation===he.implementation){f(ae,Q.sibling),we=y(Q,he.children||[]),we.return=ae,ae=we;break e}else{f(ae,Q);break}else l(ae,Q);Q=Q.sibling}we=z0(he,ae.mode,we),we.return=ae,ae=we}return A(ae);case U:return he=Cl(he),Nn(ae,Q,he,we)}if(ne(he))return rt(ae,Q,he,we);if(H(he)){if(gt=H(he),typeof gt!="function")throw Error(n(150));return he=gt.call(he),Tt(ae,Q,he,we)}if(typeof he.then=="function")return Nn(ae,Q,lm(he),we);if(he.$$typeof===E)return Nn(ae,Q,rm(ae,he),we);um(ae,he)}return typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint"?(he=""+he,Q!==null&&Q.tag===6?(f(ae,Q.sibling),we=y(Q,he),we.return=ae,ae=we):(f(ae,Q),we=I0(he,ae.mode,we),we.return=ae,ae=we),A(ae)):f(ae,Q)}return function(ae,Q,he,we){try{xf=0;var gt=Nn(ae,Q,he,we);return Yu=null,gt}catch(ut){if(ut===Xu||ut===am)throw ut;var an=Gr(29,ut,null,ae.mode);return an.lanes=we,an.return=ae,an}}}var Dl=HM(!0),WM=HM(!1),Ao=!1;function Q0(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Z0(a,l){a=a.updateQueue,l.updateQueue===a&&(l.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function wo(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Ro(a,l,f){var m=a.updateQueue;if(m===null)return null;if(m=m.shared,(fn&2)!==0){var y=m.pending;return y===null?l.next=l:(l.next=y.next,y.next=l),m.pending=l,l=em(a),wM(a,null,f),l}return Jp(a,m,l,f),em(a)}function Sf(a,l,f){if(l=l.updateQueue,l!==null&&(l=l.shared,(f&4194048)!==0)){var m=l.lanes;m&=a.pendingLanes,f|=m,l.lanes=f,tf(a,f)}}function J0(a,l){var f=a.updateQueue,m=a.alternate;if(m!==null&&(m=m.updateQueue,f===m)){var y=null,S=null;if(f=f.firstBaseUpdate,f!==null){do{var A={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};S===null?y=S=A:S=S.next=A,f=f.next}while(f!==null);S===null?y=S=l:S=S.next=l}else y=S=l;f={baseState:m.baseState,firstBaseUpdate:y,lastBaseUpdate:S,shared:m.shared,callbacks:m.callbacks},a.updateQueue=f;return}a=f.lastBaseUpdate,a===null?f.firstBaseUpdate=l:a.next=l,f.lastBaseUpdate=l}var ev=!1;function Tf(){if(ev){var a=ju;if(a!==null)throw a}}function Mf(a,l,f,m){ev=!1;var y=a.updateQueue;Ao=!1;var S=y.firstBaseUpdate,A=y.lastBaseUpdate,B=y.shared.pending;if(B!==null){y.shared.pending=null;var $=B,fe=$.next;$.next=null,A===null?S=fe:A.next=fe,A=$;var Me=a.alternate;Me!==null&&(Me=Me.updateQueue,B=Me.lastBaseUpdate,B!==A&&(B===null?Me.firstBaseUpdate=fe:B.next=fe,Me.lastBaseUpdate=$))}if(S!==null){var Ce=y.baseState;A=0,Me=fe=$=null,B=S;do{var pe=B.lane&-536870913,_e=pe!==B.lane;if(_e?(Kt&pe)===pe:(m&pe)===pe){pe!==0&&pe===$u&&(ev=!0),Me!==null&&(Me=Me.next={lane:0,tag:B.tag,payload:B.payload,callback:null,next:null});e:{var rt=a,Tt=B;pe=l;var Nn=f;switch(Tt.tag){case 1:if(rt=Tt.payload,typeof rt=="function"){Ce=rt.call(Nn,Ce,pe);break e}Ce=rt;break e;case 3:rt.flags=rt.flags&-65537|128;case 0:if(rt=Tt.payload,pe=typeof rt=="function"?rt.call(Nn,Ce,pe):rt,pe==null)break e;Ce=p({},Ce,pe);break e;case 2:Ao=!0}}pe=B.callback,pe!==null&&(a.flags|=64,_e&&(a.flags|=8192),_e=y.callbacks,_e===null?y.callbacks=[pe]:_e.push(pe))}else _e={lane:pe,tag:B.tag,payload:B.payload,callback:B.callback,next:null},Me===null?(fe=Me=_e,$=Ce):Me=Me.next=_e,A|=pe;if(B=B.next,B===null){if(B=y.shared.pending,B===null)break;_e=B,B=_e.next,_e.next=null,y.lastBaseUpdate=_e,y.shared.pending=null}}while(!0);Me===null&&($=Ce),y.baseState=$,y.firstBaseUpdate=fe,y.lastBaseUpdate=Me,S===null&&(y.shared.lanes=0),Po|=A,a.lanes=A,a.memoizedState=Ce}}function qM(a,l){if(typeof a!="function")throw Error(n(191,a));a.call(l)}function $M(a,l){var f=a.callbacks;if(f!==null)for(a.callbacks=null,a=0;a<f.length;a++)qM(f[a],l)}var Ku=O(null),cm=O(0);function jM(a,l){a=Ia,ue(cm,a),ue(Ku,l),Ia=a|l.baseLanes}function tv(){ue(cm,Ia),ue(Ku,Ku.current)}function nv(){Ia=cm.current,Y(Ku),Y(cm)}var kr=O(null),cs=null;function Co(a){var l=a.alternate;ue(ai,ai.current&1),ue(kr,a),cs===null&&(l===null||Ku.current!==null||l.memoizedState!==null)&&(cs=a)}function iv(a){ue(ai,ai.current),ue(kr,a),cs===null&&(cs=a)}function XM(a){a.tag===22?(ue(ai,ai.current),ue(kr,a),cs===null&&(cs=a)):No()}function No(){ue(ai,ai.current),ue(kr,kr.current)}function Vr(a){Y(kr),cs===a&&(cs=null),Y(ai)}var ai=O(0);function hm(a){for(var l=a;l!==null;){if(l.tag===13){var f=l.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||uy(f)||cy(f)))return l}else if(l.tag===19&&(l.memoizedProps.revealOrder==="forwards"||l.memoizedProps.revealOrder==="backwards"||l.memoizedProps.revealOrder==="unstable_legacy-backwards"||l.memoizedProps.revealOrder==="together")){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var Na=0,Ft=null,Rn=null,pi=null,fm=!1,Qu=!1,Ll=!1,dm=0,Ef=0,Zu=null,OP=0;function ni(){throw Error(n(321))}function rv(a,l){if(l===null)return!1;for(var f=0;f<l.length&&f<a.length;f++)if(!zr(a[f],l[f]))return!1;return!0}function sv(a,l,f,m,y,S){return Na=S,Ft=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,G.H=a===null||a.memoizedState===null?DE:xv,Ll=!1,S=f(m,y),Ll=!1,Qu&&(S=KM(l,f,m,y)),YM(a),S}function YM(a){G.H=Rf;var l=Rn!==null&&Rn.next!==null;if(Na=0,pi=Rn=Ft=null,fm=!1,Ef=0,Zu=null,l)throw Error(n(300));a===null||mi||(a=a.dependencies,a!==null&&im(a)&&(mi=!0))}function KM(a,l,f,m){Ft=a;var y=0;do{if(Qu&&(Zu=null),Ef=0,Qu=!1,25<=y)throw Error(n(301));if(y+=1,pi=Rn=null,a.updateQueue!=null){var S=a.updateQueue;S.lastEffect=null,S.events=null,S.stores=null,S.memoCache!=null&&(S.memoCache.index=0)}G.H=LE,S=l(f,m)}while(Qu);return S}function BP(){var a=G.H,l=a.useState()[0];return l=typeof l.then=="function"?Af(l):l,a=a.useState()[0],(Rn!==null?Rn.memoizedState:null)!==a&&(Ft.flags|=1024),l}function av(){var a=dm!==0;return dm=0,a}function ov(a,l,f){l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~f}function lv(a){if(fm){for(a=a.memoizedState;a!==null;){var l=a.queue;l!==null&&(l.pending=null),a=a.next}fm=!1}Na=0,pi=Rn=Ft=null,Qu=!1,Ef=dm=0,Zu=null}function lr(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pi===null?Ft.memoizedState=pi=a:pi=pi.next=a,pi}function oi(){if(Rn===null){var a=Ft.alternate;a=a!==null?a.memoizedState:null}else a=Rn.next;var l=pi===null?Ft.memoizedState:pi.next;if(l!==null)pi=l,Rn=a;else{if(a===null)throw Ft.alternate===null?Error(n(467)):Error(n(310));Rn=a,a={memoizedState:Rn.memoizedState,baseState:Rn.baseState,baseQueue:Rn.baseQueue,queue:Rn.queue,next:null},pi===null?Ft.memoizedState=pi=a:pi=pi.next=a}return pi}function pm(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Af(a){var l=Ef;return Ef+=1,Zu===null&&(Zu=[]),a=GM(Zu,a,l),l=Ft,(pi===null?l.memoizedState:pi.next)===null&&(l=l.alternate,G.H=l===null||l.memoizedState===null?DE:xv),a}function mm(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Af(a);if(a.$$typeof===E)return Gi(a)}throw Error(n(438,String(a)))}function uv(a){var l=null,f=Ft.updateQueue;if(f!==null&&(l=f.memoCache),l==null){var m=Ft.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(l={data:m.data.map(function(y){return y.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),f===null&&(f=pm(),Ft.updateQueue=f),f.memoCache=l,f=l.data[l.index],f===void 0)for(f=l.data[l.index]=Array(a),m=0;m<a;m++)f[m]=P;return l.index++,f}function Da(a,l){return typeof l=="function"?l(a):l}function gm(a){var l=oi();return cv(l,Rn,a)}function cv(a,l,f){var m=a.queue;if(m===null)throw Error(n(311));m.lastRenderedReducer=f;var y=a.baseQueue,S=m.pending;if(S!==null){if(y!==null){var A=y.next;y.next=S.next,S.next=A}l.baseQueue=y=S,m.pending=null}if(S=a.baseState,y===null)a.memoizedState=S;else{l=y.next;var B=A=null,$=null,fe=l,Me=!1;do{var Ce=fe.lane&-536870913;if(Ce!==fe.lane?(Kt&Ce)===Ce:(Na&Ce)===Ce){var pe=fe.revertLane;if(pe===0)$!==null&&($=$.next={lane:0,revertLane:0,gesture:null,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null}),Ce===$u&&(Me=!0);else if((Na&pe)===pe){fe=fe.next,pe===$u&&(Me=!0);continue}else Ce={lane:0,revertLane:fe.revertLane,gesture:null,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},$===null?(B=$=Ce,A=S):$=$.next=Ce,Ft.lanes|=pe,Po|=pe;Ce=fe.action,Ll&&f(S,Ce),S=fe.hasEagerState?fe.eagerState:f(S,Ce)}else pe={lane:Ce,revertLane:fe.revertLane,gesture:fe.gesture,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},$===null?(B=$=pe,A=S):$=$.next=pe,Ft.lanes|=Ce,Po|=Ce;fe=fe.next}while(fe!==null&&fe!==l);if($===null?A=S:$.next=B,!zr(S,a.memoizedState)&&(mi=!0,Me&&(f=ju,f!==null)))throw f;a.memoizedState=S,a.baseState=A,a.baseQueue=$,m.lastRenderedState=S}return y===null&&(m.lanes=0),[a.memoizedState,m.dispatch]}function hv(a){var l=oi(),f=l.queue;if(f===null)throw Error(n(311));f.lastRenderedReducer=a;var m=f.dispatch,y=f.pending,S=l.memoizedState;if(y!==null){f.pending=null;var A=y=y.next;do S=a(S,A.action),A=A.next;while(A!==y);zr(S,l.memoizedState)||(mi=!0),l.memoizedState=S,l.baseQueue===null&&(l.baseState=S),f.lastRenderedState=S}return[S,m]}function QM(a,l,f){var m=Ft,y=oi(),S=Zt;if(S){if(f===void 0)throw Error(n(407));f=f()}else f=l();var A=!zr((Rn||y).memoizedState,f);if(A&&(y.memoizedState=f,mi=!0),y=y.queue,pv(eE.bind(null,m,y,a),[a]),y.getSnapshot!==l||A||pi!==null&&pi.memoizedState.tag&1){if(m.flags|=2048,Ju(9,{destroy:void 0},JM.bind(null,m,y,f,l),null),Un===null)throw Error(n(349));S||(Na&127)!==0||ZM(m,l,f)}return f}function ZM(a,l,f){a.flags|=16384,a={getSnapshot:l,value:f},l=Ft.updateQueue,l===null?(l=pm(),Ft.updateQueue=l,l.stores=[a]):(f=l.stores,f===null?l.stores=[a]:f.push(a))}function JM(a,l,f,m){l.value=f,l.getSnapshot=m,tE(l)&&nE(a)}function eE(a,l,f){return f(function(){tE(l)&&nE(a)})}function tE(a){var l=a.getSnapshot;a=a.value;try{var f=l();return!zr(a,f)}catch{return!0}}function nE(a){var l=Tl(a,2);l!==null&&Er(l,a,2)}function fv(a){var l=lr();if(typeof a=="function"){var f=a;if(a=f(),Ll){Je(!0);try{f()}finally{Je(!1)}}}return l.memoizedState=l.baseState=a,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Da,lastRenderedState:a},l}function iE(a,l,f,m){return a.baseState=f,cv(a,Rn,typeof m=="function"?m:Da)}function FP(a,l,f,m,y){if(ym(a))throw Error(n(485));if(a=l.action,a!==null){var S={payload:y,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(A){S.listeners.push(A)}};G.T!==null?f(!0):S.isTransition=!1,m(S),f=l.pending,f===null?(S.next=l.pending=S,rE(l,S)):(S.next=f.next,l.pending=f.next=S)}}function rE(a,l){var f=l.action,m=l.payload,y=a.state;if(l.isTransition){var S=G.T,A={};G.T=A;try{var B=f(y,m),$=G.S;$!==null&&$(A,B),sE(a,l,B)}catch(fe){dv(a,l,fe)}finally{S!==null&&A.types!==null&&(S.types=A.types),G.T=S}}else try{S=f(y,m),sE(a,l,S)}catch(fe){dv(a,l,fe)}}function sE(a,l,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(m){aE(a,l,m)},function(m){return dv(a,l,m)}):aE(a,l,f)}function aE(a,l,f){l.status="fulfilled",l.value=f,oE(l),a.state=f,l=a.pending,l!==null&&(f=l.next,f===l?a.pending=null:(f=f.next,l.next=f,rE(a,f)))}function dv(a,l,f){var m=a.pending;if(a.pending=null,m!==null){m=m.next;do l.status="rejected",l.reason=f,oE(l),l=l.next;while(l!==m)}a.action=null}function oE(a){a=a.listeners;for(var l=0;l<a.length;l++)(0,a[l])()}function lE(a,l){return l}function uE(a,l){if(Zt){var f=Un.formState;if(f!==null){e:{var m=Ft;if(Zt){if(Wn){t:{for(var y=Wn,S=us;y.nodeType!==8;){if(!S){y=null;break t}if(y=hs(y.nextSibling),y===null){y=null;break t}}S=y.data,y=S==="F!"||S==="F"?y:null}if(y){Wn=hs(y.nextSibling),m=y.data==="F!";break e}}Mo(m)}m=!1}m&&(l=f[0])}}return f=lr(),f.memoizedState=f.baseState=l,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:lE,lastRenderedState:l},f.queue=m,f=RE.bind(null,Ft,m),m.dispatch=f,m=fv(!1),S=yv.bind(null,Ft,!1,m.queue),m=lr(),y={state:l,dispatch:null,action:a,pending:null},m.queue=y,f=FP.bind(null,Ft,y,S,f),y.dispatch=f,m.memoizedState=a,[l,f,!1]}function cE(a){var l=oi();return hE(l,Rn,a)}function hE(a,l,f){if(l=cv(a,l,lE)[0],a=gm(Da)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var m=Af(l)}catch(A){throw A===Xu?am:A}else m=l;l=oi();var y=l.queue,S=y.dispatch;return f!==l.memoizedState&&(Ft.flags|=2048,Ju(9,{destroy:void 0},IP.bind(null,y,f),null)),[m,S,a]}function IP(a,l){a.action=l}function fE(a){var l=oi(),f=Rn;if(f!==null)return hE(l,f,a);oi(),l=l.memoizedState,f=oi();var m=f.queue.dispatch;return f.memoizedState=a,[l,m,!1]}function Ju(a,l,f,m){return a={tag:a,create:f,deps:m,inst:l,next:null},l=Ft.updateQueue,l===null&&(l=pm(),Ft.updateQueue=l),f=l.lastEffect,f===null?l.lastEffect=a.next=a:(m=f.next,f.next=a,a.next=m,l.lastEffect=a),a}function dE(){return oi().memoizedState}function _m(a,l,f,m){var y=lr();Ft.flags|=a,y.memoizedState=Ju(1|l,{destroy:void 0},f,m===void 0?null:m)}function vm(a,l,f,m){var y=oi();m=m===void 0?null:m;var S=y.memoizedState.inst;Rn!==null&&m!==null&&rv(m,Rn.memoizedState.deps)?y.memoizedState=Ju(l,S,f,m):(Ft.flags|=a,y.memoizedState=Ju(1|l,S,f,m))}function pE(a,l){_m(8390656,8,a,l)}function pv(a,l){vm(2048,8,a,l)}function zP(a){Ft.flags|=4;var l=Ft.updateQueue;if(l===null)l=pm(),Ft.updateQueue=l,l.events=[a];else{var f=l.events;f===null?l.events=[a]:f.push(a)}}function mE(a){var l=oi().memoizedState;return zP({ref:l,nextImpl:a}),function(){if((fn&2)!==0)throw Error(n(440));return l.impl.apply(void 0,arguments)}}function gE(a,l){return vm(4,2,a,l)}function _E(a,l){return vm(4,4,a,l)}function vE(a,l){if(typeof l=="function"){a=a();var f=l(a);return function(){typeof f=="function"?f():l(null)}}if(l!=null)return a=a(),l.current=a,function(){l.current=null}}function yE(a,l,f){f=f!=null?f.concat([a]):null,vm(4,4,vE.bind(null,l,a),f)}function mv(){}function xE(a,l){var f=oi();l=l===void 0?null:l;var m=f.memoizedState;return l!==null&&rv(l,m[1])?m[0]:(f.memoizedState=[a,l],a)}function bE(a,l){var f=oi();l=l===void 0?null:l;var m=f.memoizedState;if(l!==null&&rv(l,m[1]))return m[0];if(m=a(),Ll){Je(!0);try{a()}finally{Je(!1)}}return f.memoizedState=[m,l],m}function gv(a,l,f){return f===void 0||(Na&1073741824)!==0&&(Kt&261930)===0?a.memoizedState=l:(a.memoizedState=f,a=SA(),Ft.lanes|=a,Po|=a,f)}function SE(a,l,f,m){return zr(f,l)?f:Ku.current!==null?(a=gv(a,f,m),zr(a,l)||(mi=!0),a):(Na&42)===0||(Na&1073741824)!==0&&(Kt&261930)===0?(mi=!0,a.memoizedState=f):(a=SA(),Ft.lanes|=a,Po|=a,l)}function TE(a,l,f,m,y){var S=z.p;z.p=S!==0&&8>S?S:8;var A=G.T,B={};G.T=B,yv(a,!1,l,f);try{var $=y(),fe=G.S;if(fe!==null&&fe(B,$),$!==null&&typeof $=="object"&&typeof $.then=="function"){var Me=UP($,m);wf(a,l,Me,qr(a))}else wf(a,l,m,qr(a))}catch(Ce){wf(a,l,{then:function(){},status:"rejected",reason:Ce},qr())}finally{z.p=S,A!==null&&B.types!==null&&(A.types=B.types),G.T=A}}function GP(){}function _v(a,l,f,m){if(a.tag!==5)throw Error(n(476));var y=ME(a).queue;TE(a,y,l,q,f===null?GP:function(){return EE(a),f(m)})}function ME(a){var l=a.memoizedState;if(l!==null)return l;l={memoizedState:q,baseState:q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Da,lastRenderedState:q},next:null};var f={};return l.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Da,lastRenderedState:f},next:null},a.memoizedState=l,a=a.alternate,a!==null&&(a.memoizedState=l),l}function EE(a){var l=ME(a);l.next===null&&(l=a.alternate.memoizedState),wf(a,l.next.queue,{},qr())}function vv(){return Gi(Wf)}function AE(){return oi().memoizedState}function wE(){return oi().memoizedState}function kP(a){for(var l=a.return;l!==null;){switch(l.tag){case 24:case 3:var f=qr();a=wo(f);var m=Ro(l,a,f);m!==null&&(Er(m,l,f),Sf(m,l,f)),l={cache:j0()},a.payload=l;return}l=l.return}}function VP(a,l,f){var m=qr();f={lane:m,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},ym(a)?CE(l,f):(f=B0(a,l,f,m),f!==null&&(Er(f,a,m),NE(f,l,m)))}function RE(a,l,f){var m=qr();wf(a,l,f,m)}function wf(a,l,f,m){var y={lane:m,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null};if(ym(a))CE(l,y);else{var S=a.alternate;if(a.lanes===0&&(S===null||S.lanes===0)&&(S=l.lastRenderedReducer,S!==null))try{var A=l.lastRenderedState,B=S(A,f);if(y.hasEagerState=!0,y.eagerState=B,zr(B,A))return Jp(a,l,y,0),Un===null&&Zp(),!1}catch{}if(f=B0(a,l,y,m),f!==null)return Er(f,a,m),NE(f,l,m),!0}return!1}function yv(a,l,f,m){if(m={lane:2,revertLane:Qv(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},ym(a)){if(l)throw Error(n(479))}else l=B0(a,f,m,2),l!==null&&Er(l,a,2)}function ym(a){var l=a.alternate;return a===Ft||l!==null&&l===Ft}function CE(a,l){Qu=fm=!0;var f=a.pending;f===null?l.next=l:(l.next=f.next,f.next=l),a.pending=l}function NE(a,l,f){if((f&4194048)!==0){var m=l.lanes;m&=a.pendingLanes,f|=m,l.lanes=f,tf(a,f)}}var Rf={readContext:Gi,use:mm,useCallback:ni,useContext:ni,useEffect:ni,useImperativeHandle:ni,useLayoutEffect:ni,useInsertionEffect:ni,useMemo:ni,useReducer:ni,useRef:ni,useState:ni,useDebugValue:ni,useDeferredValue:ni,useTransition:ni,useSyncExternalStore:ni,useId:ni,useHostTransitionStatus:ni,useFormState:ni,useActionState:ni,useOptimistic:ni,useMemoCache:ni,useCacheRefresh:ni};Rf.useEffectEvent=ni;var DE={readContext:Gi,use:mm,useCallback:function(a,l){return lr().memoizedState=[a,l===void 0?null:l],a},useContext:Gi,useEffect:pE,useImperativeHandle:function(a,l,f){f=f!=null?f.concat([a]):null,_m(4194308,4,vE.bind(null,l,a),f)},useLayoutEffect:function(a,l){return _m(4194308,4,a,l)},useInsertionEffect:function(a,l){_m(4,2,a,l)},useMemo:function(a,l){var f=lr();l=l===void 0?null:l;var m=a();if(Ll){Je(!0);try{a()}finally{Je(!1)}}return f.memoizedState=[m,l],m},useReducer:function(a,l,f){var m=lr();if(f!==void 0){var y=f(l);if(Ll){Je(!0);try{f(l)}finally{Je(!1)}}}else y=l;return m.memoizedState=m.baseState=y,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:y},m.queue=a,a=a.dispatch=VP.bind(null,Ft,a),[m.memoizedState,a]},useRef:function(a){var l=lr();return a={current:a},l.memoizedState=a},useState:function(a){a=fv(a);var l=a.queue,f=RE.bind(null,Ft,l);return l.dispatch=f,[a.memoizedState,f]},useDebugValue:mv,useDeferredValue:function(a,l){var f=lr();return gv(f,a,l)},useTransition:function(){var a=fv(!1);return a=TE.bind(null,Ft,a.queue,!0,!1),lr().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,l,f){var m=Ft,y=lr();if(Zt){if(f===void 0)throw Error(n(407));f=f()}else{if(f=l(),Un===null)throw Error(n(349));(Kt&127)!==0||ZM(m,l,f)}y.memoizedState=f;var S={value:f,getSnapshot:l};return y.queue=S,pE(eE.bind(null,m,S,a),[a]),m.flags|=2048,Ju(9,{destroy:void 0},JM.bind(null,m,S,f,l),null),f},useId:function(){var a=lr(),l=Un.identifierPrefix;if(Zt){var f=js,m=$s;f=(m&~(1<<32-Ke(m)-1)).toString(32)+f,l="_"+l+"R_"+f,f=dm++,0<f&&(l+="H"+f.toString(32)),l+="_"}else f=OP++,l="_"+l+"r_"+f.toString(32)+"_";return a.memoizedState=l},useHostTransitionStatus:vv,useFormState:uE,useActionState:uE,useOptimistic:function(a){var l=lr();l.memoizedState=l.baseState=a;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=f,l=yv.bind(null,Ft,!0,f),f.dispatch=l,[a,l]},useMemoCache:uv,useCacheRefresh:function(){return lr().memoizedState=kP.bind(null,Ft)},useEffectEvent:function(a){var l=lr(),f={impl:a};return l.memoizedState=f,function(){if((fn&2)!==0)throw Error(n(440));return f.impl.apply(void 0,arguments)}}},xv={readContext:Gi,use:mm,useCallback:xE,useContext:Gi,useEffect:pv,useImperativeHandle:yE,useInsertionEffect:gE,useLayoutEffect:_E,useMemo:bE,useReducer:gm,useRef:dE,useState:function(){return gm(Da)},useDebugValue:mv,useDeferredValue:function(a,l){var f=oi();return SE(f,Rn.memoizedState,a,l)},useTransition:function(){var a=gm(Da)[0],l=oi().memoizedState;return[typeof a=="boolean"?a:Af(a),l]},useSyncExternalStore:QM,useId:AE,useHostTransitionStatus:vv,useFormState:cE,useActionState:cE,useOptimistic:function(a,l){var f=oi();return iE(f,Rn,a,l)},useMemoCache:uv,useCacheRefresh:wE};xv.useEffectEvent=mE;var LE={readContext:Gi,use:mm,useCallback:xE,useContext:Gi,useEffect:pv,useImperativeHandle:yE,useInsertionEffect:gE,useLayoutEffect:_E,useMemo:bE,useReducer:hv,useRef:dE,useState:function(){return hv(Da)},useDebugValue:mv,useDeferredValue:function(a,l){var f=oi();return Rn===null?gv(f,a,l):SE(f,Rn.memoizedState,a,l)},useTransition:function(){var a=hv(Da)[0],l=oi().memoizedState;return[typeof a=="boolean"?a:Af(a),l]},useSyncExternalStore:QM,useId:AE,useHostTransitionStatus:vv,useFormState:fE,useActionState:fE,useOptimistic:function(a,l){var f=oi();return Rn!==null?iE(f,Rn,a,l):(f.baseState=a,[a,f.queue.dispatch])},useMemoCache:uv,useCacheRefresh:wE};LE.useEffectEvent=mE;function bv(a,l,f,m){l=a.memoizedState,f=f(m,l),f=f==null?l:p({},l,f),a.memoizedState=f,a.lanes===0&&(a.updateQueue.baseState=f)}var Sv={enqueueSetState:function(a,l,f){a=a._reactInternals;var m=qr(),y=wo(m);y.payload=l,f!=null&&(y.callback=f),l=Ro(a,y,m),l!==null&&(Er(l,a,m),Sf(l,a,m))},enqueueReplaceState:function(a,l,f){a=a._reactInternals;var m=qr(),y=wo(m);y.tag=1,y.payload=l,f!=null&&(y.callback=f),l=Ro(a,y,m),l!==null&&(Er(l,a,m),Sf(l,a,m))},enqueueForceUpdate:function(a,l){a=a._reactInternals;var f=qr(),m=wo(f);m.tag=2,l!=null&&(m.callback=l),l=Ro(a,m,f),l!==null&&(Er(l,a,f),Sf(l,a,f))}};function PE(a,l,f,m,y,S,A){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(m,S,A):l.prototype&&l.prototype.isPureReactComponent?!pf(f,m)||!pf(y,S):!0}function UE(a,l,f,m){a=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(f,m),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(f,m),l.state!==a&&Sv.enqueueReplaceState(l,l.state,null)}function Pl(a,l){var f=l;if("ref"in l){f={};for(var m in l)m!=="ref"&&(f[m]=l[m])}if(a=a.defaultProps){f===l&&(f=p({},f));for(var y in a)f[y]===void 0&&(f[y]=a[y])}return f}function OE(a){Qp(a)}function BE(a){console.error(a)}function FE(a){Qp(a)}function xm(a,l){try{var f=a.onUncaughtError;f(l.value,{componentStack:l.stack})}catch(m){setTimeout(function(){throw m})}}function IE(a,l,f){try{var m=a.onCaughtError;m(f.value,{componentStack:f.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function Tv(a,l,f){return f=wo(f),f.tag=3,f.payload={element:null},f.callback=function(){xm(a,l)},f}function zE(a){return a=wo(a),a.tag=3,a}function GE(a,l,f,m){var y=f.type.getDerivedStateFromError;if(typeof y=="function"){var S=m.value;a.payload=function(){return y(S)},a.callback=function(){IE(l,f,m)}}var A=f.stateNode;A!==null&&typeof A.componentDidCatch=="function"&&(a.callback=function(){IE(l,f,m),typeof y!="function"&&(Uo===null?Uo=new Set([this]):Uo.add(this));var B=m.stack;this.componentDidCatch(m.value,{componentStack:B!==null?B:""})})}function HP(a,l,f,m,y){if(f.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(l=f.alternate,l!==null&&qu(l,f,y,!0),f=kr.current,f!==null){switch(f.tag){case 31:case 13:return cs===null?Lm():f.alternate===null&&ii===0&&(ii=3),f.flags&=-257,f.flags|=65536,f.lanes=y,m===om?f.flags|=16384:(l=f.updateQueue,l===null?f.updateQueue=new Set([m]):l.add(m),Xv(a,m,y)),!1;case 22:return f.flags|=65536,m===om?f.flags|=16384:(l=f.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([m])},f.updateQueue=l):(f=l.retryQueue,f===null?l.retryQueue=new Set([m]):f.add(m)),Xv(a,m,y)),!1}throw Error(n(435,f.tag))}return Xv(a,m,y),Lm(),!1}if(Zt)return l=kr.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=y,m!==V0&&(a=Error(n(422),{cause:m}),_f(as(a,f)))):(m!==V0&&(l=Error(n(423),{cause:m}),_f(as(l,f))),a=a.current.alternate,a.flags|=65536,y&=-y,a.lanes|=y,m=as(m,f),y=Tv(a.stateNode,m,y),J0(a,y),ii!==4&&(ii=2)),!1;var S=Error(n(520),{cause:m});if(S=as(S,f),Bf===null?Bf=[S]:Bf.push(S),ii!==4&&(ii=2),l===null)return!0;m=as(m,f),f=l;do{switch(f.tag){case 3:return f.flags|=65536,a=y&-y,f.lanes|=a,a=Tv(f.stateNode,m,a),J0(f,a),!1;case 1:if(l=f.type,S=f.stateNode,(f.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Uo===null||!Uo.has(S))))return f.flags|=65536,y&=-y,f.lanes|=y,y=zE(y),GE(y,a,f,m),J0(f,y),!1}f=f.return}while(f!==null);return!1}var Mv=Error(n(461)),mi=!1;function ki(a,l,f,m){l.child=a===null?WM(l,null,f,m):Dl(l,a.child,f,m)}function kE(a,l,f,m,y){f=f.render;var S=l.ref;if("ref"in m){var A={};for(var B in m)B!=="ref"&&(A[B]=m[B])}else A=m;return wl(l),m=sv(a,l,f,A,S,y),B=av(),a!==null&&!mi?(ov(a,l,y),La(a,l,y)):(Zt&&B&&G0(l),l.flags|=1,ki(a,l,m,y),l.child)}function VE(a,l,f,m,y){if(a===null){var S=f.type;return typeof S=="function"&&!F0(S)&&S.defaultProps===void 0&&f.compare===null?(l.tag=15,l.type=S,HE(a,l,S,m,y)):(a=tm(f.type,null,m,l,l.mode,y),a.ref=l.ref,a.return=l,l.child=a)}if(S=a.child,!Lv(a,y)){var A=S.memoizedProps;if(f=f.compare,f=f!==null?f:pf,f(A,m)&&a.ref===l.ref)return La(a,l,y)}return l.flags|=1,a=Aa(S,m),a.ref=l.ref,a.return=l,l.child=a}function HE(a,l,f,m,y){if(a!==null){var S=a.memoizedProps;if(pf(S,m)&&a.ref===l.ref)if(mi=!1,l.pendingProps=m=S,Lv(a,y))(a.flags&131072)!==0&&(mi=!0);else return l.lanes=a.lanes,La(a,l,y)}return Ev(a,l,f,m,y)}function WE(a,l,f,m){var y=m.children,S=a!==null?a.memoizedState:null;if(a===null&&l.stateNode===null&&(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((l.flags&128)!==0){if(S=S!==null?S.baseLanes|f:f,a!==null){for(m=l.child=a.child,y=0;m!==null;)y=y|m.lanes|m.childLanes,m=m.sibling;m=y&~S}else m=0,l.child=null;return qE(a,l,S,f,m)}if((f&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},a!==null&&sm(l,S!==null?S.cachePool:null),S!==null?jM(l,S):tv(),XM(l);else return m=l.lanes=536870912,qE(a,l,S!==null?S.baseLanes|f:f,f,m)}else S!==null?(sm(l,S.cachePool),jM(l,S),No(),l.memoizedState=null):(a!==null&&sm(l,null),tv(),No());return ki(a,l,y,f),l.child}function Cf(a,l){return a!==null&&a.tag===22||l.stateNode!==null||(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.sibling}function qE(a,l,f,m,y){var S=Y0();return S=S===null?null:{parent:di._currentValue,pool:S},l.memoizedState={baseLanes:f,cachePool:S},a!==null&&sm(l,null),tv(),XM(l),a!==null&&qu(a,l,m,!0),l.childLanes=y,null}function bm(a,l){return l=Tm({mode:l.mode,children:l.children},a.mode),l.ref=a.ref,a.child=l,l.return=a,l}function $E(a,l,f){return Dl(l,a.child,null,f),a=bm(l,l.pendingProps),a.flags|=2,Vr(l),l.memoizedState=null,a}function WP(a,l,f){var m=l.pendingProps,y=(l.flags&128)!==0;if(l.flags&=-129,a===null){if(Zt){if(m.mode==="hidden")return a=bm(l,m),l.lanes=536870912,Cf(null,a);if(iv(l),(a=Wn)?(a=r1(a,us),a=a!==null&&a.data==="&"?a:null,a!==null&&(l.memoizedState={dehydrated:a,treeContext:So!==null?{id:$s,overflow:js}:null,retryLane:536870912,hydrationErrors:null},f=CM(a),f.return=l,l.child=f,zi=l,Wn=null)):a=null,a===null)throw Mo(l);return l.lanes=536870912,null}return bm(l,m)}var S=a.memoizedState;if(S!==null){var A=S.dehydrated;if(iv(l),y)if(l.flags&256)l.flags&=-257,l=$E(a,l,f);else if(l.memoizedState!==null)l.child=a.child,l.flags|=128,l=null;else throw Error(n(558));else if(mi||qu(a,l,f,!1),y=(f&a.childLanes)!==0,mi||y){if(m=Un,m!==null&&(A=Nu(m,f),A!==0&&A!==S.retryLane))throw S.retryLane=A,Tl(a,A),Er(m,a,A),Mv;Lm(),l=$E(a,l,f)}else a=S.treeContext,Wn=hs(A.nextSibling),zi=l,Zt=!0,To=null,us=!1,a!==null&&LM(l,a),l=bm(l,m),l.flags|=4096;return l}return a=Aa(a.child,{mode:m.mode,children:m.children}),a.ref=l.ref,l.child=a,a.return=l,a}function Sm(a,l){var f=l.ref;if(f===null)a!==null&&a.ref!==null&&(l.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(n(284));(a===null||a.ref!==f)&&(l.flags|=4194816)}}function Ev(a,l,f,m,y){return wl(l),f=sv(a,l,f,m,void 0,y),m=av(),a!==null&&!mi?(ov(a,l,y),La(a,l,y)):(Zt&&m&&G0(l),l.flags|=1,ki(a,l,f,y),l.child)}function jE(a,l,f,m,y,S){return wl(l),l.updateQueue=null,f=KM(l,m,f,y),YM(a),m=av(),a!==null&&!mi?(ov(a,l,S),La(a,l,S)):(Zt&&m&&G0(l),l.flags|=1,ki(a,l,f,S),l.child)}function XE(a,l,f,m,y){if(wl(l),l.stateNode===null){var S=ku,A=f.contextType;typeof A=="object"&&A!==null&&(S=Gi(A)),S=new f(m,S),l.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=Sv,l.stateNode=S,S._reactInternals=l,S=l.stateNode,S.props=m,S.state=l.memoizedState,S.refs={},Q0(l),A=f.contextType,S.context=typeof A=="object"&&A!==null?Gi(A):ku,S.state=l.memoizedState,A=f.getDerivedStateFromProps,typeof A=="function"&&(bv(l,f,A,m),S.state=l.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(A=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),A!==S.state&&Sv.enqueueReplaceState(S,S.state,null),Mf(l,m,S,y),Tf(),S.state=l.memoizedState),typeof S.componentDidMount=="function"&&(l.flags|=4194308),m=!0}else if(a===null){S=l.stateNode;var B=l.memoizedProps,$=Pl(f,B);S.props=$;var fe=S.context,Me=f.contextType;A=ku,typeof Me=="object"&&Me!==null&&(A=Gi(Me));var Ce=f.getDerivedStateFromProps;Me=typeof Ce=="function"||typeof S.getSnapshotBeforeUpdate=="function",B=l.pendingProps!==B,Me||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(B||fe!==A)&&UE(l,S,m,A),Ao=!1;var pe=l.memoizedState;S.state=pe,Mf(l,m,S,y),Tf(),fe=l.memoizedState,B||pe!==fe||Ao?(typeof Ce=="function"&&(bv(l,f,Ce,m),fe=l.memoizedState),($=Ao||PE(l,f,$,m,pe,fe,A))?(Me||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(l.flags|=4194308)):(typeof S.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=m,l.memoizedState=fe),S.props=m,S.state=fe,S.context=A,m=$):(typeof S.componentDidMount=="function"&&(l.flags|=4194308),m=!1)}else{S=l.stateNode,Z0(a,l),A=l.memoizedProps,Me=Pl(f,A),S.props=Me,Ce=l.pendingProps,pe=S.context,fe=f.contextType,$=ku,typeof fe=="object"&&fe!==null&&($=Gi(fe)),B=f.getDerivedStateFromProps,(fe=typeof B=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(A!==Ce||pe!==$)&&UE(l,S,m,$),Ao=!1,pe=l.memoizedState,S.state=pe,Mf(l,m,S,y),Tf();var _e=l.memoizedState;A!==Ce||pe!==_e||Ao||a!==null&&a.dependencies!==null&&im(a.dependencies)?(typeof B=="function"&&(bv(l,f,B,m),_e=l.memoizedState),(Me=Ao||PE(l,f,Me,m,pe,_e,$)||a!==null&&a.dependencies!==null&&im(a.dependencies))?(fe||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(m,_e,$),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(m,_e,$)),typeof S.componentDidUpdate=="function"&&(l.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof S.componentDidUpdate!="function"||A===a.memoizedProps&&pe===a.memoizedState||(l.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||A===a.memoizedProps&&pe===a.memoizedState||(l.flags|=1024),l.memoizedProps=m,l.memoizedState=_e),S.props=m,S.state=_e,S.context=$,m=Me):(typeof S.componentDidUpdate!="function"||A===a.memoizedProps&&pe===a.memoizedState||(l.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||A===a.memoizedProps&&pe===a.memoizedState||(l.flags|=1024),m=!1)}return S=m,Sm(a,l),m=(l.flags&128)!==0,S||m?(S=l.stateNode,f=m&&typeof f.getDerivedStateFromError!="function"?null:S.render(),l.flags|=1,a!==null&&m?(l.child=Dl(l,a.child,null,y),l.child=Dl(l,null,f,y)):ki(a,l,f,y),l.memoizedState=S.state,a=l.child):a=La(a,l,y),a}function YE(a,l,f,m){return El(),l.flags|=256,ki(a,l,f,m),l.child}var Av={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function wv(a){return{baseLanes:a,cachePool:IM()}}function Rv(a,l,f){return a=a!==null?a.childLanes&~f:0,l&&(a|=Wr),a}function KE(a,l,f){var m=l.pendingProps,y=!1,S=(l.flags&128)!==0,A;if((A=S)||(A=a!==null&&a.memoizedState===null?!1:(ai.current&2)!==0),A&&(y=!0,l.flags&=-129),A=(l.flags&32)!==0,l.flags&=-33,a===null){if(Zt){if(y?Co(l):No(),(a=Wn)?(a=r1(a,us),a=a!==null&&a.data!=="&"?a:null,a!==null&&(l.memoizedState={dehydrated:a,treeContext:So!==null?{id:$s,overflow:js}:null,retryLane:536870912,hydrationErrors:null},f=CM(a),f.return=l,l.child=f,zi=l,Wn=null)):a=null,a===null)throw Mo(l);return cy(a)?l.lanes=32:l.lanes=536870912,null}var B=m.children;return m=m.fallback,y?(No(),y=l.mode,B=Tm({mode:"hidden",children:B},y),m=Ml(m,y,f,null),B.return=l,m.return=l,B.sibling=m,l.child=B,m=l.child,m.memoizedState=wv(f),m.childLanes=Rv(a,A,f),l.memoizedState=Av,Cf(null,m)):(Co(l),Cv(l,B))}var $=a.memoizedState;if($!==null&&(B=$.dehydrated,B!==null)){if(S)l.flags&256?(Co(l),l.flags&=-257,l=Nv(a,l,f)):l.memoizedState!==null?(No(),l.child=a.child,l.flags|=128,l=null):(No(),B=m.fallback,y=l.mode,m=Tm({mode:"visible",children:m.children},y),B=Ml(B,y,f,null),B.flags|=2,m.return=l,B.return=l,m.sibling=B,l.child=m,Dl(l,a.child,null,f),m=l.child,m.memoizedState=wv(f),m.childLanes=Rv(a,A,f),l.memoizedState=Av,l=Cf(null,m));else if(Co(l),cy(B)){if(A=B.nextSibling&&B.nextSibling.dataset,A)var fe=A.dgst;A=fe,m=Error(n(419)),m.stack="",m.digest=A,_f({value:m,source:null,stack:null}),l=Nv(a,l,f)}else if(mi||qu(a,l,f,!1),A=(f&a.childLanes)!==0,mi||A){if(A=Un,A!==null&&(m=Nu(A,f),m!==0&&m!==$.retryLane))throw $.retryLane=m,Tl(a,m),Er(A,a,m),Mv;uy(B)||Lm(),l=Nv(a,l,f)}else uy(B)?(l.flags|=192,l.child=a.child,l=null):(a=$.treeContext,Wn=hs(B.nextSibling),zi=l,Zt=!0,To=null,us=!1,a!==null&&LM(l,a),l=Cv(l,m.children),l.flags|=4096);return l}return y?(No(),B=m.fallback,y=l.mode,$=a.child,fe=$.sibling,m=Aa($,{mode:"hidden",children:m.children}),m.subtreeFlags=$.subtreeFlags&65011712,fe!==null?B=Aa(fe,B):(B=Ml(B,y,f,null),B.flags|=2),B.return=l,m.return=l,m.sibling=B,l.child=m,Cf(null,m),m=l.child,B=a.child.memoizedState,B===null?B=wv(f):(y=B.cachePool,y!==null?($=di._currentValue,y=y.parent!==$?{parent:$,pool:$}:y):y=IM(),B={baseLanes:B.baseLanes|f,cachePool:y}),m.memoizedState=B,m.childLanes=Rv(a,A,f),l.memoizedState=Av,Cf(a.child,m)):(Co(l),f=a.child,a=f.sibling,f=Aa(f,{mode:"visible",children:m.children}),f.return=l,f.sibling=null,a!==null&&(A=l.deletions,A===null?(l.deletions=[a],l.flags|=16):A.push(a)),l.child=f,l.memoizedState=null,f)}function Cv(a,l){return l=Tm({mode:"visible",children:l},a.mode),l.return=a,a.child=l}function Tm(a,l){return a=Gr(22,a,null,l),a.lanes=0,a}function Nv(a,l,f){return Dl(l,a.child,null,f),a=Cv(l,l.pendingProps.children),a.flags|=2,l.memoizedState=null,a}function QE(a,l,f){a.lanes|=l;var m=a.alternate;m!==null&&(m.lanes|=l),q0(a.return,l,f)}function Dv(a,l,f,m,y,S){var A=a.memoizedState;A===null?a.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:m,tail:f,tailMode:y,treeForkCount:S}:(A.isBackwards=l,A.rendering=null,A.renderingStartTime=0,A.last=m,A.tail=f,A.tailMode=y,A.treeForkCount=S)}function ZE(a,l,f){var m=l.pendingProps,y=m.revealOrder,S=m.tail;m=m.children;var A=ai.current,B=(A&2)!==0;if(B?(A=A&1|2,l.flags|=128):A&=1,ue(ai,A),ki(a,l,m,f),m=Zt?gf:0,!B&&a!==null&&(a.flags&128)!==0)e:for(a=l.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&QE(a,f,l);else if(a.tag===19)QE(a,f,l);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(y){case"forwards":for(f=l.child,y=null;f!==null;)a=f.alternate,a!==null&&hm(a)===null&&(y=f),f=f.sibling;f=y,f===null?(y=l.child,l.child=null):(y=f.sibling,f.sibling=null),Dv(l,!1,y,f,S,m);break;case"backwards":case"unstable_legacy-backwards":for(f=null,y=l.child,l.child=null;y!==null;){if(a=y.alternate,a!==null&&hm(a)===null){l.child=y;break}a=y.sibling,y.sibling=f,f=y,y=a}Dv(l,!0,f,null,S,m);break;case"together":Dv(l,!1,null,null,void 0,m);break;default:l.memoizedState=null}return l.child}function La(a,l,f){if(a!==null&&(l.dependencies=a.dependencies),Po|=l.lanes,(f&l.childLanes)===0)if(a!==null){if(qu(a,l,f,!1),(f&l.childLanes)===0)return null}else return null;if(a!==null&&l.child!==a.child)throw Error(n(153));if(l.child!==null){for(a=l.child,f=Aa(a,a.pendingProps),l.child=f,f.return=l;a.sibling!==null;)a=a.sibling,f=f.sibling=Aa(a,a.pendingProps),f.return=l;f.sibling=null}return l.child}function Lv(a,l){return(a.lanes&l)!==0?!0:(a=a.dependencies,!!(a!==null&&im(a)))}function qP(a,l,f){switch(l.tag){case 3:Le(l,l.stateNode.containerInfo),Eo(l,di,a.memoizedState.cache),El();break;case 27:case 5:ze(l);break;case 4:Le(l,l.stateNode.containerInfo);break;case 10:Eo(l,l.type,l.memoizedProps.value);break;case 31:if(l.memoizedState!==null)return l.flags|=128,iv(l),null;break;case 13:var m=l.memoizedState;if(m!==null)return m.dehydrated!==null?(Co(l),l.flags|=128,null):(f&l.child.childLanes)!==0?KE(a,l,f):(Co(l),a=La(a,l,f),a!==null?a.sibling:null);Co(l);break;case 19:var y=(a.flags&128)!==0;if(m=(f&l.childLanes)!==0,m||(qu(a,l,f,!1),m=(f&l.childLanes)!==0),y){if(m)return ZE(a,l,f);l.flags|=128}if(y=l.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),ue(ai,ai.current),m)break;return null;case 22:return l.lanes=0,WE(a,l,f,l.pendingProps);case 24:Eo(l,di,a.memoizedState.cache)}return La(a,l,f)}function JE(a,l,f){if(a!==null)if(a.memoizedProps!==l.pendingProps)mi=!0;else{if(!Lv(a,f)&&(l.flags&128)===0)return mi=!1,qP(a,l,f);mi=(a.flags&131072)!==0}else mi=!1,Zt&&(l.flags&1048576)!==0&&DM(l,gf,l.index);switch(l.lanes=0,l.tag){case 16:e:{var m=l.pendingProps;if(a=Cl(l.elementType),l.type=a,typeof a=="function")F0(a)?(m=Pl(a,m),l.tag=1,l=XE(null,l,a,m,f)):(l.tag=0,l=Ev(null,l,a,m,f));else{if(a!=null){var y=a.$$typeof;if(y===w){l.tag=11,l=kE(null,l,a,m,f);break e}else if(y===D){l.tag=14,l=VE(null,l,a,m,f);break e}}throw l=J(a)||a,Error(n(306,l,""))}}return l;case 0:return Ev(a,l,l.type,l.pendingProps,f);case 1:return m=l.type,y=Pl(m,l.pendingProps),XE(a,l,m,y,f);case 3:e:{if(Le(l,l.stateNode.containerInfo),a===null)throw Error(n(387));m=l.pendingProps;var S=l.memoizedState;y=S.element,Z0(a,l),Mf(l,m,null,f);var A=l.memoizedState;if(m=A.cache,Eo(l,di,m),m!==S.cache&&$0(l,[di],f,!0),Tf(),m=A.element,S.isDehydrated)if(S={element:m,isDehydrated:!1,cache:A.cache},l.updateQueue.baseState=S,l.memoizedState=S,l.flags&256){l=YE(a,l,m,f);break e}else if(m!==y){y=as(Error(n(424)),l),_f(y),l=YE(a,l,m,f);break e}else for(a=l.stateNode.containerInfo,a.nodeType===9?a=a.body:a=a.nodeName==="HTML"?a.ownerDocument.body:a,Wn=hs(a.firstChild),zi=l,Zt=!0,To=null,us=!0,f=WM(l,null,m,f),l.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling;else{if(El(),m===y){l=La(a,l,f);break e}ki(a,l,m,f)}l=l.child}return l;case 26:return Sm(a,l),a===null?(f=c1(l.type,null,l.pendingProps,null))?l.memoizedState=f:Zt||(f=l.type,a=l.pendingProps,m=zm(W.current).createElement(f),m[fi]=l,m[Pi]=a,Vi(m,f,a),F(m),l.stateNode=m):l.memoizedState=c1(l.type,a.memoizedProps,l.pendingProps,a.memoizedState),null;case 27:return ze(l),a===null&&Zt&&(m=l.stateNode=o1(l.type,l.pendingProps,W.current),zi=l,us=!0,y=Wn,Io(l.type)?(hy=y,Wn=hs(m.firstChild)):Wn=y),ki(a,l,l.pendingProps.children,f),Sm(a,l),a===null&&(l.flags|=4194304),l.child;case 5:return a===null&&Zt&&((y=m=Wn)&&(m=bU(m,l.type,l.pendingProps,us),m!==null?(l.stateNode=m,zi=l,Wn=hs(m.firstChild),us=!1,y=!0):y=!1),y||Mo(l)),ze(l),y=l.type,S=l.pendingProps,A=a!==null?a.memoizedProps:null,m=S.children,ay(y,S)?m=null:A!==null&&ay(y,A)&&(l.flags|=32),l.memoizedState!==null&&(y=sv(a,l,BP,null,null,f),Wf._currentValue=y),Sm(a,l),ki(a,l,m,f),l.child;case 6:return a===null&&Zt&&((a=f=Wn)&&(f=SU(f,l.pendingProps,us),f!==null?(l.stateNode=f,zi=l,Wn=null,a=!0):a=!1),a||Mo(l)),null;case 13:return KE(a,l,f);case 4:return Le(l,l.stateNode.containerInfo),m=l.pendingProps,a===null?l.child=Dl(l,null,m,f):ki(a,l,m,f),l.child;case 11:return kE(a,l,l.type,l.pendingProps,f);case 7:return ki(a,l,l.pendingProps,f),l.child;case 8:return ki(a,l,l.pendingProps.children,f),l.child;case 12:return ki(a,l,l.pendingProps.children,f),l.child;case 10:return m=l.pendingProps,Eo(l,l.type,m.value),ki(a,l,m.children,f),l.child;case 9:return y=l.type._context,m=l.pendingProps.children,wl(l),y=Gi(y),m=m(y),l.flags|=1,ki(a,l,m,f),l.child;case 14:return VE(a,l,l.type,l.pendingProps,f);case 15:return HE(a,l,l.type,l.pendingProps,f);case 19:return ZE(a,l,f);case 31:return WP(a,l,f);case 22:return WE(a,l,f,l.pendingProps);case 24:return wl(l),m=Gi(di),a===null?(y=Y0(),y===null&&(y=Un,S=j0(),y.pooledCache=S,S.refCount++,S!==null&&(y.pooledCacheLanes|=f),y=S),l.memoizedState={parent:m,cache:y},Q0(l),Eo(l,di,y)):((a.lanes&f)!==0&&(Z0(a,l),Mf(l,null,null,f),Tf()),y=a.memoizedState,S=l.memoizedState,y.parent!==m?(y={parent:m,cache:m},l.memoizedState=y,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=y),Eo(l,di,m)):(m=S.cache,Eo(l,di,m),m!==y.cache&&$0(l,[di],f,!0))),ki(a,l,l.pendingProps.children,f),l.child;case 29:throw l.pendingProps}throw Error(n(156,l.tag))}function Pa(a){a.flags|=4}function Pv(a,l,f,m,y){if((l=(a.mode&32)!==0)&&(l=!1),l){if(a.flags|=16777216,(y&335544128)===y)if(a.stateNode.complete)a.flags|=8192;else if(AA())a.flags|=8192;else throw Nl=om,K0}else a.flags&=-16777217}function eA(a,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!m1(l))if(AA())a.flags|=8192;else throw Nl=om,K0}function Mm(a,l){l!==null&&(a.flags|=4),a.flags&16384&&(l=a.tag!==22?bn():536870912,a.lanes|=l,ic|=l)}function Nf(a,l){if(!Zt)switch(a.tailMode){case"hidden":l=a.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?a.tail=null:f.sibling=null;break;case"collapsed":f=a.tail;for(var m=null;f!==null;)f.alternate!==null&&(m=f),f=f.sibling;m===null?l||a.tail===null?a.tail=null:a.tail.sibling=null:m.sibling=null}}function qn(a){var l=a.alternate!==null&&a.alternate.child===a.child,f=0,m=0;if(l)for(var y=a.child;y!==null;)f|=y.lanes|y.childLanes,m|=y.subtreeFlags&65011712,m|=y.flags&65011712,y.return=a,y=y.sibling;else for(y=a.child;y!==null;)f|=y.lanes|y.childLanes,m|=y.subtreeFlags,m|=y.flags,y.return=a,y=y.sibling;return a.subtreeFlags|=m,a.childLanes=f,l}function $P(a,l,f){var m=l.pendingProps;switch(k0(l),l.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qn(l),null;case 1:return qn(l),null;case 3:return f=l.stateNode,m=null,a!==null&&(m=a.memoizedState.cache),l.memoizedState.cache!==m&&(l.flags|=2048),Ca(di),ke(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(a===null||a.child===null)&&(Wu(l)?Pa(l):a===null||a.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,H0())),qn(l),null;case 26:var y=l.type,S=l.memoizedState;return a===null?(Pa(l),S!==null?(qn(l),eA(l,S)):(qn(l),Pv(l,y,null,m,f))):S?S!==a.memoizedState?(Pa(l),qn(l),eA(l,S)):(qn(l),l.flags&=-16777217):(a=a.memoizedProps,a!==m&&Pa(l),qn(l),Pv(l,y,a,m,f)),null;case 27:if(ht(l),f=W.current,y=l.type,a!==null&&l.stateNode!=null)a.memoizedProps!==m&&Pa(l);else{if(!m){if(l.stateNode===null)throw Error(n(166));return qn(l),null}a=Ne.current,Wu(l)?PM(l):(a=o1(y,m,f),l.stateNode=a,Pa(l))}return qn(l),null;case 5:if(ht(l),y=l.type,a!==null&&l.stateNode!=null)a.memoizedProps!==m&&Pa(l);else{if(!m){if(l.stateNode===null)throw Error(n(166));return qn(l),null}if(S=Ne.current,Wu(l))PM(l);else{var A=zm(W.current);switch(S){case 1:S=A.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:S=A.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":S=A.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":S=A.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":S=A.createElement("div"),S.innerHTML="<script><\/script>",S=S.removeChild(S.firstChild);break;case"select":S=typeof m.is=="string"?A.createElement("select",{is:m.is}):A.createElement("select"),m.multiple?S.multiple=!0:m.size&&(S.size=m.size);break;default:S=typeof m.is=="string"?A.createElement(y,{is:m.is}):A.createElement(y)}}S[fi]=l,S[Pi]=m;e:for(A=l.child;A!==null;){if(A.tag===5||A.tag===6)S.appendChild(A.stateNode);else if(A.tag!==4&&A.tag!==27&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===l)break e;for(;A.sibling===null;){if(A.return===null||A.return===l)break e;A=A.return}A.sibling.return=A.return,A=A.sibling}l.stateNode=S;e:switch(Vi(S,y,m),y){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&Pa(l)}}return qn(l),Pv(l,l.type,a===null?null:a.memoizedProps,l.pendingProps,f),null;case 6:if(a&&l.stateNode!=null)a.memoizedProps!==m&&Pa(l);else{if(typeof m!="string"&&l.stateNode===null)throw Error(n(166));if(a=W.current,Wu(l)){if(a=l.stateNode,f=l.memoizedProps,m=null,y=zi,y!==null)switch(y.tag){case 27:case 5:m=y.memoizedProps}a[fi]=l,a=!!(a.nodeValue===f||m!==null&&m.suppressHydrationWarning===!0||KA(a.nodeValue,f)),a||Mo(l,!0)}else a=zm(a).createTextNode(m),a[fi]=l,l.stateNode=a}return qn(l),null;case 31:if(f=l.memoizedState,a===null||a.memoizedState!==null){if(m=Wu(l),f!==null){if(a===null){if(!m)throw Error(n(318));if(a=l.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(557));a[fi]=l}else El(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;qn(l),a=!1}else f=H0(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=f),a=!0;if(!a)return l.flags&256?(Vr(l),l):(Vr(l),null);if((l.flags&128)!==0)throw Error(n(558))}return qn(l),null;case 13:if(m=l.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(y=Wu(l),m!==null&&m.dehydrated!==null){if(a===null){if(!y)throw Error(n(318));if(y=l.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(n(317));y[fi]=l}else El(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;qn(l),y=!1}else y=H0(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=y),y=!0;if(!y)return l.flags&256?(Vr(l),l):(Vr(l),null)}return Vr(l),(l.flags&128)!==0?(l.lanes=f,l):(f=m!==null,a=a!==null&&a.memoizedState!==null,f&&(m=l.child,y=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(y=m.alternate.memoizedState.cachePool.pool),S=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(S=m.memoizedState.cachePool.pool),S!==y&&(m.flags|=2048)),f!==a&&f&&(l.child.flags|=8192),Mm(l,l.updateQueue),qn(l),null);case 4:return ke(),a===null&&ty(l.stateNode.containerInfo),qn(l),null;case 10:return Ca(l.type),qn(l),null;case 19:if(Y(ai),m=l.memoizedState,m===null)return qn(l),null;if(y=(l.flags&128)!==0,S=m.rendering,S===null)if(y)Nf(m,!1);else{if(ii!==0||a!==null&&(a.flags&128)!==0)for(a=l.child;a!==null;){if(S=hm(a),S!==null){for(l.flags|=128,Nf(m,!1),a=S.updateQueue,l.updateQueue=a,Mm(l,a),l.subtreeFlags=0,a=f,f=l.child;f!==null;)RM(f,a),f=f.sibling;return ue(ai,ai.current&1|2),Zt&&wa(l,m.treeForkCount),l.child}a=a.sibling}m.tail!==null&&L()>Cm&&(l.flags|=128,y=!0,Nf(m,!1),l.lanes=4194304)}else{if(!y)if(a=hm(S),a!==null){if(l.flags|=128,y=!0,a=a.updateQueue,l.updateQueue=a,Mm(l,a),Nf(m,!0),m.tail===null&&m.tailMode==="hidden"&&!S.alternate&&!Zt)return qn(l),null}else 2*L()-m.renderingStartTime>Cm&&f!==536870912&&(l.flags|=128,y=!0,Nf(m,!1),l.lanes=4194304);m.isBackwards?(S.sibling=l.child,l.child=S):(a=m.last,a!==null?a.sibling=S:l.child=S,m.last=S)}return m.tail!==null?(a=m.tail,m.rendering=a,m.tail=a.sibling,m.renderingStartTime=L(),a.sibling=null,f=ai.current,ue(ai,y?f&1|2:f&1),Zt&&wa(l,m.treeForkCount),a):(qn(l),null);case 22:case 23:return Vr(l),nv(),m=l.memoizedState!==null,a!==null?a.memoizedState!==null!==m&&(l.flags|=8192):m&&(l.flags|=8192),m?(f&536870912)!==0&&(l.flags&128)===0&&(qn(l),l.subtreeFlags&6&&(l.flags|=8192)):qn(l),f=l.updateQueue,f!==null&&Mm(l,f.retryQueue),f=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),m=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(m=l.memoizedState.cachePool.pool),m!==f&&(l.flags|=2048),a!==null&&Y(Rl),null;case 24:return f=null,a!==null&&(f=a.memoizedState.cache),l.memoizedState.cache!==f&&(l.flags|=2048),Ca(di),qn(l),null;case 25:return null;case 30:return null}throw Error(n(156,l.tag))}function jP(a,l){switch(k0(l),l.tag){case 1:return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 3:return Ca(di),ke(),a=l.flags,(a&65536)!==0&&(a&128)===0?(l.flags=a&-65537|128,l):null;case 26:case 27:case 5:return ht(l),null;case 31:if(l.memoizedState!==null){if(Vr(l),l.alternate===null)throw Error(n(340));El()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 13:if(Vr(l),a=l.memoizedState,a!==null&&a.dehydrated!==null){if(l.alternate===null)throw Error(n(340));El()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 19:return Y(ai),null;case 4:return ke(),null;case 10:return Ca(l.type),null;case 22:case 23:return Vr(l),nv(),a!==null&&Y(Rl),a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 24:return Ca(di),null;case 25:return null;default:return null}}function tA(a,l){switch(k0(l),l.tag){case 3:Ca(di),ke();break;case 26:case 27:case 5:ht(l);break;case 4:ke();break;case 31:l.memoizedState!==null&&Vr(l);break;case 13:Vr(l);break;case 19:Y(ai);break;case 10:Ca(l.type);break;case 22:case 23:Vr(l),nv(),a!==null&&Y(Rl);break;case 24:Ca(di)}}function Df(a,l){try{var f=l.updateQueue,m=f!==null?f.lastEffect:null;if(m!==null){var y=m.next;f=y;do{if((f.tag&a)===a){m=void 0;var S=f.create,A=f.inst;m=S(),A.destroy=m}f=f.next}while(f!==y)}}catch(B){Mn(l,l.return,B)}}function Do(a,l,f){try{var m=l.updateQueue,y=m!==null?m.lastEffect:null;if(y!==null){var S=y.next;m=S;do{if((m.tag&a)===a){var A=m.inst,B=A.destroy;if(B!==void 0){A.destroy=void 0,y=l;var $=f,fe=B;try{fe()}catch(Me){Mn(y,$,Me)}}}m=m.next}while(m!==S)}}catch(Me){Mn(l,l.return,Me)}}function nA(a){var l=a.updateQueue;if(l!==null){var f=a.stateNode;try{$M(l,f)}catch(m){Mn(a,a.return,m)}}}function iA(a,l,f){f.props=Pl(a.type,a.memoizedProps),f.state=a.memoizedState;try{f.componentWillUnmount()}catch(m){Mn(a,l,m)}}function Lf(a,l){try{var f=a.ref;if(f!==null){switch(a.tag){case 26:case 27:case 5:var m=a.stateNode;break;case 30:m=a.stateNode;break;default:m=a.stateNode}typeof f=="function"?a.refCleanup=f(m):f.current=m}}catch(y){Mn(a,l,y)}}function Xs(a,l){var f=a.ref,m=a.refCleanup;if(f!==null)if(typeof m=="function")try{m()}catch(y){Mn(a,l,y)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(y){Mn(a,l,y)}else f.current=null}function rA(a){var l=a.type,f=a.memoizedProps,m=a.stateNode;try{e:switch(l){case"button":case"input":case"select":case"textarea":f.autoFocus&&m.focus();break e;case"img":f.src?m.src=f.src:f.srcSet&&(m.srcset=f.srcSet)}}catch(y){Mn(a,a.return,y)}}function Uv(a,l,f){try{var m=a.stateNode;mU(m,a.type,f,l),m[Pi]=l}catch(y){Mn(a,a.return,y)}}function sA(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Io(a.type)||a.tag===4}function Ov(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||sA(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Io(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Bv(a,l,f){var m=a.tag;if(m===5||m===6)a=a.stateNode,l?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(a,l):(l=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,l.appendChild(a),f=f._reactRootContainer,f!=null||l.onclick!==null||(l.onclick=Ma));else if(m!==4&&(m===27&&Io(a.type)&&(f=a.stateNode,l=null),a=a.child,a!==null))for(Bv(a,l,f),a=a.sibling;a!==null;)Bv(a,l,f),a=a.sibling}function Em(a,l,f){var m=a.tag;if(m===5||m===6)a=a.stateNode,l?f.insertBefore(a,l):f.appendChild(a);else if(m!==4&&(m===27&&Io(a.type)&&(f=a.stateNode),a=a.child,a!==null))for(Em(a,l,f),a=a.sibling;a!==null;)Em(a,l,f),a=a.sibling}function aA(a){var l=a.stateNode,f=a.memoizedProps;try{for(var m=a.type,y=l.attributes;y.length;)l.removeAttributeNode(y[0]);Vi(l,m,f),l[fi]=a,l[Pi]=f}catch(S){Mn(a,a.return,S)}}var Ua=!1,gi=!1,Fv=!1,oA=typeof WeakSet=="function"?WeakSet:Set,Ri=null;function XP(a,l){if(a=a.containerInfo,ry=$m,a=yM(a),N0(a)){if("selectionStart"in a)var f={start:a.selectionStart,end:a.selectionEnd};else e:{f=(f=a.ownerDocument)&&f.defaultView||window;var m=f.getSelection&&f.getSelection();if(m&&m.rangeCount!==0){f=m.anchorNode;var y=m.anchorOffset,S=m.focusNode;m=m.focusOffset;try{f.nodeType,S.nodeType}catch{f=null;break e}var A=0,B=-1,$=-1,fe=0,Me=0,Ce=a,pe=null;t:for(;;){for(var _e;Ce!==f||y!==0&&Ce.nodeType!==3||(B=A+y),Ce!==S||m!==0&&Ce.nodeType!==3||($=A+m),Ce.nodeType===3&&(A+=Ce.nodeValue.length),(_e=Ce.firstChild)!==null;)pe=Ce,Ce=_e;for(;;){if(Ce===a)break t;if(pe===f&&++fe===y&&(B=A),pe===S&&++Me===m&&($=A),(_e=Ce.nextSibling)!==null)break;Ce=pe,pe=Ce.parentNode}Ce=_e}f=B===-1||$===-1?null:{start:B,end:$}}else f=null}f=f||{start:0,end:0}}else f=null;for(sy={focusedElem:a,selectionRange:f},$m=!1,Ri=l;Ri!==null;)if(l=Ri,a=l.child,(l.subtreeFlags&1028)!==0&&a!==null)a.return=l,Ri=a;else for(;Ri!==null;){switch(l=Ri,S=l.alternate,a=l.flags,l.tag){case 0:if((a&4)!==0&&(a=l.updateQueue,a=a!==null?a.events:null,a!==null))for(f=0;f<a.length;f++)y=a[f],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&S!==null){a=void 0,f=l,y=S.memoizedProps,S=S.memoizedState,m=f.stateNode;try{var rt=Pl(f.type,y);a=m.getSnapshotBeforeUpdate(rt,S),m.__reactInternalSnapshotBeforeUpdate=a}catch(Tt){Mn(f,f.return,Tt)}}break;case 3:if((a&1024)!==0){if(a=l.stateNode.containerInfo,f=a.nodeType,f===9)ly(a);else if(f===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":ly(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(n(163))}if(a=l.sibling,a!==null){a.return=l.return,Ri=a;break}Ri=l.return}}function lA(a,l,f){var m=f.flags;switch(f.tag){case 0:case 11:case 15:Ba(a,f),m&4&&Df(5,f);break;case 1:if(Ba(a,f),m&4)if(a=f.stateNode,l===null)try{a.componentDidMount()}catch(A){Mn(f,f.return,A)}else{var y=Pl(f.type,l.memoizedProps);l=l.memoizedState;try{a.componentDidUpdate(y,l,a.__reactInternalSnapshotBeforeUpdate)}catch(A){Mn(f,f.return,A)}}m&64&&nA(f),m&512&&Lf(f,f.return);break;case 3:if(Ba(a,f),m&64&&(a=f.updateQueue,a!==null)){if(l=null,f.child!==null)switch(f.child.tag){case 27:case 5:l=f.child.stateNode;break;case 1:l=f.child.stateNode}try{$M(a,l)}catch(A){Mn(f,f.return,A)}}break;case 27:l===null&&m&4&&aA(f);case 26:case 5:Ba(a,f),l===null&&m&4&&rA(f),m&512&&Lf(f,f.return);break;case 12:Ba(a,f);break;case 31:Ba(a,f),m&4&&hA(a,f);break;case 13:Ba(a,f),m&4&&fA(a,f),m&64&&(a=f.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(f=iU.bind(null,f),TU(a,f))));break;case 22:if(m=f.memoizedState!==null||Ua,!m){l=l!==null&&l.memoizedState!==null||gi,y=Ua;var S=gi;Ua=m,(gi=l)&&!S?Fa(a,f,(f.subtreeFlags&8772)!==0):Ba(a,f),Ua=y,gi=S}break;case 30:break;default:Ba(a,f)}}function uA(a){var l=a.alternate;l!==null&&(a.alternate=null,uA(l)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(l=a.stateNode,l!==null&&af(l)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Yn=null,br=!1;function Oa(a,l,f){for(f=f.child;f!==null;)cA(a,l,f),f=f.sibling}function cA(a,l,f){if(Fe&&typeof Fe.onCommitFiberUnmount=="function")try{Fe.onCommitFiberUnmount(Be,f)}catch{}switch(f.tag){case 26:gi||Xs(f,l),Oa(a,l,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:gi||Xs(f,l);var m=Yn,y=br;Io(f.type)&&(Yn=f.stateNode,br=!1),Oa(a,l,f),kf(f.stateNode),Yn=m,br=y;break;case 5:gi||Xs(f,l);case 6:if(m=Yn,y=br,Yn=null,Oa(a,l,f),Yn=m,br=y,Yn!==null)if(br)try{(Yn.nodeType===9?Yn.body:Yn.nodeName==="HTML"?Yn.ownerDocument.body:Yn).removeChild(f.stateNode)}catch(S){Mn(f,l,S)}else try{Yn.removeChild(f.stateNode)}catch(S){Mn(f,l,S)}break;case 18:Yn!==null&&(br?(a=Yn,n1(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,f.stateNode),hc(a)):n1(Yn,f.stateNode));break;case 4:m=Yn,y=br,Yn=f.stateNode.containerInfo,br=!0,Oa(a,l,f),Yn=m,br=y;break;case 0:case 11:case 14:case 15:Do(2,f,l),gi||Do(4,f,l),Oa(a,l,f);break;case 1:gi||(Xs(f,l),m=f.stateNode,typeof m.componentWillUnmount=="function"&&iA(f,l,m)),Oa(a,l,f);break;case 21:Oa(a,l,f);break;case 22:gi=(m=gi)||f.memoizedState!==null,Oa(a,l,f),gi=m;break;default:Oa(a,l,f)}}function hA(a,l){if(l.memoizedState===null&&(a=l.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{hc(a)}catch(f){Mn(l,l.return,f)}}}function fA(a,l){if(l.memoizedState===null&&(a=l.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{hc(a)}catch(f){Mn(l,l.return,f)}}function YP(a){switch(a.tag){case 31:case 13:case 19:var l=a.stateNode;return l===null&&(l=a.stateNode=new oA),l;case 22:return a=a.stateNode,l=a._retryCache,l===null&&(l=a._retryCache=new oA),l;default:throw Error(n(435,a.tag))}}function Am(a,l){var f=YP(a);l.forEach(function(m){if(!f.has(m)){f.add(m);var y=rU.bind(null,a,m);m.then(y,y)}})}function Sr(a,l){var f=l.deletions;if(f!==null)for(var m=0;m<f.length;m++){var y=f[m],S=a,A=l,B=A;e:for(;B!==null;){switch(B.tag){case 27:if(Io(B.type)){Yn=B.stateNode,br=!1;break e}break;case 5:Yn=B.stateNode,br=!1;break e;case 3:case 4:Yn=B.stateNode.containerInfo,br=!0;break e}B=B.return}if(Yn===null)throw Error(n(160));cA(S,A,y),Yn=null,br=!1,S=y.alternate,S!==null&&(S.return=null),y.return=null}if(l.subtreeFlags&13886)for(l=l.child;l!==null;)dA(l,a),l=l.sibling}var Rs=null;function dA(a,l){var f=a.alternate,m=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Sr(l,a),Tr(a),m&4&&(Do(3,a,a.return),Df(3,a),Do(5,a,a.return));break;case 1:Sr(l,a),Tr(a),m&512&&(gi||f===null||Xs(f,f.return)),m&64&&Ua&&(a=a.updateQueue,a!==null&&(m=a.callbacks,m!==null&&(f=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=f===null?m:f.concat(m))));break;case 26:var y=Rs;if(Sr(l,a),Tr(a),m&512&&(gi||f===null||Xs(f,f.return)),m&4){var S=f!==null?f.memoizedState:null;if(m=a.memoizedState,f===null)if(m===null)if(a.stateNode===null){e:{m=a.type,f=a.memoizedProps,y=y.ownerDocument||y;t:switch(m){case"title":S=y.getElementsByTagName("title")[0],(!S||S[vl]||S[fi]||S.namespaceURI==="http://www.w3.org/2000/svg"||S.hasAttribute("itemprop"))&&(S=y.createElement(m),y.head.insertBefore(S,y.querySelector("head > title"))),Vi(S,m,f),S[fi]=a,F(S),m=S;break e;case"link":var A=d1("link","href",y).get(m+(f.href||""));if(A){for(var B=0;B<A.length;B++)if(S=A[B],S.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&S.getAttribute("rel")===(f.rel==null?null:f.rel)&&S.getAttribute("title")===(f.title==null?null:f.title)&&S.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){A.splice(B,1);break t}}S=y.createElement(m),Vi(S,m,f),y.head.appendChild(S);break;case"meta":if(A=d1("meta","content",y).get(m+(f.content||""))){for(B=0;B<A.length;B++)if(S=A[B],S.getAttribute("content")===(f.content==null?null:""+f.content)&&S.getAttribute("name")===(f.name==null?null:f.name)&&S.getAttribute("property")===(f.property==null?null:f.property)&&S.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&S.getAttribute("charset")===(f.charSet==null?null:f.charSet)){A.splice(B,1);break t}}S=y.createElement(m),Vi(S,m,f),y.head.appendChild(S);break;default:throw Error(n(468,m))}S[fi]=a,F(S),m=S}a.stateNode=m}else p1(y,a.type,a.stateNode);else a.stateNode=f1(y,m,a.memoizedProps);else S!==m?(S===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):S.count--,m===null?p1(y,a.type,a.stateNode):f1(y,m,a.memoizedProps)):m===null&&a.stateNode!==null&&Uv(a,a.memoizedProps,f.memoizedProps)}break;case 27:Sr(l,a),Tr(a),m&512&&(gi||f===null||Xs(f,f.return)),f!==null&&m&4&&Uv(a,a.memoizedProps,f.memoizedProps);break;case 5:if(Sr(l,a),Tr(a),m&512&&(gi||f===null||Xs(f,f.return)),a.flags&32){y=a.stateNode;try{Si(y,"")}catch(rt){Mn(a,a.return,rt)}}m&4&&a.stateNode!=null&&(y=a.memoizedProps,Uv(a,y,f!==null?f.memoizedProps:y)),m&1024&&(Fv=!0);break;case 6:if(Sr(l,a),Tr(a),m&4){if(a.stateNode===null)throw Error(n(162));m=a.memoizedProps,f=a.stateNode;try{f.nodeValue=m}catch(rt){Mn(a,a.return,rt)}}break;case 3:if(Vm=null,y=Rs,Rs=Gm(l.containerInfo),Sr(l,a),Rs=y,Tr(a),m&4&&f!==null&&f.memoizedState.isDehydrated)try{hc(l.containerInfo)}catch(rt){Mn(a,a.return,rt)}Fv&&(Fv=!1,pA(a));break;case 4:m=Rs,Rs=Gm(a.stateNode.containerInfo),Sr(l,a),Tr(a),Rs=m;break;case 12:Sr(l,a),Tr(a);break;case 31:Sr(l,a),Tr(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,Am(a,m)));break;case 13:Sr(l,a),Tr(a),a.child.flags&8192&&a.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(Rm=L()),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,Am(a,m)));break;case 22:y=a.memoizedState!==null;var $=f!==null&&f.memoizedState!==null,fe=Ua,Me=gi;if(Ua=fe||y,gi=Me||$,Sr(l,a),gi=Me,Ua=fe,Tr(a),m&8192)e:for(l=a.stateNode,l._visibility=y?l._visibility&-2:l._visibility|1,y&&(f===null||$||Ua||gi||Ul(a)),f=null,l=a;;){if(l.tag===5||l.tag===26){if(f===null){$=f=l;try{if(S=$.stateNode,y)A=S.style,typeof A.setProperty=="function"?A.setProperty("display","none","important"):A.display="none";else{B=$.stateNode;var Ce=$.memoizedProps.style,pe=Ce!=null&&Ce.hasOwnProperty("display")?Ce.display:null;B.style.display=pe==null||typeof pe=="boolean"?"":(""+pe).trim()}}catch(rt){Mn($,$.return,rt)}}}else if(l.tag===6){if(f===null){$=l;try{$.stateNode.nodeValue=y?"":$.memoizedProps}catch(rt){Mn($,$.return,rt)}}}else if(l.tag===18){if(f===null){$=l;try{var _e=$.stateNode;y?i1(_e,!0):i1($.stateNode,!1)}catch(rt){Mn($,$.return,rt)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===a)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break e;for(;l.sibling===null;){if(l.return===null||l.return===a)break e;f===l&&(f=null),l=l.return}f===l&&(f=null),l.sibling.return=l.return,l=l.sibling}m&4&&(m=a.updateQueue,m!==null&&(f=m.retryQueue,f!==null&&(m.retryQueue=null,Am(a,f))));break;case 19:Sr(l,a),Tr(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,Am(a,m)));break;case 30:break;case 21:break;default:Sr(l,a),Tr(a)}}function Tr(a){var l=a.flags;if(l&2){try{for(var f,m=a.return;m!==null;){if(sA(m)){f=m;break}m=m.return}if(f==null)throw Error(n(160));switch(f.tag){case 27:var y=f.stateNode,S=Ov(a);Em(a,S,y);break;case 5:var A=f.stateNode;f.flags&32&&(Si(A,""),f.flags&=-33);var B=Ov(a);Em(a,B,A);break;case 3:case 4:var $=f.stateNode.containerInfo,fe=Ov(a);Bv(a,fe,$);break;default:throw Error(n(161))}}catch(Me){Mn(a,a.return,Me)}a.flags&=-3}l&4096&&(a.flags&=-4097)}function pA(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var l=a;pA(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),a=a.sibling}}function Ba(a,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)lA(a,l.alternate,l),l=l.sibling}function Ul(a){for(a=a.child;a!==null;){var l=a;switch(l.tag){case 0:case 11:case 14:case 15:Do(4,l,l.return),Ul(l);break;case 1:Xs(l,l.return);var f=l.stateNode;typeof f.componentWillUnmount=="function"&&iA(l,l.return,f),Ul(l);break;case 27:kf(l.stateNode);case 26:case 5:Xs(l,l.return),Ul(l);break;case 22:l.memoizedState===null&&Ul(l);break;case 30:Ul(l);break;default:Ul(l)}a=a.sibling}}function Fa(a,l,f){for(f=f&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var m=l.alternate,y=a,S=l,A=S.flags;switch(S.tag){case 0:case 11:case 15:Fa(y,S,f),Df(4,S);break;case 1:if(Fa(y,S,f),m=S,y=m.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(fe){Mn(m,m.return,fe)}if(m=S,y=m.updateQueue,y!==null){var B=m.stateNode;try{var $=y.shared.hiddenCallbacks;if($!==null)for(y.shared.hiddenCallbacks=null,y=0;y<$.length;y++)qM($[y],B)}catch(fe){Mn(m,m.return,fe)}}f&&A&64&&nA(S),Lf(S,S.return);break;case 27:aA(S);case 26:case 5:Fa(y,S,f),f&&m===null&&A&4&&rA(S),Lf(S,S.return);break;case 12:Fa(y,S,f);break;case 31:Fa(y,S,f),f&&A&4&&hA(y,S);break;case 13:Fa(y,S,f),f&&A&4&&fA(y,S);break;case 22:S.memoizedState===null&&Fa(y,S,f),Lf(S,S.return);break;case 30:break;default:Fa(y,S,f)}l=l.sibling}}function Iv(a,l){var f=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),a=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(a=l.memoizedState.cachePool.pool),a!==f&&(a!=null&&a.refCount++,f!=null&&vf(f))}function zv(a,l){a=null,l.alternate!==null&&(a=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==a&&(l.refCount++,a!=null&&vf(a))}function Cs(a,l,f,m){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)mA(a,l,f,m),l=l.sibling}function mA(a,l,f,m){var y=l.flags;switch(l.tag){case 0:case 11:case 15:Cs(a,l,f,m),y&2048&&Df(9,l);break;case 1:Cs(a,l,f,m);break;case 3:Cs(a,l,f,m),y&2048&&(a=null,l.alternate!==null&&(a=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==a&&(l.refCount++,a!=null&&vf(a)));break;case 12:if(y&2048){Cs(a,l,f,m),a=l.stateNode;try{var S=l.memoizedProps,A=S.id,B=S.onPostCommit;typeof B=="function"&&B(A,l.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch($){Mn(l,l.return,$)}}else Cs(a,l,f,m);break;case 31:Cs(a,l,f,m);break;case 13:Cs(a,l,f,m);break;case 23:break;case 22:S=l.stateNode,A=l.alternate,l.memoizedState!==null?S._visibility&2?Cs(a,l,f,m):Pf(a,l):S._visibility&2?Cs(a,l,f,m):(S._visibility|=2,ec(a,l,f,m,(l.subtreeFlags&10256)!==0||!1)),y&2048&&Iv(A,l);break;case 24:Cs(a,l,f,m),y&2048&&zv(l.alternate,l);break;default:Cs(a,l,f,m)}}function ec(a,l,f,m,y){for(y=y&&((l.subtreeFlags&10256)!==0||!1),l=l.child;l!==null;){var S=a,A=l,B=f,$=m,fe=A.flags;switch(A.tag){case 0:case 11:case 15:ec(S,A,B,$,y),Df(8,A);break;case 23:break;case 22:var Me=A.stateNode;A.memoizedState!==null?Me._visibility&2?ec(S,A,B,$,y):Pf(S,A):(Me._visibility|=2,ec(S,A,B,$,y)),y&&fe&2048&&Iv(A.alternate,A);break;case 24:ec(S,A,B,$,y),y&&fe&2048&&zv(A.alternate,A);break;default:ec(S,A,B,$,y)}l=l.sibling}}function Pf(a,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var f=a,m=l,y=m.flags;switch(m.tag){case 22:Pf(f,m),y&2048&&Iv(m.alternate,m);break;case 24:Pf(f,m),y&2048&&zv(m.alternate,m);break;default:Pf(f,m)}l=l.sibling}}var Uf=8192;function tc(a,l,f){if(a.subtreeFlags&Uf)for(a=a.child;a!==null;)gA(a,l,f),a=a.sibling}function gA(a,l,f){switch(a.tag){case 26:tc(a,l,f),a.flags&Uf&&a.memoizedState!==null&&OU(f,Rs,a.memoizedState,a.memoizedProps);break;case 5:tc(a,l,f);break;case 3:case 4:var m=Rs;Rs=Gm(a.stateNode.containerInfo),tc(a,l,f),Rs=m;break;case 22:a.memoizedState===null&&(m=a.alternate,m!==null&&m.memoizedState!==null?(m=Uf,Uf=16777216,tc(a,l,f),Uf=m):tc(a,l,f));break;default:tc(a,l,f)}}function _A(a){var l=a.alternate;if(l!==null&&(a=l.child,a!==null)){l.child=null;do l=a.sibling,a.sibling=null,a=l;while(a!==null)}}function Of(a){var l=a.deletions;if((a.flags&16)!==0){if(l!==null)for(var f=0;f<l.length;f++){var m=l[f];Ri=m,yA(m,a)}_A(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)vA(a),a=a.sibling}function vA(a){switch(a.tag){case 0:case 11:case 15:Of(a),a.flags&2048&&Do(9,a,a.return);break;case 3:Of(a);break;case 12:Of(a);break;case 22:var l=a.stateNode;a.memoizedState!==null&&l._visibility&2&&(a.return===null||a.return.tag!==13)?(l._visibility&=-3,wm(a)):Of(a);break;default:Of(a)}}function wm(a){var l=a.deletions;if((a.flags&16)!==0){if(l!==null)for(var f=0;f<l.length;f++){var m=l[f];Ri=m,yA(m,a)}_A(a)}for(a=a.child;a!==null;){switch(l=a,l.tag){case 0:case 11:case 15:Do(8,l,l.return),wm(l);break;case 22:f=l.stateNode,f._visibility&2&&(f._visibility&=-3,wm(l));break;default:wm(l)}a=a.sibling}}function yA(a,l){for(;Ri!==null;){var f=Ri;switch(f.tag){case 0:case 11:case 15:Do(8,f,l);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var m=f.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:vf(f.memoizedState.cache)}if(m=f.child,m!==null)m.return=f,Ri=m;else e:for(f=a;Ri!==null;){m=Ri;var y=m.sibling,S=m.return;if(uA(m),m===f){Ri=null;break e}if(y!==null){y.return=S,Ri=y;break e}Ri=S}}}var KP={getCacheForType:function(a){var l=Gi(di),f=l.data.get(a);return f===void 0&&(f=a(),l.data.set(a,f)),f},cacheSignal:function(){return Gi(di).controller.signal}},QP=typeof WeakMap=="function"?WeakMap:Map,fn=0,Un=null,$t=null,Kt=0,Tn=0,Hr=null,Lo=!1,nc=!1,Gv=!1,Ia=0,ii=0,Po=0,Ol=0,kv=0,Wr=0,ic=0,Bf=null,Mr=null,Vv=!1,Rm=0,xA=0,Cm=1/0,Nm=null,Uo=null,Ti=0,Oo=null,rc=null,za=0,Hv=0,Wv=null,bA=null,Ff=0,qv=null;function qr(){return(fn&2)!==0&&Kt!==0?Kt&-Kt:G.T!==null?Qv():rf()}function SA(){if(Wr===0)if((Kt&536870912)===0||Zt){var a=Ie;Ie<<=1,(Ie&3932160)===0&&(Ie=262144),Wr=a}else Wr=536870912;return a=kr.current,a!==null&&(a.flags|=32),Wr}function Er(a,l,f){(a===Un&&(Tn===2||Tn===9)||a.cancelPendingCommit!==null)&&(sc(a,0),Bo(a,Kt,Wr,!1)),Qi(a,f),((fn&2)===0||a!==Un)&&(a===Un&&((fn&2)===0&&(Ol|=f),ii===4&&Bo(a,Kt,Wr,!1)),Ys(a))}function TA(a,l,f){if((fn&6)!==0)throw Error(n(327));var m=!f&&(l&127)===0&&(l&a.expiredLanes)===0||Ve(a,l),y=m?eU(a,l):jv(a,l,!0),S=m;do{if(y===0){nc&&!m&&Bo(a,l,0,!1);break}else{if(f=a.current.alternate,S&&!ZP(f)){y=jv(a,l,!1),S=!1;continue}if(y===2){if(S=l,a.errorRecoveryDisabledLanes&S)var A=0;else A=a.pendingLanes&-536870913,A=A!==0?A:A&536870912?536870912:0;if(A!==0){l=A;e:{var B=a;y=Bf;var $=B.current.memoizedState.isDehydrated;if($&&(sc(B,A).flags|=256),A=jv(B,A,!1),A!==2){if(Gv&&!$){B.errorRecoveryDisabledLanes|=S,Ol|=S,y=4;break e}S=Mr,Mr=y,S!==null&&(Mr===null?Mr=S:Mr.push.apply(Mr,S))}y=A}if(S=!1,y!==2)continue}}if(y===1){sc(a,0),Bo(a,l,0,!0);break}e:{switch(m=a,S=y,S){case 0:case 1:throw Error(n(345));case 4:if((l&4194048)!==l)break;case 6:Bo(m,l,Wr,!Lo);break e;case 2:Mr=null;break;case 3:case 5:break;default:throw Error(n(329))}if((l&62914560)===l&&(y=Rm+300-L(),10<y)){if(Bo(m,l,Wr,!Lo),De(m,0,!0)!==0)break e;za=l,m.timeoutHandle=e1(MA.bind(null,m,f,Mr,Nm,Vv,l,Wr,Ol,ic,Lo,S,"Throttled",-0,0),y);break e}MA(m,f,Mr,Nm,Vv,l,Wr,Ol,ic,Lo,S,null,-0,0)}}break}while(!0);Ys(a)}function MA(a,l,f,m,y,S,A,B,$,fe,Me,Ce,pe,_e){if(a.timeoutHandle=-1,Ce=l.subtreeFlags,Ce&8192||(Ce&16785408)===16785408){Ce={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ma},gA(l,S,Ce);var rt=(S&62914560)===S?Rm-L():(S&4194048)===S?xA-L():0;if(rt=BU(Ce,rt),rt!==null){za=S,a.cancelPendingCommit=rt(LA.bind(null,a,l,S,f,m,y,A,B,$,Me,Ce,null,pe,_e)),Bo(a,S,A,!fe);return}}LA(a,l,S,f,m,y,A,B,$)}function ZP(a){for(var l=a;;){var f=l.tag;if((f===0||f===11||f===15)&&l.flags&16384&&(f=l.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var m=0;m<f.length;m++){var y=f[m],S=y.getSnapshot;y=y.value;try{if(!zr(S(),y))return!1}catch{return!1}}if(f=l.child,l.subtreeFlags&16384&&f!==null)f.return=l,l=f;else{if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function Bo(a,l,f,m){l&=~kv,l&=~Ol,a.suspendedLanes|=l,a.pingedLanes&=~l,m&&(a.warmLanes|=l),m=a.expirationTimes;for(var y=l;0<y;){var S=31-Ke(y),A=1<<S;m[S]=-1,y&=~A}f!==0&&Vp(a,f,l)}function Dm(){return(fn&6)===0?(If(0),!1):!0}function $v(){if($t!==null){if(Tn===0)var a=$t.return;else a=$t,Ra=Al=null,lv(a),Yu=null,xf=0,a=$t;for(;a!==null;)tA(a.alternate,a),a=a.return;$t=null}}function sc(a,l){var f=a.timeoutHandle;f!==-1&&(a.timeoutHandle=-1,vU(f)),f=a.cancelPendingCommit,f!==null&&(a.cancelPendingCommit=null,f()),za=0,$v(),Un=a,$t=f=Aa(a.current,null),Kt=l,Tn=0,Hr=null,Lo=!1,nc=Ve(a,l),Gv=!1,ic=Wr=kv=Ol=Po=ii=0,Mr=Bf=null,Vv=!1,(l&8)!==0&&(l|=l&32);var m=a.entangledLanes;if(m!==0)for(a=a.entanglements,m&=l;0<m;){var y=31-Ke(m),S=1<<y;l|=a[y],m&=~S}return Ia=l,Zp(),f}function EA(a,l){Ft=null,G.H=Rf,l===Xu||l===am?(l=kM(),Tn=3):l===K0?(l=kM(),Tn=4):Tn=l===Mv?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,Hr=l,$t===null&&(ii=1,xm(a,as(l,a.current)))}function AA(){var a=kr.current;return a===null?!0:(Kt&4194048)===Kt?cs===null:(Kt&62914560)===Kt||(Kt&536870912)!==0?a===cs:!1}function wA(){var a=G.H;return G.H=Rf,a===null?Rf:a}function RA(){var a=G.A;return G.A=KP,a}function Lm(){ii=4,Lo||(Kt&4194048)!==Kt&&kr.current!==null||(nc=!0),(Po&134217727)===0&&(Ol&134217727)===0||Un===null||Bo(Un,Kt,Wr,!1)}function jv(a,l,f){var m=fn;fn|=2;var y=wA(),S=RA();(Un!==a||Kt!==l)&&(Nm=null,sc(a,l)),l=!1;var A=ii;e:do try{if(Tn!==0&&$t!==null){var B=$t,$=Hr;switch(Tn){case 8:$v(),A=6;break e;case 3:case 2:case 9:case 6:kr.current===null&&(l=!0);var fe=Tn;if(Tn=0,Hr=null,ac(a,B,$,fe),f&&nc){A=0;break e}break;default:fe=Tn,Tn=0,Hr=null,ac(a,B,$,fe)}}JP(),A=ii;break}catch(Me){EA(a,Me)}while(!0);return l&&a.shellSuspendCounter++,Ra=Al=null,fn=m,G.H=y,G.A=S,$t===null&&(Un=null,Kt=0,Zp()),A}function JP(){for(;$t!==null;)CA($t)}function eU(a,l){var f=fn;fn|=2;var m=wA(),y=RA();Un!==a||Kt!==l?(Nm=null,Cm=L()+500,sc(a,l)):nc=Ve(a,l);e:do try{if(Tn!==0&&$t!==null){l=$t;var S=Hr;t:switch(Tn){case 1:Tn=0,Hr=null,ac(a,l,S,1);break;case 2:case 9:if(zM(S)){Tn=0,Hr=null,NA(l);break}l=function(){Tn!==2&&Tn!==9||Un!==a||(Tn=7),Ys(a)},S.then(l,l);break e;case 3:Tn=7;break e;case 4:Tn=5;break e;case 7:zM(S)?(Tn=0,Hr=null,NA(l)):(Tn=0,Hr=null,ac(a,l,S,7));break;case 5:var A=null;switch($t.tag){case 26:A=$t.memoizedState;case 5:case 27:var B=$t;if(A?m1(A):B.stateNode.complete){Tn=0,Hr=null;var $=B.sibling;if($!==null)$t=$;else{var fe=B.return;fe!==null?($t=fe,Pm(fe)):$t=null}break t}}Tn=0,Hr=null,ac(a,l,S,5);break;case 6:Tn=0,Hr=null,ac(a,l,S,6);break;case 8:$v(),ii=6;break e;default:throw Error(n(462))}}tU();break}catch(Me){EA(a,Me)}while(!0);return Ra=Al=null,G.H=m,G.A=y,fn=f,$t!==null?0:(Un=null,Kt=0,Zp(),ii)}function tU(){for(;$t!==null&&!lt();)CA($t)}function CA(a){var l=JE(a.alternate,a,Ia);a.memoizedProps=a.pendingProps,l===null?Pm(a):$t=l}function NA(a){var l=a,f=l.alternate;switch(l.tag){case 15:case 0:l=jE(f,l,l.pendingProps,l.type,void 0,Kt);break;case 11:l=jE(f,l,l.pendingProps,l.type.render,l.ref,Kt);break;case 5:lv(l);default:tA(f,l),l=$t=RM(l,Ia),l=JE(f,l,Ia)}a.memoizedProps=a.pendingProps,l===null?Pm(a):$t=l}function ac(a,l,f,m){Ra=Al=null,lv(l),Yu=null,xf=0;var y=l.return;try{if(HP(a,y,l,f,Kt)){ii=1,xm(a,as(f,a.current)),$t=null;return}}catch(S){if(y!==null)throw $t=y,S;ii=1,xm(a,as(f,a.current)),$t=null;return}l.flags&32768?(Zt||m===1?a=!0:nc||(Kt&536870912)!==0?a=!1:(Lo=a=!0,(m===2||m===9||m===3||m===6)&&(m=kr.current,m!==null&&m.tag===13&&(m.flags|=16384))),DA(l,a)):Pm(l)}function Pm(a){var l=a;do{if((l.flags&32768)!==0){DA(l,Lo);return}a=l.return;var f=$P(l.alternate,l,Ia);if(f!==null){$t=f;return}if(l=l.sibling,l!==null){$t=l;return}$t=l=a}while(l!==null);ii===0&&(ii=5)}function DA(a,l){do{var f=jP(a.alternate,a);if(f!==null){f.flags&=32767,$t=f;return}if(f=a.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!l&&(a=a.sibling,a!==null)){$t=a;return}$t=a=f}while(a!==null);ii=6,$t=null}function LA(a,l,f,m,y,S,A,B,$){a.cancelPendingCommit=null;do Um();while(Ti!==0);if((fn&6)!==0)throw Error(n(327));if(l!==null){if(l===a.current)throw Error(n(177));if(S=l.lanes|l.childLanes,S|=O0,Ms(a,f,S,A,B,$),a===Un&&($t=Un=null,Kt=0),rc=l,Oo=a,za=f,Hv=S,Wv=y,bA=m,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,sU(Se,function(){return FA(),null})):(a.callbackNode=null,a.callbackPriority=0),m=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||m){m=G.T,G.T=null,y=z.p,z.p=2,A=fn,fn|=4;try{XP(a,l,f)}finally{fn=A,z.p=y,G.T=m}}Ti=1,PA(),UA(),OA()}}function PA(){if(Ti===1){Ti=0;var a=Oo,l=rc,f=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||f){f=G.T,G.T=null;var m=z.p;z.p=2;var y=fn;fn|=4;try{dA(l,a);var S=sy,A=yM(a.containerInfo),B=S.focusedElem,$=S.selectionRange;if(A!==B&&B&&B.ownerDocument&&vM(B.ownerDocument.documentElement,B)){if($!==null&&N0(B)){var fe=$.start,Me=$.end;if(Me===void 0&&(Me=fe),"selectionStart"in B)B.selectionStart=fe,B.selectionEnd=Math.min(Me,B.value.length);else{var Ce=B.ownerDocument||document,pe=Ce&&Ce.defaultView||window;if(pe.getSelection){var _e=pe.getSelection(),rt=B.textContent.length,Tt=Math.min($.start,rt),Nn=$.end===void 0?Tt:Math.min($.end,rt);!_e.extend&&Tt>Nn&&(A=Nn,Nn=Tt,Tt=A);var ae=_M(B,Tt),Q=_M(B,Nn);if(ae&&Q&&(_e.rangeCount!==1||_e.anchorNode!==ae.node||_e.anchorOffset!==ae.offset||_e.focusNode!==Q.node||_e.focusOffset!==Q.offset)){var he=Ce.createRange();he.setStart(ae.node,ae.offset),_e.removeAllRanges(),Tt>Nn?(_e.addRange(he),_e.extend(Q.node,Q.offset)):(he.setEnd(Q.node,Q.offset),_e.addRange(he))}}}}for(Ce=[],_e=B;_e=_e.parentNode;)_e.nodeType===1&&Ce.push({element:_e,left:_e.scrollLeft,top:_e.scrollTop});for(typeof B.focus=="function"&&B.focus(),B=0;B<Ce.length;B++){var we=Ce[B];we.element.scrollLeft=we.left,we.element.scrollTop=we.top}}$m=!!ry,sy=ry=null}finally{fn=y,z.p=m,G.T=f}}a.current=l,Ti=2}}function UA(){if(Ti===2){Ti=0;var a=Oo,l=rc,f=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||f){f=G.T,G.T=null;var m=z.p;z.p=2;var y=fn;fn|=4;try{lA(a,l.alternate,l)}finally{fn=y,z.p=m,G.T=f}}Ti=3}}function OA(){if(Ti===4||Ti===3){Ti=0,V();var a=Oo,l=rc,f=za,m=bA;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?Ti=5:(Ti=0,rc=Oo=null,BA(a,a.pendingLanes));var y=a.pendingLanes;if(y===0&&(Uo=null),Du(f),l=l.stateNode,Fe&&typeof Fe.onCommitFiberRoot=="function")try{Fe.onCommitFiberRoot(Be,l,void 0,(l.current.flags&128)===128)}catch{}if(m!==null){l=G.T,y=z.p,z.p=2,G.T=null;try{for(var S=a.onRecoverableError,A=0;A<m.length;A++){var B=m[A];S(B.value,{componentStack:B.stack})}}finally{G.T=l,z.p=y}}(za&3)!==0&&Um(),Ys(a),y=a.pendingLanes,(f&261930)!==0&&(y&42)!==0?a===qv?Ff++:(Ff=0,qv=a):Ff=0,If(0)}}function BA(a,l){(a.pooledCacheLanes&=l)===0&&(l=a.pooledCache,l!=null&&(a.pooledCache=null,vf(l)))}function Um(){return PA(),UA(),OA(),FA()}function FA(){if(Ti!==5)return!1;var a=Oo,l=Hv;Hv=0;var f=Du(za),m=G.T,y=z.p;try{z.p=32>f?32:f,G.T=null,f=Wv,Wv=null;var S=Oo,A=za;if(Ti=0,rc=Oo=null,za=0,(fn&6)!==0)throw Error(n(331));var B=fn;if(fn|=4,vA(S.current),mA(S,S.current,A,f),fn=B,If(0,!1),Fe&&typeof Fe.onPostCommitFiberRoot=="function")try{Fe.onPostCommitFiberRoot(Be,S)}catch{}return!0}finally{z.p=y,G.T=m,BA(a,l)}}function IA(a,l,f){l=as(f,l),l=Tv(a.stateNode,l,2),a=Ro(a,l,2),a!==null&&(Qi(a,2),Ys(a))}function Mn(a,l,f){if(a.tag===3)IA(a,a,f);else for(;l!==null;){if(l.tag===3){IA(l,a,f);break}else if(l.tag===1){var m=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Uo===null||!Uo.has(m))){a=as(f,a),f=zE(2),m=Ro(l,f,2),m!==null&&(GE(f,m,l,a),Qi(m,2),Ys(m));break}}l=l.return}}function Xv(a,l,f){var m=a.pingCache;if(m===null){m=a.pingCache=new QP;var y=new Set;m.set(l,y)}else y=m.get(l),y===void 0&&(y=new Set,m.set(l,y));y.has(f)||(Gv=!0,y.add(f),a=nU.bind(null,a,l,f),l.then(a,a))}function nU(a,l,f){var m=a.pingCache;m!==null&&m.delete(l),a.pingedLanes|=a.suspendedLanes&f,a.warmLanes&=~f,Un===a&&(Kt&f)===f&&(ii===4||ii===3&&(Kt&62914560)===Kt&&300>L()-Rm?(fn&2)===0&&sc(a,0):kv|=f,ic===Kt&&(ic=0)),Ys(a)}function zA(a,l){l===0&&(l=bn()),a=Tl(a,l),a!==null&&(Qi(a,l),Ys(a))}function iU(a){var l=a.memoizedState,f=0;l!==null&&(f=l.retryLane),zA(a,f)}function rU(a,l){var f=0;switch(a.tag){case 31:case 13:var m=a.stateNode,y=a.memoizedState;y!==null&&(f=y.retryLane);break;case 19:m=a.stateNode;break;case 22:m=a.stateNode._retryCache;break;default:throw Error(n(314))}m!==null&&m.delete(l),zA(a,f)}function sU(a,l){return en(a,l)}var Om=null,oc=null,Yv=!1,Bm=!1,Kv=!1,Fo=0;function Ys(a){a!==oc&&a.next===null&&(oc===null?Om=oc=a:oc=oc.next=a),Bm=!0,Yv||(Yv=!0,oU())}function If(a,l){if(!Kv&&Bm){Kv=!0;do for(var f=!1,m=Om;m!==null;){if(a!==0){var y=m.pendingLanes;if(y===0)var S=0;else{var A=m.suspendedLanes,B=m.pingedLanes;S=(1<<31-Ke(42|a)+1)-1,S&=y&~(A&~B),S=S&201326741?S&201326741|1:S?S|2:0}S!==0&&(f=!0,HA(m,S))}else S=Kt,S=De(m,m===Un?S:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(S&3)===0||Ve(m,S)||(f=!0,HA(m,S));m=m.next}while(f);Kv=!1}}function aU(){GA()}function GA(){Bm=Yv=!1;var a=0;Fo!==0&&_U()&&(a=Fo);for(var l=L(),f=null,m=Om;m!==null;){var y=m.next,S=kA(m,l);S===0?(m.next=null,f===null?Om=y:f.next=y,y===null&&(oc=f)):(f=m,(a!==0||(S&3)!==0)&&(Bm=!0)),m=y}Ti!==0&&Ti!==5||If(a),Fo!==0&&(Fo=0)}function kA(a,l){for(var f=a.suspendedLanes,m=a.pingedLanes,y=a.expirationTimes,S=a.pendingLanes&-62914561;0<S;){var A=31-Ke(S),B=1<<A,$=y[A];$===-1?((B&f)===0||(B&m)!==0)&&(y[A]=Rt(B,l)):$<=l&&(a.expiredLanes|=B),S&=~B}if(l=Un,f=Kt,f=De(a,a===l?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m=a.callbackNode,f===0||a===l&&(Tn===2||Tn===9)||a.cancelPendingCommit!==null)return m!==null&&m!==null&&mn(m),a.callbackNode=null,a.callbackPriority=0;if((f&3)===0||Ve(a,f)){if(l=f&-f,l===a.callbackPriority)return l;switch(m!==null&&mn(m),Du(f)){case 2:case 8:f=Pe;break;case 32:f=Se;break;case 268435456:f=He;break;default:f=Se}return m=VA.bind(null,a),f=en(f,m),a.callbackPriority=l,a.callbackNode=f,l}return m!==null&&m!==null&&mn(m),a.callbackPriority=2,a.callbackNode=null,2}function VA(a,l){if(Ti!==0&&Ti!==5)return a.callbackNode=null,a.callbackPriority=0,null;var f=a.callbackNode;if(Um()&&a.callbackNode!==f)return null;var m=Kt;return m=De(a,a===Un?m:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m===0?null:(TA(a,m,l),kA(a,L()),a.callbackNode!=null&&a.callbackNode===f?VA.bind(null,a):null)}function HA(a,l){if(Um())return null;TA(a,l,!0)}function oU(){yU(function(){(fn&6)!==0?en(Ee,aU):GA()})}function Qv(){if(Fo===0){var a=$u;a===0&&(a=$e,$e<<=1,($e&261888)===0&&($e=256)),Fo=a}return Fo}function WA(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Wp(""+a)}function qA(a,l){var f=l.ownerDocument.createElement("input");return f.name=l.name,f.value=l.value,a.id&&f.setAttribute("form",a.id),l.parentNode.insertBefore(f,l),a=new FormData(a),f.parentNode.removeChild(f),a}function lU(a,l,f,m,y){if(l==="submit"&&f&&f.stateNode===y){var S=WA((y[Pi]||null).action),A=m.submitter;A&&(l=(l=A[Pi]||null)?WA(l.formAction):A.getAttribute("formAction"),l!==null&&(S=l,A=null));var B=new Xp("action","action",null,m,y);a.push({event:B,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(Fo!==0){var $=A?qA(y,A):new FormData(y);_v(f,{pending:!0,data:$,method:y.method,action:S},null,$)}}else typeof S=="function"&&(B.preventDefault(),$=A?qA(y,A):new FormData(y),_v(f,{pending:!0,data:$,method:y.method,action:S},S,$))},currentTarget:y}]})}}for(var Zv=0;Zv<U0.length;Zv++){var Jv=U0[Zv],uU=Jv.toLowerCase(),cU=Jv[0].toUpperCase()+Jv.slice(1);ws(uU,"on"+cU)}ws(SM,"onAnimationEnd"),ws(TM,"onAnimationIteration"),ws(MM,"onAnimationStart"),ws("dblclick","onDoubleClick"),ws("focusin","onFocus"),ws("focusout","onBlur"),ws(AP,"onTransitionRun"),ws(wP,"onTransitionStart"),ws(RP,"onTransitionCancel"),ws(EM,"onTransitionEnd"),le("onMouseEnter",["mouseout","mouseover"]),le("onMouseLeave",["mouseout","mouseover"]),le("onPointerEnter",["pointerout","pointerover"]),le("onPointerLeave",["pointerout","pointerover"]),de("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),de("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),de("onBeforeInput",["compositionend","keypress","textInput","paste"]),de("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),de("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),de("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),hU=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(zf));function $A(a,l){l=(l&4)!==0;for(var f=0;f<a.length;f++){var m=a[f],y=m.event;m=m.listeners;e:{var S=void 0;if(l)for(var A=m.length-1;0<=A;A--){var B=m[A],$=B.instance,fe=B.currentTarget;if(B=B.listener,$!==S&&y.isPropagationStopped())break e;S=B,y.currentTarget=fe;try{S(y)}catch(Me){Qp(Me)}y.currentTarget=null,S=$}else for(A=0;A<m.length;A++){if(B=m[A],$=B.instance,fe=B.currentTarget,B=B.listener,$!==S&&y.isPropagationStopped())break e;S=B,y.currentTarget=fe;try{S(y)}catch(Me){Qp(Me)}y.currentTarget=null,S=$}}}}function jt(a,l){var f=l[Lu];f===void 0&&(f=l[Lu]=new Set);var m=a+"__bubble";f.has(m)||(jA(l,a,2,!1),f.add(m))}function ey(a,l,f){var m=0;l&&(m|=4),jA(f,a,m,l)}var Fm="_reactListening"+Math.random().toString(36).slice(2);function ty(a){if(!a[Fm]){a[Fm]=!0,se.forEach(function(f){f!=="selectionchange"&&(hU.has(f)||ey(f,!1,a),ey(f,!0,a))});var l=a.nodeType===9?a:a.ownerDocument;l===null||l[Fm]||(l[Fm]=!0,ey("selectionchange",!1,l))}}function jA(a,l,f,m){switch(S1(l)){case 2:var y=zU;break;case 8:y=GU;break;default:y=gy}f=y.bind(null,l,f,a),y=void 0,!b0||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(y=!0),m?y!==void 0?a.addEventListener(l,f,{capture:!0,passive:y}):a.addEventListener(l,f,!0):y!==void 0?a.addEventListener(l,f,{passive:y}):a.addEventListener(l,f,!1)}function ny(a,l,f,m,y){var S=m;if((l&1)===0&&(l&2)===0&&m!==null)e:for(;;){if(m===null)return;var A=m.tag;if(A===3||A===4){var B=m.stateNode.containerInfo;if(B===y)break;if(A===4)for(A=m.return;A!==null;){var $=A.tag;if(($===3||$===4)&&A.stateNode.containerInfo===y)return;A=A.return}for(;B!==null;){if(A=vo(B),A===null)return;if($=A.tag,$===5||$===6||$===26||$===27){m=S=A;continue e}B=B.parentNode}}m=m.return}ZT(function(){var fe=S,Me=y0(f),Ce=[];e:{var pe=AM.get(a);if(pe!==void 0){var _e=Xp,rt=a;switch(a){case"keypress":if($p(f)===0)break e;case"keydown":case"keyup":_e=rP;break;case"focusin":rt="focus",_e=E0;break;case"focusout":rt="blur",_e=E0;break;case"beforeblur":case"afterblur":_e=E0;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_e=tM;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_e=$L;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_e=oP;break;case SM:case TM:case MM:_e=YL;break;case EM:_e=uP;break;case"scroll":case"scrollend":_e=WL;break;case"wheel":_e=hP;break;case"copy":case"cut":case"paste":_e=QL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_e=iM;break;case"toggle":case"beforetoggle":_e=dP}var Tt=(l&4)!==0,Nn=!Tt&&(a==="scroll"||a==="scrollend"),ae=Tt?pe!==null?pe+"Capture":null:pe;Tt=[];for(var Q=fe,he;Q!==null;){var we=Q;if(he=we.stateNode,we=we.tag,we!==5&&we!==26&&we!==27||he===null||ae===null||(we=of(Q,ae),we!=null&&Tt.push(Gf(Q,we,he))),Nn)break;Q=Q.return}0<Tt.length&&(pe=new _e(pe,rt,null,f,Me),Ce.push({event:pe,listeners:Tt}))}}if((l&7)===0){e:{if(pe=a==="mouseover"||a==="pointerover",_e=a==="mouseout"||a==="pointerout",pe&&f!==v0&&(rt=f.relatedTarget||f.fromElement)&&(vo(rt)||rt[Es]))break e;if((_e||pe)&&(pe=Me.window===Me?Me:(pe=Me.ownerDocument)?pe.defaultView||pe.parentWindow:window,_e?(rt=f.relatedTarget||f.toElement,_e=fe,rt=rt?vo(rt):null,rt!==null&&(Nn=s(rt),Tt=rt.tag,rt!==Nn||Tt!==5&&Tt!==27&&Tt!==6)&&(rt=null)):(_e=null,rt=fe),_e!==rt)){if(Tt=tM,we="onMouseLeave",ae="onMouseEnter",Q="mouse",(a==="pointerout"||a==="pointerover")&&(Tt=iM,we="onPointerLeave",ae="onPointerEnter",Q="pointer"),Nn=_e==null?pe:yl(_e),he=rt==null?pe:yl(rt),pe=new Tt(we,Q+"leave",_e,f,Me),pe.target=Nn,pe.relatedTarget=he,we=null,vo(Me)===fe&&(Tt=new Tt(ae,Q+"enter",rt,f,Me),Tt.target=he,Tt.relatedTarget=Nn,we=Tt),Nn=we,_e&&rt)t:{for(Tt=fU,ae=_e,Q=rt,he=0,we=ae;we;we=Tt(we))he++;we=0;for(var gt=Q;gt;gt=Tt(gt))we++;for(;0<he-we;)ae=Tt(ae),he--;for(;0<we-he;)Q=Tt(Q),we--;for(;he--;){if(ae===Q||Q!==null&&ae===Q.alternate){Tt=ae;break t}ae=Tt(ae),Q=Tt(Q)}Tt=null}else Tt=null;_e!==null&&XA(Ce,pe,_e,Tt,!1),rt!==null&&Nn!==null&&XA(Ce,Nn,rt,Tt,!0)}}e:{if(pe=fe?yl(fe):window,_e=pe.nodeName&&pe.nodeName.toLowerCase(),_e==="select"||_e==="input"&&pe.type==="file")var an=hM;else if(uM(pe))if(fM)an=TP;else{an=bP;var ut=xP}else _e=pe.nodeName,!_e||_e.toLowerCase()!=="input"||pe.type!=="checkbox"&&pe.type!=="radio"?fe&&As(fe.elementType)&&(an=hM):an=SP;if(an&&(an=an(a,fe))){cM(Ce,an,f,Me);break e}ut&&ut(a,pe,fe),a==="focusout"&&fe&&pe.type==="number"&&fe.memoizedProps.value!=null&&Oi(pe,"number",pe.value)}switch(ut=fe?yl(fe):window,a){case"focusin":(uM(ut)||ut.contentEditable==="true")&&(Iu=ut,D0=fe,mf=null);break;case"focusout":mf=D0=Iu=null;break;case"mousedown":L0=!0;break;case"contextmenu":case"mouseup":case"dragend":L0=!1,xM(Ce,f,Me);break;case"selectionchange":if(EP)break;case"keydown":case"keyup":xM(Ce,f,Me)}var kt;if(w0)e:{switch(a){case"compositionstart":var Qt="onCompositionStart";break e;case"compositionend":Qt="onCompositionEnd";break e;case"compositionupdate":Qt="onCompositionUpdate";break e}Qt=void 0}else Fu?oM(a,f)&&(Qt="onCompositionEnd"):a==="keydown"&&f.keyCode===229&&(Qt="onCompositionStart");Qt&&(rM&&f.locale!=="ko"&&(Fu||Qt!=="onCompositionStart"?Qt==="onCompositionEnd"&&Fu&&(kt=JT()):(bo=Me,S0="value"in bo?bo.value:bo.textContent,Fu=!0)),ut=Im(fe,Qt),0<ut.length&&(Qt=new nM(Qt,a,null,f,Me),Ce.push({event:Qt,listeners:ut}),kt?Qt.data=kt:(kt=lM(f),kt!==null&&(Qt.data=kt)))),(kt=mP?gP(a,f):_P(a,f))&&(Qt=Im(fe,"onBeforeInput"),0<Qt.length&&(ut=new nM("onBeforeInput","beforeinput",null,f,Me),Ce.push({event:ut,listeners:Qt}),ut.data=kt)),lU(Ce,a,fe,f,Me)}$A(Ce,l)})}function Gf(a,l,f){return{instance:a,listener:l,currentTarget:f}}function Im(a,l){for(var f=l+"Capture",m=[];a!==null;){var y=a,S=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||S===null||(y=of(a,f),y!=null&&m.unshift(Gf(a,y,S)),y=of(a,l),y!=null&&m.push(Gf(a,y,S))),a.tag===3)return m;a=a.return}return[]}function fU(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function XA(a,l,f,m,y){for(var S=l._reactName,A=[];f!==null&&f!==m;){var B=f,$=B.alternate,fe=B.stateNode;if(B=B.tag,$!==null&&$===m)break;B!==5&&B!==26&&B!==27||fe===null||($=fe,y?(fe=of(f,S),fe!=null&&A.unshift(Gf(f,fe,$))):y||(fe=of(f,S),fe!=null&&A.push(Gf(f,fe,$)))),f=f.return}A.length!==0&&a.push({event:l,listeners:A})}var dU=/\r\n?/g,pU=/\u0000|\uFFFD/g;function YA(a){return(typeof a=="string"?a:""+a).replace(dU,`
`).replace(pU,"")}function KA(a,l){return l=YA(l),YA(a)===l}function Cn(a,l,f,m,y,S){switch(f){case"children":typeof m=="string"?l==="body"||l==="textarea"&&m===""||Si(a,m):(typeof m=="number"||typeof m=="bigint")&&l!=="body"&&Si(a,""+m);break;case"className":xt(a,"class",m);break;case"tabIndex":xt(a,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":xt(a,f,m);break;case"style":Uu(a,m,S);break;case"data":if(l!=="object"){xt(a,"data",m);break}case"src":case"href":if(m===""&&(l!=="a"||f!=="href")){a.removeAttribute(f);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(f);break}m=Wp(""+m),a.setAttribute(f,m);break;case"action":case"formAction":if(typeof m=="function"){a.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof S=="function"&&(f==="formAction"?(l!=="input"&&Cn(a,l,"name",y.name,y,null),Cn(a,l,"formEncType",y.formEncType,y,null),Cn(a,l,"formMethod",y.formMethod,y,null),Cn(a,l,"formTarget",y.formTarget,y,null)):(Cn(a,l,"encType",y.encType,y,null),Cn(a,l,"method",y.method,y,null),Cn(a,l,"target",y.target,y,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(f);break}m=Wp(""+m),a.setAttribute(f,m);break;case"onClick":m!=null&&(a.onclick=Ma);break;case"onScroll":m!=null&&jt("scroll",a);break;case"onScrollEnd":m!=null&&jt("scrollend",a);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(f=m.__html,f!=null){if(y.children!=null)throw Error(n(60));a.innerHTML=f}}break;case"multiple":a.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":a.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){a.removeAttribute("xlink:href");break}f=Wp(""+m),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(f,""+m):a.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(f,""):a.removeAttribute(f);break;case"capture":case"download":m===!0?a.setAttribute(f,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(f,m):a.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?a.setAttribute(f,m):a.removeAttribute(f);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?a.removeAttribute(f):a.setAttribute(f,m);break;case"popover":jt("beforetoggle",a),jt("toggle",a),at(a,"popover",m);break;case"xlinkActuate":ot(a,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":ot(a,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":ot(a,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":ot(a,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":ot(a,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":ot(a,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":ot(a,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":ot(a,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":ot(a,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":at(a,"is",m);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=VL.get(f)||f,at(a,f,m))}}function iy(a,l,f,m,y,S){switch(f){case"style":Uu(a,m,S);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(f=m.__html,f!=null){if(y.children!=null)throw Error(n(60));a.innerHTML=f}}break;case"children":typeof m=="string"?Si(a,m):(typeof m=="number"||typeof m=="bigint")&&Si(a,""+m);break;case"onScroll":m!=null&&jt("scroll",a);break;case"onScrollEnd":m!=null&&jt("scrollend",a);break;case"onClick":m!=null&&(a.onclick=Ma);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!me.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(y=f.endsWith("Capture"),l=f.slice(2,y?f.length-7:void 0),S=a[Pi]||null,S=S!=null?S[f]:null,typeof S=="function"&&a.removeEventListener(l,S,y),typeof m=="function")){typeof S!="function"&&S!==null&&(f in a?a[f]=null:a.hasAttribute(f)&&a.removeAttribute(f)),a.addEventListener(l,m,y);break e}f in a?a[f]=m:m===!0?a.setAttribute(f,""):at(a,f,m)}}}function Vi(a,l,f){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":jt("error",a),jt("load",a);var m=!1,y=!1,S;for(S in f)if(f.hasOwnProperty(S)){var A=f[S];if(A!=null)switch(S){case"src":m=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:Cn(a,l,S,A,f,null)}}y&&Cn(a,l,"srcSet",f.srcSet,f,null),m&&Cn(a,l,"src",f.src,f,null);return;case"input":jt("invalid",a);var B=S=A=y=null,$=null,fe=null;for(m in f)if(f.hasOwnProperty(m)){var Me=f[m];if(Me!=null)switch(m){case"name":y=Me;break;case"type":A=Me;break;case"checked":$=Me;break;case"defaultChecked":fe=Me;break;case"value":S=Me;break;case"defaultValue":B=Me;break;case"children":case"dangerouslySetInnerHTML":if(Me!=null)throw Error(n(137,l));break;default:Cn(a,l,m,Me,f,null)}}Ta(a,S,B,$,fe,A,y,!1);return;case"select":jt("invalid",a),m=A=S=null;for(y in f)if(f.hasOwnProperty(y)&&(B=f[y],B!=null))switch(y){case"value":S=B;break;case"defaultValue":A=B;break;case"multiple":m=B;default:Cn(a,l,y,B,f,null)}l=S,f=A,a.multiple=!!m,l!=null?rs(a,!!m,l,!1):f!=null&&rs(a,!!m,f,!0);return;case"textarea":jt("invalid",a),S=y=m=null;for(A in f)if(f.hasOwnProperty(A)&&(B=f[A],B!=null))switch(A){case"value":m=B;break;case"defaultValue":y=B;break;case"children":S=B;break;case"dangerouslySetInnerHTML":if(B!=null)throw Error(n(91));break;default:Cn(a,l,A,B,f,null)}Bi(a,m,y,S);return;case"option":for($ in f)f.hasOwnProperty($)&&(m=f[$],m!=null)&&($==="selected"?a.selected=m&&typeof m!="function"&&typeof m!="symbol":Cn(a,l,$,m,f,null));return;case"dialog":jt("beforetoggle",a),jt("toggle",a),jt("cancel",a),jt("close",a);break;case"iframe":case"object":jt("load",a);break;case"video":case"audio":for(m=0;m<zf.length;m++)jt(zf[m],a);break;case"image":jt("error",a),jt("load",a);break;case"details":jt("toggle",a);break;case"embed":case"source":case"link":jt("error",a),jt("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(fe in f)if(f.hasOwnProperty(fe)&&(m=f[fe],m!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:Cn(a,l,fe,m,f,null)}return;default:if(As(l)){for(Me in f)f.hasOwnProperty(Me)&&(m=f[Me],m!==void 0&&iy(a,l,Me,m,f,void 0));return}}for(B in f)f.hasOwnProperty(B)&&(m=f[B],m!=null&&Cn(a,l,B,m,f,null))}function mU(a,l,f,m){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,S=null,A=null,B=null,$=null,fe=null,Me=null;for(_e in f){var Ce=f[_e];if(f.hasOwnProperty(_e)&&Ce!=null)switch(_e){case"checked":break;case"value":break;case"defaultValue":$=Ce;default:m.hasOwnProperty(_e)||Cn(a,l,_e,null,m,Ce)}}for(var pe in m){var _e=m[pe];if(Ce=f[pe],m.hasOwnProperty(pe)&&(_e!=null||Ce!=null))switch(pe){case"type":S=_e;break;case"name":y=_e;break;case"checked":fe=_e;break;case"defaultChecked":Me=_e;break;case"value":A=_e;break;case"defaultValue":B=_e;break;case"children":case"dangerouslySetInnerHTML":if(_e!=null)throw Error(n(137,l));break;default:_e!==Ce&&Cn(a,l,pe,_e,m,Ce)}}Ui(a,A,B,$,fe,Me,S,y);return;case"select":_e=A=B=pe=null;for(S in f)if($=f[S],f.hasOwnProperty(S)&&$!=null)switch(S){case"value":break;case"multiple":_e=$;default:m.hasOwnProperty(S)||Cn(a,l,S,null,m,$)}for(y in m)if(S=m[y],$=f[y],m.hasOwnProperty(y)&&(S!=null||$!=null))switch(y){case"value":pe=S;break;case"defaultValue":B=S;break;case"multiple":A=S;default:S!==$&&Cn(a,l,y,S,m,$)}l=B,f=A,m=_e,pe!=null?rs(a,!!f,pe,!1):!!m!=!!f&&(l!=null?rs(a,!!f,l,!0):rs(a,!!f,f?[]:"",!1));return;case"textarea":_e=pe=null;for(B in f)if(y=f[B],f.hasOwnProperty(B)&&y!=null&&!m.hasOwnProperty(B))switch(B){case"value":break;case"children":break;default:Cn(a,l,B,null,m,y)}for(A in m)if(y=m[A],S=f[A],m.hasOwnProperty(A)&&(y!=null||S!=null))switch(A){case"value":pe=y;break;case"defaultValue":_e=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(n(91));break;default:y!==S&&Cn(a,l,A,y,m,S)}Sn(a,pe,_e);return;case"option":for(var rt in f)pe=f[rt],f.hasOwnProperty(rt)&&pe!=null&&!m.hasOwnProperty(rt)&&(rt==="selected"?a.selected=!1:Cn(a,l,rt,null,m,pe));for($ in m)pe=m[$],_e=f[$],m.hasOwnProperty($)&&pe!==_e&&(pe!=null||_e!=null)&&($==="selected"?a.selected=pe&&typeof pe!="function"&&typeof pe!="symbol":Cn(a,l,$,pe,m,_e));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Tt in f)pe=f[Tt],f.hasOwnProperty(Tt)&&pe!=null&&!m.hasOwnProperty(Tt)&&Cn(a,l,Tt,null,m,pe);for(fe in m)if(pe=m[fe],_e=f[fe],m.hasOwnProperty(fe)&&pe!==_e&&(pe!=null||_e!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(n(137,l));break;default:Cn(a,l,fe,pe,m,_e)}return;default:if(As(l)){for(var Nn in f)pe=f[Nn],f.hasOwnProperty(Nn)&&pe!==void 0&&!m.hasOwnProperty(Nn)&&iy(a,l,Nn,void 0,m,pe);for(Me in m)pe=m[Me],_e=f[Me],!m.hasOwnProperty(Me)||pe===_e||pe===void 0&&_e===void 0||iy(a,l,Me,pe,m,_e);return}}for(var ae in f)pe=f[ae],f.hasOwnProperty(ae)&&pe!=null&&!m.hasOwnProperty(ae)&&Cn(a,l,ae,null,m,pe);for(Ce in m)pe=m[Ce],_e=f[Ce],!m.hasOwnProperty(Ce)||pe===_e||pe==null&&_e==null||Cn(a,l,Ce,pe,m,_e)}function QA(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function gU(){if(typeof performance.getEntriesByType=="function"){for(var a=0,l=0,f=performance.getEntriesByType("resource"),m=0;m<f.length;m++){var y=f[m],S=y.transferSize,A=y.initiatorType,B=y.duration;if(S&&B&&QA(A)){for(A=0,B=y.responseEnd,m+=1;m<f.length;m++){var $=f[m],fe=$.startTime;if(fe>B)break;var Me=$.transferSize,Ce=$.initiatorType;Me&&QA(Ce)&&($=$.responseEnd,A+=Me*($<B?1:(B-fe)/($-fe)))}if(--m,l+=8*(S+A)/(y.duration/1e3),a++,10<a)break}}if(0<a)return l/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var ry=null,sy=null;function zm(a){return a.nodeType===9?a:a.ownerDocument}function ZA(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function JA(a,l){if(a===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&l==="foreignObject"?0:a}function ay(a,l){return a==="textarea"||a==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var oy=null;function _U(){var a=window.event;return a&&a.type==="popstate"?a===oy?!1:(oy=a,!0):(oy=null,!1)}var e1=typeof setTimeout=="function"?setTimeout:void 0,vU=typeof clearTimeout=="function"?clearTimeout:void 0,t1=typeof Promise=="function"?Promise:void 0,yU=typeof queueMicrotask=="function"?queueMicrotask:typeof t1<"u"?function(a){return t1.resolve(null).then(a).catch(xU)}:e1;function xU(a){setTimeout(function(){throw a})}function Io(a){return a==="head"}function n1(a,l){var f=l,m=0;do{var y=f.nextSibling;if(a.removeChild(f),y&&y.nodeType===8)if(f=y.data,f==="/$"||f==="/&"){if(m===0){a.removeChild(y),hc(l);return}m--}else if(f==="$"||f==="$?"||f==="$~"||f==="$!"||f==="&")m++;else if(f==="html")kf(a.ownerDocument.documentElement);else if(f==="head"){f=a.ownerDocument.head,kf(f);for(var S=f.firstChild;S;){var A=S.nextSibling,B=S.nodeName;S[vl]||B==="SCRIPT"||B==="STYLE"||B==="LINK"&&S.rel.toLowerCase()==="stylesheet"||f.removeChild(S),S=A}}else f==="body"&&kf(a.ownerDocument.body);f=y}while(f);hc(l)}function i1(a,l){var f=a;a=0;do{var m=f.nextSibling;if(f.nodeType===1?l?(f._stashedDisplay=f.style.display,f.style.display="none"):(f.style.display=f._stashedDisplay||"",f.getAttribute("style")===""&&f.removeAttribute("style")):f.nodeType===3&&(l?(f._stashedText=f.nodeValue,f.nodeValue=""):f.nodeValue=f._stashedText||""),m&&m.nodeType===8)if(f=m.data,f==="/$"){if(a===0)break;a--}else f!=="$"&&f!=="$?"&&f!=="$~"&&f!=="$!"||a++;f=m}while(f)}function ly(a){var l=a.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var f=l;switch(l=l.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":ly(f),af(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}a.removeChild(f)}}function bU(a,l,f,m){for(;a.nodeType===1;){var y=f;if(a.nodeName.toLowerCase()!==l.toLowerCase()){if(!m&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(m){if(!a[vl])switch(l){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(S=a.getAttribute("rel"),S==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(S!==y.rel||a.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||a.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||a.getAttribute("title")!==(y.title==null?null:y.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(S=a.getAttribute("src"),(S!==(y.src==null?null:y.src)||a.getAttribute("type")!==(y.type==null?null:y.type)||a.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&S&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(l==="input"&&a.type==="hidden"){var S=y.name==null?null:""+y.name;if(y.type==="hidden"&&a.getAttribute("name")===S)return a}else return a;if(a=hs(a.nextSibling),a===null)break}return null}function SU(a,l,f){if(l==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!f||(a=hs(a.nextSibling),a===null))return null;return a}function r1(a,l){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!l||(a=hs(a.nextSibling),a===null))return null;return a}function uy(a){return a.data==="$?"||a.data==="$~"}function cy(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function TU(a,l){var f=a.ownerDocument;if(a.data==="$~")a._reactRetry=l;else if(a.data!=="$?"||f.readyState!=="loading")l();else{var m=function(){l(),f.removeEventListener("DOMContentLoaded",m)};f.addEventListener("DOMContentLoaded",m),a._reactRetry=m}}function hs(a){for(;a!=null;a=a.nextSibling){var l=a.nodeType;if(l===1||l===3)break;if(l===8){if(l=a.data,l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"||l==="F!"||l==="F")break;if(l==="/$"||l==="/&")return null}}return a}var hy=null;function s1(a){a=a.nextSibling;for(var l=0;a;){if(a.nodeType===8){var f=a.data;if(f==="/$"||f==="/&"){if(l===0)return hs(a.nextSibling);l--}else f!=="$"&&f!=="$!"&&f!=="$?"&&f!=="$~"&&f!=="&"||l++}a=a.nextSibling}return null}function a1(a){a=a.previousSibling;for(var l=0;a;){if(a.nodeType===8){var f=a.data;if(f==="$"||f==="$!"||f==="$?"||f==="$~"||f==="&"){if(l===0)return a;l--}else f!=="/$"&&f!=="/&"||l++}a=a.previousSibling}return null}function o1(a,l,f){switch(l=zm(f),a){case"html":if(a=l.documentElement,!a)throw Error(n(452));return a;case"head":if(a=l.head,!a)throw Error(n(453));return a;case"body":if(a=l.body,!a)throw Error(n(454));return a;default:throw Error(n(451))}}function kf(a){for(var l=a.attributes;l.length;)a.removeAttributeNode(l[0]);af(a)}var fs=new Map,l1=new Set;function Gm(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Ga=z.d;z.d={f:MU,r:EU,D:AU,C:wU,L:RU,m:CU,X:DU,S:NU,M:LU};function MU(){var a=Ga.f(),l=Dm();return a||l}function EU(a){var l=yo(a);l!==null&&l.tag===5&&l.type==="form"?EE(l):Ga.r(a)}var lc=typeof document>"u"?null:document;function u1(a,l,f){var m=lc;if(m&&typeof l=="string"&&l){var y=Nt(l);y='link[rel="'+a+'"][href="'+y+'"]',typeof f=="string"&&(y+='[crossorigin="'+f+'"]'),l1.has(y)||(l1.add(y),a={rel:a,crossOrigin:f,href:l},m.querySelector(y)===null&&(l=m.createElement("link"),Vi(l,"link",a),F(l),m.head.appendChild(l)))}}function AU(a){Ga.D(a),u1("dns-prefetch",a,null)}function wU(a,l){Ga.C(a,l),u1("preconnect",a,l)}function RU(a,l,f){Ga.L(a,l,f);var m=lc;if(m&&a&&l){var y='link[rel="preload"][as="'+Nt(l)+'"]';l==="image"&&f&&f.imageSrcSet?(y+='[imagesrcset="'+Nt(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(y+='[imagesizes="'+Nt(f.imageSizes)+'"]')):y+='[href="'+Nt(a)+'"]';var S=y;switch(l){case"style":S=uc(a);break;case"script":S=cc(a)}fs.has(S)||(a=p({rel:"preload",href:l==="image"&&f&&f.imageSrcSet?void 0:a,as:l},f),fs.set(S,a),m.querySelector(y)!==null||l==="style"&&m.querySelector(Vf(S))||l==="script"&&m.querySelector(Hf(S))||(l=m.createElement("link"),Vi(l,"link",a),F(l),m.head.appendChild(l)))}}function CU(a,l){Ga.m(a,l);var f=lc;if(f&&a){var m=l&&typeof l.as=="string"?l.as:"script",y='link[rel="modulepreload"][as="'+Nt(m)+'"][href="'+Nt(a)+'"]',S=y;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":S=cc(a)}if(!fs.has(S)&&(a=p({rel:"modulepreload",href:a},l),fs.set(S,a),f.querySelector(y)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(Hf(S)))return}m=f.createElement("link"),Vi(m,"link",a),F(m),f.head.appendChild(m)}}}function NU(a,l,f){Ga.S(a,l,f);var m=lc;if(m&&a){var y=xo(m).hoistableStyles,S=uc(a);l=l||"default";var A=y.get(S);if(!A){var B={loading:0,preload:null};if(A=m.querySelector(Vf(S)))B.loading=5;else{a=p({rel:"stylesheet",href:a,"data-precedence":l},f),(f=fs.get(S))&&fy(a,f);var $=A=m.createElement("link");F($),Vi($,"link",a),$._p=new Promise(function(fe,Me){$.onload=fe,$.onerror=Me}),$.addEventListener("load",function(){B.loading|=1}),$.addEventListener("error",function(){B.loading|=2}),B.loading|=4,km(A,l,m)}A={type:"stylesheet",instance:A,count:1,state:B},y.set(S,A)}}}function DU(a,l){Ga.X(a,l);var f=lc;if(f&&a){var m=xo(f).hoistableScripts,y=cc(a),S=m.get(y);S||(S=f.querySelector(Hf(y)),S||(a=p({src:a,async:!0},l),(l=fs.get(y))&&dy(a,l),S=f.createElement("script"),F(S),Vi(S,"link",a),f.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},m.set(y,S))}}function LU(a,l){Ga.M(a,l);var f=lc;if(f&&a){var m=xo(f).hoistableScripts,y=cc(a),S=m.get(y);S||(S=f.querySelector(Hf(y)),S||(a=p({src:a,async:!0,type:"module"},l),(l=fs.get(y))&&dy(a,l),S=f.createElement("script"),F(S),Vi(S,"link",a),f.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},m.set(y,S))}}function c1(a,l,f,m){var y=(y=W.current)?Gm(y):null;if(!y)throw Error(n(446));switch(a){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(l=uc(f.href),f=xo(y).hoistableStyles,m=f.get(l),m||(m={type:"style",instance:null,count:0,state:null},f.set(l,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){a=uc(f.href);var S=xo(y).hoistableStyles,A=S.get(a);if(A||(y=y.ownerDocument||y,A={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},S.set(a,A),(S=y.querySelector(Vf(a)))&&!S._p&&(A.instance=S,A.state.loading=5),fs.has(a)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},fs.set(a,f),S||PU(y,a,f,A.state))),l&&m===null)throw Error(n(528,""));return A}if(l&&m!==null)throw Error(n(529,""));return null;case"script":return l=f.async,f=f.src,typeof f=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=cc(f),f=xo(y).hoistableScripts,m=f.get(l),m||(m={type:"script",instance:null,count:0,state:null},f.set(l,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,a))}}function uc(a){return'href="'+Nt(a)+'"'}function Vf(a){return'link[rel="stylesheet"]['+a+"]"}function h1(a){return p({},a,{"data-precedence":a.precedence,precedence:null})}function PU(a,l,f,m){a.querySelector('link[rel="preload"][as="style"]['+l+"]")?m.loading=1:(l=a.createElement("link"),m.preload=l,l.addEventListener("load",function(){return m.loading|=1}),l.addEventListener("error",function(){return m.loading|=2}),Vi(l,"link",f),F(l),a.head.appendChild(l))}function cc(a){return'[src="'+Nt(a)+'"]'}function Hf(a){return"script[async]"+a}function f1(a,l,f){if(l.count++,l.instance===null)switch(l.type){case"style":var m=a.querySelector('style[data-href~="'+Nt(f.href)+'"]');if(m)return l.instance=m,F(m),m;var y=p({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return m=(a.ownerDocument||a).createElement("style"),F(m),Vi(m,"style",y),km(m,f.precedence,a),l.instance=m;case"stylesheet":y=uc(f.href);var S=a.querySelector(Vf(y));if(S)return l.state.loading|=4,l.instance=S,F(S),S;m=h1(f),(y=fs.get(y))&&fy(m,y),S=(a.ownerDocument||a).createElement("link"),F(S);var A=S;return A._p=new Promise(function(B,$){A.onload=B,A.onerror=$}),Vi(S,"link",m),l.state.loading|=4,km(S,f.precedence,a),l.instance=S;case"script":return S=cc(f.src),(y=a.querySelector(Hf(S)))?(l.instance=y,F(y),y):(m=f,(y=fs.get(S))&&(m=p({},f),dy(m,y)),a=a.ownerDocument||a,y=a.createElement("script"),F(y),Vi(y,"link",m),a.head.appendChild(y),l.instance=y);case"void":return null;default:throw Error(n(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(m=l.instance,l.state.loading|=4,km(m,f.precedence,a));return l.instance}function km(a,l,f){for(var m=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=m.length?m[m.length-1]:null,S=y,A=0;A<m.length;A++){var B=m[A];if(B.dataset.precedence===l)S=B;else if(S!==y)break}S?S.parentNode.insertBefore(a,S.nextSibling):(l=f.nodeType===9?f.head:f,l.insertBefore(a,l.firstChild))}function fy(a,l){a.crossOrigin==null&&(a.crossOrigin=l.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=l.referrerPolicy),a.title==null&&(a.title=l.title)}function dy(a,l){a.crossOrigin==null&&(a.crossOrigin=l.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=l.referrerPolicy),a.integrity==null&&(a.integrity=l.integrity)}var Vm=null;function d1(a,l,f){if(Vm===null){var m=new Map,y=Vm=new Map;y.set(f,m)}else y=Vm,m=y.get(f),m||(m=new Map,y.set(f,m));if(m.has(a))return m;for(m.set(a,null),f=f.getElementsByTagName(a),y=0;y<f.length;y++){var S=f[y];if(!(S[vl]||S[fi]||a==="link"&&S.getAttribute("rel")==="stylesheet")&&S.namespaceURI!=="http://www.w3.org/2000/svg"){var A=S.getAttribute(l)||"";A=a+A;var B=m.get(A);B?B.push(S):m.set(A,[S])}}return m}function p1(a,l,f){a=a.ownerDocument||a,a.head.insertBefore(f,l==="title"?a.querySelector("head > title"):null)}function UU(a,l,f){if(f===1||l.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;return l.rel==="stylesheet"?(a=l.disabled,typeof l.precedence=="string"&&a==null):!0;case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function m1(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function OU(a,l,f,m){if(f.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var y=uc(m.href),S=l.querySelector(Vf(y));if(S){l=S._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(a.count++,a=Hm.bind(a),l.then(a,a)),f.state.loading|=4,f.instance=S,F(S);return}S=l.ownerDocument||l,m=h1(m),(y=fs.get(y))&&fy(m,y),S=S.createElement("link"),F(S);var A=S;A._p=new Promise(function(B,$){A.onload=B,A.onerror=$}),Vi(S,"link",m),f.instance=S}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(f,l),(l=f.state.preload)&&(f.state.loading&3)===0&&(a.count++,f=Hm.bind(a),l.addEventListener("load",f),l.addEventListener("error",f))}}var py=0;function BU(a,l){return a.stylesheets&&a.count===0&&qm(a,a.stylesheets),0<a.count||0<a.imgCount?function(f){var m=setTimeout(function(){if(a.stylesheets&&qm(a,a.stylesheets),a.unsuspend){var S=a.unsuspend;a.unsuspend=null,S()}},6e4+l);0<a.imgBytes&&py===0&&(py=62500*gU());var y=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&qm(a,a.stylesheets),a.unsuspend)){var S=a.unsuspend;a.unsuspend=null,S()}},(a.imgBytes>py?50:800)+l);return a.unsuspend=f,function(){a.unsuspend=null,clearTimeout(m),clearTimeout(y)}}:null}function Hm(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)qm(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Wm=null;function qm(a,l){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Wm=new Map,l.forEach(FU,a),Wm=null,Hm.call(a))}function FU(a,l){if(!(l.state.loading&4)){var f=Wm.get(a);if(f)var m=f.get(null);else{f=new Map,Wm.set(a,f);for(var y=a.querySelectorAll("link[data-precedence],style[data-precedence]"),S=0;S<y.length;S++){var A=y[S];(A.nodeName==="LINK"||A.getAttribute("media")!=="not all")&&(f.set(A.dataset.precedence,A),m=A)}m&&f.set(null,m)}y=l.instance,A=y.getAttribute("data-precedence"),S=f.get(A)||m,S===m&&f.set(null,y),f.set(A,y),this.count++,m=Hm.bind(this),y.addEventListener("load",m),y.addEventListener("error",m),S?S.parentNode.insertBefore(y,S.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(y,a.firstChild)),l.state.loading|=4}}var Wf={$$typeof:E,Provider:null,Consumer:null,_currentValue:q,_currentValue2:q,_threadCount:0};function IU(a,l,f,m,y,S,A,B,$){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=rn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rn(0),this.hiddenUpdates=rn(null),this.identifierPrefix=m,this.onUncaughtError=y,this.onCaughtError=S,this.onRecoverableError=A,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=$,this.incompleteTransitions=new Map}function g1(a,l,f,m,y,S,A,B,$,fe,Me,Ce){return a=new IU(a,l,f,A,$,fe,Me,Ce,B),l=1,S===!0&&(l|=24),S=Gr(3,null,null,l),a.current=S,S.stateNode=a,l=j0(),l.refCount++,a.pooledCache=l,l.refCount++,S.memoizedState={element:m,isDehydrated:f,cache:l},Q0(S),a}function _1(a){return a?(a=ku,a):ku}function v1(a,l,f,m,y,S){y=_1(y),m.context===null?m.context=y:m.pendingContext=y,m=wo(l),m.payload={element:f},S=S===void 0?null:S,S!==null&&(m.callback=S),f=Ro(a,m,l),f!==null&&(Er(f,a,l),Sf(f,a,l))}function y1(a,l){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var f=a.retryLane;a.retryLane=f!==0&&f<l?f:l}}function my(a,l){y1(a,l),(a=a.alternate)&&y1(a,l)}function x1(a){if(a.tag===13||a.tag===31){var l=Tl(a,67108864);l!==null&&Er(l,a,67108864),my(a,67108864)}}function b1(a){if(a.tag===13||a.tag===31){var l=qr();l=nf(l);var f=Tl(a,l);f!==null&&Er(f,a,l),my(a,l)}}var $m=!0;function zU(a,l,f,m){var y=G.T;G.T=null;var S=z.p;try{z.p=2,gy(a,l,f,m)}finally{z.p=S,G.T=y}}function GU(a,l,f,m){var y=G.T;G.T=null;var S=z.p;try{z.p=8,gy(a,l,f,m)}finally{z.p=S,G.T=y}}function gy(a,l,f,m){if($m){var y=_y(m);if(y===null)ny(a,l,m,jm,f),T1(a,m);else if(VU(y,a,l,f,m))m.stopPropagation();else if(T1(a,m),l&4&&-1<kU.indexOf(a)){for(;y!==null;){var S=yo(y);if(S!==null)switch(S.tag){case 3:if(S=S.stateNode,S.current.memoizedState.isDehydrated){var A=Oe(S.pendingLanes);if(A!==0){var B=S;for(B.pendingLanes|=2,B.entangledLanes|=2;A;){var $=1<<31-Ke(A);B.entanglements[1]|=$,A&=~$}Ys(S),(fn&6)===0&&(Cm=L()+500,If(0))}}break;case 31:case 13:B=Tl(S,2),B!==null&&Er(B,S,2),Dm(),my(S,2)}if(S=_y(m),S===null&&ny(a,l,m,jm,f),S===y)break;y=S}y!==null&&m.stopPropagation()}else ny(a,l,m,null,f)}}function _y(a){return a=y0(a),vy(a)}var jm=null;function vy(a){if(jm=null,a=vo(a),a!==null){var l=s(a);if(l===null)a=null;else{var f=l.tag;if(f===13){if(a=o(l),a!==null)return a;a=null}else if(f===31){if(a=u(l),a!==null)return a;a=null}else if(f===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;a=null}else l!==a&&(a=null)}}return jm=a,null}function S1(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(re()){case Ee:return 2;case Pe:return 8;case Se:case ft:return 32;case He:return 268435456;default:return 32}default:return 32}}var yy=!1,zo=null,Go=null,ko=null,qf=new Map,$f=new Map,Vo=[],kU="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function T1(a,l){switch(a){case"focusin":case"focusout":zo=null;break;case"dragenter":case"dragleave":Go=null;break;case"mouseover":case"mouseout":ko=null;break;case"pointerover":case"pointerout":qf.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":$f.delete(l.pointerId)}}function jf(a,l,f,m,y,S){return a===null||a.nativeEvent!==S?(a={blockedOn:l,domEventName:f,eventSystemFlags:m,nativeEvent:S,targetContainers:[y]},l!==null&&(l=yo(l),l!==null&&x1(l)),a):(a.eventSystemFlags|=m,l=a.targetContainers,y!==null&&l.indexOf(y)===-1&&l.push(y),a)}function VU(a,l,f,m,y){switch(l){case"focusin":return zo=jf(zo,a,l,f,m,y),!0;case"dragenter":return Go=jf(Go,a,l,f,m,y),!0;case"mouseover":return ko=jf(ko,a,l,f,m,y),!0;case"pointerover":var S=y.pointerId;return qf.set(S,jf(qf.get(S)||null,a,l,f,m,y)),!0;case"gotpointercapture":return S=y.pointerId,$f.set(S,jf($f.get(S)||null,a,l,f,m,y)),!0}return!1}function M1(a){var l=vo(a.target);if(l!==null){var f=s(l);if(f!==null){if(l=f.tag,l===13){if(l=o(f),l!==null){a.blockedOn=l,qs(a.priority,function(){b1(f)});return}}else if(l===31){if(l=u(f),l!==null){a.blockedOn=l,qs(a.priority,function(){b1(f)});return}}else if(l===3&&f.stateNode.current.memoizedState.isDehydrated){a.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Xm(a){if(a.blockedOn!==null)return!1;for(var l=a.targetContainers;0<l.length;){var f=_y(a.nativeEvent);if(f===null){f=a.nativeEvent;var m=new f.constructor(f.type,f);v0=m,f.target.dispatchEvent(m),v0=null}else return l=yo(f),l!==null&&x1(l),a.blockedOn=f,!1;l.shift()}return!0}function E1(a,l,f){Xm(a)&&f.delete(l)}function HU(){yy=!1,zo!==null&&Xm(zo)&&(zo=null),Go!==null&&Xm(Go)&&(Go=null),ko!==null&&Xm(ko)&&(ko=null),qf.forEach(E1),$f.forEach(E1)}function Ym(a,l){a.blockedOn===l&&(a.blockedOn=null,yy||(yy=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,HU)))}var Km=null;function A1(a){Km!==a&&(Km=a,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Km===a&&(Km=null);for(var l=0;l<a.length;l+=3){var f=a[l],m=a[l+1],y=a[l+2];if(typeof m!="function"){if(vy(m||f)===null)continue;break}var S=yo(f);S!==null&&(a.splice(l,3),l-=3,_v(S,{pending:!0,data:y,method:f.method,action:m},m,y))}}))}function hc(a){function l($){return Ym($,a)}zo!==null&&Ym(zo,a),Go!==null&&Ym(Go,a),ko!==null&&Ym(ko,a),qf.forEach(l),$f.forEach(l);for(var f=0;f<Vo.length;f++){var m=Vo[f];m.blockedOn===a&&(m.blockedOn=null)}for(;0<Vo.length&&(f=Vo[0],f.blockedOn===null);)M1(f),f.blockedOn===null&&Vo.shift();if(f=(a.ownerDocument||a).$$reactFormReplay,f!=null)for(m=0;m<f.length;m+=3){var y=f[m],S=f[m+1],A=y[Pi]||null;if(typeof S=="function")A||A1(f);else if(A){var B=null;if(S&&S.hasAttribute("formAction")){if(y=S,A=S[Pi]||null)B=A.formAction;else if(vy(y)!==null)continue}else B=A.action;typeof B=="function"?f[m+1]=B:(f.splice(m,3),m-=3),A1(f)}}}function w1(){function a(S){S.canIntercept&&S.info==="react-transition"&&S.intercept({handler:function(){return new Promise(function(A){return y=A})},focusReset:"manual",scroll:"manual"})}function l(){y!==null&&(y(),y=null),m||setTimeout(f,20)}function f(){if(!m&&!navigation.transition){var S=navigation.currentEntry;S&&S.url!=null&&navigation.navigate(S.url,{state:S.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,y=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",l),navigation.addEventListener("navigateerror",l),setTimeout(f,100),function(){m=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",l),navigation.removeEventListener("navigateerror",l),y!==null&&(y(),y=null)}}}function xy(a){this._internalRoot=a}Qm.prototype.render=xy.prototype.render=function(a){var l=this._internalRoot;if(l===null)throw Error(n(409));var f=l.current,m=qr();v1(f,m,a,l,null,null)},Qm.prototype.unmount=xy.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var l=a.containerInfo;v1(a.current,2,null,a,null,null),Dm(),l[Es]=null}};function Qm(a){this._internalRoot=a}Qm.prototype.unstable_scheduleHydration=function(a){if(a){var l=rf();a={blockedOn:null,target:a,priority:l};for(var f=0;f<Vo.length&&l!==0&&l<Vo[f].priority;f++);Vo.splice(f,0,a),f===0&&M1(a)}};var R1=e.version;if(R1!=="19.2.4")throw Error(n(527,R1,"19.2.4"));z.findDOMNode=function(a){var l=a._reactInternals;if(l===void 0)throw typeof a.render=="function"?Error(n(188)):(a=Object.keys(a).join(","),Error(n(268,a)));return a=h(l),a=a!==null?d(a):null,a=a===null?null:a.stateNode,a};var WU={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:G,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zm.isDisabled&&Zm.supportsFiber)try{Be=Zm.inject(WU),Fe=Zm}catch{}}return Yf.createRoot=function(a,l){if(!r(a))throw Error(n(299));var f=!1,m="",y=OE,S=BE,A=FE;return l!=null&&(l.unstable_strictMode===!0&&(f=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onUncaughtError!==void 0&&(y=l.onUncaughtError),l.onCaughtError!==void 0&&(S=l.onCaughtError),l.onRecoverableError!==void 0&&(A=l.onRecoverableError)),l=g1(a,1,!1,null,null,f,m,null,y,S,A,w1),a[Es]=l.current,ty(a),new xy(l)},Yf.hydrateRoot=function(a,l,f){if(!r(a))throw Error(n(299));var m=!1,y="",S=OE,A=BE,B=FE,$=null;return f!=null&&(f.unstable_strictMode===!0&&(m=!0),f.identifierPrefix!==void 0&&(y=f.identifierPrefix),f.onUncaughtError!==void 0&&(S=f.onUncaughtError),f.onCaughtError!==void 0&&(A=f.onCaughtError),f.onRecoverableError!==void 0&&(B=f.onRecoverableError),f.formState!==void 0&&($=f.formState)),l=g1(a,1,!0,l,f??null,m,y,$,S,A,B,w1),l.context=_1(null),f=l.current,m=qr(),m=nf(m),y=wo(m),y.callback=null,Ro(f,y,m),f=m,l.current.lanes=f,Qi(l,f),Ys(l),a[Es]=l.current,ty(a),new Qm(l)},Yf.version="19.2.4",Yf}var I1;function tO(){if(I1)return Ty.exports;I1=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Ty.exports=eO(),Ty.exports}var nO=tO();function iO(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,h=!1;try{if(s=(t=t.call(i)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){h=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(h)throw r}}return u}}function rO(i,e,t){return e=fO(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function z1(i,e){return oO(i)||iO(i,e)||ON(i,e)||cO()}function sO(i){return aO(i)||lO(i)||ON(i)||uO()}function aO(i){if(Array.isArray(i))return _b(i)}function oO(i){if(Array.isArray(i))return i}function lO(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function ON(i,e){if(i){if(typeof i=="string")return _b(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _b(i,e)}}function _b(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=i[t];return n}function uO(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cO(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hO(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function fO(i){var e=hO(i,"string");return typeof e=="symbol"?e:String(e)}var dO=function(e,t){var n=new Set(t);return Object.assign.apply(Object,[{}].concat(sO(Object.entries(e).filter(function(r){var s=z1(r,1),o=s[0];return!n.has(o)}).map(function(r){var s=z1(r,2),o=s[0],u=s[1];return rO({},o,u)}))))};function vb(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function pO(i){if(Array.isArray(i))return i}function mO(i){if(Array.isArray(i))return vb(i)}function gO(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function _O(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,h=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){h=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(h)throw r}}return u}}function vO(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yO(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xO(i,e){return pO(i)||_O(i,e)||BN(i,e)||vO()}function G1(i){return mO(i)||gO(i)||BN(i)||yO()}function BN(i,e){if(i){if(typeof i=="string")return vb(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?vb(i,e):void 0}}function bO(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.wrapperElementType,n=t===void 0?"div":t,r=e.nodeMapper,s=r===void 0?function(d){return d}:r,o=e.methodNames,u=o===void 0?[]:o,c=e.initPropNames,h=c===void 0?[]:c;return vn.forwardRef(function(d,p){var g=vn.useRef(),_=vn.useMemo(function(){var b=Object.fromEntries(h.filter(function(x){return d.hasOwnProperty(x)}).map(function(x){return[x,d[x]]}));return i(b)},[]);k1(function(){_(s(g.current))},vn.useLayoutEffect),k1(function(){return _._destructor instanceof Function?_._destructor:void 0});var v=vn.useCallback(function(b){for(var x=arguments.length,M=new Array(x>1?x-1:0),E=1;E<x;E++)M[E-1]=arguments[E];return _[b]instanceof Function?_[b].apply(_,M):void 0},[_]),T=vn.useRef({});return Object.keys(dO(d,[].concat(G1(u),G1(h)))).filter(function(b){return T.current[b]!==d[b]}).forEach(function(b){return v(b,d[b])}),T.current=d,vn.useImperativeHandle(p,function(){return Object.fromEntries(u.map(function(b){return[b,function(){for(var x=arguments.length,M=new Array(x),E=0;E<x;E++)M[E]=arguments[E];return v.apply(void 0,[b].concat(M))}]}))},[v]),YU.createElement(n,{ref:g})})}function k1(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vn.useEffect,t=vn.useRef(),n=vn.useRef(!1),r=vn.useRef(!1),s=vn.useState(0),o=xO(s,2);o[0];var u=o[1];n.current&&(r.current=!0),e(function(){return n.current||(t.current=i(),n.current=!0),u(function(c){return c+1}),function(){r.current&&t.current&&t.current()}},[])}const Tu="182",qi={ROTATE:0,DOLLY:1,PAN:2},no={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},FN=0,yb=1,IN=2,SO=0,Bd=1,TO=2,io=3,Jr=0,Pn=1,rr=2,_r=0,es=1,eh=2,th=3,nh=4,jc=5,sr=100,vS=101,yS=102,zN=103,GN=104,Ka=200,xS=201,bS=202,SS=203,Jd=204,ep=205,TS=206,MS=207,ES=208,AS=209,wS=210,MO=211,EO=212,AO=213,wO=214,tp=0,np=1,ip=2,hl=3,rp=4,sp=5,ap=6,op=7,Sp=0,kN=1,VN=2,$i=0,RS=1,CS=2,NS=3,DS=4,HN=5,LS=6,PS=7,US=300,Vs=301,pa=302,ih=303,rh=304,cu=306,hu=1e3,Nr=1001,fu=1002,xn=1003,OS=1004,ro=1005,Gn=1006,Xc=1007,Dr=1008,Hn=1009,iu=1010,ru=1011,Is=1012,Ni=1013,yn=1014,ri=1015,Zn=1016,z_=1017,G_=1018,ts=1020,k_=35902,V_=35899,BS=1021,Tp=1022,si=1023,ji=1026,pr=1027,Mp=1028,kh=1029,mr=1030,Vh=1031,RO=1032,Hh=1033,sl=33776,al=33777,ol=33778,ll=33779,lp=35840,up=35841,cp=35842,hp=35843,sh=36196,ah=37492,oh=37496,lh=37488,uh=37489,du=37490,ch=37491,hh=37808,fh=37809,dh=37810,ph=37811,mh=37812,gh=37813,_h=37814,vh=37815,yh=37816,xh=37817,bh=37818,Sh=37819,Th=37820,Mh=37821,Eh=36492,xb=36494,bb=36495,Ah=36283,wh=36284,pu=36285,Rh=36286,CO=3200,da=0,WN=1,Rr="",nr="srgb",mu="srgb-linear",Ch="linear",Ye="srgb",wy="",qN="rg",NO="ga",DO=0,$l=7680,LO=7681,PO=7682,UO=7683,OO=34055,BO=34056,FO=5386,IO=512,zO=513,GO=514,kO=515,VO=516,HO=517,WO=518,Sb=519,FS=512,Ep=513,IS=514,Ap=515,zS=516,GS=517,wp=518,kS=519,Nh=35044,Vc=35048,V1="300 es",gr=2e3,ma=2001,ca={COMPUTE:"compute",RENDER:"render"};function VS(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}function __(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function fp(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function $N(){const i=fp("canvas");return i.style.display="block",i}const H1={};function dp(...i){const e="THREE."+i.shift();console.log(e,...i)}function Ae(...i){const e="THREE."+i.shift();console.warn(e,...i)}function Re(...i){const e="THREE."+i.shift();console.error(e,...i)}function Vn(...i){const e=i.join(" ");e in H1||(H1[e]=!0,Ae(...i))}function qO(i,e,t){return new Promise(function(n,r){function s(){switch(i.clientWaitSync(e,i.SYNC_FLUSH_COMMANDS_BIT,0)){case i.WAIT_FAILED:r();break;case i.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:n()}}setTimeout(s,t)})}class xa{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const r=n[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const Ji=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let W1=1234567;const Fd=Math.PI/180,gu=180/Math.PI;function lo(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Ji[i&255]+Ji[i>>8&255]+Ji[i>>16&255]+Ji[i>>24&255]+"-"+Ji[e&255]+Ji[e>>8&255]+"-"+Ji[e>>16&15|64]+Ji[e>>24&255]+"-"+Ji[t&63|128]+Ji[t>>8&255]+"-"+Ji[t>>16&255]+Ji[t>>24&255]+Ji[n&255]+Ji[n>>8&255]+Ji[n>>16&255]+Ji[n>>24&255]).toLowerCase()}function zt(i,e,t){return Math.max(e,Math.min(t,i))}function HS(i,e){return(i%e+e)%e}function $O(i,e,t,n,r){return n+(i-e)*(r-n)/(t-e)}function jO(i,e,t){return i!==e?(t-i)/(e-i):0}function Id(i,e,t){return(1-t)*i+t*e}function XO(i,e,t,n){return Id(i,e,1-Math.exp(-t*n))}function YO(i,e=1){return e-Math.abs(HS(i,e*2)-e)}function KO(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function QO(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function ZO(i,e){return i+Math.floor(Math.random()*(e-i+1))}function JO(i,e){return i+Math.random()*(e-i)}function eB(i){return i*(.5-Math.random())}function tB(i){i!==void 0&&(W1=i);let e=W1+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function nB(i){return i*Fd}function iB(i){return i*gu}function rB(i){return(i&i-1)===0&&i!==0}function sB(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function aB(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function oB(i,e,t,n,r){const s=Math.cos,o=Math.sin,u=s(t/2),c=o(t/2),h=s((e+n)/2),d=o((e+n)/2),p=s((e-n)/2),g=o((e-n)/2),_=s((n-e)/2),v=o((n-e)/2);switch(r){case"XYX":i.set(u*d,c*p,c*g,u*h);break;case"YZY":i.set(c*g,u*d,c*p,u*h);break;case"ZXZ":i.set(c*p,c*g,u*d,u*h);break;case"XZX":i.set(u*d,c*v,c*_,u*h);break;case"YXY":i.set(c*_,u*d,c*v,u*h);break;case"ZYZ":i.set(c*v,c*_,u*d,u*h);break;default:Ae("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function fr(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function It(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const v_={DEG2RAD:Fd,RAD2DEG:gu,generateUUID:lo,clamp:zt,euclideanModulo:HS,mapLinear:$O,inverseLerp:jO,lerp:Id,damp:XO,pingpong:YO,smoothstep:KO,smootherstep:QO,randInt:ZO,randFloat:JO,randFloatSpread:eB,seededRandom:tB,degToRad:nB,radToDeg:iB,isPowerOfTwo:rB,ceilPowerOfTwo:sB,floorPowerOfTwo:aB,setQuaternionFromProperEuler:oB,normalize:It,denormalize:fr};class Ue{constructor(e=0,t=0){Ue.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=zt(this.x,e.x,t.x),this.y=zt(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=zt(this.x,e,t),this.y=zt(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(zt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(zt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*r+e.x,this.y=s*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Hs{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,s,o,u){let c=n[r+0],h=n[r+1],d=n[r+2],p=n[r+3],g=s[o+0],_=s[o+1],v=s[o+2],T=s[o+3];if(u<=0){e[t+0]=c,e[t+1]=h,e[t+2]=d,e[t+3]=p;return}if(u>=1){e[t+0]=g,e[t+1]=_,e[t+2]=v,e[t+3]=T;return}if(p!==T||c!==g||h!==_||d!==v){let b=c*g+h*_+d*v+p*T;b<0&&(g=-g,_=-_,v=-v,T=-T,b=-b);let x=1-u;if(b<.9995){const M=Math.acos(b),E=Math.sin(M);x=Math.sin(x*M)/E,u=Math.sin(u*M)/E,c=c*x+g*u,h=h*x+_*u,d=d*x+v*u,p=p*x+T*u}else{c=c*x+g*u,h=h*x+_*u,d=d*x+v*u,p=p*x+T*u;const M=1/Math.sqrt(c*c+h*h+d*d+p*p);c*=M,h*=M,d*=M,p*=M}}e[t]=c,e[t+1]=h,e[t+2]=d,e[t+3]=p}static multiplyQuaternionsFlat(e,t,n,r,s,o){const u=n[r],c=n[r+1],h=n[r+2],d=n[r+3],p=s[o],g=s[o+1],_=s[o+2],v=s[o+3];return e[t]=u*v+d*p+c*_-h*g,e[t+1]=c*v+d*g+h*p-u*_,e[t+2]=h*v+d*_+u*g-c*p,e[t+3]=d*v-u*p-c*g-h*_,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,s=e._z,o=e._order,u=Math.cos,c=Math.sin,h=u(n/2),d=u(r/2),p=u(s/2),g=c(n/2),_=c(r/2),v=c(s/2);switch(o){case"XYZ":this._x=g*d*p+h*_*v,this._y=h*_*p-g*d*v,this._z=h*d*v+g*_*p,this._w=h*d*p-g*_*v;break;case"YXZ":this._x=g*d*p+h*_*v,this._y=h*_*p-g*d*v,this._z=h*d*v-g*_*p,this._w=h*d*p+g*_*v;break;case"ZXY":this._x=g*d*p-h*_*v,this._y=h*_*p+g*d*v,this._z=h*d*v+g*_*p,this._w=h*d*p-g*_*v;break;case"ZYX":this._x=g*d*p-h*_*v,this._y=h*_*p+g*d*v,this._z=h*d*v-g*_*p,this._w=h*d*p+g*_*v;break;case"YZX":this._x=g*d*p+h*_*v,this._y=h*_*p+g*d*v,this._z=h*d*v-g*_*p,this._w=h*d*p-g*_*v;break;case"XZY":this._x=g*d*p-h*_*v,this._y=h*_*p-g*d*v,this._z=h*d*v+g*_*p,this._w=h*d*p+g*_*v;break;default:Ae("Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],s=t[8],o=t[1],u=t[5],c=t[9],h=t[2],d=t[6],p=t[10],g=n+u+p;if(g>0){const _=.5/Math.sqrt(g+1);this._w=.25/_,this._x=(d-c)*_,this._y=(s-h)*_,this._z=(o-r)*_}else if(n>u&&n>p){const _=2*Math.sqrt(1+n-u-p);this._w=(d-c)/_,this._x=.25*_,this._y=(r+o)/_,this._z=(s+h)/_}else if(u>p){const _=2*Math.sqrt(1+u-n-p);this._w=(s-h)/_,this._x=(r+o)/_,this._y=.25*_,this._z=(c+d)/_}else{const _=2*Math.sqrt(1+p-n-u);this._w=(o-r)/_,this._x=(s+h)/_,this._y=(c+d)/_,this._z=.25*_}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(zt(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,s=e._z,o=e._w,u=t._x,c=t._y,h=t._z,d=t._w;return this._x=n*d+o*u+r*h-s*c,this._y=r*d+o*c+s*u-n*h,this._z=s*d+o*h+n*c-r*u,this._w=o*d-n*u-r*c-s*h,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let n=e._x,r=e._y,s=e._z,o=e._w,u=this.dot(e);u<0&&(n=-n,r=-r,s=-s,o=-o,u=-u);let c=1-t;if(u<.9995){const h=Math.acos(u),d=Math.sin(h);c=Math.sin(c*h)/d,t=Math.sin(t*h)/d,this._x=this._x*c+n*t,this._y=this._y*c+r*t,this._z=this._z*c+s*t,this._w=this._w*c+o*t,this._onChangeCallback()}else this._x=this._x*c+n*t,this._y=this._y*c+r*t,this._z=this._z*c+s*t,this._w=this._w*c+o*t,this.normalize();return this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class k{constructor(e=0,t=0,n=0){k.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(q1.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(q1.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*r,this.y=s[1]*t+s[4]*n+s[7]*r,this.z=s[2]*t+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,u=e.z,c=e.w,h=2*(o*r-u*n),d=2*(u*t-s*r),p=2*(s*n-o*t);return this.x=t+c*h+o*p-u*d,this.y=n+c*d+u*h-s*p,this.z=r+c*p+s*d-o*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r,this.y=s[1]*t+s[5]*n+s[9]*r,this.z=s[2]*t+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=zt(this.x,e.x,t.x),this.y=zt(this.y,e.y,t.y),this.z=zt(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=zt(this.x,e,t),this.y=zt(this.y,e,t),this.z=zt(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(zt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,s=e.z,o=t.x,u=t.y,c=t.z;return this.x=r*c-s*u,this.y=s*o-n*c,this.z=n*u-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Ry.copy(this).projectOnVector(e),this.sub(Ry)}reflect(e){return this.sub(Ry.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(zt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ry=new k,q1=new Hs;class Ct{constructor(e,t,n,r,s,o,u,c,h){Ct.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,u,c,h)}set(e,t,n,r,s,o,u,c,h){const d=this.elements;return d[0]=e,d[1]=r,d[2]=u,d[3]=t,d[4]=s,d[5]=c,d[6]=n,d[7]=o,d[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],u=n[3],c=n[6],h=n[1],d=n[4],p=n[7],g=n[2],_=n[5],v=n[8],T=r[0],b=r[3],x=r[6],M=r[1],E=r[4],w=r[7],C=r[2],N=r[5],D=r[8];return s[0]=o*T+u*M+c*C,s[3]=o*b+u*E+c*N,s[6]=o*x+u*w+c*D,s[1]=h*T+d*M+p*C,s[4]=h*b+d*E+p*N,s[7]=h*x+d*w+p*D,s[2]=g*T+_*M+v*C,s[5]=g*b+_*E+v*N,s[8]=g*x+_*w+v*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],u=e[5],c=e[6],h=e[7],d=e[8];return t*o*d-t*u*h-n*s*d+n*u*c+r*s*h-r*o*c}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],u=e[5],c=e[6],h=e[7],d=e[8],p=d*o-u*h,g=u*c-d*s,_=h*s-o*c,v=t*p+n*g+r*_;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);const T=1/v;return e[0]=p*T,e[1]=(r*h-d*n)*T,e[2]=(u*n-r*o)*T,e[3]=g*T,e[4]=(d*t-r*c)*T,e[5]=(r*s-u*t)*T,e[6]=_*T,e[7]=(n*c-h*t)*T,e[8]=(o*t-n*s)*T,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,o,u){const c=Math.cos(s),h=Math.sin(s);return this.set(n*c,n*h,-n*(c*o+h*u)+o+e,-r*h,r*c,-r*(-h*o+c*u)+u+t,0,0,1),this}scale(e,t){return this.premultiply(Cy.makeScale(e,t)),this}rotate(e){return this.premultiply(Cy.makeRotation(-e)),this}translate(e,t){return this.premultiply(Cy.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Cy=new Ct,$1=new Ct().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),j1=new Ct().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function lB(){const i={enabled:!0,workingColorSpace:mu,spaces:{},convert:function(r,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===Ye&&(r.r=uo(r.r),r.g=uo(r.g),r.b=uo(r.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Ye&&(r.r=Yc(r.r),r.g=Yc(r.g),r.b=Yc(r.b))),r},workingToColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},colorSpaceToWorking:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Rr?Ch:this.spaces[r].transfer},getToneMappingMode:function(r){return this.spaces[r].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,o){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(r,s){return Vn("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),i.workingToColorSpace(r,s)},toWorkingColorSpace:function(r,s){return Vn("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),i.colorSpaceToWorking(r,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return i.define({[mu]:{primaries:e,whitePoint:n,transfer:Ch,toXYZ:$1,fromXYZ:j1,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:nr},outputColorSpaceConfig:{drawingBufferColorSpace:nr}},[nr]:{primaries:e,whitePoint:n,transfer:Ye,toXYZ:$1,fromXYZ:j1,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:nr}}}),i}const vt=lB();function uo(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function Yc(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let fc;class uB{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{fc===void 0&&(fc=fp("canvas")),fc.width=e.width,fc.height=e.height;const r=fc.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=fc}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=fp("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=uo(s[o]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(uo(t[n]/255)*255):t[n]=uo(t[n]);return{data:t,width:e.width,height:e.height}}else return Ae("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let cB=0;class WS{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:cB++}),this.uuid=lo(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):typeof VideoFrame<"u"&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,u=r.length;o<u;o++)r[o].isDataTexture?s.push(Ny(r[o].image)):s.push(Ny(r[o]))}else s=Ny(r);n.url=s}return t||(e.images[this.uuid]=n),n}}function Ny(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?uB.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(Ae("Texture: Unable to serialize Texture."),{})}let hB=0;const Dy=new k;class ui extends xa{constructor(e=ui.DEFAULT_IMAGE,t=ui.DEFAULT_MAPPING,n=Nr,r=Nr,s=Gn,o=Dr,u=si,c=Hn,h=ui.DEFAULT_ANISOTROPY,d=Rr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:hB++}),this.uuid=lo(),this.name="",this.source=new WS(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=h,this.format=u,this.internalFormat=null,this.type=c,this.offset=new Ue(0,0),this.repeat=new Ue(1,1),this.center=new Ue(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ct,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Dy).x}get height(){return this.source.getSize(Dy).y}get depth(){return this.source.getSize(Dy).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){Ae(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){Ae(`Texture.setValues(): property '${t}' does not exist.`);continue}r&&n&&r.isVector2&&n.isVector2||r&&n&&r.isVector3&&n.isVector3||r&&n&&r.isMatrix3&&n.isMatrix3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==US)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case hu:e.x=e.x-Math.floor(e.x);break;case Nr:e.x=e.x<0?0:1;break;case fu:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case hu:e.y=e.y-Math.floor(e.y);break;case Nr:e.y=e.y<0?0:1;break;case fu:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}ui.DEFAULT_IMAGE=null;ui.DEFAULT_MAPPING=US;ui.DEFAULT_ANISOTROPY=1;class Lt{constructor(e=0,t=0,n=0,r=1){Lt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,s;const c=e.elements,h=c[0],d=c[4],p=c[8],g=c[1],_=c[5],v=c[9],T=c[2],b=c[6],x=c[10];if(Math.abs(d-g)<.01&&Math.abs(p-T)<.01&&Math.abs(v-b)<.01){if(Math.abs(d+g)<.1&&Math.abs(p+T)<.1&&Math.abs(v+b)<.1&&Math.abs(h+_+x-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const E=(h+1)/2,w=(_+1)/2,C=(x+1)/2,N=(d+g)/4,D=(p+T)/4,U=(v+b)/4;return E>w&&E>C?E<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(E),r=N/n,s=D/n):w>C?w<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(w),n=N/r,s=U/r):C<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(C),n=D/s,r=U/s),this.set(n,r,s,t),this}let M=Math.sqrt((b-v)*(b-v)+(p-T)*(p-T)+(g-d)*(g-d));return Math.abs(M)<.001&&(M=1),this.x=(b-v)/M,this.y=(p-T)/M,this.z=(g-d)/M,this.w=Math.acos((h+_+x-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=zt(this.x,e.x,t.x),this.y=zt(this.y,e.y,t.y),this.z=zt(this.z,e.z,t.z),this.w=zt(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=zt(this.x,e,t),this.y=zt(this.y,e,t),this.z=zt(this.z,e,t),this.w=zt(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(zt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Mu extends xa{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Gn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new Lt(0,0,e,t),this.scissorTest=!1,this.viewport=new Lt(0,0,e,t);const r={width:e,height:t,depth:n.depth},s=new ui(r);this.textures=[];const o=n.count;for(let u=0;u<o;u++)this.textures[u]=s.clone(),this.textures[u].isRenderTargetTexture=!0,this.textures[u].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:Gn,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n,this.textures[r].isData3DTexture!==!0&&(this.textures[r].isArrayTexture=this.textures[r].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const r=Object.assign({},e.textures[t].image);this.textures[t].source=new WS(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Gs extends Mu{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class qS extends ui{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=xn,this.minFilter=xn,this.wrapR=Nr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class fB extends ui{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=xn,this.minFilter=xn,this.wrapR=Nr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Eu{constructor(e=new k(1/0,1/0,1/0),t=new k(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Ns.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Ns.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Ns.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,u=s.count;o<u;o++)e.isMesh===!0?e.getVertexPosition(o,Ns):Ns.fromBufferAttribute(s,o),Ns.applyMatrix4(e.matrixWorld),this.expandByPoint(Ns);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Jm.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),Jm.copy(n.boundingBox)),Jm.applyMatrix4(e.matrixWorld),this.union(Jm)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Ns),Ns.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Kf),eg.subVectors(this.max,Kf),dc.subVectors(e.a,Kf),pc.subVectors(e.b,Kf),mc.subVectors(e.c,Kf),Wo.subVectors(pc,dc),qo.subVectors(mc,pc),Bl.subVectors(dc,mc);let t=[0,-Wo.z,Wo.y,0,-qo.z,qo.y,0,-Bl.z,Bl.y,Wo.z,0,-Wo.x,qo.z,0,-qo.x,Bl.z,0,-Bl.x,-Wo.y,Wo.x,0,-qo.y,qo.x,0,-Bl.y,Bl.x,0];return!Ly(t,dc,pc,mc,eg)||(t=[1,0,0,0,1,0,0,0,1],!Ly(t,dc,pc,mc,eg))?!1:(tg.crossVectors(Wo,qo),t=[tg.x,tg.y,tg.z],Ly(t,dc,pc,mc,eg))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ns).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ns).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(ka[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ka[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ka[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ka[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ka[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ka[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ka[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ka[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ka),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const ka=[new k,new k,new k,new k,new k,new k,new k,new k],Ns=new k,Jm=new Eu,dc=new k,pc=new k,mc=new k,Wo=new k,qo=new k,Bl=new k,Kf=new k,eg=new k,tg=new k,Fl=new k;function Ly(i,e,t,n,r){for(let s=0,o=i.length-3;s<=o;s+=3){Fl.fromArray(i,s);const u=r.x*Math.abs(Fl.x)+r.y*Math.abs(Fl.y)+r.z*Math.abs(Fl.z),c=e.dot(Fl),h=t.dot(Fl),d=n.dot(Fl);if(Math.max(-Math.max(c,h,d),Math.min(c,h,d))>u)return!1}return!0}const dB=new Eu,Qf=new k,Py=new k;class Rp{constructor(e=new k,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):dB.setFromPoints(e).getCenter(n);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Qf.subVectors(e,this.center);const t=Qf.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.addScaledVector(Qf,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Py.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Qf.copy(e.center).add(Py)),this.expandByPoint(Qf.copy(e.center).sub(Py))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const Va=new k,Uy=new k,ng=new k,$o=new k,Oy=new k,ig=new k,By=new k;class H_{constructor(e=new k,t=new k(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Va)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Va.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Va.copy(this.origin).addScaledVector(this.direction,t),Va.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){Uy.copy(e).add(t).multiplyScalar(.5),ng.copy(t).sub(e).normalize(),$o.copy(this.origin).sub(Uy);const s=e.distanceTo(t)*.5,o=-this.direction.dot(ng),u=$o.dot(this.direction),c=-$o.dot(ng),h=$o.lengthSq(),d=Math.abs(1-o*o);let p,g,_,v;if(d>0)if(p=o*c-u,g=o*u-c,v=s*d,p>=0)if(g>=-v)if(g<=v){const T=1/d;p*=T,g*=T,_=p*(p+o*g+2*u)+g*(o*p+g+2*c)+h}else g=s,p=Math.max(0,-(o*g+u)),_=-p*p+g*(g+2*c)+h;else g=-s,p=Math.max(0,-(o*g+u)),_=-p*p+g*(g+2*c)+h;else g<=-v?(p=Math.max(0,-(-o*s+u)),g=p>0?-s:Math.min(Math.max(-s,-c),s),_=-p*p+g*(g+2*c)+h):g<=v?(p=0,g=Math.min(Math.max(-s,-c),s),_=g*(g+2*c)+h):(p=Math.max(0,-(o*s+u)),g=p>0?s:Math.min(Math.max(-s,-c),s),_=-p*p+g*(g+2*c)+h);else g=o>0?-s:s,p=Math.max(0,-(o*g+u)),_=-p*p+g*(g+2*c)+h;return n&&n.copy(this.origin).addScaledVector(this.direction,p),r&&r.copy(Uy).addScaledVector(ng,g),_}intersectSphere(e,t){Va.subVectors(e.center,this.origin);const n=Va.dot(this.direction),r=Va.dot(Va)-n*n,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),u=n-o,c=n+o;return c<0?null:u<0?this.at(c,t):this.at(u,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,s,o,u,c;const h=1/this.direction.x,d=1/this.direction.y,p=1/this.direction.z,g=this.origin;return h>=0?(n=(e.min.x-g.x)*h,r=(e.max.x-g.x)*h):(n=(e.max.x-g.x)*h,r=(e.min.x-g.x)*h),d>=0?(s=(e.min.y-g.y)*d,o=(e.max.y-g.y)*d):(s=(e.max.y-g.y)*d,o=(e.min.y-g.y)*d),n>o||s>r||((s>n||isNaN(n))&&(n=s),(o<r||isNaN(r))&&(r=o),p>=0?(u=(e.min.z-g.z)*p,c=(e.max.z-g.z)*p):(u=(e.max.z-g.z)*p,c=(e.min.z-g.z)*p),n>c||u>r)||((u>n||n!==n)&&(n=u),(c<r||r!==r)&&(r=c),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,Va)!==null}intersectTriangle(e,t,n,r,s){Oy.subVectors(t,e),ig.subVectors(n,e),By.crossVectors(Oy,ig);let o=this.direction.dot(By),u;if(o>0){if(r)return null;u=1}else if(o<0)u=-1,o=-o;else return null;$o.subVectors(this.origin,e);const c=u*this.direction.dot(ig.crossVectors($o,ig));if(c<0)return null;const h=u*this.direction.dot(Oy.cross($o));if(h<0||c+h>o)return null;const d=-u*$o.dot(By);return d<0?null:this.at(d/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ht{constructor(e,t,n,r,s,o,u,c,h,d,p,g,_,v,T,b){Ht.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,u,c,h,d,p,g,_,v,T,b)}set(e,t,n,r,s,o,u,c,h,d,p,g,_,v,T,b){const x=this.elements;return x[0]=e,x[4]=t,x[8]=n,x[12]=r,x[1]=s,x[5]=o,x[9]=u,x[13]=c,x[2]=h,x[6]=d,x[10]=p,x[14]=g,x[3]=_,x[7]=v,x[11]=T,x[15]=b,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ht().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return this.determinant()===0?(e.set(1,0,0),t.set(0,1,0),n.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this)}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const t=this.elements,n=e.elements,r=1/gc.setFromMatrixColumn(e,0).length(),s=1/gc.setFromMatrixColumn(e,1).length(),o=1/gc.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),u=Math.sin(n),c=Math.cos(r),h=Math.sin(r),d=Math.cos(s),p=Math.sin(s);if(e.order==="XYZ"){const g=o*d,_=o*p,v=u*d,T=u*p;t[0]=c*d,t[4]=-c*p,t[8]=h,t[1]=_+v*h,t[5]=g-T*h,t[9]=-u*c,t[2]=T-g*h,t[6]=v+_*h,t[10]=o*c}else if(e.order==="YXZ"){const g=c*d,_=c*p,v=h*d,T=h*p;t[0]=g+T*u,t[4]=v*u-_,t[8]=o*h,t[1]=o*p,t[5]=o*d,t[9]=-u,t[2]=_*u-v,t[6]=T+g*u,t[10]=o*c}else if(e.order==="ZXY"){const g=c*d,_=c*p,v=h*d,T=h*p;t[0]=g-T*u,t[4]=-o*p,t[8]=v+_*u,t[1]=_+v*u,t[5]=o*d,t[9]=T-g*u,t[2]=-o*h,t[6]=u,t[10]=o*c}else if(e.order==="ZYX"){const g=o*d,_=o*p,v=u*d,T=u*p;t[0]=c*d,t[4]=v*h-_,t[8]=g*h+T,t[1]=c*p,t[5]=T*h+g,t[9]=_*h-v,t[2]=-h,t[6]=u*c,t[10]=o*c}else if(e.order==="YZX"){const g=o*c,_=o*h,v=u*c,T=u*h;t[0]=c*d,t[4]=T-g*p,t[8]=v*p+_,t[1]=p,t[5]=o*d,t[9]=-u*d,t[2]=-h*d,t[6]=_*p+v,t[10]=g-T*p}else if(e.order==="XZY"){const g=o*c,_=o*h,v=u*c,T=u*h;t[0]=c*d,t[4]=-p,t[8]=h*d,t[1]=g*p+T,t[5]=o*d,t[9]=_*p-v,t[2]=v*p-_,t[6]=u*d,t[10]=T*p+g}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(pB,e,mB)}lookAt(e,t,n){const r=this.elements;return $r.subVectors(e,t),$r.lengthSq()===0&&($r.z=1),$r.normalize(),jo.crossVectors(n,$r),jo.lengthSq()===0&&(Math.abs(n.z)===1?$r.x+=1e-4:$r.z+=1e-4,$r.normalize(),jo.crossVectors(n,$r)),jo.normalize(),rg.crossVectors($r,jo),r[0]=jo.x,r[4]=rg.x,r[8]=$r.x,r[1]=jo.y,r[5]=rg.y,r[9]=$r.y,r[2]=jo.z,r[6]=rg.z,r[10]=$r.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],u=n[4],c=n[8],h=n[12],d=n[1],p=n[5],g=n[9],_=n[13],v=n[2],T=n[6],b=n[10],x=n[14],M=n[3],E=n[7],w=n[11],C=n[15],N=r[0],D=r[4],U=r[8],R=r[12],P=r[1],I=r[5],H=r[9],X=r[13],J=r[2],ne=r[6],G=r[10],z=r[14],q=r[3],ce=r[7],xe=r[11],O=r[15];return s[0]=o*N+u*P+c*J+h*q,s[4]=o*D+u*I+c*ne+h*ce,s[8]=o*U+u*H+c*G+h*xe,s[12]=o*R+u*X+c*z+h*O,s[1]=d*N+p*P+g*J+_*q,s[5]=d*D+p*I+g*ne+_*ce,s[9]=d*U+p*H+g*G+_*xe,s[13]=d*R+p*X+g*z+_*O,s[2]=v*N+T*P+b*J+x*q,s[6]=v*D+T*I+b*ne+x*ce,s[10]=v*U+T*H+b*G+x*xe,s[14]=v*R+T*X+b*z+x*O,s[3]=M*N+E*P+w*J+C*q,s[7]=M*D+E*I+w*ne+C*ce,s[11]=M*U+E*H+w*G+C*xe,s[15]=M*R+E*X+w*z+C*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],s=e[12],o=e[1],u=e[5],c=e[9],h=e[13],d=e[2],p=e[6],g=e[10],_=e[14],v=e[3],T=e[7],b=e[11],x=e[15],M=c*_-h*g,E=u*_-h*p,w=u*g-c*p,C=o*_-h*d,N=o*g-c*d,D=o*p-u*d;return t*(T*M-b*E+x*w)-n*(v*M-b*C+x*N)+r*(v*E-T*C+x*D)-s*(v*w-T*N+b*D)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],u=e[5],c=e[6],h=e[7],d=e[8],p=e[9],g=e[10],_=e[11],v=e[12],T=e[13],b=e[14],x=e[15],M=p*b*h-T*g*h+T*c*_-u*b*_-p*c*x+u*g*x,E=v*g*h-d*b*h-v*c*_+o*b*_+d*c*x-o*g*x,w=d*T*h-v*p*h+v*u*_-o*T*_-d*u*x+o*p*x,C=v*p*c-d*T*c-v*u*g+o*T*g+d*u*b-o*p*b,N=t*M+n*E+r*w+s*C;if(N===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const D=1/N;return e[0]=M*D,e[1]=(T*g*s-p*b*s-T*r*_+n*b*_+p*r*x-n*g*x)*D,e[2]=(u*b*s-T*c*s+T*r*h-n*b*h-u*r*x+n*c*x)*D,e[3]=(p*c*s-u*g*s-p*r*h+n*g*h+u*r*_-n*c*_)*D,e[4]=E*D,e[5]=(d*b*s-v*g*s+v*r*_-t*b*_-d*r*x+t*g*x)*D,e[6]=(v*c*s-o*b*s-v*r*h+t*b*h+o*r*x-t*c*x)*D,e[7]=(o*g*s-d*c*s+d*r*h-t*g*h-o*r*_+t*c*_)*D,e[8]=w*D,e[9]=(v*p*s-d*T*s-v*n*_+t*T*_+d*n*x-t*p*x)*D,e[10]=(o*T*s-v*u*s+v*n*h-t*T*h-o*n*x+t*u*x)*D,e[11]=(d*u*s-o*p*s-d*n*h+t*p*h+o*n*_-t*u*_)*D,e[12]=C*D,e[13]=(d*T*r-v*p*r+v*n*g-t*T*g-d*n*b+t*p*b)*D,e[14]=(v*u*r-o*T*r-v*n*c+t*T*c+o*n*b-t*u*b)*D,e[15]=(o*p*r-d*u*r+d*n*c-t*p*c-o*n*g+t*u*g)*D,this}scale(e){const t=this.elements,n=e.x,r=e.y,s=e.z;return t[0]*=n,t[4]*=r,t[8]*=s,t[1]*=n,t[5]*=r,t[9]*=s,t[2]*=n,t[6]*=r,t[10]*=s,t[3]*=n,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),s=1-n,o=e.x,u=e.y,c=e.z,h=s*o,d=s*u;return this.set(h*o+n,h*u-r*c,h*c+r*u,0,h*u+r*c,d*u+n,d*c-r*o,0,h*c-r*u,d*c+r*o,s*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,s,o){return this.set(1,n,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,s=t._x,o=t._y,u=t._z,c=t._w,h=s+s,d=o+o,p=u+u,g=s*h,_=s*d,v=s*p,T=o*d,b=o*p,x=u*p,M=c*h,E=c*d,w=c*p,C=n.x,N=n.y,D=n.z;return r[0]=(1-(T+x))*C,r[1]=(_+w)*C,r[2]=(v-E)*C,r[3]=0,r[4]=(_-w)*N,r[5]=(1-(g+x))*N,r[6]=(b+M)*N,r[7]=0,r[8]=(v+E)*D,r[9]=(b-M)*D,r[10]=(1-(g+T))*D,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;if(e.x=r[12],e.y=r[13],e.z=r[14],this.determinant()===0)return n.set(1,1,1),t.identity(),this;let s=gc.set(r[0],r[1],r[2]).length();const o=gc.set(r[4],r[5],r[6]).length(),u=gc.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),Ds.copy(this);const h=1/s,d=1/o,p=1/u;return Ds.elements[0]*=h,Ds.elements[1]*=h,Ds.elements[2]*=h,Ds.elements[4]*=d,Ds.elements[5]*=d,Ds.elements[6]*=d,Ds.elements[8]*=p,Ds.elements[9]*=p,Ds.elements[10]*=p,t.setFromRotationMatrix(Ds),n.x=s,n.y=o,n.z=u,this}makePerspective(e,t,n,r,s,o,u=gr,c=!1){const h=this.elements,d=2*s/(t-e),p=2*s/(n-r),g=(t+e)/(t-e),_=(n+r)/(n-r);let v,T;if(c)v=s/(o-s),T=o*s/(o-s);else if(u===gr)v=-(o+s)/(o-s),T=-2*o*s/(o-s);else if(u===ma)v=-o/(o-s),T=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return h[0]=d,h[4]=0,h[8]=g,h[12]=0,h[1]=0,h[5]=p,h[9]=_,h[13]=0,h[2]=0,h[6]=0,h[10]=v,h[14]=T,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(e,t,n,r,s,o,u=gr,c=!1){const h=this.elements,d=2/(t-e),p=2/(n-r),g=-(t+e)/(t-e),_=-(n+r)/(n-r);let v,T;if(c)v=1/(o-s),T=o/(o-s);else if(u===gr)v=-2/(o-s),T=-(o+s)/(o-s);else if(u===ma)v=-1/(o-s),T=-s/(o-s);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return h[0]=d,h[4]=0,h[8]=0,h[12]=g,h[1]=0,h[5]=p,h[9]=0,h[13]=_,h[2]=0,h[6]=0,h[10]=v,h[14]=T,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const gc=new k,Ds=new Ht,pB=new k(0,0,0),mB=new k(1,1,1),jo=new k,rg=new k,$r=new k,X1=new Ht,Y1=new Hs;class Or{constructor(e=0,t=0,n=0,r=Or.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,s=r[0],o=r[4],u=r[8],c=r[1],h=r[5],d=r[9],p=r[2],g=r[6],_=r[10];switch(t){case"XYZ":this._y=Math.asin(zt(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-d,_),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(g,h),this._z=0);break;case"YXZ":this._x=Math.asin(-zt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(u,_),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-p,s),this._z=0);break;case"ZXY":this._x=Math.asin(zt(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-p,_),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-zt(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(g,_),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,h));break;case"YZX":this._z=Math.asin(zt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,h),this._y=Math.atan2(-p,s)):(this._x=0,this._y=Math.atan2(u,_));break;case"XZY":this._z=Math.asin(-zt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(g,h),this._y=Math.atan2(u,s)):(this._x=Math.atan2(-d,_),this._y=0);break;default:Ae("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return X1.makeRotationFromQuaternion(e),this.setFromRotationMatrix(X1,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Y1.setFromEuler(this),this.setFromQuaternion(Y1,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Or.DEFAULT_ORDER="XYZ";let $S=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},gB=0;const K1=new k,_c=new Hs,Ha=new Ht,sg=new k,Zf=new k,_B=new k,vB=new Hs,Q1=new k(1,0,0),Z1=new k(0,1,0),J1=new k(0,0,1),ew={type:"added"},yB={type:"removed"},vc={type:"childadded",child:null},Fy={type:"childremoved",child:null};class ci extends xa{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:gB++}),this.uuid=lo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ci.DEFAULT_UP.clone();const e=new k,t=new Or,n=new Hs,r=new k(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Ht},normalMatrix:{value:new Ct}}),this.matrix=new Ht,this.matrixWorld=new Ht,this.matrixAutoUpdate=ci.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ci.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new $S,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return _c.setFromAxisAngle(e,t),this.quaternion.multiply(_c),this}rotateOnWorldAxis(e,t){return _c.setFromAxisAngle(e,t),this.quaternion.premultiply(_c),this}rotateX(e){return this.rotateOnAxis(Q1,e)}rotateY(e){return this.rotateOnAxis(Z1,e)}rotateZ(e){return this.rotateOnAxis(J1,e)}translateOnAxis(e,t){return K1.copy(e).applyQuaternion(this.quaternion),this.position.add(K1.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Q1,e)}translateY(e){return this.translateOnAxis(Z1,e)}translateZ(e){return this.translateOnAxis(J1,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ha.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?sg.copy(e):sg.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Zf.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ha.lookAt(Zf,sg,this.up):Ha.lookAt(sg,Zf,this.up),this.quaternion.setFromRotationMatrix(Ha),r&&(Ha.extractRotation(r.matrixWorld),_c.setFromRotationMatrix(Ha),this.quaternion.premultiply(_c.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(Re("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(ew),vc.child=e,this.dispatchEvent(vc),vc.child=null):Re("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(yB),Fy.child=e,this.dispatchEvent(Fy),Fy.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ha.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ha.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ha),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(ew),vc.child=e,this.dispatchEvent(vc),vc.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Zf,e,_B),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Zf,vB,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(u=>({...u,boundingBox:u.boundingBox?u.boundingBox.toJSON():void 0,boundingSphere:u.boundingSphere?u.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(u=>({...u})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(r.boundingBox=this.boundingBox.toJSON()));function s(u,c){return u[c.uuid]===void 0&&(u[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const c=u.shapes;if(Array.isArray(c))for(let h=0,d=c.length;h<d;h++){const p=c[h];s(e.shapes,p)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let c=0,h=this.material.length;c<h;c++)u.push(s(e.materials,this.material[c]));r.material=u}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let u=0;u<this.children.length;u++)r.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let u=0;u<this.animations.length;u++){const c=this.animations[u];r.animations.push(s(e.animations,c))}}if(t){const u=o(e.geometries),c=o(e.materials),h=o(e.textures),d=o(e.images),p=o(e.shapes),g=o(e.skeletons),_=o(e.animations),v=o(e.nodes);u.length>0&&(n.geometries=u),c.length>0&&(n.materials=c),h.length>0&&(n.textures=h),d.length>0&&(n.images=d),p.length>0&&(n.shapes=p),g.length>0&&(n.skeletons=g),_.length>0&&(n.animations=_),v.length>0&&(n.nodes=v)}return n.object=r,n;function o(u){const c=[];for(const h in u){const d=u[h];delete d.metadata,c.push(d)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}}ci.DEFAULT_UP=new k(0,1,0);ci.DEFAULT_MATRIX_AUTO_UPDATE=!0;ci.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ls=new k,Wa=new k,Iy=new k,qa=new k,yc=new k,xc=new k,tw=new k,zy=new k,Gy=new k,ky=new k,Vy=new Lt,Hy=new Lt,Wy=new Lt;class gs{constructor(e=new k,t=new k,n=new k){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Ls.subVectors(e,t),r.cross(Ls);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,n,r,s){Ls.subVectors(r,t),Wa.subVectors(n,t),Iy.subVectors(e,t);const o=Ls.dot(Ls),u=Ls.dot(Wa),c=Ls.dot(Iy),h=Wa.dot(Wa),d=Wa.dot(Iy),p=o*h-u*u;if(p===0)return s.set(0,0,0),null;const g=1/p,_=(h*c-u*d)*g,v=(o*d-u*c)*g;return s.set(1-_-v,v,_)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,qa)===null?!1:qa.x>=0&&qa.y>=0&&qa.x+qa.y<=1}static getInterpolation(e,t,n,r,s,o,u,c){return this.getBarycoord(e,t,n,r,qa)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,qa.x),c.addScaledVector(o,qa.y),c.addScaledVector(u,qa.z),c)}static getInterpolatedAttribute(e,t,n,r,s,o){return Vy.setScalar(0),Hy.setScalar(0),Wy.setScalar(0),Vy.fromBufferAttribute(e,t),Hy.fromBufferAttribute(e,n),Wy.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(Vy,s.x),o.addScaledVector(Hy,s.y),o.addScaledVector(Wy,s.z),o}static isFrontFacing(e,t,n,r){return Ls.subVectors(n,t),Wa.subVectors(e,t),Ls.cross(Wa).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ls.subVectors(this.c,this.b),Wa.subVectors(this.a,this.b),Ls.cross(Wa).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return gs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return gs.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,s){return gs.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}containsPoint(e){return gs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return gs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,s=this.c;let o,u;yc.subVectors(r,n),xc.subVectors(s,n),zy.subVectors(e,n);const c=yc.dot(zy),h=xc.dot(zy);if(c<=0&&h<=0)return t.copy(n);Gy.subVectors(e,r);const d=yc.dot(Gy),p=xc.dot(Gy);if(d>=0&&p<=d)return t.copy(r);const g=c*p-d*h;if(g<=0&&c>=0&&d<=0)return o=c/(c-d),t.copy(n).addScaledVector(yc,o);ky.subVectors(e,s);const _=yc.dot(ky),v=xc.dot(ky);if(v>=0&&_<=v)return t.copy(s);const T=_*h-c*v;if(T<=0&&h>=0&&v<=0)return u=h/(h-v),t.copy(n).addScaledVector(xc,u);const b=d*v-_*p;if(b<=0&&p-d>=0&&_-v>=0)return tw.subVectors(s,r),u=(p-d)/(p-d+(_-v)),t.copy(r).addScaledVector(tw,u);const x=1/(b+T+g);return o=T*x,u=g*x,t.copy(n).addScaledVector(yc,o).addScaledVector(xc,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const jN={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xo={h:0,s:0,l:0},ag={h:0,s:0,l:0};function qy(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}class dt{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=nr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,vt.colorSpaceToWorking(this,t),this}setRGB(e,t,n,r=vt.workingColorSpace){return this.r=e,this.g=t,this.b=n,vt.colorSpaceToWorking(this,r),this}setHSL(e,t,n,r=vt.workingColorSpace){if(e=HS(e,1),t=zt(t,0,1),n=zt(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=qy(o,s,e+1/3),this.g=qy(o,s,e),this.b=qy(o,s,e-1/3)}return vt.colorSpaceToWorking(this,r),this}setStyle(e,t=nr){function n(s){s!==void 0&&parseFloat(s)<1&&Ae("Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],u=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:Ae("Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);Ae("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=nr){const n=jN[e.toLowerCase()];return n!==void 0?this.setHex(n,t):Ae("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=uo(e.r),this.g=uo(e.g),this.b=uo(e.b),this}copyLinearToSRGB(e){return this.r=Yc(e.r),this.g=Yc(e.g),this.b=Yc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=nr){return vt.workingToColorSpace(er.copy(this),e),Math.round(zt(er.r*255,0,255))*65536+Math.round(zt(er.g*255,0,255))*256+Math.round(zt(er.b*255,0,255))}getHexString(e=nr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=vt.workingColorSpace){vt.workingToColorSpace(er.copy(this),t);const n=er.r,r=er.g,s=er.b,o=Math.max(n,r,s),u=Math.min(n,r,s);let c,h;const d=(u+o)/2;if(u===o)c=0,h=0;else{const p=o-u;switch(h=d<=.5?p/(o+u):p/(2-o-u),o){case n:c=(r-s)/p+(r<s?6:0);break;case r:c=(s-n)/p+2;break;case s:c=(n-r)/p+4;break}c/=6}return e.h=c,e.s=h,e.l=d,e}getRGB(e,t=vt.workingColorSpace){return vt.workingToColorSpace(er.copy(this),t),e.r=er.r,e.g=er.g,e.b=er.b,e}getStyle(e=nr){vt.workingToColorSpace(er.copy(this),e);const t=er.r,n=er.g,r=er.b;return e!==nr?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(Xo),this.setHSL(Xo.h+e,Xo.s+t,Xo.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Xo),e.getHSL(ag);const n=Id(Xo.h,ag.h,t),r=Id(Xo.s,ag.s,t),s=Id(Xo.l,ag.l,t);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*r,this.g=s[1]*t+s[4]*n+s[7]*r,this.b=s[2]*t+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const er=new dt;dt.NAMES=jN;let xB=0;class ar extends xa{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:xB++}),this.uuid=lo(),this.name="",this.type="Material",this.blending=es,this.side=Jr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Jd,this.blendDst=ep,this.blendEquation=sr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new dt(0,0,0),this.blendAlpha=0,this.depthFunc=hl,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Sb,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=$l,this.stencilZFail=$l,this.stencilZPass=$l,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){Ae(`Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){Ae(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==es&&(n.blending=this.blending),this.side!==Jr&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==Jd&&(n.blendSrc=this.blendSrc),this.blendDst!==ep&&(n.blendDst=this.blendDst),this.blendEquation!==sr&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==hl&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Sb&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==$l&&(n.stencilFail=this.stencilFail),this.stencilZFail!==$l&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==$l&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.allowOverride===!1&&(n.allowOverride=!1),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(s){const o=[];for(const u in s){const c=s[u];delete c.metadata,o.push(c)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class la extends ar{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new dt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Or,this.combine=Sp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Za=bB();function bB(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),n=new Uint32Array(512),r=new Uint32Array(512);for(let c=0;c<256;++c){const h=c-127;h<-27?(n[c]=0,n[c|256]=32768,r[c]=24,r[c|256]=24):h<-14?(n[c]=1024>>-h-14,n[c|256]=1024>>-h-14|32768,r[c]=-h-1,r[c|256]=-h-1):h<=15?(n[c]=h+15<<10,n[c|256]=h+15<<10|32768,r[c]=13,r[c|256]=13):h<128?(n[c]=31744,n[c|256]=64512,r[c]=24,r[c|256]=24):(n[c]=31744,n[c|256]=64512,r[c]=13,r[c|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),u=new Uint32Array(64);for(let c=1;c<1024;++c){let h=c<<13,d=0;for(;(h&8388608)===0;)h<<=1,d-=8388608;h&=-8388609,d+=947912704,s[c]=h|d}for(let c=1024;c<2048;++c)s[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)o[c]=c<<23;o[31]=1199570944,o[32]=2147483648;for(let c=33;c<63;++c)o[c]=2147483648+(c-32<<23);o[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(u[c]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:u}}function jr(i){Math.abs(i)>65504&&Ae("DataUtils.toHalfFloat(): Value out of range."),i=zt(i,-65504,65504),Za.floatView[0]=i;const e=Za.uint32View[0],t=e>>23&511;return Za.baseTable[t]+((e&8388607)>>Za.shiftTable[t])}function og(i){const e=i>>10;return Za.uint32View[0]=Za.mantissaTable[Za.offsetTable[e]+(i&1023)]+Za.exponentTable[e],Za.floatView[0]}const _i=new k,lg=new Ue;let SB=0;class Xi{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:SB++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=Nh,this.updateRanges=[],this.gpuType=ri,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)lg.fromBufferAttribute(this,t),lg.applyMatrix3(e),this.setXY(t,lg.x,lg.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)_i.fromBufferAttribute(this,t),_i.applyMatrix3(e),this.setXYZ(t,_i.x,_i.y,_i.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)_i.fromBufferAttribute(this,t),_i.applyMatrix4(e),this.setXYZ(t,_i.x,_i.y,_i.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)_i.fromBufferAttribute(this,t),_i.applyNormalMatrix(e),this.setXYZ(t,_i.x,_i.y,_i.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)_i.fromBufferAttribute(this,t),_i.transformDirection(e),this.setXYZ(t,_i.x,_i.y,_i.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=fr(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=It(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=fr(t,this.array)),t}setX(e,t){return this.normalized&&(t=It(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=fr(t,this.array)),t}setY(e,t){return this.normalized&&(t=It(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=fr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=It(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=fr(t,this.array)),t}setW(e,t){return this.normalized&&(t=It(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=It(t,this.array),n=It(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=It(t,this.array),n=It(n,this.array),r=It(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=It(t,this.array),n=It(n,this.array),r=It(r,this.array),s=It(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Nh&&(e.usage=this.usage),e}}class jS extends Xi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class XS extends Xi{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class XN extends Xi{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=og(this.array[e*this.itemSize]);return this.normalized&&(t=fr(t,this.array)),t}setX(e,t){return this.normalized&&(t=It(t,this.array)),this.array[e*this.itemSize]=jr(t),this}getY(e){let t=og(this.array[e*this.itemSize+1]);return this.normalized&&(t=fr(t,this.array)),t}setY(e,t){return this.normalized&&(t=It(t,this.array)),this.array[e*this.itemSize+1]=jr(t),this}getZ(e){let t=og(this.array[e*this.itemSize+2]);return this.normalized&&(t=fr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=It(t,this.array)),this.array[e*this.itemSize+2]=jr(t),this}getW(e){let t=og(this.array[e*this.itemSize+3]);return this.normalized&&(t=fr(t,this.array)),t}setW(e,t){return this.normalized&&(t=It(t,this.array)),this.array[e*this.itemSize+3]=jr(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=It(t,this.array),n=It(n,this.array)),this.array[e+0]=jr(t),this.array[e+1]=jr(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=It(t,this.array),n=It(n,this.array),r=It(r,this.array)),this.array[e+0]=jr(t),this.array[e+1]=jr(n),this.array[e+2]=jr(r),this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=It(t,this.array),n=It(n,this.array),r=It(r,this.array),s=It(s,this.array)),this.array[e+0]=jr(t),this.array[e+1]=jr(n),this.array[e+2]=jr(r),this.array[e+3]=jr(s),this}}class ti extends Xi{constructor(e,t,n){super(new Float32Array(e),t,n)}}let TB=0;const ds=new Ht,$y=new ci,bc=new k,Xr=new Eu,Jf=new Eu,Ci=new k;class wi extends xa{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:TB++}),this.uuid=lo(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(VS(e)?XS:jS)(e,1):this.index=e,this}setIndirect(e,t=0){return this.indirect=e,this.indirectOffset=t,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Ct().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ds.makeRotationFromQuaternion(e),this.applyMatrix4(ds),this}rotateX(e){return ds.makeRotationX(e),this.applyMatrix4(ds),this}rotateY(e){return ds.makeRotationY(e),this.applyMatrix4(ds),this}rotateZ(e){return ds.makeRotationZ(e),this.applyMatrix4(ds),this}translate(e,t,n){return ds.makeTranslation(e,t,n),this.applyMatrix4(ds),this}scale(e,t,n){return ds.makeScale(e,t,n),this.applyMatrix4(ds),this}lookAt(e){return $y.lookAt(e),$y.updateMatrix(),this.applyMatrix4($y.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(bc).negate(),this.translate(bc.x,bc.y,bc.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];n.push(o.x,o.y,o.z||0)}this.setAttribute("position",new ti(n,3))}else{const n=Math.min(e.length,t.count);for(let r=0;r<n;r++){const s=e[r];t.setXYZ(r,s.x,s.y,s.z||0)}e.length>t.count&&Ae("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Eu);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Re("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new k(-1/0,-1/0,-1/0),new k(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const s=t[n];Xr.setFromBufferAttribute(s),this.morphTargetsRelative?(Ci.addVectors(this.boundingBox.min,Xr.min),this.boundingBox.expandByPoint(Ci),Ci.addVectors(this.boundingBox.max,Xr.max),this.boundingBox.expandByPoint(Ci)):(this.boundingBox.expandByPoint(Xr.min),this.boundingBox.expandByPoint(Xr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Re('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Rp);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Re("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new k,1/0);return}if(e){const n=this.boundingSphere.center;if(Xr.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const u=t[s];Jf.setFromBufferAttribute(u),this.morphTargetsRelative?(Ci.addVectors(Xr.min,Jf.min),Xr.expandByPoint(Ci),Ci.addVectors(Xr.max,Jf.max),Xr.expandByPoint(Ci)):(Xr.expandByPoint(Jf.min),Xr.expandByPoint(Jf.max))}Xr.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)Ci.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(Ci));if(t)for(let s=0,o=t.length;s<o;s++){const u=t[s],c=this.morphTargetsRelative;for(let h=0,d=u.count;h<d;h++)Ci.fromBufferAttribute(u,h),c&&(bc.fromBufferAttribute(e,h),Ci.add(bc)),r=Math.max(r,n.distanceToSquared(Ci))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&Re('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){Re("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Xi(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),u=[],c=[];for(let U=0;U<n.count;U++)u[U]=new k,c[U]=new k;const h=new k,d=new k,p=new k,g=new Ue,_=new Ue,v=new Ue,T=new k,b=new k;function x(U,R,P){h.fromBufferAttribute(n,U),d.fromBufferAttribute(n,R),p.fromBufferAttribute(n,P),g.fromBufferAttribute(s,U),_.fromBufferAttribute(s,R),v.fromBufferAttribute(s,P),d.sub(h),p.sub(h),_.sub(g),v.sub(g);const I=1/(_.x*v.y-v.x*_.y);isFinite(I)&&(T.copy(d).multiplyScalar(v.y).addScaledVector(p,-_.y).multiplyScalar(I),b.copy(p).multiplyScalar(_.x).addScaledVector(d,-v.x).multiplyScalar(I),u[U].add(T),u[R].add(T),u[P].add(T),c[U].add(b),c[R].add(b),c[P].add(b))}let M=this.groups;M.length===0&&(M=[{start:0,count:e.count}]);for(let U=0,R=M.length;U<R;++U){const P=M[U],I=P.start,H=P.count;for(let X=I,J=I+H;X<J;X+=3)x(e.getX(X+0),e.getX(X+1),e.getX(X+2))}const E=new k,w=new k,C=new k,N=new k;function D(U){C.fromBufferAttribute(r,U),N.copy(C);const R=u[U];E.copy(R),E.sub(C.multiplyScalar(C.dot(R))).normalize(),w.crossVectors(N,R);const I=w.dot(c[U])<0?-1:1;o.setXYZW(U,E.x,E.y,E.z,I)}for(let U=0,R=M.length;U<R;++U){const P=M[U],I=P.start,H=P.count;for(let X=I,J=I+H;X<J;X+=3)D(e.getX(X+0)),D(e.getX(X+1)),D(e.getX(X+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Xi(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let g=0,_=n.count;g<_;g++)n.setXYZ(g,0,0,0);const r=new k,s=new k,o=new k,u=new k,c=new k,h=new k,d=new k,p=new k;if(e)for(let g=0,_=e.count;g<_;g+=3){const v=e.getX(g+0),T=e.getX(g+1),b=e.getX(g+2);r.fromBufferAttribute(t,v),s.fromBufferAttribute(t,T),o.fromBufferAttribute(t,b),d.subVectors(o,s),p.subVectors(r,s),d.cross(p),u.fromBufferAttribute(n,v),c.fromBufferAttribute(n,T),h.fromBufferAttribute(n,b),u.add(d),c.add(d),h.add(d),n.setXYZ(v,u.x,u.y,u.z),n.setXYZ(T,c.x,c.y,c.z),n.setXYZ(b,h.x,h.y,h.z)}else for(let g=0,_=t.count;g<_;g+=3)r.fromBufferAttribute(t,g+0),s.fromBufferAttribute(t,g+1),o.fromBufferAttribute(t,g+2),d.subVectors(o,s),p.subVectors(r,s),d.cross(p),n.setXYZ(g+0,d.x,d.y,d.z),n.setXYZ(g+1,d.x,d.y,d.z),n.setXYZ(g+2,d.x,d.y,d.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ci.fromBufferAttribute(e,t),Ci.normalize(),e.setXYZ(t,Ci.x,Ci.y,Ci.z)}toNonIndexed(){function e(u,c){const h=u.array,d=u.itemSize,p=u.normalized,g=new h.constructor(c.length*d);let _=0,v=0;for(let T=0,b=c.length;T<b;T++){u.isInterleavedBufferAttribute?_=c[T]*u.data.stride+u.offset:_=c[T]*d;for(let x=0;x<d;x++)g[v++]=h[_++]}return new Xi(g,d,p)}if(this.index===null)return Ae("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new wi,n=this.index.array,r=this.attributes;for(const u in r){const c=r[u],h=e(c,n);t.setAttribute(u,h)}const s=this.morphAttributes;for(const u in s){const c=[],h=s[u];for(let d=0,p=h.length;d<p;d++){const g=h[d],_=e(g,n);c.push(_)}t.morphAttributes[u]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let u=0,c=o.length;u<c;u++){const h=o[u];t.addGroup(h.start,h.count,h.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const c in n){const h=n[c];e.data.attributes[c]=h.toJSON(e.data)}const r={};let s=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],d=[];for(let p=0,g=h.length;p<g;p++){const _=h[p];d.push(_.toJSON(e.data))}d.length>0&&(r[c]=d,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere=u.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const r=e.attributes;for(const h in r){const d=r[h];this.setAttribute(h,d.clone(t))}const s=e.morphAttributes;for(const h in s){const d=[],p=s[h];for(let g=0,_=p.length;g<_;g++)d.push(p[g].clone(t));this.morphAttributes[h]=d}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let h=0,d=o.length;h<d;h++){const p=o[h];this.addGroup(p.start,p.count,p.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const nw=new Ht,Il=new H_,ug=new Rp,iw=new k,cg=new k,hg=new k,fg=new k,jy=new k,dg=new k,rw=new k,pg=new k;class yi extends ci{constructor(e=new wi,t=new la){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const u=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=s}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const u=this.morphTargetInfluences;if(s&&u){dg.set(0,0,0);for(let c=0,h=s.length;c<h;c++){const d=u[c],p=s[c];d!==0&&(jy.fromBufferAttribute(p,e),o?dg.addScaledVector(jy,d):dg.addScaledVector(jy.sub(t),d))}t.add(dg)}return t}raycast(e,t){const n=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),ug.copy(n.boundingSphere),ug.applyMatrix4(s),Il.copy(e.ray).recast(e.near),!(ug.containsPoint(Il.origin)===!1&&(Il.intersectSphere(ug,iw)===null||Il.origin.distanceToSquared(iw)>(e.far-e.near)**2))&&(nw.copy(s).invert(),Il.copy(e.ray).applyMatrix4(nw),!(n.boundingBox!==null&&Il.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,Il)))}_computeIntersections(e,t,n){let r;const s=this.geometry,o=this.material,u=s.index,c=s.attributes.position,h=s.attributes.uv,d=s.attributes.uv1,p=s.attributes.normal,g=s.groups,_=s.drawRange;if(u!==null)if(Array.isArray(o))for(let v=0,T=g.length;v<T;v++){const b=g[v],x=o[b.materialIndex],M=Math.max(b.start,_.start),E=Math.min(u.count,Math.min(b.start+b.count,_.start+_.count));for(let w=M,C=E;w<C;w+=3){const N=u.getX(w),D=u.getX(w+1),U=u.getX(w+2);r=mg(this,x,e,n,h,d,p,N,D,U),r&&(r.faceIndex=Math.floor(w/3),r.face.materialIndex=b.materialIndex,t.push(r))}}else{const v=Math.max(0,_.start),T=Math.min(u.count,_.start+_.count);for(let b=v,x=T;b<x;b+=3){const M=u.getX(b),E=u.getX(b+1),w=u.getX(b+2);r=mg(this,o,e,n,h,d,p,M,E,w),r&&(r.faceIndex=Math.floor(b/3),t.push(r))}}else if(c!==void 0)if(Array.isArray(o))for(let v=0,T=g.length;v<T;v++){const b=g[v],x=o[b.materialIndex],M=Math.max(b.start,_.start),E=Math.min(c.count,Math.min(b.start+b.count,_.start+_.count));for(let w=M,C=E;w<C;w+=3){const N=w,D=w+1,U=w+2;r=mg(this,x,e,n,h,d,p,N,D,U),r&&(r.faceIndex=Math.floor(w/3),r.face.materialIndex=b.materialIndex,t.push(r))}}else{const v=Math.max(0,_.start),T=Math.min(c.count,_.start+_.count);for(let b=v,x=T;b<x;b+=3){const M=b,E=b+1,w=b+2;r=mg(this,o,e,n,h,d,p,M,E,w),r&&(r.faceIndex=Math.floor(b/3),t.push(r))}}}}function MB(i,e,t,n,r,s,o,u){let c;if(e.side===Pn?c=n.intersectTriangle(o,s,r,!0,u):c=n.intersectTriangle(r,s,o,e.side===Jr,u),c===null)return null;pg.copy(u),pg.applyMatrix4(i.matrixWorld);const h=t.ray.origin.distanceTo(pg);return h<t.near||h>t.far?null:{distance:h,point:pg.clone(),object:i}}function mg(i,e,t,n,r,s,o,u,c,h){i.getVertexPosition(u,cg),i.getVertexPosition(c,hg),i.getVertexPosition(h,fg);const d=MB(i,e,t,n,cg,hg,fg,rw);if(d){const p=new k;gs.getBarycoord(rw,cg,hg,fg,p),r&&(d.uv=gs.getInterpolatedAttribute(r,u,c,h,p,new Ue)),s&&(d.uv1=gs.getInterpolatedAttribute(s,u,c,h,p,new Ue)),o&&(d.normal=gs.getInterpolatedAttribute(o,u,c,h,p,new k),d.normal.dot(n.direction)>0&&d.normal.multiplyScalar(-1));const g={a:u,b:c,c:h,normal:new k,materialIndex:0};gs.getNormal(cg,hg,fg,g.normal),d.face=g,d.barycoord=p}return d}class Au extends wi{constructor(e=1,t=1,n=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const u=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const c=[],h=[],d=[],p=[];let g=0,_=0;v("z","y","x",-1,-1,n,t,e,o,s,0),v("z","y","x",1,-1,n,t,-e,o,s,1),v("x","z","y",1,1,e,n,t,r,o,2),v("x","z","y",1,-1,e,n,-t,r,o,3),v("x","y","z",1,-1,e,t,n,r,s,4),v("x","y","z",-1,-1,e,t,-n,r,s,5),this.setIndex(c),this.setAttribute("position",new ti(h,3)),this.setAttribute("normal",new ti(d,3)),this.setAttribute("uv",new ti(p,2));function v(T,b,x,M,E,w,C,N,D,U,R){const P=w/D,I=C/U,H=w/2,X=C/2,J=N/2,ne=D+1,G=U+1;let z=0,q=0;const ce=new k;for(let xe=0;xe<G;xe++){const O=xe*I-X;for(let Y=0;Y<ne;Y++){const ue=Y*P-H;ce[T]=ue*M,ce[b]=O*E,ce[x]=J,h.push(ce.x,ce.y,ce.z),ce[T]=0,ce[b]=0,ce[x]=N>0?1:-1,d.push(ce.x,ce.y,ce.z),p.push(Y/D),p.push(1-xe/U),z+=1}}for(let xe=0;xe<U;xe++)for(let O=0;O<D;O++){const Y=g+O+ne*xe,ue=g+O+ne*(xe+1),Ne=g+(O+1)+ne*(xe+1),Z=g+(O+1)+ne*xe;c.push(Y,ue,Z),c.push(ue,Ne,Z),q+=6}u.addGroup(_,q,R),_+=q,g+=z}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Au(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Dh(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const r=i[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(Ae("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function cr(i){const e={};for(let t=0;t<i.length;t++){const n=Dh(i[t]);for(const r in n)e[r]=n[r]}return e}function EB(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function YN(i){const e=i.getRenderTarget();return e===null?i.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:vt.workingColorSpace}const KN={clone:Dh,merge:cr};var AB=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,wB=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class bs extends ar{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=AB,this.fragmentShader=wB,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Dh(e.uniforms),this.uniformsGroups=EB(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this.defaultAttributeValues=Object.assign({},e.defaultAttributeValues),this.index0AttributeName=e.index0AttributeName,this.uniformsNeedUpdate=e.uniformsNeedUpdate,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class YS extends ci{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ht,this.projectionMatrix=new Ht,this.projectionMatrixInverse=new Ht,this.coordinateSystem=gr,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Yo=new k,sw=new Ue,aw=new Ue;class Di extends YS{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=gu*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Fd*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return gu*2*Math.atan(Math.tan(Fd*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Yo.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Yo.x,Yo.y).multiplyScalar(-e/Yo.z),Yo.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Yo.x,Yo.y).multiplyScalar(-e/Yo.z)}getViewSize(e,t){return this.getViewBounds(e,sw,aw),t.subVectors(aw,sw)}setViewOffset(e,t,n,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Fd*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,h=o.fullHeight;s+=o.offsetX*r/c,t-=o.offsetY*n/h,r*=o.width/c,n*=o.height/h}const u=this.filmOffset;u!==0&&(s+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Sc=-90,Tc=1;class QN extends ci{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Di(Sc,Tc,e,t);r.layers=this.layers,this.add(r);const s=new Di(Sc,Tc,e,t);s.layers=this.layers,this.add(s);const o=new Di(Sc,Tc,e,t);o.layers=this.layers,this.add(o);const u=new Di(Sc,Tc,e,t);u.layers=this.layers,this.add(u);const c=new Di(Sc,Tc,e,t);c.layers=this.layers,this.add(c);const h=new Di(Sc,Tc,e,t);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,s,o,u,c]=t;for(const h of t)this.remove(h);if(e===gr)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),u.up.set(0,1,0),u.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===ma)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),u.up.set(0,-1,0),u.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const h of t)this.add(h),h.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,u,c,h,d]=this.children,p=e.getRenderTarget(),g=e.getActiveCubeFace(),_=e.getActiveMipmapLevel(),v=e.xr.enabled;e.xr.enabled=!1;const T=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,s),e.setRenderTarget(n,1,r),e.render(t,o),e.setRenderTarget(n,2,r),e.render(t,u),e.setRenderTarget(n,3,r),e.render(t,c),e.setRenderTarget(n,4,r),e.render(t,h),n.texture.generateMipmaps=T,e.setRenderTarget(n,5,r),e.render(t,d),e.setRenderTarget(p,g,_),e.xr.enabled=v,n.texture.needsPMREMUpdate=!0}}class Cp extends ui{constructor(e=[],t=Vs,n,r,s,o,u,c,h,d){super(e,t,n,r,s,o,u,c,h,d),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class KS extends Gs{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new Cp(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Au(5,5,5),s=new bs({name:"CubemapFromEquirect",uniforms:Dh(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Pn,blending:_r});s.uniforms.tEquirect.value=t;const o=new yi(r,s),u=t.minFilter;return t.minFilter===Dr&&(t.minFilter=Gn),new QN(1,10,this).update(e,o),t.minFilter=u,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,n=!0,r=!0){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(s)}}let Hc=class extends ci{constructor(){super(),this.isGroup=!0,this.type="Group"}};const RB={type:"move"};class a_{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Hc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Hc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new k,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new k),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Hc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new k,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new k),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,s=null,o=null;const u=this._targetRay,c=this._grip,h=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(h&&e.hand){o=!0;for(const T of e.hand.values()){const b=t.getJointPose(T,n),x=this._getHandJoint(h,T);b!==null&&(x.matrix.fromArray(b.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale),x.matrixWorldNeedsUpdate=!0,x.jointRadius=b.radius),x.visible=b!==null}const d=h.joints["index-finger-tip"],p=h.joints["thumb-tip"],g=d.position.distanceTo(p.position),_=.02,v=.005;h.inputState.pinching&&g>_+v?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&g<=_-v&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));u!==null&&(r=t.getPose(e.targetRaySpace,n),r===null&&s!==null&&(r=s),r!==null&&(u.matrix.fromArray(r.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,r.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(r.linearVelocity)):u.hasLinearVelocity=!1,r.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(r.angularVelocity)):u.hasAngularVelocity=!1,this.dispatchEvent(RB)))}return u!==null&&(u.visible=r!==null),c!==null&&(c.visible=s!==null),h!==null&&(h.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new Hc;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class W_ extends ci{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Or,this.environmentIntensity=1,this.environmentRotation=new Or,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class QS{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Nh,this.updateRanges=[],this.version=0,this.uuid=lo()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=lo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=lo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ur=new k;class pp{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)ur.fromBufferAttribute(this,t),ur.applyMatrix4(e),this.setXYZ(t,ur.x,ur.y,ur.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ur.fromBufferAttribute(this,t),ur.applyNormalMatrix(e),this.setXYZ(t,ur.x,ur.y,ur.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ur.fromBufferAttribute(this,t),ur.transformDirection(e),this.setXYZ(t,ur.x,ur.y,ur.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=fr(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=It(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=It(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=It(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=It(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=It(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=fr(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=fr(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=fr(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=fr(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=It(t,this.array),n=It(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=It(t,this.array),n=It(n,this.array),r=It(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=It(t,this.array),n=It(n,this.array),r=It(r,this.array),s=It(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){dp("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new Xi(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new pp(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){dp("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class ZS extends ar{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new dt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Mc;const ed=new k,Ec=new k,Ac=new k,wc=new Ue,td=new Ue,ZN=new Ht,gg=new k,nd=new k,_g=new k,ow=new Ue,Xy=new Ue,lw=new Ue;class CB extends ci{constructor(e=new ZS){if(super(),this.isSprite=!0,this.type="Sprite",Mc===void 0){Mc=new wi;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new QS(t,5);Mc.setIndex([0,1,2,0,2,3]),Mc.setAttribute("position",new pp(n,3,0,!1)),Mc.setAttribute("uv",new pp(n,2,3,!1))}this.geometry=Mc,this.material=e,this.center=new Ue(.5,.5),this.count=1}raycast(e,t){e.camera===null&&Re('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ec.setFromMatrixScale(this.matrixWorld),ZN.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ac.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Ec.multiplyScalar(-Ac.z);const n=this.material.rotation;let r,s;n!==0&&(s=Math.cos(n),r=Math.sin(n));const o=this.center;vg(gg.set(-.5,-.5,0),Ac,o,Ec,r,s),vg(nd.set(.5,-.5,0),Ac,o,Ec,r,s),vg(_g.set(.5,.5,0),Ac,o,Ec,r,s),ow.set(0,0),Xy.set(1,0),lw.set(1,1);let u=e.ray.intersectTriangle(gg,nd,_g,!1,ed);if(u===null&&(vg(nd.set(-.5,.5,0),Ac,o,Ec,r,s),Xy.set(0,1),u=e.ray.intersectTriangle(gg,_g,nd,!1,ed),u===null))return;const c=e.ray.origin.distanceTo(ed);c<e.near||c>e.far||t.push({distance:c,point:ed.clone(),uv:gs.getInterpolation(ed,gg,nd,_g,ow,Xy,lw,new Ue),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function vg(i,e,t,n,r,s){wc.subVectors(i,t).addScalar(.5).multiply(n),r!==void 0?(td.x=s*wc.x-r*wc.y,td.y=r*wc.x+s*wc.y):td.copy(wc),i.copy(e),i.x+=td.x,i.y+=td.y,i.applyMatrix4(ZN)}class JS extends ui{constructor(e=null,t=1,n=1,r,s,o,u,c,h=xn,d=xn,p,g){super(null,o,u,c,h,d,r,s,p,g),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class NB extends Xi{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Yy=new k,DB=new k,LB=new Ct;class Bs{constructor(e=new k(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=Yy.subVectors(n,t).cross(DB.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Yy),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||LB.getNormalMatrix(e),r=this.coplanarPoint(Yy).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const zl=new Rp,PB=new Ue(.5,.5),yg=new k;class Np{constructor(e=new Bs,t=new Bs,n=new Bs,r=new Bs,s=new Bs,o=new Bs){this.planes=[e,t,n,r,s,o]}set(e,t,n,r,s,o){const u=this.planes;return u[0].copy(e),u[1].copy(t),u[2].copy(n),u[3].copy(r),u[4].copy(s),u[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=gr,n=!1){const r=this.planes,s=e.elements,o=s[0],u=s[1],c=s[2],h=s[3],d=s[4],p=s[5],g=s[6],_=s[7],v=s[8],T=s[9],b=s[10],x=s[11],M=s[12],E=s[13],w=s[14],C=s[15];if(r[0].setComponents(h-o,_-d,x-v,C-M).normalize(),r[1].setComponents(h+o,_+d,x+v,C+M).normalize(),r[2].setComponents(h+u,_+p,x+T,C+E).normalize(),r[3].setComponents(h-u,_-p,x-T,C-E).normalize(),n)r[4].setComponents(c,g,b,w).normalize(),r[5].setComponents(h-c,_-g,x-b,C-w).normalize();else if(r[4].setComponents(h-c,_-g,x-b,C-w).normalize(),t===gr)r[5].setComponents(h+c,_+g,x+b,C+w).normalize();else if(t===ma)r[5].setComponents(c,g,b,w).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),zl.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),zl.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(zl)}intersectsSprite(e){zl.center.set(0,0,0);const t=PB.distanceTo(e.center);return zl.radius=.7071067811865476+t,zl.applyMatrix4(e.matrixWorld),this.intersectsSphere(zl)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(yg.x=r.normal.x>0?e.max.x:e.min.x,yg.y=r.normal.y>0?e.max.y:e.min.y,yg.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(yg)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const Ks=new Ht,Qs=new Np;class eT{constructor(){this.coordinateSystem=gr}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ks.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Qs.setFromProjectionMatrix(Ks,r.coordinateSystem,r.reversedDepth),Qs.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ks.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Qs.setFromProjectionMatrix(Ks,r.coordinateSystem,r.reversedDepth),Qs.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ks.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Qs.setFromProjectionMatrix(Ks,r.coordinateSystem,r.reversedDepth),Qs.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ks.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Qs.setFromProjectionMatrix(Ks,r.coordinateSystem,r.reversedDepth),Qs.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ks.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Qs.setFromProjectionMatrix(Ks,r.coordinateSystem,r.reversedDepth),Qs.containsPoint(e))return!0}return!1}clone(){return new eT}}class q_ extends ar{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new dt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const y_=new k,x_=new k,uw=new Ht,id=new H_,xg=new Rp,Ky=new k,cw=new k;class UB extends ci{constructor(e=new wi,t=new q_){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let r=1,s=t.count;r<s;r++)y_.fromBufferAttribute(t,r-1),x_.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=y_.distanceTo(x_);e.setAttribute("lineDistance",new ti(n,1))}else Ae("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),xg.copy(n.boundingSphere),xg.applyMatrix4(r),xg.radius+=s,e.ray.intersectsSphere(xg)===!1)return;uw.copy(r).invert(),id.copy(e.ray).applyMatrix4(uw);const u=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=u*u,h=this.isLineSegments?2:1,d=n.index,g=n.attributes.position;if(d!==null){const _=Math.max(0,o.start),v=Math.min(d.count,o.start+o.count);for(let T=_,b=v-1;T<b;T+=h){const x=d.getX(T),M=d.getX(T+1),E=bg(this,e,id,c,x,M,T);E&&t.push(E)}if(this.isLineLoop){const T=d.getX(v-1),b=d.getX(_),x=bg(this,e,id,c,T,b,v-1);x&&t.push(x)}}else{const _=Math.max(0,o.start),v=Math.min(g.count,o.start+o.count);for(let T=_,b=v-1;T<b;T+=h){const x=bg(this,e,id,c,T,T+1,T);x&&t.push(x)}if(this.isLineLoop){const T=bg(this,e,id,c,v-1,_,v-1);T&&t.push(T)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const u=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=s}}}}}function bg(i,e,t,n,r,s,o){const u=i.geometry.attributes.position;if(y_.fromBufferAttribute(u,r),x_.fromBufferAttribute(u,s),t.distanceSqToSegment(y_,x_,Ky,cw)>n)return;Ky.applyMatrix4(i.matrixWorld);const h=e.ray.origin.distanceTo(Ky);if(!(h<e.near||h>e.far))return{distance:h,point:cw.clone().applyMatrix4(i.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:i}}class OB extends ar{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new dt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class JN extends ui{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=xn,this.minFilter=xn,this.generateMipmaps=!1,this.needsUpdate=!0}}class BB extends ui{constructor(e,t,n,r,s,o,u,c,h){super(e,t,n,r,s,o,u,c,h),this.isCanvasTexture=!0,this.needsUpdate=!0}}class vr extends ui{constructor(e,t,n=yn,r,s,o,u=xn,c=xn,h,d=ji,p=1){if(d!==ji&&d!==pr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const g={width:e,height:t,depth:p};super(g,r,s,o,u,c,d,n,h),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new WS(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class e2 extends vr{constructor(e,t=yn,n=Vs,r,s,o=xn,u=xn,c,h=ji){const d={width:e,height:e,depth:1},p=[d,d,d,d,d,d];super(e,e,t,n,r,s,o,u,c,h),this.image=p,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class t2 extends ui{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class Dp extends wi{constructor(e=1,t=1,n=1,r=32,s=1,o=!1,u=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:u,thetaLength:c};const h=this;r=Math.floor(r),s=Math.floor(s);const d=[],p=[],g=[],_=[];let v=0;const T=[],b=n/2;let x=0;M(),o===!1&&(e>0&&E(!0),t>0&&E(!1)),this.setIndex(d),this.setAttribute("position",new ti(p,3)),this.setAttribute("normal",new ti(g,3)),this.setAttribute("uv",new ti(_,2));function M(){const w=new k,C=new k;let N=0;const D=(t-e)/n;for(let U=0;U<=s;U++){const R=[],P=U/s,I=P*(t-e)+e;for(let H=0;H<=r;H++){const X=H/r,J=X*c+u,ne=Math.sin(J),G=Math.cos(J);C.x=I*ne,C.y=-P*n+b,C.z=I*G,p.push(C.x,C.y,C.z),w.set(ne,D,G).normalize(),g.push(w.x,w.y,w.z),_.push(X,1-P),R.push(v++)}T.push(R)}for(let U=0;U<r;U++)for(let R=0;R<s;R++){const P=T[R][U],I=T[R+1][U],H=T[R+1][U+1],X=T[R][U+1];(e>0||R!==0)&&(d.push(P,I,X),N+=3),(t>0||R!==s-1)&&(d.push(I,H,X),N+=3)}h.addGroup(x,N,0),x+=N}function E(w){const C=v,N=new Ue,D=new k;let U=0;const R=w===!0?e:t,P=w===!0?1:-1;for(let H=1;H<=r;H++)p.push(0,b*P,0),g.push(0,P,0),_.push(.5,.5),v++;const I=v;for(let H=0;H<=r;H++){const J=H/r*c+u,ne=Math.cos(J),G=Math.sin(J);D.x=R*G,D.y=b*P,D.z=R*ne,p.push(D.x,D.y,D.z),g.push(0,P,0),N.x=ne*.5+.5,N.y=G*.5*P+.5,_.push(N.x,N.y),v++}for(let H=0;H<r;H++){const X=C+H,J=I+H;w===!0?d.push(J,J+1,X):d.push(J+1,J,X),U+=3}h.addGroup(x,U,w===!0?1:2),x+=U}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Dp(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class tT extends Dp{constructor(e=1,t=1,n=32,r=1,s=!1,o=0,u=Math.PI*2){super(0,e,t,n,r,s,o,u),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:u}}static fromJSON(e){return new tT(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class mo{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){Ae("Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let r=0;const s=n.length;let o;t?o=t:o=e*n[s-1];let u=0,c=s-1,h;for(;u<=c;)if(r=Math.floor(u+(c-u)/2),h=n[r]-o,h<0)u=r+1;else if(h>0)c=r-1;else{c=r;break}if(r=c,n[r]===o)return r/(s-1);const d=n[r],g=n[r+1]-d,_=(o-d)/g;return(r+_)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),u=this.getPoint(s),c=t||(o.isVector2?new Ue:new k);return c.copy(u).sub(o).normalize(),c}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new k,r=[],s=[],o=[],u=new k,c=new Ht;for(let _=0;_<=e;_++){const v=_/e;r[_]=this.getTangentAt(v,new k)}s[0]=new k,o[0]=new k;let h=Number.MAX_VALUE;const d=Math.abs(r[0].x),p=Math.abs(r[0].y),g=Math.abs(r[0].z);d<=h&&(h=d,n.set(1,0,0)),p<=h&&(h=p,n.set(0,1,0)),g<=h&&n.set(0,0,1),u.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],u),o[0].crossVectors(r[0],s[0]);for(let _=1;_<=e;_++){if(s[_]=s[_-1].clone(),o[_]=o[_-1].clone(),u.crossVectors(r[_-1],r[_]),u.length()>Number.EPSILON){u.normalize();const v=Math.acos(zt(r[_-1].dot(r[_]),-1,1));s[_].applyMatrix4(c.makeRotationAxis(u,v))}o[_].crossVectors(r[_],s[_])}if(t===!0){let _=Math.acos(zt(s[0].dot(s[e]),-1,1));_/=e,r[0].dot(u.crossVectors(s[0],s[e]))>0&&(_=-_);for(let v=1;v<=e;v++)s[v].applyMatrix4(c.makeRotationAxis(r[v],_*v)),o[v].crossVectors(r[v],s[v])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class n2 extends mo{constructor(e=0,t=0,n=1,r=1,s=0,o=Math.PI*2,u=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=u,this.aRotation=c}getPoint(e,t=new Ue){const n=t,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const u=this.aStartAngle+e*s;let c=this.aX+this.xRadius*Math.cos(u),h=this.aY+this.yRadius*Math.sin(u);if(this.aRotation!==0){const d=Math.cos(this.aRotation),p=Math.sin(this.aRotation),g=c-this.aX,_=h-this.aY;c=g*d-_*p+this.aX,h=g*p+_*d+this.aY}return n.set(c,h)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class FB extends n2{constructor(e,t,n,r,s,o){super(e,t,n,n,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function nT(){let i=0,e=0,t=0,n=0;function r(s,o,u,c){i=s,e=u,t=-3*s+3*o-2*u-c,n=2*s-2*o+u+c}return{initCatmullRom:function(s,o,u,c,h){r(o,u,h*(u-s),h*(c-o))},initNonuniformCatmullRom:function(s,o,u,c,h,d,p){let g=(o-s)/h-(u-s)/(h+d)+(u-o)/d,_=(u-o)/d-(c-o)/(d+p)+(c-u)/p;g*=d,_*=d,r(o,u,g,_)},calc:function(s){const o=s*s,u=o*s;return i+e*s+t*o+n*u}}}const Sg=new k,Qy=new nT,Zy=new nT,Jy=new nT;class IB extends mo{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new k){const n=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let u=Math.floor(o),c=o-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/s)+1)*s:c===0&&u===s-1&&(u=s-2,c=1);let h,d;this.closed||u>0?h=r[(u-1)%s]:(Sg.subVectors(r[0],r[1]).add(r[0]),h=Sg);const p=r[u%s],g=r[(u+1)%s];if(this.closed||u+2<s?d=r[(u+2)%s]:(Sg.subVectors(r[s-1],r[s-2]).add(r[s-1]),d=Sg),this.curveType==="centripetal"||this.curveType==="chordal"){const _=this.curveType==="chordal"?.5:.25;let v=Math.pow(h.distanceToSquared(p),_),T=Math.pow(p.distanceToSquared(g),_),b=Math.pow(g.distanceToSquared(d),_);T<1e-4&&(T=1),v<1e-4&&(v=T),b<1e-4&&(b=T),Qy.initNonuniformCatmullRom(h.x,p.x,g.x,d.x,v,T,b),Zy.initNonuniformCatmullRom(h.y,p.y,g.y,d.y,v,T,b),Jy.initNonuniformCatmullRom(h.z,p.z,g.z,d.z,v,T,b)}else this.curveType==="catmullrom"&&(Qy.initCatmullRom(h.x,p.x,g.x,d.x,this.tension),Zy.initCatmullRom(h.y,p.y,g.y,d.y,this.tension),Jy.initCatmullRom(h.z,p.z,g.z,d.z,this.tension));return n.set(Qy.calc(c),Zy.calc(c),Jy.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new k().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function hw(i,e,t,n,r){const s=(n-e)*.5,o=(r-t)*.5,u=i*i,c=i*u;return(2*t-2*n+s+o)*c+(-3*t+3*n-2*s-o)*u+s*i+t}function zB(i,e){const t=1-i;return t*t*e}function GB(i,e){return 2*(1-i)*i*e}function kB(i,e){return i*i*e}function zd(i,e,t,n){return zB(i,e)+GB(i,t)+kB(i,n)}function VB(i,e){const t=1-i;return t*t*t*e}function HB(i,e){const t=1-i;return 3*t*t*i*e}function WB(i,e){return 3*(1-i)*i*i*e}function qB(i,e){return i*i*i*e}function Gd(i,e,t,n,r){return VB(i,e)+HB(i,t)+WB(i,n)+qB(i,r)}class $B extends mo{constructor(e=new Ue,t=new Ue,n=new Ue,r=new Ue){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Ue){const n=t,r=this.v0,s=this.v1,o=this.v2,u=this.v3;return n.set(Gd(e,r.x,s.x,o.x,u.x),Gd(e,r.y,s.y,o.y,u.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class i2 extends mo{constructor(e=new k,t=new k,n=new k,r=new k){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new k){const n=t,r=this.v0,s=this.v1,o=this.v2,u=this.v3;return n.set(Gd(e,r.x,s.x,o.x,u.x),Gd(e,r.y,s.y,o.y,u.y),Gd(e,r.z,s.z,o.z,u.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class jB extends mo{constructor(e=new Ue,t=new Ue){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Ue){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Ue){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class XB extends mo{constructor(e=new k,t=new k){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new k){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new k){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class YB extends mo{constructor(e=new Ue,t=new Ue,n=new Ue){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Ue){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(zd(e,r.x,s.x,o.x),zd(e,r.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class iT extends mo{constructor(e=new k,t=new k,n=new k){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new k){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(zd(e,r.x,s.x,o.x),zd(e,r.y,s.y,o.y),zd(e,r.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class KB extends mo{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Ue){const n=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),u=s-o,c=r[o===0?o:o-1],h=r[o],d=r[o>r.length-2?r.length-1:o+1],p=r[o>r.length-3?r.length-1:o+2];return n.set(hw(u,c.x,h.x,d.x,p.x),hw(u,c.y,h.y,d.y,p.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new Ue().fromArray(r))}return this}}var QB=Object.freeze({__proto__:null,ArcCurve:FB,CatmullRomCurve3:IB,CubicBezierCurve:$B,CubicBezierCurve3:i2,EllipseCurve:n2,LineCurve:jB,LineCurve3:XB,QuadraticBezierCurve:YB,QuadraticBezierCurve3:iT,SplineCurve:KB});class Lp extends wi{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const s=e/2,o=t/2,u=Math.floor(n),c=Math.floor(r),h=u+1,d=c+1,p=e/u,g=t/c,_=[],v=[],T=[],b=[];for(let x=0;x<d;x++){const M=x*g-o;for(let E=0;E<h;E++){const w=E*p-s;v.push(w,-M,0),T.push(0,0,1),b.push(E/u),b.push(1-x/c)}}for(let x=0;x<c;x++)for(let M=0;M<u;M++){const E=M+h*x,w=M+h*(x+1),C=M+1+h*(x+1),N=M+1+h*x;_.push(E,w,N),_.push(w,C,N)}this.setIndex(_),this.setAttribute("position",new ti(v,3)),this.setAttribute("normal",new ti(T,3)),this.setAttribute("uv",new ti(b,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Lp(e.width,e.height,e.widthSegments,e.heightSegments)}}class Pp extends wi{constructor(e=1,t=32,n=16,r=0,s=Math.PI*2,o=0,u=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:s,thetaStart:o,thetaLength:u},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const c=Math.min(o+u,Math.PI);let h=0;const d=[],p=new k,g=new k,_=[],v=[],T=[],b=[];for(let x=0;x<=n;x++){const M=[],E=x/n;let w=0;x===0&&o===0?w=.5/t:x===n&&c===Math.PI&&(w=-.5/t);for(let C=0;C<=t;C++){const N=C/t;p.x=-e*Math.cos(r+N*s)*Math.sin(o+E*u),p.y=e*Math.cos(o+E*u),p.z=e*Math.sin(r+N*s)*Math.sin(o+E*u),v.push(p.x,p.y,p.z),g.copy(p).normalize(),T.push(g.x,g.y,g.z),b.push(N+w,1-E),M.push(h++)}d.push(M)}for(let x=0;x<n;x++)for(let M=0;M<t;M++){const E=d[x][M+1],w=d[x][M],C=d[x+1][M],N=d[x+1][M+1];(x!==0||o>0)&&_.push(E,w,N),(x!==n-1||c<Math.PI)&&_.push(w,C,N)}this.setIndex(_),this.setAttribute("position",new ti(v,3)),this.setAttribute("normal",new ti(T,3)),this.setAttribute("uv",new ti(b,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pp(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class rT extends wi{constructor(e=new iT(new k(-1,-1,0),new k(-1,1,0),new k(1,1,0)),t=64,n=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const u=new k,c=new k,h=new Ue;let d=new k;const p=[],g=[],_=[],v=[];T(),this.setIndex(v),this.setAttribute("position",new ti(p,3)),this.setAttribute("normal",new ti(g,3)),this.setAttribute("uv",new ti(_,2));function T(){for(let E=0;E<t;E++)b(E);b(s===!1?t:0),M(),x()}function b(E){d=e.getPointAt(E/t,d);const w=o.normals[E],C=o.binormals[E];for(let N=0;N<=r;N++){const D=N/r*Math.PI*2,U=Math.sin(D),R=-Math.cos(D);c.x=R*w.x+U*C.x,c.y=R*w.y+U*C.y,c.z=R*w.z+U*C.z,c.normalize(),g.push(c.x,c.y,c.z),u.x=d.x+n*c.x,u.y=d.y+n*c.y,u.z=d.z+n*c.z,p.push(u.x,u.y,u.z)}}function x(){for(let E=1;E<=t;E++)for(let w=1;w<=r;w++){const C=(r+1)*(E-1)+(w-1),N=(r+1)*E+(w-1),D=(r+1)*E+w,U=(r+1)*(E-1)+w;v.push(C,N,U),v.push(N,D,U)}}function M(){for(let E=0;E<=t;E++)for(let w=0;w<=r;w++)h.x=E/t,h.y=w/r,_.push(h.x,h.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new rT(new QB[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class ZB extends ar{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new dt(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class JB extends bs{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class r2 extends ar{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new dt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=da,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Or,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class eF extends r2{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ue(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return zt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new dt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new dt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new dt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class tF extends ar{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new dt(16777215),this.specular=new dt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=da,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Or,this.combine=Sp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nF extends ar{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new dt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=da,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class iF extends ar{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=da,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class s2 extends ar{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new dt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=da,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Or,this.combine=Sp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class rF extends ar{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=CO,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class sF extends ar{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class aF extends ar{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new dt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=da,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class oF extends q_{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}const ex={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class lF{constructor(e,t,n){const r=this;let s=!1,o=0,u=0,c;const h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this._abortController=null,this.itemStart=function(d){u++,s===!1&&r.onStart!==void 0&&r.onStart(d,o,u),s=!0},this.itemEnd=function(d){o++,r.onProgress!==void 0&&r.onProgress(d,o,u),o===u&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(d){r.onError!==void 0&&r.onError(d)},this.resolveURL=function(d){return c?c(d):d},this.setURLModifier=function(d){return c=d,this},this.addHandler=function(d,p){return h.push(d,p),this},this.removeHandler=function(d){const p=h.indexOf(d);return p!==-1&&h.splice(p,2),this},this.getHandler=function(d){for(let p=0,g=h.length;p<g;p+=2){const _=h[p],v=h[p+1];if(_.global&&(_.lastIndex=0),_.test(d))return v}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const uF=new lF;class sT{constructor(e){this.manager=e!==void 0?e:uF,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,s){n.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}sT.DEFAULT_MATERIAL_NAME="__DEFAULT";const Rc=new WeakMap;class cF extends sT{constructor(e){super(e)}load(e,t,n,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=ex.get(`image:${e}`);if(o!==void 0){if(o.complete===!0)s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0);else{let p=Rc.get(o);p===void 0&&(p=[],Rc.set(o,p)),p.push({onLoad:t,onError:r})}return o}const u=fp("img");function c(){d(),t&&t(this);const p=Rc.get(this)||[];for(let g=0;g<p.length;g++){const _=p[g];_.onLoad&&_.onLoad(this)}Rc.delete(this),s.manager.itemEnd(e)}function h(p){d(),r&&r(p),ex.remove(`image:${e}`);const g=Rc.get(this)||[];for(let _=0;_<g.length;_++){const v=g[_];v.onError&&v.onError(p)}Rc.delete(this),s.manager.itemError(e),s.manager.itemEnd(e)}function d(){u.removeEventListener("load",c,!1),u.removeEventListener("error",h,!1)}return u.addEventListener("load",c,!1),u.addEventListener("error",h,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(u.crossOrigin=this.crossOrigin),ex.add(`image:${e}`,u),s.manager.itemStart(e),u.src=e,u}}class hF extends sT{constructor(e){super(e)}load(e,t,n,r){const s=new ui,o=new cF(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(u){s.image=u,s.needsUpdate=!0,t!==void 0&&t(s)},n,r),s}}class wu extends ci{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new dt(e),this.intensity=t}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t}}class fF extends wu{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ci.DEFAULT_UP),this.updateMatrix(),this.groundColor=new dt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}toJSON(e){const t=super.toJSON(e);return t.object.groundColor=this.groundColor.getHex(),t}}const tx=new Ht,fw=new k,dw=new k;class aT{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ue(512,512),this.mapType=Hn,this.map=null,this.mapPass=null,this.matrix=new Ht,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Np,this._frameExtents=new Ue(1,1),this._viewportCount=1,this._viewports=[new Lt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;fw.setFromMatrixPosition(e.matrixWorld),t.position.copy(fw),dw.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(dw),t.updateMatrixWorld(),tx.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(tx,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(tx)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class dF extends aT{constructor(){super(new Di(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=gu*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||t.far;(n!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class oT extends wu{constructor(e,t,n=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ci.DEFAULT_UP),this.updateMatrix(),this.target=new ci,this.distance=n,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new dF}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.map=e.map,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.angle=this.angle,t.object.decay=this.decay,t.object.penumbra=this.penumbra,t.object.target=this.target.uuid,this.map&&this.map.isTexture&&(t.object.map=this.map.toJSON(e).uuid),t.object.shadow=this.shadow.toJSON(),t}}class pF extends aT{constructor(){super(new Di(90,1,.5,500)),this.isPointLightShadow=!0}}class mF extends wu{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new pF}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.decay=this.decay,t.object.shadow=this.shadow.toJSON(),t}}class Wh extends YS{constructor(e=-1,t=1,n=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,o=n+e,u=r+t,c=r-t;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=h*this.view.offsetX,o=s+h*this.view.width,u-=d*this.view.offsetY,c=u-d*this.view.height}this.projectionMatrix.makeOrthographic(s,o,u,c,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class gF extends aT{constructor(){super(new Wh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class a2 extends wu{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ci.DEFAULT_UP),this.updateMatrix(),this.target=new ci,this.shadow=new gF}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.shadow=this.shadow.toJSON(),t.object.target=this.target.uuid,t}}class o2 extends wu{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class _F extends wu{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class vF{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new k)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(n*s)),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*n*s),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const n=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-r*r)}}class yF extends wu{constructor(e=new vF,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class l2 extends Di{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class u2{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}class xF extends QS{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const pw=new Ht;class c2{constructor(e,t,n=0,r=1/0){this.ray=new H_(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new $S,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):Re("Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return pw.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(pw),this}intersectObject(e,t=!0,n=[]){return Tb(e,this,n,t),n.sort(mw),n}intersectObjects(e,t=!0,n=[]){for(let r=0,s=e.length;r<s;r++)Tb(e[r],this,n,t);return n.sort(mw),n}}function mw(i,e){return i.distance-e.distance}function Tb(i,e,t,n){let r=!0;if(i.layers.test(e.layers)&&i.raycast(e,t)===!1&&(r=!1),r===!0&&n===!0){const s=i.children;for(let o=0,u=s.length;o<u;o++)Tb(s[o],e,t,!0)}}class gw{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=zt(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(zt(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class $_{constructor(e,t,n,r){$_.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,r){const s=this.elements;return s[0]=e,s[2]=t,s[1]=n,s[3]=r,this}}class j_ extends xa{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){Ae("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function Mb(i,e,t,n){const r=bF(n);switch(t){case BS:return i*e;case Mp:return i*e/r.components*r.byteLength;case kh:return i*e/r.components*r.byteLength;case mr:return i*e*2/r.components*r.byteLength;case Vh:return i*e*2/r.components*r.byteLength;case Tp:return i*e*3/r.components*r.byteLength;case si:return i*e*4/r.components*r.byteLength;case Hh:return i*e*4/r.components*r.byteLength;case sl:case al:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case ol:case ll:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case up:case hp:return Math.max(i,16)*Math.max(e,8)/4;case lp:case cp:return Math.max(i,8)*Math.max(e,8)/2;case sh:case ah:case lh:case uh:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case oh:case du:case ch:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case hh:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case fh:return Math.floor((i+4)/5)*Math.floor((e+3)/4)*16;case dh:return Math.floor((i+4)/5)*Math.floor((e+4)/5)*16;case ph:return Math.floor((i+5)/6)*Math.floor((e+4)/5)*16;case mh:return Math.floor((i+5)/6)*Math.floor((e+5)/6)*16;case gh:return Math.floor((i+7)/8)*Math.floor((e+4)/5)*16;case _h:return Math.floor((i+7)/8)*Math.floor((e+5)/6)*16;case vh:return Math.floor((i+7)/8)*Math.floor((e+7)/8)*16;case yh:return Math.floor((i+9)/10)*Math.floor((e+4)/5)*16;case xh:return Math.floor((i+9)/10)*Math.floor((e+5)/6)*16;case bh:return Math.floor((i+9)/10)*Math.floor((e+7)/8)*16;case Sh:return Math.floor((i+9)/10)*Math.floor((e+9)/10)*16;case Th:return Math.floor((i+11)/12)*Math.floor((e+9)/10)*16;case Mh:return Math.floor((i+11)/12)*Math.floor((e+11)/12)*16;case Eh:case xb:case bb:return Math.ceil(i/4)*Math.ceil(e/4)*16;case Ah:case wh:return Math.ceil(i/4)*Math.ceil(e/4)*8;case pu:case Rh:return Math.ceil(i/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function bF(i){switch(i){case Hn:case iu:return{byteLength:1,components:1};case Is:case ru:case Zn:return{byteLength:2,components:1};case z_:case G_:return{byteLength:2,components:4};case yn:case Ni:case ri:return{byteLength:4,components:1};case k_:case V_:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${i}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Tu}}));typeof window<"u"&&(window.__THREE__?Ae("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Tu);function h2(){let i=null,e=!1,t=null,n=null;function r(s,o){t(s,o),n=i.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(r),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){i=s}}}function SF(i){const e=new WeakMap;function t(u,c){const h=u.array,d=u.usage,p=h.byteLength,g=i.createBuffer();i.bindBuffer(c,g),i.bufferData(c,h,d),u.onUploadCallback();let _;if(h instanceof Float32Array)_=i.FLOAT;else if(typeof Float16Array<"u"&&h instanceof Float16Array)_=i.HALF_FLOAT;else if(h instanceof Uint16Array)u.isFloat16BufferAttribute?_=i.HALF_FLOAT:_=i.UNSIGNED_SHORT;else if(h instanceof Int16Array)_=i.SHORT;else if(h instanceof Uint32Array)_=i.UNSIGNED_INT;else if(h instanceof Int32Array)_=i.INT;else if(h instanceof Int8Array)_=i.BYTE;else if(h instanceof Uint8Array)_=i.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)_=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:g,type:_,bytesPerElement:h.BYTES_PER_ELEMENT,version:u.version,size:p}}function n(u,c,h){const d=c.array,p=c.updateRanges;if(i.bindBuffer(h,u),p.length===0)i.bufferSubData(h,0,d);else{p.sort((_,v)=>_.start-v.start);let g=0;for(let _=1;_<p.length;_++){const v=p[g],T=p[_];T.start<=v.start+v.count+1?v.count=Math.max(v.count,T.start+T.count-v.start):(++g,p[g]=T)}p.length=g+1;for(let _=0,v=p.length;_<v;_++){const T=p[_];i.bufferSubData(h,T.start*d.BYTES_PER_ELEMENT,d,T.start,T.count)}c.clearUpdateRanges()}c.onUploadCallback()}function r(u){return u.isInterleavedBufferAttribute&&(u=u.data),e.get(u)}function s(u){u.isInterleavedBufferAttribute&&(u=u.data);const c=e.get(u);c&&(i.deleteBuffer(c.buffer),e.delete(u))}function o(u,c){if(u.isInterleavedBufferAttribute&&(u=u.data),u.isGLBufferAttribute){const d=e.get(u);(!d||d.version<u.version)&&e.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}const h=e.get(u);if(h===void 0)e.set(u,t(u,c));else if(h.version<u.version){if(h.size!==u.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(h.buffer,u,c),h.version=u.version}}return{get:r,remove:s,update:o}}var TF=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,MF=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,EF=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,AF=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,wF=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,RF=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,CF=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,NF=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,DF=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,LF=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,PF=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,UF=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,OF=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,BF=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,FF=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,IF=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,zF=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,GF=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,kF=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,VF=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,HF=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,WF=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,qF=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,$F=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,jF=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,XF=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,YF=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,KF=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,QF=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,ZF=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,JF="gl_FragColor = linearToOutputTexel( gl_FragColor );",eI=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,tI=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,nI=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,iI=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,rI=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,sI=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,aI=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,oI=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,lI=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,uI=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,cI=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,hI=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,fI=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,dI=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,pI=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,mI=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,gI=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,_I=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,vI=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,yI=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,xI=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.diffuseContribution = diffuseColor.rgb * ( 1.0 - metalnessFactor );
material.metalness = metalnessFactor;
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor;
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = vec3( 0.04 );
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.0001, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,bI=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	vec3 diffuseContribution;
	vec3 specularColor;
	vec3 specularColorBlended;
	float roughness;
	float metalness;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
		vec3 iridescenceFresnelDielectric;
		vec3 iridescenceFresnelMetallic;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return v;
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColorBlended;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float rInv = 1.0 / ( roughness + 0.1 );
	float a = -1.9362 + 1.0678 * roughness + 0.4573 * r2 - 0.8469 * rInv;
	float b = -0.6014 + 0.5538 * roughness - 0.4670 * r2 - 0.1255 * rInv;
	float DG = exp( a * dotNV + b );
	return saturate( DG );
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = texture2D( dfgLUT, vec2( material.roughness, dotNV ) ).rg;
	vec2 dfgL = texture2D( dfgLUT, vec2( material.roughness, dotNL ) ).rg;
	vec3 FssEss_V = material.specularColorBlended * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColorBlended * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColorBlended + ( 1.0 - material.specularColorBlended ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColorBlended * t2.x + ( vec3( 1.0 ) - material.specularColorBlended ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseContribution * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
 
 		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
 
 		float sheenAlbedoV = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
 		float sheenAlbedoL = IBLSheenBRDF( geometryNormal, directLight.direction, material.sheenRoughness );
 
 		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * max( sheenAlbedoV, sheenAlbedoL );
 
 		irradiance *= sheenEnergyComp;
 
 	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseContribution );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 diffuse = irradiance * BRDF_Lambert( material.diffuseContribution );
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		diffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectDiffuse += diffuse;
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness ) * RECIPROCAL_PI;
 	#endif
	vec3 singleScatteringDielectric = vec3( 0.0 );
	vec3 multiScatteringDielectric = vec3( 0.0 );
	vec3 singleScatteringMetallic = vec3( 0.0 );
	vec3 multiScatteringMetallic = vec3( 0.0 );
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnelDielectric, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.iridescence, material.iridescenceFresnelMetallic, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscattering( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#endif
	vec3 singleScattering = mix( singleScatteringDielectric, singleScatteringMetallic, material.metalness );
	vec3 multiScattering = mix( multiScatteringDielectric, multiScatteringMetallic, material.metalness );
	vec3 totalScatteringDielectric = singleScatteringDielectric + multiScatteringDielectric;
	vec3 diffuse = material.diffuseContribution * ( 1.0 - totalScatteringDielectric );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	vec3 indirectSpecular = radiance * singleScattering;
	indirectSpecular += multiScattering * cosineWeightedIrradiance;
	vec3 indirectDiffuse = diffuse * cosineWeightedIrradiance;
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		indirectSpecular *= sheenEnergyComp;
		indirectDiffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectSpecular += indirectSpecular;
	reflectedLight.indirectDiffuse += indirectDiffuse;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,SI=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnelDielectric = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceFresnelMetallic = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.diffuseColor );
		material.iridescenceFresnel = mix( material.iridescenceFresnelDielectric, material.iridescenceFresnelMetallic, material.metalness );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS ) && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,TI=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,MI=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,EI=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,AI=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,wI=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,RI=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,CI=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,NI=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,DI=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,LI=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,PI=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,UI=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,OI=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,BI=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,FI=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,II=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,zI=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,GI=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,kI=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,VI=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,HI=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,WI=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,qI=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,$I=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,jI=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,XI=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,YI=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,KI=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,QI=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,ZI=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,JI=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,ez=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,tz=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,nz=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,iz=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,rz=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#else
			uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#endif
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#else
			uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#endif
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform samplerCubeShadow pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#elif defined( SHADOWMAP_TYPE_BASIC )
			uniform samplerCube pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#endif
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float interleavedGradientNoise( vec2 position ) {
			return fract( 52.9829189 * fract( dot( position, vec2( 0.06711056, 0.00583715 ) ) ) );
		}
		vec2 vogelDiskSample( int sampleIndex, int samplesCount, float phi ) {
			const float goldenAngle = 2.399963229728653;
			float r = sqrt( ( float( sampleIndex ) + 0.5 ) / float( samplesCount ) );
			float theta = float( sampleIndex ) * goldenAngle + phi;
			return vec2( cos( theta ), sin( theta ) ) * r;
		}
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float getShadow( sampler2DShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
				float radius = shadowRadius * texelSize.x;
				float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
				shadow = (
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 0, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 1, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 2, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 3, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 4, 5, phi ) * radius, shadowCoord.z ) )
				) * 0.2;
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#elif defined( SHADOWMAP_TYPE_VSM )
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 distribution = texture2D( shadowMap, shadowCoord.xy ).rg;
				float mean = distribution.x;
				float variance = distribution.y * distribution.y;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					float hard_shadow = step( mean, shadowCoord.z );
				#else
					float hard_shadow = step( shadowCoord.z, mean );
				#endif
				if ( hard_shadow == 1.0 ) {
					shadow = 1.0;
				} else {
					variance = max( variance, 0.0000001 );
					float d = shadowCoord.z - mean;
					float p_max = variance / ( variance + d * d );
					p_max = clamp( ( p_max - 0.3 ) / 0.65, 0.0, 1.0 );
					shadow = max( hard_shadow, p_max );
				}
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#else
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				float depth = texture2D( shadowMap, shadowCoord.xy ).r;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					shadow = step( depth, shadowCoord.z );
				#else
					shadow = step( shadowCoord.z, depth );
				#endif
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#if defined( SHADOWMAP_TYPE_PCF )
	float getPointShadow( samplerCubeShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float texelSize = shadowRadius / shadowMapSize.x;
			vec3 absDir = abs( bd3D );
			vec3 tangent = absDir.x > absDir.z ? vec3( 0.0, 1.0, 0.0 ) : vec3( 1.0, 0.0, 0.0 );
			tangent = normalize( cross( bd3D, tangent ) );
			vec3 bitangent = cross( bd3D, tangent );
			float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
			shadow = (
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 0, 5, phi ).x + bitangent * vogelDiskSample( 0, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 1, 5, phi ).x + bitangent * vogelDiskSample( 1, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 2, 5, phi ).x + bitangent * vogelDiskSample( 2, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 3, 5, phi ).x + bitangent * vogelDiskSample( 3, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 4, 5, phi ).x + bitangent * vogelDiskSample( 4, 5, phi ).y ) * texelSize, dp ) )
			) * 0.2;
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#elif defined( SHADOWMAP_TYPE_BASIC )
	float getPointShadow( samplerCube shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float depth = textureCube( shadowMap, bd3D ).r;
			#ifdef USE_REVERSED_DEPTH_BUFFER
				shadow = step( depth, dp );
			#else
				shadow = step( dp, depth );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#endif
	#endif
#endif`,sz=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,az=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,oz=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0 && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,lz=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,uz=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,cz=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,hz=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,fz=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,dz=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,pz=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,mz=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,gz=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseContribution, material.specularColorBlended, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,_z=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,vz=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,yz=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,xz=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,bz=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Sz=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Tz=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Mz=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Ez=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Az=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,wz=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Rz=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Cz=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,Nz=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Dz=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = vec4( dist, 0.0, 0.0, 1.0 );
}`,Lz=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Pz=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Uz=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Oz=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Bz=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Fz=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Iz=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,zz=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Gz=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,kz=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Vz=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Hz=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( normalize( normal ) * 0.5 + 0.5, diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Wz=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,qz=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$z=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,jz=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
 
		outgoingLight = outgoingLight + sheenSpecularDirect + sheenSpecularIndirect;
 
 	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Xz=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Yz=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Kz=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Qz=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Zz=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Jz=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,eG=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,tG=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Vt={alphahash_fragment:TF,alphahash_pars_fragment:MF,alphamap_fragment:EF,alphamap_pars_fragment:AF,alphatest_fragment:wF,alphatest_pars_fragment:RF,aomap_fragment:CF,aomap_pars_fragment:NF,batching_pars_vertex:DF,batching_vertex:LF,begin_vertex:PF,beginnormal_vertex:UF,bsdfs:OF,iridescence_fragment:BF,bumpmap_pars_fragment:FF,clipping_planes_fragment:IF,clipping_planes_pars_fragment:zF,clipping_planes_pars_vertex:GF,clipping_planes_vertex:kF,color_fragment:VF,color_pars_fragment:HF,color_pars_vertex:WF,color_vertex:qF,common:$F,cube_uv_reflection_fragment:jF,defaultnormal_vertex:XF,displacementmap_pars_vertex:YF,displacementmap_vertex:KF,emissivemap_fragment:QF,emissivemap_pars_fragment:ZF,colorspace_fragment:JF,colorspace_pars_fragment:eI,envmap_fragment:tI,envmap_common_pars_fragment:nI,envmap_pars_fragment:iI,envmap_pars_vertex:rI,envmap_physical_pars_fragment:mI,envmap_vertex:sI,fog_vertex:aI,fog_pars_vertex:oI,fog_fragment:lI,fog_pars_fragment:uI,gradientmap_pars_fragment:cI,lightmap_pars_fragment:hI,lights_lambert_fragment:fI,lights_lambert_pars_fragment:dI,lights_pars_begin:pI,lights_toon_fragment:gI,lights_toon_pars_fragment:_I,lights_phong_fragment:vI,lights_phong_pars_fragment:yI,lights_physical_fragment:xI,lights_physical_pars_fragment:bI,lights_fragment_begin:SI,lights_fragment_maps:TI,lights_fragment_end:MI,logdepthbuf_fragment:EI,logdepthbuf_pars_fragment:AI,logdepthbuf_pars_vertex:wI,logdepthbuf_vertex:RI,map_fragment:CI,map_pars_fragment:NI,map_particle_fragment:DI,map_particle_pars_fragment:LI,metalnessmap_fragment:PI,metalnessmap_pars_fragment:UI,morphinstance_vertex:OI,morphcolor_vertex:BI,morphnormal_vertex:FI,morphtarget_pars_vertex:II,morphtarget_vertex:zI,normal_fragment_begin:GI,normal_fragment_maps:kI,normal_pars_fragment:VI,normal_pars_vertex:HI,normal_vertex:WI,normalmap_pars_fragment:qI,clearcoat_normal_fragment_begin:$I,clearcoat_normal_fragment_maps:jI,clearcoat_pars_fragment:XI,iridescence_pars_fragment:YI,opaque_fragment:KI,packing:QI,premultiplied_alpha_fragment:ZI,project_vertex:JI,dithering_fragment:ez,dithering_pars_fragment:tz,roughnessmap_fragment:nz,roughnessmap_pars_fragment:iz,shadowmap_pars_fragment:rz,shadowmap_pars_vertex:sz,shadowmap_vertex:az,shadowmask_pars_fragment:oz,skinbase_vertex:lz,skinning_pars_vertex:uz,skinning_vertex:cz,skinnormal_vertex:hz,specularmap_fragment:fz,specularmap_pars_fragment:dz,tonemapping_fragment:pz,tonemapping_pars_fragment:mz,transmission_fragment:gz,transmission_pars_fragment:_z,uv_pars_fragment:vz,uv_pars_vertex:yz,uv_vertex:xz,worldpos_vertex:bz,background_vert:Sz,background_frag:Tz,backgroundCube_vert:Mz,backgroundCube_frag:Ez,cube_vert:Az,cube_frag:wz,depth_vert:Rz,depth_frag:Cz,distance_vert:Nz,distance_frag:Dz,equirect_vert:Lz,equirect_frag:Pz,linedashed_vert:Uz,linedashed_frag:Oz,meshbasic_vert:Bz,meshbasic_frag:Fz,meshlambert_vert:Iz,meshlambert_frag:zz,meshmatcap_vert:Gz,meshmatcap_frag:kz,meshnormal_vert:Vz,meshnormal_frag:Hz,meshphong_vert:Wz,meshphong_frag:qz,meshphysical_vert:$z,meshphysical_frag:jz,meshtoon_vert:Xz,meshtoon_frag:Yz,points_vert:Kz,points_frag:Qz,shadow_vert:Zz,shadow_frag:Jz,sprite_vert:eG,sprite_frag:tG},Xe={common:{diffuse:{value:new dt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ct},alphaMap:{value:null},alphaMapTransform:{value:new Ct},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ct}},envmap:{envMap:{value:null},envMapRotation:{value:new Ct},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ct}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ct}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ct},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ct},normalScale:{value:new Ue(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ct},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ct}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ct}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ct}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new dt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new dt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ct},alphaTest:{value:0},uvTransform:{value:new Ct}},sprite:{diffuse:{value:new dt(16777215)},opacity:{value:1},center:{value:new Ue(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ct},alphaMap:{value:null},alphaMapTransform:{value:new Ct},alphaTest:{value:0}}},sa={basic:{uniforms:cr([Xe.common,Xe.specularmap,Xe.envmap,Xe.aomap,Xe.lightmap,Xe.fog]),vertexShader:Vt.meshbasic_vert,fragmentShader:Vt.meshbasic_frag},lambert:{uniforms:cr([Xe.common,Xe.specularmap,Xe.envmap,Xe.aomap,Xe.lightmap,Xe.emissivemap,Xe.bumpmap,Xe.normalmap,Xe.displacementmap,Xe.fog,Xe.lights,{emissive:{value:new dt(0)}}]),vertexShader:Vt.meshlambert_vert,fragmentShader:Vt.meshlambert_frag},phong:{uniforms:cr([Xe.common,Xe.specularmap,Xe.envmap,Xe.aomap,Xe.lightmap,Xe.emissivemap,Xe.bumpmap,Xe.normalmap,Xe.displacementmap,Xe.fog,Xe.lights,{emissive:{value:new dt(0)},specular:{value:new dt(1118481)},shininess:{value:30}}]),vertexShader:Vt.meshphong_vert,fragmentShader:Vt.meshphong_frag},standard:{uniforms:cr([Xe.common,Xe.envmap,Xe.aomap,Xe.lightmap,Xe.emissivemap,Xe.bumpmap,Xe.normalmap,Xe.displacementmap,Xe.roughnessmap,Xe.metalnessmap,Xe.fog,Xe.lights,{emissive:{value:new dt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Vt.meshphysical_vert,fragmentShader:Vt.meshphysical_frag},toon:{uniforms:cr([Xe.common,Xe.aomap,Xe.lightmap,Xe.emissivemap,Xe.bumpmap,Xe.normalmap,Xe.displacementmap,Xe.gradientmap,Xe.fog,Xe.lights,{emissive:{value:new dt(0)}}]),vertexShader:Vt.meshtoon_vert,fragmentShader:Vt.meshtoon_frag},matcap:{uniforms:cr([Xe.common,Xe.bumpmap,Xe.normalmap,Xe.displacementmap,Xe.fog,{matcap:{value:null}}]),vertexShader:Vt.meshmatcap_vert,fragmentShader:Vt.meshmatcap_frag},points:{uniforms:cr([Xe.points,Xe.fog]),vertexShader:Vt.points_vert,fragmentShader:Vt.points_frag},dashed:{uniforms:cr([Xe.common,Xe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Vt.linedashed_vert,fragmentShader:Vt.linedashed_frag},depth:{uniforms:cr([Xe.common,Xe.displacementmap]),vertexShader:Vt.depth_vert,fragmentShader:Vt.depth_frag},normal:{uniforms:cr([Xe.common,Xe.bumpmap,Xe.normalmap,Xe.displacementmap,{opacity:{value:1}}]),vertexShader:Vt.meshnormal_vert,fragmentShader:Vt.meshnormal_frag},sprite:{uniforms:cr([Xe.sprite,Xe.fog]),vertexShader:Vt.sprite_vert,fragmentShader:Vt.sprite_frag},background:{uniforms:{uvTransform:{value:new Ct},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Vt.background_vert,fragmentShader:Vt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ct}},vertexShader:Vt.backgroundCube_vert,fragmentShader:Vt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Vt.cube_vert,fragmentShader:Vt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Vt.equirect_vert,fragmentShader:Vt.equirect_frag},distance:{uniforms:cr([Xe.common,Xe.displacementmap,{referencePosition:{value:new k},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Vt.distance_vert,fragmentShader:Vt.distance_frag},shadow:{uniforms:cr([Xe.lights,Xe.fog,{color:{value:new dt(0)},opacity:{value:1}}]),vertexShader:Vt.shadow_vert,fragmentShader:Vt.shadow_frag}};sa.physical={uniforms:cr([sa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ct},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ct},clearcoatNormalScale:{value:new Ue(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ct},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ct},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ct},sheen:{value:0},sheenColor:{value:new dt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ct},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ct},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ct},transmissionSamplerSize:{value:new Ue},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ct},attenuationDistance:{value:0},attenuationColor:{value:new dt(0)},specularColor:{value:new dt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ct},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ct},anisotropyVector:{value:new Ue},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ct}}]),vertexShader:Vt.meshphysical_vert,fragmentShader:Vt.meshphysical_frag};const Tg={r:0,b:0,g:0},Gl=new Or,nG=new Ht;function iG(i,e,t,n,r,s,o){const u=new dt(0);let c=s===!0?0:1,h,d,p=null,g=0,_=null;function v(E){let w=E.isScene===!0?E.background:null;return w&&w.isTexture&&(w=(E.backgroundBlurriness>0?t:e).get(w)),w}function T(E){let w=!1;const C=v(E);C===null?x(u,c):C&&C.isColor&&(x(C,1),w=!0);const N=i.xr.getEnvironmentBlendMode();N==="additive"?n.buffers.color.setClear(0,0,0,1,o):N==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(i.autoClear||w)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil))}function b(E,w){const C=v(w);C&&(C.isCubeTexture||C.mapping===cu)?(d===void 0&&(d=new yi(new Au(1,1,1),new bs({name:"BackgroundCubeMaterial",uniforms:Dh(sa.backgroundCube.uniforms),vertexShader:sa.backgroundCube.vertexShader,fragmentShader:sa.backgroundCube.fragmentShader,side:Pn,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(N,D,U){this.matrixWorld.copyPosition(U.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(d)),Gl.copy(w.backgroundRotation),Gl.x*=-1,Gl.y*=-1,Gl.z*=-1,C.isCubeTexture&&C.isRenderTargetTexture===!1&&(Gl.y*=-1,Gl.z*=-1),d.material.uniforms.envMap.value=C,d.material.uniforms.flipEnvMap.value=C.isCubeTexture&&C.isRenderTargetTexture===!1?-1:1,d.material.uniforms.backgroundBlurriness.value=w.backgroundBlurriness,d.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,d.material.uniforms.backgroundRotation.value.setFromMatrix4(nG.makeRotationFromEuler(Gl)),d.material.toneMapped=vt.getTransfer(C.colorSpace)!==Ye,(p!==C||g!==C.version||_!==i.toneMapping)&&(d.material.needsUpdate=!0,p=C,g=C.version,_=i.toneMapping),d.layers.enableAll(),E.unshift(d,d.geometry,d.material,0,0,null)):C&&C.isTexture&&(h===void 0&&(h=new yi(new Lp(2,2),new bs({name:"BackgroundMaterial",uniforms:Dh(sa.background.uniforms),vertexShader:sa.background.vertexShader,fragmentShader:sa.background.fragmentShader,side:Jr,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(h)),h.material.uniforms.t2D.value=C,h.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,h.material.toneMapped=vt.getTransfer(C.colorSpace)!==Ye,C.matrixAutoUpdate===!0&&C.updateMatrix(),h.material.uniforms.uvTransform.value.copy(C.matrix),(p!==C||g!==C.version||_!==i.toneMapping)&&(h.material.needsUpdate=!0,p=C,g=C.version,_=i.toneMapping),h.layers.enableAll(),E.unshift(h,h.geometry,h.material,0,0,null))}function x(E,w){E.getRGB(Tg,YN(i)),n.buffers.color.setClear(Tg.r,Tg.g,Tg.b,w,o)}function M(){d!==void 0&&(d.geometry.dispose(),d.material.dispose(),d=void 0),h!==void 0&&(h.geometry.dispose(),h.material.dispose(),h=void 0)}return{getClearColor:function(){return u},setClearColor:function(E,w=1){u.set(E),c=w,x(u,c)},getClearAlpha:function(){return c},setClearAlpha:function(E){c=E,x(u,c)},render:T,addToRenderList:b,dispose:M}}function rG(i,e){const t=i.getParameter(i.MAX_VERTEX_ATTRIBS),n={},r=g(null);let s=r,o=!1;function u(P,I,H,X,J){let ne=!1;const G=p(X,H,I);s!==G&&(s=G,h(s.object)),ne=_(P,X,H,J),ne&&v(P,X,H,J),J!==null&&e.update(J,i.ELEMENT_ARRAY_BUFFER),(ne||o)&&(o=!1,w(P,I,H,X),J!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.get(J).buffer))}function c(){return i.createVertexArray()}function h(P){return i.bindVertexArray(P)}function d(P){return i.deleteVertexArray(P)}function p(P,I,H){const X=H.wireframe===!0;let J=n[P.id];J===void 0&&(J={},n[P.id]=J);let ne=J[I.id];ne===void 0&&(ne={},J[I.id]=ne);let G=ne[X];return G===void 0&&(G=g(c()),ne[X]=G),G}function g(P){const I=[],H=[],X=[];for(let J=0;J<t;J++)I[J]=0,H[J]=0,X[J]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:I,enabledAttributes:H,attributeDivisors:X,object:P,attributes:{},index:null}}function _(P,I,H,X){const J=s.attributes,ne=I.attributes;let G=0;const z=H.getAttributes();for(const q in z)if(z[q].location>=0){const xe=J[q];let O=ne[q];if(O===void 0&&(q==="instanceMatrix"&&P.instanceMatrix&&(O=P.instanceMatrix),q==="instanceColor"&&P.instanceColor&&(O=P.instanceColor)),xe===void 0||xe.attribute!==O||O&&xe.data!==O.data)return!0;G++}return s.attributesNum!==G||s.index!==X}function v(P,I,H,X){const J={},ne=I.attributes;let G=0;const z=H.getAttributes();for(const q in z)if(z[q].location>=0){let xe=ne[q];xe===void 0&&(q==="instanceMatrix"&&P.instanceMatrix&&(xe=P.instanceMatrix),q==="instanceColor"&&P.instanceColor&&(xe=P.instanceColor));const O={};O.attribute=xe,xe&&xe.data&&(O.data=xe.data),J[q]=O,G++}s.attributes=J,s.attributesNum=G,s.index=X}function T(){const P=s.newAttributes;for(let I=0,H=P.length;I<H;I++)P[I]=0}function b(P){x(P,0)}function x(P,I){const H=s.newAttributes,X=s.enabledAttributes,J=s.attributeDivisors;H[P]=1,X[P]===0&&(i.enableVertexAttribArray(P),X[P]=1),J[P]!==I&&(i.vertexAttribDivisor(P,I),J[P]=I)}function M(){const P=s.newAttributes,I=s.enabledAttributes;for(let H=0,X=I.length;H<X;H++)I[H]!==P[H]&&(i.disableVertexAttribArray(H),I[H]=0)}function E(P,I,H,X,J,ne,G){G===!0?i.vertexAttribIPointer(P,I,H,J,ne):i.vertexAttribPointer(P,I,H,X,J,ne)}function w(P,I,H,X){T();const J=X.attributes,ne=H.getAttributes(),G=I.defaultAttributeValues;for(const z in ne){const q=ne[z];if(q.location>=0){let ce=J[z];if(ce===void 0&&(z==="instanceMatrix"&&P.instanceMatrix&&(ce=P.instanceMatrix),z==="instanceColor"&&P.instanceColor&&(ce=P.instanceColor)),ce!==void 0){const xe=ce.normalized,O=ce.itemSize,Y=e.get(ce);if(Y===void 0)continue;const ue=Y.buffer,Ne=Y.type,Z=Y.bytesPerElement,W=Ne===i.INT||Ne===i.UNSIGNED_INT||ce.gpuType===Ni;if(ce.isInterleavedBufferAttribute){const ie=ce.data,Le=ie.stride,ke=ce.offset;if(ie.isInstancedInterleavedBuffer){for(let ze=0;ze<q.locationSize;ze++)x(q.location+ze,ie.meshPerAttribute);P.isInstancedMesh!==!0&&X._maxInstanceCount===void 0&&(X._maxInstanceCount=ie.meshPerAttribute*ie.count)}else for(let ze=0;ze<q.locationSize;ze++)b(q.location+ze);i.bindBuffer(i.ARRAY_BUFFER,ue);for(let ze=0;ze<q.locationSize;ze++)E(q.location+ze,O/q.locationSize,Ne,xe,Le*Z,(ke+O/q.locationSize*ze)*Z,W)}else{if(ce.isInstancedBufferAttribute){for(let ie=0;ie<q.locationSize;ie++)x(q.location+ie,ce.meshPerAttribute);P.isInstancedMesh!==!0&&X._maxInstanceCount===void 0&&(X._maxInstanceCount=ce.meshPerAttribute*ce.count)}else for(let ie=0;ie<q.locationSize;ie++)b(q.location+ie);i.bindBuffer(i.ARRAY_BUFFER,ue);for(let ie=0;ie<q.locationSize;ie++)E(q.location+ie,O/q.locationSize,Ne,xe,O*Z,O/q.locationSize*ie*Z,W)}}else if(G!==void 0){const xe=G[z];if(xe!==void 0)switch(xe.length){case 2:i.vertexAttrib2fv(q.location,xe);break;case 3:i.vertexAttrib3fv(q.location,xe);break;case 4:i.vertexAttrib4fv(q.location,xe);break;default:i.vertexAttrib1fv(q.location,xe)}}}}M()}function C(){U();for(const P in n){const I=n[P];for(const H in I){const X=I[H];for(const J in X)d(X[J].object),delete X[J];delete I[H]}delete n[P]}}function N(P){if(n[P.id]===void 0)return;const I=n[P.id];for(const H in I){const X=I[H];for(const J in X)d(X[J].object),delete X[J];delete I[H]}delete n[P.id]}function D(P){for(const I in n){const H=n[I];if(H[P.id]===void 0)continue;const X=H[P.id];for(const J in X)d(X[J].object),delete X[J];delete H[P.id]}}function U(){R(),o=!0,s!==r&&(s=r,h(s.object))}function R(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:u,reset:U,resetDefaultState:R,dispose:C,releaseStatesOfGeometry:N,releaseStatesOfProgram:D,initAttributes:T,enableAttribute:b,disableUnusedAttributes:M}}function sG(i,e,t){let n;function r(h){n=h}function s(h,d){i.drawArrays(n,h,d),t.update(d,n,1)}function o(h,d,p){p!==0&&(i.drawArraysInstanced(n,h,d,p),t.update(d,n,p))}function u(h,d,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,h,0,d,0,p);let _=0;for(let v=0;v<p;v++)_+=d[v];t.update(_,n,1)}function c(h,d,p,g){if(p===0)return;const _=e.get("WEBGL_multi_draw");if(_===null)for(let v=0;v<h.length;v++)o(h[v],d[v],g[v]);else{_.multiDrawArraysInstancedWEBGL(n,h,0,d,0,g,0,p);let v=0;for(let T=0;T<p;T++)v+=d[T]*g[T];t.update(v,n,1)}}this.setMode=r,this.render=s,this.renderInstances=o,this.renderMultiDraw=u,this.renderMultiDrawInstances=c}function aG(i,e,t,n){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const D=e.get("EXT_texture_filter_anisotropic");r=i.getParameter(D.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(D){return!(D!==si&&n.convert(D)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT))}function u(D){const U=D===Zn&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(D!==Hn&&n.convert(D)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)&&D!==ri&&!U)}function c(D){if(D==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";D="mediump"}return D==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let h=t.precision!==void 0?t.precision:"highp";const d=c(h);d!==h&&(Ae("WebGLRenderer:",h,"not supported, using",d,"instead."),h=d);const p=t.logarithmicDepthBuffer===!0,g=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),_=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),v=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),T=i.getParameter(i.MAX_TEXTURE_SIZE),b=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),x=i.getParameter(i.MAX_VERTEX_ATTRIBS),M=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),E=i.getParameter(i.MAX_VARYING_VECTORS),w=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),C=i.getParameter(i.MAX_SAMPLES),N=i.getParameter(i.SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:u,precision:h,logarithmicDepthBuffer:p,reversedDepthBuffer:g,maxTextures:_,maxVertexTextures:v,maxTextureSize:T,maxCubemapSize:b,maxAttributes:x,maxVertexUniforms:M,maxVaryings:E,maxFragmentUniforms:w,maxSamples:C,samples:N}}function oG(i){const e=this;let t=null,n=0,r=!1,s=!1;const o=new Bs,u=new Ct,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(p,g){const _=p.length!==0||g||n!==0||r;return r=g,n=p.length,_},this.beginShadows=function(){s=!0,d(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(p,g){t=d(p,g,0)},this.setState=function(p,g,_){const v=p.clippingPlanes,T=p.clipIntersection,b=p.clipShadows,x=i.get(p);if(!r||v===null||v.length===0||s&&!b)s?d(null):h();else{const M=s?0:n,E=M*4;let w=x.clippingState||null;c.value=w,w=d(v,g,E,_);for(let C=0;C!==E;++C)w[C]=t[C];x.clippingState=w,this.numIntersection=T?this.numPlanes:0,this.numPlanes+=M}};function h(){c.value!==t&&(c.value=t,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function d(p,g,_,v){const T=p!==null?p.length:0;let b=null;if(T!==0){if(b=c.value,v!==!0||b===null){const x=_+T*4,M=g.matrixWorldInverse;u.getNormalMatrix(M),(b===null||b.length<x)&&(b=new Float32Array(x));for(let E=0,w=_;E!==T;++E,w+=4)o.copy(p[E]).applyMatrix4(M,u),o.normal.toArray(b,w),b[w+3]=o.constant}c.value=b,c.needsUpdate=!0}return e.numPlanes=T,e.numIntersection=0,b}}function lG(i){let e=new WeakMap;function t(o,u){return u===ih?o.mapping=Vs:u===rh&&(o.mapping=pa),o}function n(o){if(o&&o.isTexture){const u=o.mapping;if(u===ih||u===rh)if(e.has(o)){const c=e.get(o).texture;return t(c,o.mapping)}else{const c=o.image;if(c&&c.height>0){const h=new KS(c.height);return h.fromEquirectangularTexture(i,o),e.set(o,h),o.addEventListener("dispose",r),t(h.texture,o.mapping)}else return null}}return o}function r(o){const u=o.target;u.removeEventListener("dispose",r);const c=e.get(u);c!==void 0&&(e.delete(u),c.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}const nl=4,_w=[.125,.215,.35,.446,.526,.582],Yl=20,uG=256,rd=new Wh,vw=new dt;let nx=null,ix=0,rx=0,sx=!1;const cG=new k;let yw=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,t=0,n=.1,r=100,s={}){const{size:o=256,position:u=cG}=s;nx=this._renderer.getRenderTarget(),ix=this._renderer.getActiveCubeFace(),rx=this._renderer.getActiveMipmapLevel(),sx=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,n,r,c,u),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Sw(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=bw(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(nx,ix,rx),this._renderer.xr.enabled=sx,e.scissorTest=!1,Cc(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Vs||e.mapping===pa?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),nx=this._renderer.getRenderTarget(),ix=this._renderer.getActiveCubeFace(),rx=this._renderer.getActiveMipmapLevel(),sx=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Gn,minFilter:Gn,generateMipmaps:!1,type:Zn,format:si,colorSpace:mu,depthBuffer:!1},r=xw(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=xw(e,t,n);const{_lodMax:s}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=hG(s)),this._blurMaterial=dG(s,e,t),this._ggxMaterial=fG(s,e,t)}return r}_compileMaterial(e){const t=new yi(new wi,e);this._renderer.compile(t,rd)}_sceneToCubeUV(e,t,n,r,s){const c=new Di(90,1,t,n),h=[1,-1,1,1,1,1],d=[1,1,1,-1,-1,-1],p=this._renderer,g=p.autoClear,_=p.toneMapping;p.getClearColor(vw),p.toneMapping=$i,p.autoClear=!1,p.state.buffers.depth.getReversed()&&(p.setRenderTarget(r),p.clearDepth(),p.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new yi(new Au,new la({name:"PMREM.Background",side:Pn,depthWrite:!1,depthTest:!1})));const T=this._backgroundBox,b=T.material;let x=!1;const M=e.background;M?M.isColor&&(b.color.copy(M),e.background=null,x=!0):(b.color.copy(vw),x=!0);for(let E=0;E<6;E++){const w=E%3;w===0?(c.up.set(0,h[E],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x+d[E],s.y,s.z)):w===1?(c.up.set(0,0,h[E]),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y+d[E],s.z)):(c.up.set(0,h[E],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y,s.z+d[E]));const C=this._cubeSize;Cc(r,w*C,E>2?C:0,C,C),p.setRenderTarget(r),x&&p.render(T,c),p.render(e,c)}p.toneMapping=_,p.autoClear=g,e.background=M}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===Vs||e.mapping===pa;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=Sw()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=bw());const s=r?this._cubemapMaterial:this._equirectMaterial,o=this._lodMeshes[0];o.material=s;const u=s.uniforms;u.envMap.value=e;const c=this._cubeSize;Cc(t,0,0,3*c,2*c),n.setRenderTarget(t),n.render(o,rd)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodMeshes.length;for(let s=1;s<r;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=n}_applyGGXFilter(e,t,n){const r=this._renderer,s=this._pingPongRenderTarget,o=this._ggxMaterial,u=this._lodMeshes[n];u.material=o;const c=o.uniforms,h=n/(this._lodMeshes.length-1),d=t/(this._lodMeshes.length-1),p=Math.sqrt(h*h-d*d),g=0+h*1.25,_=p*g,{_lodMax:v}=this,T=this._sizeLods[n],b=3*T*(n>v-nl?n-v+nl:0),x=4*(this._cubeSize-T);c.envMap.value=e.texture,c.roughness.value=_,c.mipInt.value=v-t,Cc(s,b,x,3*T,2*T),r.setRenderTarget(s),r.render(u,rd),c.envMap.value=s.texture,c.roughness.value=0,c.mipInt.value=v-n,Cc(e,b,x,3*T,2*T),r.setRenderTarget(e),r.render(u,rd)}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,u){const c=this._renderer,h=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&Re("blur direction must be either latitudinal or longitudinal!");const d=3,p=this._lodMeshes[r];p.material=h;const g=h.uniforms,_=this._sizeLods[n]-1,v=isFinite(s)?Math.PI/(2*_):2*Math.PI/(2*Yl-1),T=s/v,b=isFinite(s)?1+Math.floor(d*T):Yl;b>Yl&&Ae(`sigmaRadians, ${s}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${Yl}`);const x=[];let M=0;for(let D=0;D<Yl;++D){const U=D/T,R=Math.exp(-U*U/2);x.push(R),D===0?M+=R:D<b&&(M+=2*R)}for(let D=0;D<x.length;D++)x[D]=x[D]/M;g.envMap.value=e.texture,g.samples.value=b,g.weights.value=x,g.latitudinal.value=o==="latitudinal",u&&(g.poleAxis.value=u);const{_lodMax:E}=this;g.dTheta.value=v,g.mipInt.value=E-n;const w=this._sizeLods[r],C=3*w*(r>E-nl?r-E+nl:0),N=4*(this._cubeSize-w);Cc(t,C,N,3*w,2*w),c.setRenderTarget(t),c.render(p,rd)}};function hG(i){const e=[],t=[],n=[];let r=i;const s=i-nl+1+_w.length;for(let o=0;o<s;o++){const u=Math.pow(2,r);e.push(u);let c=1/u;o>i-nl?c=_w[o-i+nl-1]:o===0&&(c=0),t.push(c);const h=1/(u-2),d=-h,p=1+h,g=[d,d,p,d,p,p,d,d,p,p,d,p],_=6,v=6,T=3,b=2,x=1,M=new Float32Array(T*v*_),E=new Float32Array(b*v*_),w=new Float32Array(x*v*_);for(let N=0;N<_;N++){const D=N%3*2/3-1,U=N>2?0:-1,R=[D,U,0,D+2/3,U,0,D+2/3,U+1,0,D,U,0,D+2/3,U+1,0,D,U+1,0];M.set(R,T*v*N),E.set(g,b*v*N);const P=[N,N,N,N,N,N];w.set(P,x*v*N)}const C=new wi;C.setAttribute("position",new Xi(M,T)),C.setAttribute("uv",new Xi(E,b)),C.setAttribute("faceIndex",new Xi(w,x)),n.push(new yi(C,null)),r>nl&&r--}return{lodMeshes:n,sizeLods:e,sigmas:t}}function xw(i,e,t){const n=new Gs(i,e,t);return n.texture.mapping=cu,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Cc(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function fG(i,e,t){return new bs({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:uG,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:X_(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:_r,depthTest:!1,depthWrite:!1})}function dG(i,e,t){const n=new Float32Array(Yl),r=new k(0,1,0);return new bs({name:"SphericalGaussianBlur",defines:{n:Yl,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:X_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:_r,depthTest:!1,depthWrite:!1})}function bw(){return new bs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:X_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:_r,depthTest:!1,depthWrite:!1})}function Sw(){return new bs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:X_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:_r,depthTest:!1,depthWrite:!1})}function X_(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function pG(i){let e=new WeakMap,t=null;function n(u){if(u&&u.isTexture){const c=u.mapping,h=c===ih||c===rh,d=c===Vs||c===pa;if(h||d){let p=e.get(u);const g=p!==void 0?p.texture.pmremVersion:0;if(u.isRenderTargetTexture&&u.pmremVersion!==g)return t===null&&(t=new yw(i)),p=h?t.fromEquirectangular(u,p):t.fromCubemap(u,p),p.texture.pmremVersion=u.pmremVersion,e.set(u,p),p.texture;if(p!==void 0)return p.texture;{const _=u.image;return h&&_&&_.height>0||d&&_&&r(_)?(t===null&&(t=new yw(i)),p=h?t.fromEquirectangular(u):t.fromCubemap(u),p.texture.pmremVersion=u.pmremVersion,e.set(u,p),u.addEventListener("dispose",s),p.texture):null}}}return u}function r(u){let c=0;const h=6;for(let d=0;d<h;d++)u[d]!==void 0&&c++;return c===h}function s(u){const c=u.target;c.removeEventListener("dispose",s);const h=e.get(c);h!==void 0&&(e.delete(c),h.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function mG(i){const e={};function t(n){if(e[n]!==void 0)return e[n];const r=i.getExtension(n);return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const r=t(n);return r===null&&Vn("WebGLRenderer: "+n+" extension not supported."),r}}}function gG(i,e,t,n){const r={},s=new WeakMap;function o(p){const g=p.target;g.index!==null&&e.remove(g.index);for(const v in g.attributes)e.remove(g.attributes[v]);g.removeEventListener("dispose",o),delete r[g.id];const _=s.get(g);_&&(e.remove(_),s.delete(g)),n.releaseStatesOfGeometry(g),g.isInstancedBufferGeometry===!0&&delete g._maxInstanceCount,t.memory.geometries--}function u(p,g){return r[g.id]===!0||(g.addEventListener("dispose",o),r[g.id]=!0,t.memory.geometries++),g}function c(p){const g=p.attributes;for(const _ in g)e.update(g[_],i.ARRAY_BUFFER)}function h(p){const g=[],_=p.index,v=p.attributes.position;let T=0;if(_!==null){const M=_.array;T=_.version;for(let E=0,w=M.length;E<w;E+=3){const C=M[E+0],N=M[E+1],D=M[E+2];g.push(C,N,N,D,D,C)}}else if(v!==void 0){const M=v.array;T=v.version;for(let E=0,w=M.length/3-1;E<w;E+=3){const C=E+0,N=E+1,D=E+2;g.push(C,N,N,D,D,C)}}else return;const b=new(VS(g)?XS:jS)(g,1);b.version=T;const x=s.get(p);x&&e.remove(x),s.set(p,b)}function d(p){const g=s.get(p);if(g){const _=p.index;_!==null&&g.version<_.version&&h(p)}else h(p);return s.get(p)}return{get:u,update:c,getWireframeAttribute:d}}function _G(i,e,t){let n;function r(g){n=g}let s,o;function u(g){s=g.type,o=g.bytesPerElement}function c(g,_){i.drawElements(n,_,s,g*o),t.update(_,n,1)}function h(g,_,v){v!==0&&(i.drawElementsInstanced(n,_,s,g*o,v),t.update(_,n,v))}function d(g,_,v){if(v===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,_,0,s,g,0,v);let b=0;for(let x=0;x<v;x++)b+=_[x];t.update(b,n,1)}function p(g,_,v,T){if(v===0)return;const b=e.get("WEBGL_multi_draw");if(b===null)for(let x=0;x<g.length;x++)h(g[x]/o,_[x],T[x]);else{b.multiDrawElementsInstancedWEBGL(n,_,0,s,g,0,T,0,v);let x=0;for(let M=0;M<v;M++)x+=_[M]*T[M];t.update(x,n,1)}}this.setMode=r,this.setIndex=u,this.render=c,this.renderInstances=h,this.renderMultiDraw=d,this.renderMultiDrawInstances=p}function vG(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,u){switch(t.calls++,o){case i.TRIANGLES:t.triangles+=u*(s/3);break;case i.LINES:t.lines+=u*(s/2);break;case i.LINE_STRIP:t.lines+=u*(s-1);break;case i.LINE_LOOP:t.lines+=u*s;break;case i.POINTS:t.points+=u*s;break;default:Re("WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:n}}function yG(i,e,t){const n=new WeakMap,r=new Lt;function s(o,u,c){const h=o.morphTargetInfluences,d=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,p=d!==void 0?d.length:0;let g=n.get(u);if(g===void 0||g.count!==p){let P=function(){U.dispose(),n.delete(u),u.removeEventListener("dispose",P)};var _=P;g!==void 0&&g.texture.dispose();const v=u.morphAttributes.position!==void 0,T=u.morphAttributes.normal!==void 0,b=u.morphAttributes.color!==void 0,x=u.morphAttributes.position||[],M=u.morphAttributes.normal||[],E=u.morphAttributes.color||[];let w=0;v===!0&&(w=1),T===!0&&(w=2),b===!0&&(w=3);let C=u.attributes.position.count*w,N=1;C>e.maxTextureSize&&(N=Math.ceil(C/e.maxTextureSize),C=e.maxTextureSize);const D=new Float32Array(C*N*4*p),U=new qS(D,C,N,p);U.type=ri,U.needsUpdate=!0;const R=w*4;for(let I=0;I<p;I++){const H=x[I],X=M[I],J=E[I],ne=C*N*4*I;for(let G=0;G<H.count;G++){const z=G*R;v===!0&&(r.fromBufferAttribute(H,G),D[ne+z+0]=r.x,D[ne+z+1]=r.y,D[ne+z+2]=r.z,D[ne+z+3]=0),T===!0&&(r.fromBufferAttribute(X,G),D[ne+z+4]=r.x,D[ne+z+5]=r.y,D[ne+z+6]=r.z,D[ne+z+7]=0),b===!0&&(r.fromBufferAttribute(J,G),D[ne+z+8]=r.x,D[ne+z+9]=r.y,D[ne+z+10]=r.z,D[ne+z+11]=J.itemSize===4?r.w:1)}}g={count:p,texture:U,size:new Ue(C,N)},n.set(u,g),u.addEventListener("dispose",P)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(i,"morphTexture",o.morphTexture,t);else{let v=0;for(let b=0;b<h.length;b++)v+=h[b];const T=u.morphTargetsRelative?1:1-v;c.getUniforms().setValue(i,"morphTargetBaseInfluence",T),c.getUniforms().setValue(i,"morphTargetInfluences",h)}c.getUniforms().setValue(i,"morphTargetsTexture",g.texture,t),c.getUniforms().setValue(i,"morphTargetsTextureSize",g.size)}return{update:s}}function xG(i,e,t,n){let r=new WeakMap;function s(c){const h=n.render.frame,d=c.geometry,p=e.get(c,d);if(r.get(p)!==h&&(e.update(p),r.set(p,h)),c.isInstancedMesh&&(c.hasEventListener("dispose",u)===!1&&c.addEventListener("dispose",u),r.get(c)!==h&&(t.update(c.instanceMatrix,i.ARRAY_BUFFER),c.instanceColor!==null&&t.update(c.instanceColor,i.ARRAY_BUFFER),r.set(c,h))),c.isSkinnedMesh){const g=c.skeleton;r.get(g)!==h&&(g.update(),r.set(g,h))}return p}function o(){r=new WeakMap}function u(c){const h=c.target;h.removeEventListener("dispose",u),t.remove(h.instanceMatrix),h.instanceColor!==null&&t.remove(h.instanceColor)}return{update:s,dispose:o}}const bG={[RS]:"LINEAR_TONE_MAPPING",[CS]:"REINHARD_TONE_MAPPING",[NS]:"CINEON_TONE_MAPPING",[DS]:"ACES_FILMIC_TONE_MAPPING",[LS]:"AGX_TONE_MAPPING",[PS]:"NEUTRAL_TONE_MAPPING",[HN]:"CUSTOM_TONE_MAPPING"};function SG(i,e,t,n,r){const s=new Gs(e,t,{type:i,depthBuffer:n,stencilBuffer:r}),o=new Gs(e,t,{type:Zn,depthBuffer:!1,stencilBuffer:!1}),u=new wi;u.setAttribute("position",new ti([-1,3,0,-1,-1,0,3,-1,0],3)),u.setAttribute("uv",new ti([0,2,0,0,2,0],2));const c=new JB({uniforms:{tDiffuse:{value:null}},vertexShader:`
			precision highp float;

			uniform mat4 modelViewMatrix;
			uniform mat4 projectionMatrix;

			attribute vec3 position;
			attribute vec2 uv;

			varying vec2 vUv;

			void main() {
				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}`,fragmentShader:`
			precision highp float;

			uniform sampler2D tDiffuse;

			varying vec2 vUv;

			#include <tonemapping_pars_fragment>
			#include <colorspace_pars_fragment>

			void main() {
				gl_FragColor = texture2D( tDiffuse, vUv );

				#ifdef LINEAR_TONE_MAPPING
					gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );
				#elif defined( REINHARD_TONE_MAPPING )
					gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );
				#elif defined( CINEON_TONE_MAPPING )
					gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );
				#elif defined( ACES_FILMIC_TONE_MAPPING )
					gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );
				#elif defined( AGX_TONE_MAPPING )
					gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );
				#elif defined( NEUTRAL_TONE_MAPPING )
					gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );
				#elif defined( CUSTOM_TONE_MAPPING )
					gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );
				#endif

				#ifdef SRGB_TRANSFER
					gl_FragColor = sRGBTransferOETF( gl_FragColor );
				#endif
			}`,depthTest:!1,depthWrite:!1}),h=new yi(u,c),d=new Wh(-1,1,1,-1,0,1);let p=null,g=null,_=!1,v,T=null,b=[],x=!1;this.setSize=function(M,E){s.setSize(M,E),o.setSize(M,E);for(let w=0;w<b.length;w++){const C=b[w];C.setSize&&C.setSize(M,E)}},this.setEffects=function(M){b=M,x=b.length>0&&b[0].isRenderPass===!0;const E=s.width,w=s.height;for(let C=0;C<b.length;C++){const N=b[C];N.setSize&&N.setSize(E,w)}},this.begin=function(M,E){if(_||M.toneMapping===$i&&b.length===0)return!1;if(T=E,E!==null){const w=E.width,C=E.height;(s.width!==w||s.height!==C)&&this.setSize(w,C)}return x===!1&&M.setRenderTarget(s),v=M.toneMapping,M.toneMapping=$i,!0},this.hasRenderPass=function(){return x},this.end=function(M,E){M.toneMapping=v,_=!0;let w=s,C=o;for(let N=0;N<b.length;N++){const D=b[N];if(D.enabled!==!1&&(D.render(M,C,w,E),D.needsSwap!==!1)){const U=w;w=C,C=U}}if(p!==M.outputColorSpace||g!==M.toneMapping){p=M.outputColorSpace,g=M.toneMapping,c.defines={},vt.getTransfer(p)===Ye&&(c.defines.SRGB_TRANSFER="");const N=bG[g];N&&(c.defines[N]=""),c.needsUpdate=!0}c.uniforms.tDiffuse.value=w.texture,M.setRenderTarget(T),M.render(h,d),T=null,_=!1},this.isCompositing=function(){return _},this.dispose=function(){s.dispose(),o.dispose(),u.dispose(),c.dispose()}}const f2=new ui,Eb=new vr(1,1),d2=new qS,p2=new fB,m2=new Cp,Tw=[],Mw=[],Ew=new Float32Array(16),Aw=new Float32Array(9),ww=new Float32Array(4);function qh(i,e,t){const n=i[0];if(n<=0||n>0)return i;const r=e*t;let s=Tw[r];if(s===void 0&&(s=new Float32Array(r),Tw[r]=s),e!==0){n.toArray(s,0);for(let o=1,u=0;o!==e;++o)u+=t,i[o].toArray(s,u)}return s}function Ei(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function Ai(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function Y_(i,e){let t=Mw[e];t===void 0&&(t=new Int32Array(e),Mw[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function TG(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function MG(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ei(t,e))return;i.uniform2fv(this.addr,e),Ai(t,e)}}function EG(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ei(t,e))return;i.uniform3fv(this.addr,e),Ai(t,e)}}function AG(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ei(t,e))return;i.uniform4fv(this.addr,e),Ai(t,e)}}function wG(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ei(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),Ai(t,e)}else{if(Ei(t,n))return;ww.set(n),i.uniformMatrix2fv(this.addr,!1,ww),Ai(t,n)}}function RG(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ei(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),Ai(t,e)}else{if(Ei(t,n))return;Aw.set(n),i.uniformMatrix3fv(this.addr,!1,Aw),Ai(t,n)}}function CG(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ei(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),Ai(t,e)}else{if(Ei(t,n))return;Ew.set(n),i.uniformMatrix4fv(this.addr,!1,Ew),Ai(t,n)}}function NG(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function DG(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ei(t,e))return;i.uniform2iv(this.addr,e),Ai(t,e)}}function LG(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ei(t,e))return;i.uniform3iv(this.addr,e),Ai(t,e)}}function PG(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ei(t,e))return;i.uniform4iv(this.addr,e),Ai(t,e)}}function UG(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function OG(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ei(t,e))return;i.uniform2uiv(this.addr,e),Ai(t,e)}}function BG(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ei(t,e))return;i.uniform3uiv(this.addr,e),Ai(t,e)}}function FG(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ei(t,e))return;i.uniform4uiv(this.addr,e),Ai(t,e)}}function IG(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r);let s;this.type===i.SAMPLER_2D_SHADOW?(Eb.compareFunction=t.isReversedDepthBuffer()?wp:Ap,s=Eb):s=f2,t.setTexture2D(e||s,r)}function zG(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||p2,r)}function GG(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTextureCube(e||m2,r)}function kG(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||d2,r)}function VG(i){switch(i){case 5126:return TG;case 35664:return MG;case 35665:return EG;case 35666:return AG;case 35674:return wG;case 35675:return RG;case 35676:return CG;case 5124:case 35670:return NG;case 35667:case 35671:return DG;case 35668:case 35672:return LG;case 35669:case 35673:return PG;case 5125:return UG;case 36294:return OG;case 36295:return BG;case 36296:return FG;case 35678:case 36198:case 36298:case 36306:case 35682:return IG;case 35679:case 36299:case 36307:return zG;case 35680:case 36300:case 36308:case 36293:return GG;case 36289:case 36303:case 36311:case 36292:return kG}}function HG(i,e){i.uniform1fv(this.addr,e)}function WG(i,e){const t=qh(e,this.size,2);i.uniform2fv(this.addr,t)}function qG(i,e){const t=qh(e,this.size,3);i.uniform3fv(this.addr,t)}function $G(i,e){const t=qh(e,this.size,4);i.uniform4fv(this.addr,t)}function jG(i,e){const t=qh(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function XG(i,e){const t=qh(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function YG(i,e){const t=qh(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function KG(i,e){i.uniform1iv(this.addr,e)}function QG(i,e){i.uniform2iv(this.addr,e)}function ZG(i,e){i.uniform3iv(this.addr,e)}function JG(i,e){i.uniform4iv(this.addr,e)}function ek(i,e){i.uniform1uiv(this.addr,e)}function tk(i,e){i.uniform2uiv(this.addr,e)}function nk(i,e){i.uniform3uiv(this.addr,e)}function ik(i,e){i.uniform4uiv(this.addr,e)}function rk(i,e,t){const n=this.cache,r=e.length,s=Y_(t,r);Ei(n,s)||(i.uniform1iv(this.addr,s),Ai(n,s));let o;this.type===i.SAMPLER_2D_SHADOW?o=Eb:o=f2;for(let u=0;u!==r;++u)t.setTexture2D(e[u]||o,s[u])}function sk(i,e,t){const n=this.cache,r=e.length,s=Y_(t,r);Ei(n,s)||(i.uniform1iv(this.addr,s),Ai(n,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||p2,s[o])}function ak(i,e,t){const n=this.cache,r=e.length,s=Y_(t,r);Ei(n,s)||(i.uniform1iv(this.addr,s),Ai(n,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||m2,s[o])}function ok(i,e,t){const n=this.cache,r=e.length,s=Y_(t,r);Ei(n,s)||(i.uniform1iv(this.addr,s),Ai(n,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||d2,s[o])}function lk(i){switch(i){case 5126:return HG;case 35664:return WG;case 35665:return qG;case 35666:return $G;case 35674:return jG;case 35675:return XG;case 35676:return YG;case 5124:case 35670:return KG;case 35667:case 35671:return QG;case 35668:case 35672:return ZG;case 35669:case 35673:return JG;case 5125:return ek;case 36294:return tk;case 36295:return nk;case 36296:return ik;case 35678:case 36198:case 36298:case 36306:case 35682:return rk;case 35679:case 36299:case 36307:return sk;case 35680:case 36300:case 36308:case 36293:return ak;case 36289:case 36303:case 36311:case 36292:return ok}}class uk{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=VG(t.type)}}class ck{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=lk(t.type)}}class hk{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const u=r[s];u.setValue(e,t[u.id],n)}}}const ax=/(\w+)(\])?(\[|\.)?/g;function Rw(i,e){i.seq.push(e),i.map[e.id]=e}function fk(i,e,t){const n=i.name,r=n.length;for(ax.lastIndex=0;;){const s=ax.exec(n),o=ax.lastIndex;let u=s[1];const c=s[2]==="]",h=s[3];if(c&&(u=u|0),h===void 0||h==="["&&o+2===r){Rw(t,h===void 0?new uk(u,i,e):new ck(u,i,e));break}else{let p=t.map[u];p===void 0&&(p=new hk(u),Rw(t,p)),t=p}}}class o_{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let o=0;o<n;++o){const u=e.getActiveUniform(t,o),c=e.getUniformLocation(t,u.name);fk(u,c,this)}const r=[],s=[];for(const o of this.seq)o.type===e.SAMPLER_2D_SHADOW||o.type===e.SAMPLER_CUBE_SHADOW||o.type===e.SAMPLER_2D_ARRAY_SHADOW?r.push(o):s.push(o);r.length>0&&(this.seq=r.concat(s))}setValue(e,t,n,r){const s=this.map[t];s!==void 0&&s.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let s=0,o=t.length;s!==o;++s){const u=t[s],c=n[u.id];c.needsUpdate!==!1&&u.setValue(e,c.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&n.push(o)}return n}}function Cw(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const dk=37297;let pk=0;function mk(i,e){const t=i.split(`
`),n=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const u=o+1;n.push(`${u===e?">":" "} ${u}: ${t[o]}`)}return n.join(`
`)}const Nw=new Ct;function gk(i){vt._getMatrix(Nw,vt.workingColorSpace,i);const e=`mat3( ${Nw.elements.map(t=>t.toFixed(4))} )`;switch(vt.getTransfer(i)){case Ch:return[e,"LinearTransferOETF"];case Ye:return[e,"sRGBTransferOETF"];default:return Ae("WebGLProgram: Unsupported color space: ",i),[e,"LinearTransferOETF"]}}function Dw(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),s=(i.getShaderInfoLog(e)||"").trim();if(n&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const u=parseInt(o[1]);return t.toUpperCase()+`

`+s+`

`+mk(i.getShaderSource(e),u)}else return s}function _k(i,e){const t=gk(e);return[`vec4 ${i}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}const vk={[RS]:"Linear",[CS]:"Reinhard",[NS]:"Cineon",[DS]:"ACESFilmic",[LS]:"AgX",[PS]:"Neutral",[HN]:"Custom"};function yk(i,e){const t=vk[e];return t===void 0?(Ae("WebGLProgram: Unsupported toneMapping:",e),"vec3 "+i+"( vec3 color ) { return LinearToneMapping( color ); }"):"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Mg=new k;function xk(){vt.getLuminanceCoefficients(Mg);const i=Mg.x.toFixed(4),e=Mg.y.toFixed(4),t=Mg.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${i}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function bk(i){return[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",i.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Rd).join(`
`)}function Sk(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function Tk(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const s=i.getActiveAttrib(e,r),o=s.name;let u=1;s.type===i.FLOAT_MAT2&&(u=2),s.type===i.FLOAT_MAT3&&(u=3),s.type===i.FLOAT_MAT4&&(u=4),t[o]={type:s.type,location:i.getAttribLocation(e,o),locationSize:u}}return t}function Rd(i){return i!==""}function Lw(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Pw(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Mk=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ab(i){return i.replace(Mk,Ak)}const Ek=new Map;function Ak(i,e){let t=Vt[e];if(t===void 0){const n=Ek.get(e);if(n!==void 0)t=Vt[n],Ae('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return Ab(t)}const wk=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Uw(i){return i.replace(wk,Rk)}function Rk(i,e,t,n){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function Ow(i){let e=`precision ${i.precision} float;
	precision ${i.precision} int;
	precision ${i.precision} sampler2D;
	precision ${i.precision} samplerCube;
	precision ${i.precision} sampler3D;
	precision ${i.precision} sampler2DArray;
	precision ${i.precision} sampler2DShadow;
	precision ${i.precision} samplerCubeShadow;
	precision ${i.precision} sampler2DArrayShadow;
	precision ${i.precision} isampler2D;
	precision ${i.precision} isampler3D;
	precision ${i.precision} isamplerCube;
	precision ${i.precision} isampler2DArray;
	precision ${i.precision} usampler2D;
	precision ${i.precision} usampler3D;
	precision ${i.precision} usamplerCube;
	precision ${i.precision} usampler2DArray;
	`;return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}const Ck={[Bd]:"SHADOWMAP_TYPE_PCF",[io]:"SHADOWMAP_TYPE_VSM"};function Nk(i){return Ck[i.shadowMapType]||"SHADOWMAP_TYPE_BASIC"}const Dk={[Vs]:"ENVMAP_TYPE_CUBE",[pa]:"ENVMAP_TYPE_CUBE",[cu]:"ENVMAP_TYPE_CUBE_UV"};function Lk(i){return i.envMap===!1?"ENVMAP_TYPE_CUBE":Dk[i.envMapMode]||"ENVMAP_TYPE_CUBE"}const Pk={[pa]:"ENVMAP_MODE_REFRACTION"};function Uk(i){return i.envMap===!1?"ENVMAP_MODE_REFLECTION":Pk[i.envMapMode]||"ENVMAP_MODE_REFLECTION"}const Ok={[Sp]:"ENVMAP_BLENDING_MULTIPLY",[kN]:"ENVMAP_BLENDING_MIX",[VN]:"ENVMAP_BLENDING_ADD"};function Bk(i){return i.envMap===!1?"ENVMAP_BLENDING_NONE":Ok[i.combine]||"ENVMAP_BLENDING_NONE"}function Fk(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}function Ik(i,e,t,n){const r=i.getContext(),s=t.defines;let o=t.vertexShader,u=t.fragmentShader;const c=Nk(t),h=Lk(t),d=Uk(t),p=Bk(t),g=Fk(t),_=bk(t),v=Sk(s),T=r.createProgram();let b,x,M=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(b=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(Rd).join(`
`),b.length>0&&(b+=`
`),x=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(Rd).join(`
`),x.length>0&&(x+=`
`)):(b=[Ow(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Rd).join(`
`),x=[Ow(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.envMap?"#define "+d:"",t.envMap?"#define "+p:"",g?"#define CUBEUV_TEXEL_WIDTH "+g.texelWidth:"",g?"#define CUBEUV_TEXEL_HEIGHT "+g.texelHeight:"",g?"#define CUBEUV_MAX_MIP "+g.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==$i?"#define TONE_MAPPING":"",t.toneMapping!==$i?Vt.tonemapping_pars_fragment:"",t.toneMapping!==$i?yk("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Vt.colorspace_pars_fragment,_k("linearToOutputTexel",t.outputColorSpace),xk(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Rd).join(`
`)),o=Ab(o),o=Lw(o,t),o=Pw(o,t),u=Ab(u),u=Lw(u,t),u=Pw(u,t),o=Uw(o),u=Uw(u),t.isRawShaderMaterial!==!0&&(M=`#version 300 es
`,b=[_,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+b,x=["#define varying in",t.glslVersion===V1?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===V1?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+x);const E=M+b+o,w=M+x+u,C=Cw(r,r.VERTEX_SHADER,E),N=Cw(r,r.FRAGMENT_SHADER,w);r.attachShader(T,C),r.attachShader(T,N),t.index0AttributeName!==void 0?r.bindAttribLocation(T,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(T,0,"position"),r.linkProgram(T);function D(I){if(i.debug.checkShaderErrors){const H=r.getProgramInfoLog(T)||"",X=r.getShaderInfoLog(C)||"",J=r.getShaderInfoLog(N)||"",ne=H.trim(),G=X.trim(),z=J.trim();let q=!0,ce=!0;if(r.getProgramParameter(T,r.LINK_STATUS)===!1)if(q=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(r,T,C,N);else{const xe=Dw(r,C,"vertex"),O=Dw(r,N,"fragment");Re("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(T,r.VALIDATE_STATUS)+`

Material Name: `+I.name+`
Material Type: `+I.type+`

Program Info Log: `+ne+`
`+xe+`
`+O)}else ne!==""?Ae("WebGLProgram: Program Info Log:",ne):(G===""||z==="")&&(ce=!1);ce&&(I.diagnostics={runnable:q,programLog:ne,vertexShader:{log:G,prefix:b},fragmentShader:{log:z,prefix:x}})}r.deleteShader(C),r.deleteShader(N),U=new o_(r,T),R=Tk(r,T)}let U;this.getUniforms=function(){return U===void 0&&D(this),U};let R;this.getAttributes=function(){return R===void 0&&D(this),R};let P=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return P===!1&&(P=r.getProgramParameter(T,dk)),P},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(T),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=pk++,this.cacheKey=e,this.usedTimes=1,this.program=T,this.vertexShader=C,this.fragmentShader=N,this}let zk=0;class Gk{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new kk(e),t.set(e,n)),n}}class kk{constructor(e){this.id=zk++,this.code=e,this.usedTimes=0}}function Vk(i,e,t,n,r,s,o){const u=new $S,c=new Gk,h=new Set,d=[],p=new Map,g=r.logarithmicDepthBuffer;let _=r.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distance",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function T(R){return h.add(R),R===0?"uv":`uv${R}`}function b(R,P,I,H,X){const J=H.fog,ne=X.geometry,G=R.isMeshStandardMaterial?H.environment:null,z=(R.isMeshStandardMaterial?t:e).get(R.envMap||G),q=z&&z.mapping===cu?z.image.height:null,ce=v[R.type];R.precision!==null&&(_=r.getMaxPrecision(R.precision),_!==R.precision&&Ae("WebGLProgram.getParameters:",R.precision,"not supported, using",_,"instead."));const xe=ne.morphAttributes.position||ne.morphAttributes.normal||ne.morphAttributes.color,O=xe!==void 0?xe.length:0;let Y=0;ne.morphAttributes.position!==void 0&&(Y=1),ne.morphAttributes.normal!==void 0&&(Y=2),ne.morphAttributes.color!==void 0&&(Y=3);let ue,Ne,Z,W;if(ce){const rn=sa[ce];ue=rn.vertexShader,Ne=rn.fragmentShader}else ue=R.vertexShader,Ne=R.fragmentShader,c.update(R),Z=c.getVertexShaderID(R),W=c.getFragmentShaderID(R);const ie=i.getRenderTarget(),Le=i.state.buffers.depth.getReversed(),ke=X.isInstancedMesh===!0,ze=X.isBatchedMesh===!0,ht=!!R.map,nn=!!R.matcap,Pt=!!z,wt=!!R.aoMap,qt=!!R.lightMap,Mt=!!R.bumpMap,un=!!R.normalMap,K=!!R.displacementMap,jn=!!R.emissiveMap,en=!!R.metalnessMap,mn=!!R.roughnessMap,lt=R.anisotropy>0,V=R.clearcoat>0,L=R.dispersion>0,re=R.iridescence>0,Ee=R.sheen>0,Pe=R.transmission>0,Se=lt&&!!R.anisotropyMap,ft=V&&!!R.clearcoatMap,He=V&&!!R.clearcoatNormalMap,st=V&&!!R.clearcoatRoughnessMap,At=re&&!!R.iridescenceMap,Be=re&&!!R.iridescenceThicknessMap,Fe=Ee&&!!R.sheenColorMap,Je=Ee&&!!R.sheenRoughnessMap,Ke=!!R.specularMap,We=!!R.specularColorMap,Gt=!!R.specularIntensityMap,te=Pe&&!!R.transmissionMap,$e=Pe&&!!R.thicknessMap,Ie=!!R.gradientMap,Qe=!!R.alphaMap,Oe=R.alphaTest>0,De=!!R.alphaHash,Ve=!!R.extensions;let Rt=$i;R.toneMapped&&(ie===null||ie.isXRRenderTarget===!0)&&(Rt=i.toneMapping);const bn={shaderID:ce,shaderType:R.type,shaderName:R.name,vertexShader:ue,fragmentShader:Ne,defines:R.defines,customVertexShaderID:Z,customFragmentShaderID:W,isRawShaderMaterial:R.isRawShaderMaterial===!0,glslVersion:R.glslVersion,precision:_,batching:ze,batchingColor:ze&&X._colorsTexture!==null,instancing:ke,instancingColor:ke&&X.instanceColor!==null,instancingMorph:ke&&X.morphTexture!==null,outputColorSpace:ie===null?i.outputColorSpace:ie.isXRRenderTarget===!0?ie.texture.colorSpace:mu,alphaToCoverage:!!R.alphaToCoverage,map:ht,matcap:nn,envMap:Pt,envMapMode:Pt&&z.mapping,envMapCubeUVHeight:q,aoMap:wt,lightMap:qt,bumpMap:Mt,normalMap:un,displacementMap:K,emissiveMap:jn,normalMapObjectSpace:un&&R.normalMapType===WN,normalMapTangentSpace:un&&R.normalMapType===da,metalnessMap:en,roughnessMap:mn,anisotropy:lt,anisotropyMap:Se,clearcoat:V,clearcoatMap:ft,clearcoatNormalMap:He,clearcoatRoughnessMap:st,dispersion:L,iridescence:re,iridescenceMap:At,iridescenceThicknessMap:Be,sheen:Ee,sheenColorMap:Fe,sheenRoughnessMap:Je,specularMap:Ke,specularColorMap:We,specularIntensityMap:Gt,transmission:Pe,transmissionMap:te,thicknessMap:$e,gradientMap:Ie,opaque:R.transparent===!1&&R.blending===es&&R.alphaToCoverage===!1,alphaMap:Qe,alphaTest:Oe,alphaHash:De,combine:R.combine,mapUv:ht&&T(R.map.channel),aoMapUv:wt&&T(R.aoMap.channel),lightMapUv:qt&&T(R.lightMap.channel),bumpMapUv:Mt&&T(R.bumpMap.channel),normalMapUv:un&&T(R.normalMap.channel),displacementMapUv:K&&T(R.displacementMap.channel),emissiveMapUv:jn&&T(R.emissiveMap.channel),metalnessMapUv:en&&T(R.metalnessMap.channel),roughnessMapUv:mn&&T(R.roughnessMap.channel),anisotropyMapUv:Se&&T(R.anisotropyMap.channel),clearcoatMapUv:ft&&T(R.clearcoatMap.channel),clearcoatNormalMapUv:He&&T(R.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:st&&T(R.clearcoatRoughnessMap.channel),iridescenceMapUv:At&&T(R.iridescenceMap.channel),iridescenceThicknessMapUv:Be&&T(R.iridescenceThicknessMap.channel),sheenColorMapUv:Fe&&T(R.sheenColorMap.channel),sheenRoughnessMapUv:Je&&T(R.sheenRoughnessMap.channel),specularMapUv:Ke&&T(R.specularMap.channel),specularColorMapUv:We&&T(R.specularColorMap.channel),specularIntensityMapUv:Gt&&T(R.specularIntensityMap.channel),transmissionMapUv:te&&T(R.transmissionMap.channel),thicknessMapUv:$e&&T(R.thicknessMap.channel),alphaMapUv:Qe&&T(R.alphaMap.channel),vertexTangents:!!ne.attributes.tangent&&(un||lt),vertexColors:R.vertexColors,vertexAlphas:R.vertexColors===!0&&!!ne.attributes.color&&ne.attributes.color.itemSize===4,pointsUvs:X.isPoints===!0&&!!ne.attributes.uv&&(ht||Qe),fog:!!J,useFog:R.fog===!0,fogExp2:!!J&&J.isFogExp2,flatShading:R.flatShading===!0&&R.wireframe===!1,sizeAttenuation:R.sizeAttenuation===!0,logarithmicDepthBuffer:g,reversedDepthBuffer:Le,skinning:X.isSkinnedMesh===!0,morphTargets:ne.morphAttributes.position!==void 0,morphNormals:ne.morphAttributes.normal!==void 0,morphColors:ne.morphAttributes.color!==void 0,morphTargetsCount:O,morphTextureStride:Y,numDirLights:P.directional.length,numPointLights:P.point.length,numSpotLights:P.spot.length,numSpotLightMaps:P.spotLightMap.length,numRectAreaLights:P.rectArea.length,numHemiLights:P.hemi.length,numDirLightShadows:P.directionalShadowMap.length,numPointLightShadows:P.pointShadowMap.length,numSpotLightShadows:P.spotShadowMap.length,numSpotLightShadowsWithMaps:P.numSpotLightShadowsWithMaps,numLightProbes:P.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:R.dithering,shadowMapEnabled:i.shadowMap.enabled&&I.length>0,shadowMapType:i.shadowMap.type,toneMapping:Rt,decodeVideoTexture:ht&&R.map.isVideoTexture===!0&&vt.getTransfer(R.map.colorSpace)===Ye,decodeVideoTextureEmissive:jn&&R.emissiveMap.isVideoTexture===!0&&vt.getTransfer(R.emissiveMap.colorSpace)===Ye,premultipliedAlpha:R.premultipliedAlpha,doubleSided:R.side===rr,flipSided:R.side===Pn,useDepthPacking:R.depthPacking>=0,depthPacking:R.depthPacking||0,index0AttributeName:R.index0AttributeName,extensionClipCullDistance:Ve&&R.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Ve&&R.extensions.multiDraw===!0||ze)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:R.customProgramCacheKey()};return bn.vertexUv1s=h.has(1),bn.vertexUv2s=h.has(2),bn.vertexUv3s=h.has(3),h.clear(),bn}function x(R){const P=[];if(R.shaderID?P.push(R.shaderID):(P.push(R.customVertexShaderID),P.push(R.customFragmentShaderID)),R.defines!==void 0)for(const I in R.defines)P.push(I),P.push(R.defines[I]);return R.isRawShaderMaterial===!1&&(M(P,R),E(P,R),P.push(i.outputColorSpace)),P.push(R.customProgramCacheKey),P.join()}function M(R,P){R.push(P.precision),R.push(P.outputColorSpace),R.push(P.envMapMode),R.push(P.envMapCubeUVHeight),R.push(P.mapUv),R.push(P.alphaMapUv),R.push(P.lightMapUv),R.push(P.aoMapUv),R.push(P.bumpMapUv),R.push(P.normalMapUv),R.push(P.displacementMapUv),R.push(P.emissiveMapUv),R.push(P.metalnessMapUv),R.push(P.roughnessMapUv),R.push(P.anisotropyMapUv),R.push(P.clearcoatMapUv),R.push(P.clearcoatNormalMapUv),R.push(P.clearcoatRoughnessMapUv),R.push(P.iridescenceMapUv),R.push(P.iridescenceThicknessMapUv),R.push(P.sheenColorMapUv),R.push(P.sheenRoughnessMapUv),R.push(P.specularMapUv),R.push(P.specularColorMapUv),R.push(P.specularIntensityMapUv),R.push(P.transmissionMapUv),R.push(P.thicknessMapUv),R.push(P.combine),R.push(P.fogExp2),R.push(P.sizeAttenuation),R.push(P.morphTargetsCount),R.push(P.morphAttributeCount),R.push(P.numDirLights),R.push(P.numPointLights),R.push(P.numSpotLights),R.push(P.numSpotLightMaps),R.push(P.numHemiLights),R.push(P.numRectAreaLights),R.push(P.numDirLightShadows),R.push(P.numPointLightShadows),R.push(P.numSpotLightShadows),R.push(P.numSpotLightShadowsWithMaps),R.push(P.numLightProbes),R.push(P.shadowMapType),R.push(P.toneMapping),R.push(P.numClippingPlanes),R.push(P.numClipIntersection),R.push(P.depthPacking)}function E(R,P){u.disableAll(),P.instancing&&u.enable(0),P.instancingColor&&u.enable(1),P.instancingMorph&&u.enable(2),P.matcap&&u.enable(3),P.envMap&&u.enable(4),P.normalMapObjectSpace&&u.enable(5),P.normalMapTangentSpace&&u.enable(6),P.clearcoat&&u.enable(7),P.iridescence&&u.enable(8),P.alphaTest&&u.enable(9),P.vertexColors&&u.enable(10),P.vertexAlphas&&u.enable(11),P.vertexUv1s&&u.enable(12),P.vertexUv2s&&u.enable(13),P.vertexUv3s&&u.enable(14),P.vertexTangents&&u.enable(15),P.anisotropy&&u.enable(16),P.alphaHash&&u.enable(17),P.batching&&u.enable(18),P.dispersion&&u.enable(19),P.batchingColor&&u.enable(20),P.gradientMap&&u.enable(21),R.push(u.mask),u.disableAll(),P.fog&&u.enable(0),P.useFog&&u.enable(1),P.flatShading&&u.enable(2),P.logarithmicDepthBuffer&&u.enable(3),P.reversedDepthBuffer&&u.enable(4),P.skinning&&u.enable(5),P.morphTargets&&u.enable(6),P.morphNormals&&u.enable(7),P.morphColors&&u.enable(8),P.premultipliedAlpha&&u.enable(9),P.shadowMapEnabled&&u.enable(10),P.doubleSided&&u.enable(11),P.flipSided&&u.enable(12),P.useDepthPacking&&u.enable(13),P.dithering&&u.enable(14),P.transmission&&u.enable(15),P.sheen&&u.enable(16),P.opaque&&u.enable(17),P.pointsUvs&&u.enable(18),P.decodeVideoTexture&&u.enable(19),P.decodeVideoTextureEmissive&&u.enable(20),P.alphaToCoverage&&u.enable(21),R.push(u.mask)}function w(R){const P=v[R.type];let I;if(P){const H=sa[P];I=KN.clone(H.uniforms)}else I=R.uniforms;return I}function C(R,P){let I=p.get(P);return I!==void 0?++I.usedTimes:(I=new Ik(i,P,R,s),d.push(I),p.set(P,I)),I}function N(R){if(--R.usedTimes===0){const P=d.indexOf(R);d[P]=d[d.length-1],d.pop(),p.delete(R.cacheKey),R.destroy()}}function D(R){c.remove(R)}function U(){c.dispose()}return{getParameters:b,getProgramCacheKey:x,getUniforms:w,acquireProgram:C,releaseProgram:N,releaseShaderCache:D,programs:d,dispose:U}}function Hk(){let i=new WeakMap;function e(o){return i.has(o)}function t(o){let u=i.get(o);return u===void 0&&(u={},i.set(o,u)),u}function n(o){i.delete(o)}function r(o,u,c){i.get(o)[u]=c}function s(){i=new WeakMap}return{has:e,get:t,remove:n,update:r,dispose:s}}function Wk(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function Bw(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function Fw(){const i=[];let e=0;const t=[],n=[],r=[];function s(){e=0,t.length=0,n.length=0,r.length=0}function o(p,g,_,v,T,b){let x=i[e];return x===void 0?(x={id:p.id,object:p,geometry:g,material:_,groupOrder:v,renderOrder:p.renderOrder,z:T,group:b},i[e]=x):(x.id=p.id,x.object=p,x.geometry=g,x.material=_,x.groupOrder=v,x.renderOrder=p.renderOrder,x.z=T,x.group=b),e++,x}function u(p,g,_,v,T,b){const x=o(p,g,_,v,T,b);_.transmission>0?n.push(x):_.transparent===!0?r.push(x):t.push(x)}function c(p,g,_,v,T,b){const x=o(p,g,_,v,T,b);_.transmission>0?n.unshift(x):_.transparent===!0?r.unshift(x):t.unshift(x)}function h(p,g){t.length>1&&t.sort(p||Wk),n.length>1&&n.sort(g||Bw),r.length>1&&r.sort(g||Bw)}function d(){for(let p=e,g=i.length;p<g;p++){const _=i[p];if(_.id===null)break;_.id=null,_.object=null,_.geometry=null,_.material=null,_.group=null}}return{opaque:t,transmissive:n,transparent:r,init:s,push:u,unshift:c,finish:d,sort:h}}function qk(){let i=new WeakMap;function e(n,r){const s=i.get(n);let o;return s===void 0?(o=new Fw,i.set(n,[o])):r>=s.length?(o=new Fw,s.push(o)):o=s[r],o}function t(){i=new WeakMap}return{get:e,dispose:t}}function $k(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new k,color:new dt};break;case"SpotLight":t={position:new k,direction:new k,color:new dt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new k,color:new dt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new k,skyColor:new dt,groundColor:new dt};break;case"RectAreaLight":t={color:new dt,position:new k,halfWidth:new k,halfHeight:new k};break}return i[e.id]=t,t}}}function jk(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ue};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ue};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ue,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let Xk=0;function Yk(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function Kk(i){const e=new $k,t=jk(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let h=0;h<9;h++)n.probe.push(new k);const r=new k,s=new Ht,o=new Ht;function u(h){let d=0,p=0,g=0;for(let R=0;R<9;R++)n.probe[R].set(0,0,0);let _=0,v=0,T=0,b=0,x=0,M=0,E=0,w=0,C=0,N=0,D=0;h.sort(Yk);for(let R=0,P=h.length;R<P;R++){const I=h[R],H=I.color,X=I.intensity,J=I.distance;let ne=null;if(I.shadow&&I.shadow.map&&(I.shadow.map.texture.format===mr?ne=I.shadow.map.texture:ne=I.shadow.map.depthTexture||I.shadow.map.texture),I.isAmbientLight)d+=H.r*X,p+=H.g*X,g+=H.b*X;else if(I.isLightProbe){for(let G=0;G<9;G++)n.probe[G].addScaledVector(I.sh.coefficients[G],X);D++}else if(I.isDirectionalLight){const G=e.get(I);if(G.color.copy(I.color).multiplyScalar(I.intensity),I.castShadow){const z=I.shadow,q=t.get(I);q.shadowIntensity=z.intensity,q.shadowBias=z.bias,q.shadowNormalBias=z.normalBias,q.shadowRadius=z.radius,q.shadowMapSize=z.mapSize,n.directionalShadow[_]=q,n.directionalShadowMap[_]=ne,n.directionalShadowMatrix[_]=I.shadow.matrix,M++}n.directional[_]=G,_++}else if(I.isSpotLight){const G=e.get(I);G.position.setFromMatrixPosition(I.matrixWorld),G.color.copy(H).multiplyScalar(X),G.distance=J,G.coneCos=Math.cos(I.angle),G.penumbraCos=Math.cos(I.angle*(1-I.penumbra)),G.decay=I.decay,n.spot[T]=G;const z=I.shadow;if(I.map&&(n.spotLightMap[C]=I.map,C++,z.updateMatrices(I),I.castShadow&&N++),n.spotLightMatrix[T]=z.matrix,I.castShadow){const q=t.get(I);q.shadowIntensity=z.intensity,q.shadowBias=z.bias,q.shadowNormalBias=z.normalBias,q.shadowRadius=z.radius,q.shadowMapSize=z.mapSize,n.spotShadow[T]=q,n.spotShadowMap[T]=ne,w++}T++}else if(I.isRectAreaLight){const G=e.get(I);G.color.copy(H).multiplyScalar(X),G.halfWidth.set(I.width*.5,0,0),G.halfHeight.set(0,I.height*.5,0),n.rectArea[b]=G,b++}else if(I.isPointLight){const G=e.get(I);if(G.color.copy(I.color).multiplyScalar(I.intensity),G.distance=I.distance,G.decay=I.decay,I.castShadow){const z=I.shadow,q=t.get(I);q.shadowIntensity=z.intensity,q.shadowBias=z.bias,q.shadowNormalBias=z.normalBias,q.shadowRadius=z.radius,q.shadowMapSize=z.mapSize,q.shadowCameraNear=z.camera.near,q.shadowCameraFar=z.camera.far,n.pointShadow[v]=q,n.pointShadowMap[v]=ne,n.pointShadowMatrix[v]=I.shadow.matrix,E++}n.point[v]=G,v++}else if(I.isHemisphereLight){const G=e.get(I);G.skyColor.copy(I.color).multiplyScalar(X),G.groundColor.copy(I.groundColor).multiplyScalar(X),n.hemi[x]=G,x++}}b>0&&(i.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Xe.LTC_FLOAT_1,n.rectAreaLTC2=Xe.LTC_FLOAT_2):(n.rectAreaLTC1=Xe.LTC_HALF_1,n.rectAreaLTC2=Xe.LTC_HALF_2)),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=g;const U=n.hash;(U.directionalLength!==_||U.pointLength!==v||U.spotLength!==T||U.rectAreaLength!==b||U.hemiLength!==x||U.numDirectionalShadows!==M||U.numPointShadows!==E||U.numSpotShadows!==w||U.numSpotMaps!==C||U.numLightProbes!==D)&&(n.directional.length=_,n.spot.length=T,n.rectArea.length=b,n.point.length=v,n.hemi.length=x,n.directionalShadow.length=M,n.directionalShadowMap.length=M,n.pointShadow.length=E,n.pointShadowMap.length=E,n.spotShadow.length=w,n.spotShadowMap.length=w,n.directionalShadowMatrix.length=M,n.pointShadowMatrix.length=E,n.spotLightMatrix.length=w+C-N,n.spotLightMap.length=C,n.numSpotLightShadowsWithMaps=N,n.numLightProbes=D,U.directionalLength=_,U.pointLength=v,U.spotLength=T,U.rectAreaLength=b,U.hemiLength=x,U.numDirectionalShadows=M,U.numPointShadows=E,U.numSpotShadows=w,U.numSpotMaps=C,U.numLightProbes=D,n.version=Xk++)}function c(h,d){let p=0,g=0,_=0,v=0,T=0;const b=d.matrixWorldInverse;for(let x=0,M=h.length;x<M;x++){const E=h[x];if(E.isDirectionalLight){const w=n.directional[p];w.direction.setFromMatrixPosition(E.matrixWorld),r.setFromMatrixPosition(E.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(b),p++}else if(E.isSpotLight){const w=n.spot[_];w.position.setFromMatrixPosition(E.matrixWorld),w.position.applyMatrix4(b),w.direction.setFromMatrixPosition(E.matrixWorld),r.setFromMatrixPosition(E.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(b),_++}else if(E.isRectAreaLight){const w=n.rectArea[v];w.position.setFromMatrixPosition(E.matrixWorld),w.position.applyMatrix4(b),o.identity(),s.copy(E.matrixWorld),s.premultiply(b),o.extractRotation(s),w.halfWidth.set(E.width*.5,0,0),w.halfHeight.set(0,E.height*.5,0),w.halfWidth.applyMatrix4(o),w.halfHeight.applyMatrix4(o),v++}else if(E.isPointLight){const w=n.point[g];w.position.setFromMatrixPosition(E.matrixWorld),w.position.applyMatrix4(b),g++}else if(E.isHemisphereLight){const w=n.hemi[T];w.direction.setFromMatrixPosition(E.matrixWorld),w.direction.transformDirection(b),T++}}}return{setup:u,setupView:c,state:n}}function Iw(i){const e=new Kk(i),t=[],n=[];function r(d){h.camera=d,t.length=0,n.length=0}function s(d){t.push(d)}function o(d){n.push(d)}function u(){e.setup(t)}function c(d){e.setupView(t,d)}const h={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:h,setupLights:u,setupLightsView:c,pushLight:s,pushShadow:o}}function Qk(i){let e=new WeakMap;function t(r,s=0){const o=e.get(r);let u;return o===void 0?(u=new Iw(i),e.set(r,[u])):s>=o.length?(u=new Iw(i),o.push(u)):u=o[s],u}function n(){e=new WeakMap}return{get:t,dispose:n}}const Zk=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Jk=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ).rg;
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ).r;
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( max( 0.0, squared_mean - mean * mean ) );
	gl_FragColor = vec4( mean, std_dev, 0.0, 1.0 );
}`,e4=[new k(1,0,0),new k(-1,0,0),new k(0,1,0),new k(0,-1,0),new k(0,0,1),new k(0,0,-1)],t4=[new k(0,-1,0),new k(0,-1,0),new k(0,0,1),new k(0,0,-1),new k(0,-1,0),new k(0,-1,0)],zw=new Ht,sd=new k,ox=new k;function n4(i,e,t){let n=new Np;const r=new Ue,s=new Ue,o=new Lt,u=new rF,c=new sF,h={},d=t.maxTextureSize,p={[Jr]:Pn,[Pn]:Jr,[rr]:rr},g=new bs({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ue},radius:{value:4}},vertexShader:Zk,fragmentShader:Jk}),_=g.clone();_.defines.HORIZONTAL_PASS=1;const v=new wi;v.setAttribute("position",new Xi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const T=new yi(v,g),b=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Bd;let x=this.type;this.render=function(N,D,U){if(b.enabled===!1||b.autoUpdate===!1&&b.needsUpdate===!1||N.length===0)return;N.type===TO&&(Ae("WebGLShadowMap: PCFSoftShadowMap has been deprecated. Using PCFShadowMap instead."),N.type=Bd);const R=i.getRenderTarget(),P=i.getActiveCubeFace(),I=i.getActiveMipmapLevel(),H=i.state;H.setBlending(_r),H.buffers.depth.getReversed()===!0?H.buffers.color.setClear(0,0,0,0):H.buffers.color.setClear(1,1,1,1),H.buffers.depth.setTest(!0),H.setScissorTest(!1);const X=x!==this.type;X&&D.traverse(function(J){J.material&&(Array.isArray(J.material)?J.material.forEach(ne=>ne.needsUpdate=!0):J.material.needsUpdate=!0)});for(let J=0,ne=N.length;J<ne;J++){const G=N[J],z=G.shadow;if(z===void 0){Ae("WebGLShadowMap:",G,"has no shadow.");continue}if(z.autoUpdate===!1&&z.needsUpdate===!1)continue;r.copy(z.mapSize);const q=z.getFrameExtents();if(r.multiply(q),s.copy(z.mapSize),(r.x>d||r.y>d)&&(r.x>d&&(s.x=Math.floor(d/q.x),r.x=s.x*q.x,z.mapSize.x=s.x),r.y>d&&(s.y=Math.floor(d/q.y),r.y=s.y*q.y,z.mapSize.y=s.y)),z.map===null||X===!0){if(z.map!==null&&(z.map.depthTexture!==null&&(z.map.depthTexture.dispose(),z.map.depthTexture=null),z.map.dispose()),this.type===io){if(G.isPointLight){Ae("WebGLShadowMap: VSM shadow maps are not supported for PointLights. Use PCF or BasicShadowMap instead.");continue}z.map=new Gs(r.x,r.y,{format:mr,type:Zn,minFilter:Gn,magFilter:Gn,generateMipmaps:!1}),z.map.texture.name=G.name+".shadowMap",z.map.depthTexture=new vr(r.x,r.y,ri),z.map.depthTexture.name=G.name+".shadowMapDepth",z.map.depthTexture.format=ji,z.map.depthTexture.compareFunction=null,z.map.depthTexture.minFilter=xn,z.map.depthTexture.magFilter=xn}else{G.isPointLight?(z.map=new KS(r.x),z.map.depthTexture=new e2(r.x,yn)):(z.map=new Gs(r.x,r.y),z.map.depthTexture=new vr(r.x,r.y,yn)),z.map.depthTexture.name=G.name+".shadowMap",z.map.depthTexture.format=ji;const xe=i.state.buffers.depth.getReversed();this.type===Bd?(z.map.depthTexture.compareFunction=xe?wp:Ap,z.map.depthTexture.minFilter=Gn,z.map.depthTexture.magFilter=Gn):(z.map.depthTexture.compareFunction=null,z.map.depthTexture.minFilter=xn,z.map.depthTexture.magFilter=xn)}z.camera.updateProjectionMatrix()}const ce=z.map.isWebGLCubeRenderTarget?6:1;for(let xe=0;xe<ce;xe++){if(z.map.isWebGLCubeRenderTarget)i.setRenderTarget(z.map,xe),i.clear();else{xe===0&&(i.setRenderTarget(z.map),i.clear());const O=z.getViewport(xe);o.set(s.x*O.x,s.y*O.y,s.x*O.z,s.y*O.w),H.viewport(o)}if(G.isPointLight){const O=z.camera,Y=z.matrix,ue=G.distance||O.far;ue!==O.far&&(O.far=ue,O.updateProjectionMatrix()),sd.setFromMatrixPosition(G.matrixWorld),O.position.copy(sd),ox.copy(O.position),ox.add(e4[xe]),O.up.copy(t4[xe]),O.lookAt(ox),O.updateMatrixWorld(),Y.makeTranslation(-sd.x,-sd.y,-sd.z),zw.multiplyMatrices(O.projectionMatrix,O.matrixWorldInverse),z._frustum.setFromProjectionMatrix(zw,O.coordinateSystem,O.reversedDepth)}else z.updateMatrices(G);n=z.getFrustum(),w(D,U,z.camera,G,this.type)}z.isPointLightShadow!==!0&&this.type===io&&M(z,U),z.needsUpdate=!1}x=this.type,b.needsUpdate=!1,i.setRenderTarget(R,P,I)};function M(N,D){const U=e.update(T);g.defines.VSM_SAMPLES!==N.blurSamples&&(g.defines.VSM_SAMPLES=N.blurSamples,_.defines.VSM_SAMPLES=N.blurSamples,g.needsUpdate=!0,_.needsUpdate=!0),N.mapPass===null&&(N.mapPass=new Gs(r.x,r.y,{format:mr,type:Zn})),g.uniforms.shadow_pass.value=N.map.depthTexture,g.uniforms.resolution.value=N.mapSize,g.uniforms.radius.value=N.radius,i.setRenderTarget(N.mapPass),i.clear(),i.renderBufferDirect(D,null,U,g,T,null),_.uniforms.shadow_pass.value=N.mapPass.texture,_.uniforms.resolution.value=N.mapSize,_.uniforms.radius.value=N.radius,i.setRenderTarget(N.map),i.clear(),i.renderBufferDirect(D,null,U,_,T,null)}function E(N,D,U,R){let P=null;const I=U.isPointLight===!0?N.customDistanceMaterial:N.customDepthMaterial;if(I!==void 0)P=I;else if(P=U.isPointLight===!0?c:u,i.localClippingEnabled&&D.clipShadows===!0&&Array.isArray(D.clippingPlanes)&&D.clippingPlanes.length!==0||D.displacementMap&&D.displacementScale!==0||D.alphaMap&&D.alphaTest>0||D.map&&D.alphaTest>0||D.alphaToCoverage===!0){const H=P.uuid,X=D.uuid;let J=h[H];J===void 0&&(J={},h[H]=J);let ne=J[X];ne===void 0&&(ne=P.clone(),J[X]=ne,D.addEventListener("dispose",C)),P=ne}if(P.visible=D.visible,P.wireframe=D.wireframe,R===io?P.side=D.shadowSide!==null?D.shadowSide:D.side:P.side=D.shadowSide!==null?D.shadowSide:p[D.side],P.alphaMap=D.alphaMap,P.alphaTest=D.alphaToCoverage===!0?.5:D.alphaTest,P.map=D.map,P.clipShadows=D.clipShadows,P.clippingPlanes=D.clippingPlanes,P.clipIntersection=D.clipIntersection,P.displacementMap=D.displacementMap,P.displacementScale=D.displacementScale,P.displacementBias=D.displacementBias,P.wireframeLinewidth=D.wireframeLinewidth,P.linewidth=D.linewidth,U.isPointLight===!0&&P.isMeshDistanceMaterial===!0){const H=i.properties.get(P);H.light=U}return P}function w(N,D,U,R,P){if(N.visible===!1)return;if(N.layers.test(D.layers)&&(N.isMesh||N.isLine||N.isPoints)&&(N.castShadow||N.receiveShadow&&P===io)&&(!N.frustumCulled||n.intersectsObject(N))){N.modelViewMatrix.multiplyMatrices(U.matrixWorldInverse,N.matrixWorld);const X=e.update(N),J=N.material;if(Array.isArray(J)){const ne=X.groups;for(let G=0,z=ne.length;G<z;G++){const q=ne[G],ce=J[q.materialIndex];if(ce&&ce.visible){const xe=E(N,ce,R,P);N.onBeforeShadow(i,N,D,U,X,xe,q),i.renderBufferDirect(U,null,X,xe,N,q),N.onAfterShadow(i,N,D,U,X,xe,q)}}}else if(J.visible){const ne=E(N,J,R,P);N.onBeforeShadow(i,N,D,U,X,ne,null),i.renderBufferDirect(U,null,X,ne,N,null),N.onAfterShadow(i,N,D,U,X,ne,null)}}const H=N.children;for(let X=0,J=H.length;X<J;X++)w(H[X],D,U,R,P)}function C(N){N.target.removeEventListener("dispose",C);for(const U in h){const R=h[U],P=N.target.uuid;P in R&&(R[P].dispose(),delete R[P])}}}const i4={[tp]:np,[ip]:ap,[rp]:op,[hl]:sp,[np]:tp,[ap]:ip,[op]:rp,[sp]:hl};function r4(i,e){function t(){let te=!1;const $e=new Lt;let Ie=null;const Qe=new Lt(0,0,0,0);return{setMask:function(Oe){Ie!==Oe&&!te&&(i.colorMask(Oe,Oe,Oe,Oe),Ie=Oe)},setLocked:function(Oe){te=Oe},setClear:function(Oe,De,Ve,Rt,bn){bn===!0&&(Oe*=Rt,De*=Rt,Ve*=Rt),$e.set(Oe,De,Ve,Rt),Qe.equals($e)===!1&&(i.clearColor(Oe,De,Ve,Rt),Qe.copy($e))},reset:function(){te=!1,Ie=null,Qe.set(-1,0,0,0)}}}function n(){let te=!1,$e=!1,Ie=null,Qe=null,Oe=null;return{setReversed:function(De){if($e!==De){const Ve=e.get("EXT_clip_control");De?Ve.clipControlEXT(Ve.LOWER_LEFT_EXT,Ve.ZERO_TO_ONE_EXT):Ve.clipControlEXT(Ve.LOWER_LEFT_EXT,Ve.NEGATIVE_ONE_TO_ONE_EXT),$e=De;const Rt=Oe;Oe=null,this.setClear(Rt)}},getReversed:function(){return $e},setTest:function(De){De?ie(i.DEPTH_TEST):Le(i.DEPTH_TEST)},setMask:function(De){Ie!==De&&!te&&(i.depthMask(De),Ie=De)},setFunc:function(De){if($e&&(De=i4[De]),Qe!==De){switch(De){case tp:i.depthFunc(i.NEVER);break;case np:i.depthFunc(i.ALWAYS);break;case ip:i.depthFunc(i.LESS);break;case hl:i.depthFunc(i.LEQUAL);break;case rp:i.depthFunc(i.EQUAL);break;case sp:i.depthFunc(i.GEQUAL);break;case ap:i.depthFunc(i.GREATER);break;case op:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}Qe=De}},setLocked:function(De){te=De},setClear:function(De){Oe!==De&&($e&&(De=1-De),i.clearDepth(De),Oe=De)},reset:function(){te=!1,Ie=null,Qe=null,Oe=null,$e=!1}}}function r(){let te=!1,$e=null,Ie=null,Qe=null,Oe=null,De=null,Ve=null,Rt=null,bn=null;return{setTest:function(rn){te||(rn?ie(i.STENCIL_TEST):Le(i.STENCIL_TEST))},setMask:function(rn){$e!==rn&&!te&&(i.stencilMask(rn),$e=rn)},setFunc:function(rn,Qi,Ms){(Ie!==rn||Qe!==Qi||Oe!==Ms)&&(i.stencilFunc(rn,Qi,Ms),Ie=rn,Qe=Qi,Oe=Ms)},setOp:function(rn,Qi,Ms){(De!==rn||Ve!==Qi||Rt!==Ms)&&(i.stencilOp(rn,Qi,Ms),De=rn,Ve=Qi,Rt=Ms)},setLocked:function(rn){te=rn},setClear:function(rn){bn!==rn&&(i.clearStencil(rn),bn=rn)},reset:function(){te=!1,$e=null,Ie=null,Qe=null,Oe=null,De=null,Ve=null,Rt=null,bn=null}}}const s=new t,o=new n,u=new r,c=new WeakMap,h=new WeakMap;let d={},p={},g=new WeakMap,_=[],v=null,T=!1,b=null,x=null,M=null,E=null,w=null,C=null,N=null,D=new dt(0,0,0),U=0,R=!1,P=null,I=null,H=null,X=null,J=null;const ne=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let G=!1,z=0;const q=i.getParameter(i.VERSION);q.indexOf("WebGL")!==-1?(z=parseFloat(/^WebGL (\d)/.exec(q)[1]),G=z>=1):q.indexOf("OpenGL ES")!==-1&&(z=parseFloat(/^OpenGL ES (\d)/.exec(q)[1]),G=z>=2);let ce=null,xe={};const O=i.getParameter(i.SCISSOR_BOX),Y=i.getParameter(i.VIEWPORT),ue=new Lt().fromArray(O),Ne=new Lt().fromArray(Y);function Z(te,$e,Ie,Qe){const Oe=new Uint8Array(4),De=i.createTexture();i.bindTexture(te,De),i.texParameteri(te,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(te,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let Ve=0;Ve<Ie;Ve++)te===i.TEXTURE_3D||te===i.TEXTURE_2D_ARRAY?i.texImage3D($e,0,i.RGBA,1,1,Qe,0,i.RGBA,i.UNSIGNED_BYTE,Oe):i.texImage2D($e+Ve,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,Oe);return De}const W={};W[i.TEXTURE_2D]=Z(i.TEXTURE_2D,i.TEXTURE_2D,1),W[i.TEXTURE_CUBE_MAP]=Z(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),W[i.TEXTURE_2D_ARRAY]=Z(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),W[i.TEXTURE_3D]=Z(i.TEXTURE_3D,i.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),u.setClear(0),ie(i.DEPTH_TEST),o.setFunc(hl),Mt(!1),un(yb),ie(i.CULL_FACE),wt(_r);function ie(te){d[te]!==!0&&(i.enable(te),d[te]=!0)}function Le(te){d[te]!==!1&&(i.disable(te),d[te]=!1)}function ke(te,$e){return p[te]!==$e?(i.bindFramebuffer(te,$e),p[te]=$e,te===i.DRAW_FRAMEBUFFER&&(p[i.FRAMEBUFFER]=$e),te===i.FRAMEBUFFER&&(p[i.DRAW_FRAMEBUFFER]=$e),!0):!1}function ze(te,$e){let Ie=_,Qe=!1;if(te){Ie=g.get($e),Ie===void 0&&(Ie=[],g.set($e,Ie));const Oe=te.textures;if(Ie.length!==Oe.length||Ie[0]!==i.COLOR_ATTACHMENT0){for(let De=0,Ve=Oe.length;De<Ve;De++)Ie[De]=i.COLOR_ATTACHMENT0+De;Ie.length=Oe.length,Qe=!0}}else Ie[0]!==i.BACK&&(Ie[0]=i.BACK,Qe=!0);Qe&&i.drawBuffers(Ie)}function ht(te){return v!==te?(i.useProgram(te),v=te,!0):!1}const nn={[sr]:i.FUNC_ADD,[vS]:i.FUNC_SUBTRACT,[yS]:i.FUNC_REVERSE_SUBTRACT};nn[zN]=i.MIN,nn[GN]=i.MAX;const Pt={[Ka]:i.ZERO,[xS]:i.ONE,[bS]:i.SRC_COLOR,[Jd]:i.SRC_ALPHA,[wS]:i.SRC_ALPHA_SATURATE,[ES]:i.DST_COLOR,[TS]:i.DST_ALPHA,[SS]:i.ONE_MINUS_SRC_COLOR,[ep]:i.ONE_MINUS_SRC_ALPHA,[AS]:i.ONE_MINUS_DST_COLOR,[MS]:i.ONE_MINUS_DST_ALPHA,[MO]:i.CONSTANT_COLOR,[EO]:i.ONE_MINUS_CONSTANT_COLOR,[AO]:i.CONSTANT_ALPHA,[wO]:i.ONE_MINUS_CONSTANT_ALPHA};function wt(te,$e,Ie,Qe,Oe,De,Ve,Rt,bn,rn){if(te===_r){T===!0&&(Le(i.BLEND),T=!1);return}if(T===!1&&(ie(i.BLEND),T=!0),te!==jc){if(te!==b||rn!==R){if((x!==sr||w!==sr)&&(i.blendEquation(i.FUNC_ADD),x=sr,w=sr),rn)switch(te){case es:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case eh:i.blendFunc(i.ONE,i.ONE);break;case th:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case nh:i.blendFuncSeparate(i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ZERO,i.ONE);break;default:Re("WebGLState: Invalid blending: ",te);break}else switch(te){case es:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case eh:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE,i.ONE,i.ONE);break;case th:Re("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case nh:Re("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Re("WebGLState: Invalid blending: ",te);break}M=null,E=null,C=null,N=null,D.set(0,0,0),U=0,b=te,R=rn}return}Oe=Oe||$e,De=De||Ie,Ve=Ve||Qe,($e!==x||Oe!==w)&&(i.blendEquationSeparate(nn[$e],nn[Oe]),x=$e,w=Oe),(Ie!==M||Qe!==E||De!==C||Ve!==N)&&(i.blendFuncSeparate(Pt[Ie],Pt[Qe],Pt[De],Pt[Ve]),M=Ie,E=Qe,C=De,N=Ve),(Rt.equals(D)===!1||bn!==U)&&(i.blendColor(Rt.r,Rt.g,Rt.b,bn),D.copy(Rt),U=bn),b=te,R=!1}function qt(te,$e){te.side===rr?Le(i.CULL_FACE):ie(i.CULL_FACE);let Ie=te.side===Pn;$e&&(Ie=!Ie),Mt(Ie),te.blending===es&&te.transparent===!1?wt(_r):wt(te.blending,te.blendEquation,te.blendSrc,te.blendDst,te.blendEquationAlpha,te.blendSrcAlpha,te.blendDstAlpha,te.blendColor,te.blendAlpha,te.premultipliedAlpha),o.setFunc(te.depthFunc),o.setTest(te.depthTest),o.setMask(te.depthWrite),s.setMask(te.colorWrite);const Qe=te.stencilWrite;u.setTest(Qe),Qe&&(u.setMask(te.stencilWriteMask),u.setFunc(te.stencilFunc,te.stencilRef,te.stencilFuncMask),u.setOp(te.stencilFail,te.stencilZFail,te.stencilZPass)),jn(te.polygonOffset,te.polygonOffsetFactor,te.polygonOffsetUnits),te.alphaToCoverage===!0?ie(i.SAMPLE_ALPHA_TO_COVERAGE):Le(i.SAMPLE_ALPHA_TO_COVERAGE)}function Mt(te){P!==te&&(te?i.frontFace(i.CW):i.frontFace(i.CCW),P=te)}function un(te){te!==FN?(ie(i.CULL_FACE),te!==I&&(te===yb?i.cullFace(i.BACK):te===IN?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):Le(i.CULL_FACE),I=te}function K(te){te!==H&&(G&&i.lineWidth(te),H=te)}function jn(te,$e,Ie){te?(ie(i.POLYGON_OFFSET_FILL),(X!==$e||J!==Ie)&&(i.polygonOffset($e,Ie),X=$e,J=Ie)):Le(i.POLYGON_OFFSET_FILL)}function en(te){te?ie(i.SCISSOR_TEST):Le(i.SCISSOR_TEST)}function mn(te){te===void 0&&(te=i.TEXTURE0+ne-1),ce!==te&&(i.activeTexture(te),ce=te)}function lt(te,$e,Ie){Ie===void 0&&(ce===null?Ie=i.TEXTURE0+ne-1:Ie=ce);let Qe=xe[Ie];Qe===void 0&&(Qe={type:void 0,texture:void 0},xe[Ie]=Qe),(Qe.type!==te||Qe.texture!==$e)&&(ce!==Ie&&(i.activeTexture(Ie),ce=Ie),i.bindTexture(te,$e||W[te]),Qe.type=te,Qe.texture=$e)}function V(){const te=xe[ce];te!==void 0&&te.type!==void 0&&(i.bindTexture(te.type,null),te.type=void 0,te.texture=void 0)}function L(){try{i.compressedTexImage2D(...arguments)}catch(te){Re("WebGLState:",te)}}function re(){try{i.compressedTexImage3D(...arguments)}catch(te){Re("WebGLState:",te)}}function Ee(){try{i.texSubImage2D(...arguments)}catch(te){Re("WebGLState:",te)}}function Pe(){try{i.texSubImage3D(...arguments)}catch(te){Re("WebGLState:",te)}}function Se(){try{i.compressedTexSubImage2D(...arguments)}catch(te){Re("WebGLState:",te)}}function ft(){try{i.compressedTexSubImage3D(...arguments)}catch(te){Re("WebGLState:",te)}}function He(){try{i.texStorage2D(...arguments)}catch(te){Re("WebGLState:",te)}}function st(){try{i.texStorage3D(...arguments)}catch(te){Re("WebGLState:",te)}}function At(){try{i.texImage2D(...arguments)}catch(te){Re("WebGLState:",te)}}function Be(){try{i.texImage3D(...arguments)}catch(te){Re("WebGLState:",te)}}function Fe(te){ue.equals(te)===!1&&(i.scissor(te.x,te.y,te.z,te.w),ue.copy(te))}function Je(te){Ne.equals(te)===!1&&(i.viewport(te.x,te.y,te.z,te.w),Ne.copy(te))}function Ke(te,$e){let Ie=h.get($e);Ie===void 0&&(Ie=new WeakMap,h.set($e,Ie));let Qe=Ie.get(te);Qe===void 0&&(Qe=i.getUniformBlockIndex($e,te.name),Ie.set(te,Qe))}function We(te,$e){const Qe=h.get($e).get(te);c.get($e)!==Qe&&(i.uniformBlockBinding($e,Qe,te.__bindingPointIndex),c.set($e,Qe))}function Gt(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),o.setReversed(!1),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),d={},ce=null,xe={},p={},g=new WeakMap,_=[],v=null,T=!1,b=null,x=null,M=null,E=null,w=null,C=null,N=null,D=new dt(0,0,0),U=0,R=!1,P=null,I=null,H=null,X=null,J=null,ue.set(0,0,i.canvas.width,i.canvas.height),Ne.set(0,0,i.canvas.width,i.canvas.height),s.reset(),o.reset(),u.reset()}return{buffers:{color:s,depth:o,stencil:u},enable:ie,disable:Le,bindFramebuffer:ke,drawBuffers:ze,useProgram:ht,setBlending:wt,setMaterial:qt,setFlipSided:Mt,setCullFace:un,setLineWidth:K,setPolygonOffset:jn,setScissorTest:en,activeTexture:mn,bindTexture:lt,unbindTexture:V,compressedTexImage2D:L,compressedTexImage3D:re,texImage2D:At,texImage3D:Be,updateUBOMapping:Ke,uniformBlockBinding:We,texStorage2D:He,texStorage3D:st,texSubImage2D:Ee,texSubImage3D:Pe,compressedTexSubImage2D:Se,compressedTexSubImage3D:ft,scissor:Fe,viewport:Je,reset:Gt}}function s4(i,e,t,n,r,s,o){const u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),h=new Ue,d=new WeakMap;let p;const g=new WeakMap;let _=!1;try{_=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(V,L){return _?new OffscreenCanvas(V,L):fp("canvas")}function T(V,L,re){let Ee=1;const Pe=lt(V);if((Pe.width>re||Pe.height>re)&&(Ee=re/Math.max(Pe.width,Pe.height)),Ee<1)if(typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&V instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&V instanceof ImageBitmap||typeof VideoFrame<"u"&&V instanceof VideoFrame){const Se=Math.floor(Ee*Pe.width),ft=Math.floor(Ee*Pe.height);p===void 0&&(p=v(Se,ft));const He=L?v(Se,ft):p;return He.width=Se,He.height=ft,He.getContext("2d").drawImage(V,0,0,Se,ft),Ae("WebGLRenderer: Texture has been resized from ("+Pe.width+"x"+Pe.height+") to ("+Se+"x"+ft+")."),He}else return"data"in V&&Ae("WebGLRenderer: Image in DataTexture is too big ("+Pe.width+"x"+Pe.height+")."),V;return V}function b(V){return V.generateMipmaps}function x(V){i.generateMipmap(V)}function M(V){return V.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:V.isWebGL3DRenderTarget?i.TEXTURE_3D:V.isWebGLArrayRenderTarget||V.isCompressedArrayTexture?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D}function E(V,L,re,Ee,Pe=!1){if(V!==null){if(i[V]!==void 0)return i[V];Ae("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+V+"'")}let Se=L;if(L===i.RED&&(re===i.FLOAT&&(Se=i.R32F),re===i.HALF_FLOAT&&(Se=i.R16F),re===i.UNSIGNED_BYTE&&(Se=i.R8)),L===i.RED_INTEGER&&(re===i.UNSIGNED_BYTE&&(Se=i.R8UI),re===i.UNSIGNED_SHORT&&(Se=i.R16UI),re===i.UNSIGNED_INT&&(Se=i.R32UI),re===i.BYTE&&(Se=i.R8I),re===i.SHORT&&(Se=i.R16I),re===i.INT&&(Se=i.R32I)),L===i.RG&&(re===i.FLOAT&&(Se=i.RG32F),re===i.HALF_FLOAT&&(Se=i.RG16F),re===i.UNSIGNED_BYTE&&(Se=i.RG8)),L===i.RG_INTEGER&&(re===i.UNSIGNED_BYTE&&(Se=i.RG8UI),re===i.UNSIGNED_SHORT&&(Se=i.RG16UI),re===i.UNSIGNED_INT&&(Se=i.RG32UI),re===i.BYTE&&(Se=i.RG8I),re===i.SHORT&&(Se=i.RG16I),re===i.INT&&(Se=i.RG32I)),L===i.RGB_INTEGER&&(re===i.UNSIGNED_BYTE&&(Se=i.RGB8UI),re===i.UNSIGNED_SHORT&&(Se=i.RGB16UI),re===i.UNSIGNED_INT&&(Se=i.RGB32UI),re===i.BYTE&&(Se=i.RGB8I),re===i.SHORT&&(Se=i.RGB16I),re===i.INT&&(Se=i.RGB32I)),L===i.RGBA_INTEGER&&(re===i.UNSIGNED_BYTE&&(Se=i.RGBA8UI),re===i.UNSIGNED_SHORT&&(Se=i.RGBA16UI),re===i.UNSIGNED_INT&&(Se=i.RGBA32UI),re===i.BYTE&&(Se=i.RGBA8I),re===i.SHORT&&(Se=i.RGBA16I),re===i.INT&&(Se=i.RGBA32I)),L===i.RGB&&(re===i.UNSIGNED_INT_5_9_9_9_REV&&(Se=i.RGB9_E5),re===i.UNSIGNED_INT_10F_11F_11F_REV&&(Se=i.R11F_G11F_B10F)),L===i.RGBA){const ft=Pe?Ch:vt.getTransfer(Ee);re===i.FLOAT&&(Se=i.RGBA32F),re===i.HALF_FLOAT&&(Se=i.RGBA16F),re===i.UNSIGNED_BYTE&&(Se=ft===Ye?i.SRGB8_ALPHA8:i.RGBA8),re===i.UNSIGNED_SHORT_4_4_4_4&&(Se=i.RGBA4),re===i.UNSIGNED_SHORT_5_5_5_1&&(Se=i.RGB5_A1)}return(Se===i.R16F||Se===i.R32F||Se===i.RG16F||Se===i.RG32F||Se===i.RGBA16F||Se===i.RGBA32F)&&e.get("EXT_color_buffer_float"),Se}function w(V,L){let re;return V?L===null||L===yn||L===ts?re=i.DEPTH24_STENCIL8:L===ri?re=i.DEPTH32F_STENCIL8:L===Is&&(re=i.DEPTH24_STENCIL8,Ae("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):L===null||L===yn||L===ts?re=i.DEPTH_COMPONENT24:L===ri?re=i.DEPTH_COMPONENT32F:L===Is&&(re=i.DEPTH_COMPONENT16),re}function C(V,L){return b(V)===!0||V.isFramebufferTexture&&V.minFilter!==xn&&V.minFilter!==Gn?Math.log2(Math.max(L.width,L.height))+1:V.mipmaps!==void 0&&V.mipmaps.length>0?V.mipmaps.length:V.isCompressedTexture&&Array.isArray(V.image)?L.mipmaps.length:1}function N(V){const L=V.target;L.removeEventListener("dispose",N),U(L),L.isVideoTexture&&d.delete(L)}function D(V){const L=V.target;L.removeEventListener("dispose",D),P(L)}function U(V){const L=n.get(V);if(L.__webglInit===void 0)return;const re=V.source,Ee=g.get(re);if(Ee){const Pe=Ee[L.__cacheKey];Pe.usedTimes--,Pe.usedTimes===0&&R(V),Object.keys(Ee).length===0&&g.delete(re)}n.remove(V)}function R(V){const L=n.get(V);i.deleteTexture(L.__webglTexture);const re=V.source,Ee=g.get(re);delete Ee[L.__cacheKey],o.memory.textures--}function P(V){const L=n.get(V);if(V.depthTexture&&(V.depthTexture.dispose(),n.remove(V.depthTexture)),V.isWebGLCubeRenderTarget)for(let Ee=0;Ee<6;Ee++){if(Array.isArray(L.__webglFramebuffer[Ee]))for(let Pe=0;Pe<L.__webglFramebuffer[Ee].length;Pe++)i.deleteFramebuffer(L.__webglFramebuffer[Ee][Pe]);else i.deleteFramebuffer(L.__webglFramebuffer[Ee]);L.__webglDepthbuffer&&i.deleteRenderbuffer(L.__webglDepthbuffer[Ee])}else{if(Array.isArray(L.__webglFramebuffer))for(let Ee=0;Ee<L.__webglFramebuffer.length;Ee++)i.deleteFramebuffer(L.__webglFramebuffer[Ee]);else i.deleteFramebuffer(L.__webglFramebuffer);if(L.__webglDepthbuffer&&i.deleteRenderbuffer(L.__webglDepthbuffer),L.__webglMultisampledFramebuffer&&i.deleteFramebuffer(L.__webglMultisampledFramebuffer),L.__webglColorRenderbuffer)for(let Ee=0;Ee<L.__webglColorRenderbuffer.length;Ee++)L.__webglColorRenderbuffer[Ee]&&i.deleteRenderbuffer(L.__webglColorRenderbuffer[Ee]);L.__webglDepthRenderbuffer&&i.deleteRenderbuffer(L.__webglDepthRenderbuffer)}const re=V.textures;for(let Ee=0,Pe=re.length;Ee<Pe;Ee++){const Se=n.get(re[Ee]);Se.__webglTexture&&(i.deleteTexture(Se.__webglTexture),o.memory.textures--),n.remove(re[Ee])}n.remove(V)}let I=0;function H(){I=0}function X(){const V=I;return V>=r.maxTextures&&Ae("WebGLTextures: Trying to use "+V+" texture units while this GPU supports only "+r.maxTextures),I+=1,V}function J(V){const L=[];return L.push(V.wrapS),L.push(V.wrapT),L.push(V.wrapR||0),L.push(V.magFilter),L.push(V.minFilter),L.push(V.anisotropy),L.push(V.internalFormat),L.push(V.format),L.push(V.type),L.push(V.generateMipmaps),L.push(V.premultiplyAlpha),L.push(V.flipY),L.push(V.unpackAlignment),L.push(V.colorSpace),L.join()}function ne(V,L){const re=n.get(V);if(V.isVideoTexture&&en(V),V.isRenderTargetTexture===!1&&V.isExternalTexture!==!0&&V.version>0&&re.__version!==V.version){const Ee=V.image;if(Ee===null)Ae("WebGLRenderer: Texture marked for update but no image data found.");else if(Ee.complete===!1)Ae("WebGLRenderer: Texture marked for update but image is incomplete");else{W(re,V,L);return}}else V.isExternalTexture&&(re.__webglTexture=V.sourceTexture?V.sourceTexture:null);t.bindTexture(i.TEXTURE_2D,re.__webglTexture,i.TEXTURE0+L)}function G(V,L){const re=n.get(V);if(V.isRenderTargetTexture===!1&&V.version>0&&re.__version!==V.version){W(re,V,L);return}else V.isExternalTexture&&(re.__webglTexture=V.sourceTexture?V.sourceTexture:null);t.bindTexture(i.TEXTURE_2D_ARRAY,re.__webglTexture,i.TEXTURE0+L)}function z(V,L){const re=n.get(V);if(V.isRenderTargetTexture===!1&&V.version>0&&re.__version!==V.version){W(re,V,L);return}t.bindTexture(i.TEXTURE_3D,re.__webglTexture,i.TEXTURE0+L)}function q(V,L){const re=n.get(V);if(V.isCubeDepthTexture!==!0&&V.version>0&&re.__version!==V.version){ie(re,V,L);return}t.bindTexture(i.TEXTURE_CUBE_MAP,re.__webglTexture,i.TEXTURE0+L)}const ce={[hu]:i.REPEAT,[Nr]:i.CLAMP_TO_EDGE,[fu]:i.MIRRORED_REPEAT},xe={[xn]:i.NEAREST,[OS]:i.NEAREST_MIPMAP_NEAREST,[ro]:i.NEAREST_MIPMAP_LINEAR,[Gn]:i.LINEAR,[Xc]:i.LINEAR_MIPMAP_NEAREST,[Dr]:i.LINEAR_MIPMAP_LINEAR},O={[FS]:i.NEVER,[kS]:i.ALWAYS,[Ep]:i.LESS,[Ap]:i.LEQUAL,[IS]:i.EQUAL,[wp]:i.GEQUAL,[zS]:i.GREATER,[GS]:i.NOTEQUAL};function Y(V,L){if(L.type===ri&&e.has("OES_texture_float_linear")===!1&&(L.magFilter===Gn||L.magFilter===Xc||L.magFilter===ro||L.magFilter===Dr||L.minFilter===Gn||L.minFilter===Xc||L.minFilter===ro||L.minFilter===Dr)&&Ae("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),i.texParameteri(V,i.TEXTURE_WRAP_S,ce[L.wrapS]),i.texParameteri(V,i.TEXTURE_WRAP_T,ce[L.wrapT]),(V===i.TEXTURE_3D||V===i.TEXTURE_2D_ARRAY)&&i.texParameteri(V,i.TEXTURE_WRAP_R,ce[L.wrapR]),i.texParameteri(V,i.TEXTURE_MAG_FILTER,xe[L.magFilter]),i.texParameteri(V,i.TEXTURE_MIN_FILTER,xe[L.minFilter]),L.compareFunction&&(i.texParameteri(V,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(V,i.TEXTURE_COMPARE_FUNC,O[L.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(L.magFilter===xn||L.minFilter!==ro&&L.minFilter!==Dr||L.type===ri&&e.has("OES_texture_float_linear")===!1)return;if(L.anisotropy>1||n.get(L).__currentAnisotropy){const re=e.get("EXT_texture_filter_anisotropic");i.texParameterf(V,re.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(L.anisotropy,r.getMaxAnisotropy())),n.get(L).__currentAnisotropy=L.anisotropy}}}function ue(V,L){let re=!1;V.__webglInit===void 0&&(V.__webglInit=!0,L.addEventListener("dispose",N));const Ee=L.source;let Pe=g.get(Ee);Pe===void 0&&(Pe={},g.set(Ee,Pe));const Se=J(L);if(Se!==V.__cacheKey){Pe[Se]===void 0&&(Pe[Se]={texture:i.createTexture(),usedTimes:0},o.memory.textures++,re=!0),Pe[Se].usedTimes++;const ft=Pe[V.__cacheKey];ft!==void 0&&(Pe[V.__cacheKey].usedTimes--,ft.usedTimes===0&&R(L)),V.__cacheKey=Se,V.__webglTexture=Pe[Se].texture}return re}function Ne(V,L,re){return Math.floor(Math.floor(V/re)/L)}function Z(V,L,re,Ee){const Se=V.updateRanges;if(Se.length===0)t.texSubImage2D(i.TEXTURE_2D,0,0,0,L.width,L.height,re,Ee,L.data);else{Se.sort((Be,Fe)=>Be.start-Fe.start);let ft=0;for(let Be=1;Be<Se.length;Be++){const Fe=Se[ft],Je=Se[Be],Ke=Fe.start+Fe.count,We=Ne(Je.start,L.width,4),Gt=Ne(Fe.start,L.width,4);Je.start<=Ke+1&&We===Gt&&Ne(Je.start+Je.count-1,L.width,4)===We?Fe.count=Math.max(Fe.count,Je.start+Je.count-Fe.start):(++ft,Se[ft]=Je)}Se.length=ft+1;const He=i.getParameter(i.UNPACK_ROW_LENGTH),st=i.getParameter(i.UNPACK_SKIP_PIXELS),At=i.getParameter(i.UNPACK_SKIP_ROWS);i.pixelStorei(i.UNPACK_ROW_LENGTH,L.width);for(let Be=0,Fe=Se.length;Be<Fe;Be++){const Je=Se[Be],Ke=Math.floor(Je.start/4),We=Math.ceil(Je.count/4),Gt=Ke%L.width,te=Math.floor(Ke/L.width),$e=We,Ie=1;i.pixelStorei(i.UNPACK_SKIP_PIXELS,Gt),i.pixelStorei(i.UNPACK_SKIP_ROWS,te),t.texSubImage2D(i.TEXTURE_2D,0,Gt,te,$e,Ie,re,Ee,L.data)}V.clearUpdateRanges(),i.pixelStorei(i.UNPACK_ROW_LENGTH,He),i.pixelStorei(i.UNPACK_SKIP_PIXELS,st),i.pixelStorei(i.UNPACK_SKIP_ROWS,At)}}function W(V,L,re){let Ee=i.TEXTURE_2D;(L.isDataArrayTexture||L.isCompressedArrayTexture)&&(Ee=i.TEXTURE_2D_ARRAY),L.isData3DTexture&&(Ee=i.TEXTURE_3D);const Pe=ue(V,L),Se=L.source;t.bindTexture(Ee,V.__webglTexture,i.TEXTURE0+re);const ft=n.get(Se);if(Se.version!==ft.__version||Pe===!0){t.activeTexture(i.TEXTURE0+re);const He=vt.getPrimaries(vt.workingColorSpace),st=L.colorSpace===Rr?null:vt.getPrimaries(L.colorSpace),At=L.colorSpace===Rr||He===st?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,L.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,L.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,L.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,At);let Be=T(L.image,!1,r.maxTextureSize);Be=mn(L,Be);const Fe=s.convert(L.format,L.colorSpace),Je=s.convert(L.type);let Ke=E(L.internalFormat,Fe,Je,L.colorSpace,L.isVideoTexture);Y(Ee,L);let We;const Gt=L.mipmaps,te=L.isVideoTexture!==!0,$e=ft.__version===void 0||Pe===!0,Ie=Se.dataReady,Qe=C(L,Be);if(L.isDepthTexture)Ke=w(L.format===pr,L.type),$e&&(te?t.texStorage2D(i.TEXTURE_2D,1,Ke,Be.width,Be.height):t.texImage2D(i.TEXTURE_2D,0,Ke,Be.width,Be.height,0,Fe,Je,null));else if(L.isDataTexture)if(Gt.length>0){te&&$e&&t.texStorage2D(i.TEXTURE_2D,Qe,Ke,Gt[0].width,Gt[0].height);for(let Oe=0,De=Gt.length;Oe<De;Oe++)We=Gt[Oe],te?Ie&&t.texSubImage2D(i.TEXTURE_2D,Oe,0,0,We.width,We.height,Fe,Je,We.data):t.texImage2D(i.TEXTURE_2D,Oe,Ke,We.width,We.height,0,Fe,Je,We.data);L.generateMipmaps=!1}else te?($e&&t.texStorage2D(i.TEXTURE_2D,Qe,Ke,Be.width,Be.height),Ie&&Z(L,Be,Fe,Je)):t.texImage2D(i.TEXTURE_2D,0,Ke,Be.width,Be.height,0,Fe,Je,Be.data);else if(L.isCompressedTexture)if(L.isCompressedArrayTexture){te&&$e&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Qe,Ke,Gt[0].width,Gt[0].height,Be.depth);for(let Oe=0,De=Gt.length;Oe<De;Oe++)if(We=Gt[Oe],L.format!==si)if(Fe!==null)if(te){if(Ie)if(L.layerUpdates.size>0){const Ve=Mb(We.width,We.height,L.format,L.type);for(const Rt of L.layerUpdates){const bn=We.data.subarray(Rt*Ve/We.data.BYTES_PER_ELEMENT,(Rt+1)*Ve/We.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Oe,0,0,Rt,We.width,We.height,1,Fe,bn)}L.clearLayerUpdates()}else t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Oe,0,0,0,We.width,We.height,Be.depth,Fe,We.data)}else t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,Oe,Ke,We.width,We.height,Be.depth,0,We.data,0,0);else Ae("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else te?Ie&&t.texSubImage3D(i.TEXTURE_2D_ARRAY,Oe,0,0,0,We.width,We.height,Be.depth,Fe,Je,We.data):t.texImage3D(i.TEXTURE_2D_ARRAY,Oe,Ke,We.width,We.height,Be.depth,0,Fe,Je,We.data)}else{te&&$e&&t.texStorage2D(i.TEXTURE_2D,Qe,Ke,Gt[0].width,Gt[0].height);for(let Oe=0,De=Gt.length;Oe<De;Oe++)We=Gt[Oe],L.format!==si?Fe!==null?te?Ie&&t.compressedTexSubImage2D(i.TEXTURE_2D,Oe,0,0,We.width,We.height,Fe,We.data):t.compressedTexImage2D(i.TEXTURE_2D,Oe,Ke,We.width,We.height,0,We.data):Ae("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):te?Ie&&t.texSubImage2D(i.TEXTURE_2D,Oe,0,0,We.width,We.height,Fe,Je,We.data):t.texImage2D(i.TEXTURE_2D,Oe,Ke,We.width,We.height,0,Fe,Je,We.data)}else if(L.isDataArrayTexture)if(te){if($e&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Qe,Ke,Be.width,Be.height,Be.depth),Ie)if(L.layerUpdates.size>0){const Oe=Mb(Be.width,Be.height,L.format,L.type);for(const De of L.layerUpdates){const Ve=Be.data.subarray(De*Oe/Be.data.BYTES_PER_ELEMENT,(De+1)*Oe/Be.data.BYTES_PER_ELEMENT);t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,De,Be.width,Be.height,1,Fe,Je,Ve)}L.clearLayerUpdates()}else t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,Be.width,Be.height,Be.depth,Fe,Je,Be.data)}else t.texImage3D(i.TEXTURE_2D_ARRAY,0,Ke,Be.width,Be.height,Be.depth,0,Fe,Je,Be.data);else if(L.isData3DTexture)te?($e&&t.texStorage3D(i.TEXTURE_3D,Qe,Ke,Be.width,Be.height,Be.depth),Ie&&t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,Be.width,Be.height,Be.depth,Fe,Je,Be.data)):t.texImage3D(i.TEXTURE_3D,0,Ke,Be.width,Be.height,Be.depth,0,Fe,Je,Be.data);else if(L.isFramebufferTexture){if($e)if(te)t.texStorage2D(i.TEXTURE_2D,Qe,Ke,Be.width,Be.height);else{let Oe=Be.width,De=Be.height;for(let Ve=0;Ve<Qe;Ve++)t.texImage2D(i.TEXTURE_2D,Ve,Ke,Oe,De,0,Fe,Je,null),Oe>>=1,De>>=1}}else if(Gt.length>0){if(te&&$e){const Oe=lt(Gt[0]);t.texStorage2D(i.TEXTURE_2D,Qe,Ke,Oe.width,Oe.height)}for(let Oe=0,De=Gt.length;Oe<De;Oe++)We=Gt[Oe],te?Ie&&t.texSubImage2D(i.TEXTURE_2D,Oe,0,0,Fe,Je,We):t.texImage2D(i.TEXTURE_2D,Oe,Ke,Fe,Je,We);L.generateMipmaps=!1}else if(te){if($e){const Oe=lt(Be);t.texStorage2D(i.TEXTURE_2D,Qe,Ke,Oe.width,Oe.height)}Ie&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,Fe,Je,Be)}else t.texImage2D(i.TEXTURE_2D,0,Ke,Fe,Je,Be);b(L)&&x(Ee),ft.__version=Se.version,L.onUpdate&&L.onUpdate(L)}V.__version=L.version}function ie(V,L,re){if(L.image.length!==6)return;const Ee=ue(V,L),Pe=L.source;t.bindTexture(i.TEXTURE_CUBE_MAP,V.__webglTexture,i.TEXTURE0+re);const Se=n.get(Pe);if(Pe.version!==Se.__version||Ee===!0){t.activeTexture(i.TEXTURE0+re);const ft=vt.getPrimaries(vt.workingColorSpace),He=L.colorSpace===Rr?null:vt.getPrimaries(L.colorSpace),st=L.colorSpace===Rr||ft===He?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,L.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,L.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,L.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,st);const At=L.isCompressedTexture||L.image[0].isCompressedTexture,Be=L.image[0]&&L.image[0].isDataTexture,Fe=[];for(let De=0;De<6;De++)!At&&!Be?Fe[De]=T(L.image[De],!0,r.maxCubemapSize):Fe[De]=Be?L.image[De].image:L.image[De],Fe[De]=mn(L,Fe[De]);const Je=Fe[0],Ke=s.convert(L.format,L.colorSpace),We=s.convert(L.type),Gt=E(L.internalFormat,Ke,We,L.colorSpace),te=L.isVideoTexture!==!0,$e=Se.__version===void 0||Ee===!0,Ie=Pe.dataReady;let Qe=C(L,Je);Y(i.TEXTURE_CUBE_MAP,L);let Oe;if(At){te&&$e&&t.texStorage2D(i.TEXTURE_CUBE_MAP,Qe,Gt,Je.width,Je.height);for(let De=0;De<6;De++){Oe=Fe[De].mipmaps;for(let Ve=0;Ve<Oe.length;Ve++){const Rt=Oe[Ve];L.format!==si?Ke!==null?te?Ie&&t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ve,0,0,Rt.width,Rt.height,Ke,Rt.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ve,Gt,Rt.width,Rt.height,0,Rt.data):Ae("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):te?Ie&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ve,0,0,Rt.width,Rt.height,Ke,We,Rt.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ve,Gt,Rt.width,Rt.height,0,Ke,We,Rt.data)}}}else{if(Oe=L.mipmaps,te&&$e){Oe.length>0&&Qe++;const De=lt(Fe[0]);t.texStorage2D(i.TEXTURE_CUBE_MAP,Qe,Gt,De.width,De.height)}for(let De=0;De<6;De++)if(Be){te?Ie&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,0,0,Fe[De].width,Fe[De].height,Ke,We,Fe[De].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,Gt,Fe[De].width,Fe[De].height,0,Ke,We,Fe[De].data);for(let Ve=0;Ve<Oe.length;Ve++){const bn=Oe[Ve].image[De].image;te?Ie&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ve+1,0,0,bn.width,bn.height,Ke,We,bn.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ve+1,Gt,bn.width,bn.height,0,Ke,We,bn.data)}}else{te?Ie&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,0,0,Ke,We,Fe[De]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,Gt,Ke,We,Fe[De]);for(let Ve=0;Ve<Oe.length;Ve++){const Rt=Oe[Ve];te?Ie&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ve+1,0,0,Ke,We,Rt.image[De]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ve+1,Gt,Ke,We,Rt.image[De])}}}b(L)&&x(i.TEXTURE_CUBE_MAP),Se.__version=Pe.version,L.onUpdate&&L.onUpdate(L)}V.__version=L.version}function Le(V,L,re,Ee,Pe,Se){const ft=s.convert(re.format,re.colorSpace),He=s.convert(re.type),st=E(re.internalFormat,ft,He,re.colorSpace),At=n.get(L),Be=n.get(re);if(Be.__renderTarget=L,!At.__hasExternalTextures){const Fe=Math.max(1,L.width>>Se),Je=Math.max(1,L.height>>Se);Pe===i.TEXTURE_3D||Pe===i.TEXTURE_2D_ARRAY?t.texImage3D(Pe,Se,st,Fe,Je,L.depth,0,ft,He,null):t.texImage2D(Pe,Se,st,Fe,Je,0,ft,He,null)}t.bindFramebuffer(i.FRAMEBUFFER,V),jn(L)?u.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,Ee,Pe,Be.__webglTexture,0,K(L)):(Pe===i.TEXTURE_2D||Pe>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&Pe<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,Ee,Pe,Be.__webglTexture,Se),t.bindFramebuffer(i.FRAMEBUFFER,null)}function ke(V,L,re){if(i.bindRenderbuffer(i.RENDERBUFFER,V),L.depthBuffer){const Ee=L.depthTexture,Pe=Ee&&Ee.isDepthTexture?Ee.type:null,Se=w(L.stencilBuffer,Pe),ft=L.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;jn(L)?u.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,K(L),Se,L.width,L.height):re?i.renderbufferStorageMultisample(i.RENDERBUFFER,K(L),Se,L.width,L.height):i.renderbufferStorage(i.RENDERBUFFER,Se,L.width,L.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,ft,i.RENDERBUFFER,V)}else{const Ee=L.textures;for(let Pe=0;Pe<Ee.length;Pe++){const Se=Ee[Pe],ft=s.convert(Se.format,Se.colorSpace),He=s.convert(Se.type),st=E(Se.internalFormat,ft,He,Se.colorSpace);jn(L)?u.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,K(L),st,L.width,L.height):re?i.renderbufferStorageMultisample(i.RENDERBUFFER,K(L),st,L.width,L.height):i.renderbufferStorage(i.RENDERBUFFER,st,L.width,L.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function ze(V,L,re){const Ee=L.isWebGLCubeRenderTarget===!0;if(t.bindFramebuffer(i.FRAMEBUFFER,V),!(L.depthTexture&&L.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Pe=n.get(L.depthTexture);if(Pe.__renderTarget=L,(!Pe.__webglTexture||L.depthTexture.image.width!==L.width||L.depthTexture.image.height!==L.height)&&(L.depthTexture.image.width=L.width,L.depthTexture.image.height=L.height,L.depthTexture.needsUpdate=!0),Ee){if(Pe.__webglInit===void 0&&(Pe.__webglInit=!0,L.depthTexture.addEventListener("dispose",N)),Pe.__webglTexture===void 0){Pe.__webglTexture=i.createTexture(),t.bindTexture(i.TEXTURE_CUBE_MAP,Pe.__webglTexture),Y(i.TEXTURE_CUBE_MAP,L.depthTexture);const At=s.convert(L.depthTexture.format),Be=s.convert(L.depthTexture.type);let Fe;L.depthTexture.format===ji?Fe=i.DEPTH_COMPONENT24:L.depthTexture.format===pr&&(Fe=i.DEPTH24_STENCIL8);for(let Je=0;Je<6;Je++)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Je,0,Fe,L.width,L.height,0,At,Be,null)}}else ne(L.depthTexture,0);const Se=Pe.__webglTexture,ft=K(L),He=Ee?i.TEXTURE_CUBE_MAP_POSITIVE_X+re:i.TEXTURE_2D,st=L.depthTexture.format===pr?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;if(L.depthTexture.format===ji)jn(L)?u.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,st,He,Se,0,ft):i.framebufferTexture2D(i.FRAMEBUFFER,st,He,Se,0);else if(L.depthTexture.format===pr)jn(L)?u.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,st,He,Se,0,ft):i.framebufferTexture2D(i.FRAMEBUFFER,st,He,Se,0);else throw new Error("Unknown depthTexture format")}function ht(V){const L=n.get(V),re=V.isWebGLCubeRenderTarget===!0;if(L.__boundDepthTexture!==V.depthTexture){const Ee=V.depthTexture;if(L.__depthDisposeCallback&&L.__depthDisposeCallback(),Ee){const Pe=()=>{delete L.__boundDepthTexture,delete L.__depthDisposeCallback,Ee.removeEventListener("dispose",Pe)};Ee.addEventListener("dispose",Pe),L.__depthDisposeCallback=Pe}L.__boundDepthTexture=Ee}if(V.depthTexture&&!L.__autoAllocateDepthBuffer)if(re)for(let Ee=0;Ee<6;Ee++)ze(L.__webglFramebuffer[Ee],V,Ee);else{const Ee=V.texture.mipmaps;Ee&&Ee.length>0?ze(L.__webglFramebuffer[0],V,0):ze(L.__webglFramebuffer,V,0)}else if(re){L.__webglDepthbuffer=[];for(let Ee=0;Ee<6;Ee++)if(t.bindFramebuffer(i.FRAMEBUFFER,L.__webglFramebuffer[Ee]),L.__webglDepthbuffer[Ee]===void 0)L.__webglDepthbuffer[Ee]=i.createRenderbuffer(),ke(L.__webglDepthbuffer[Ee],V,!1);else{const Pe=V.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Se=L.__webglDepthbuffer[Ee];i.bindRenderbuffer(i.RENDERBUFFER,Se),i.framebufferRenderbuffer(i.FRAMEBUFFER,Pe,i.RENDERBUFFER,Se)}}else{const Ee=V.texture.mipmaps;if(Ee&&Ee.length>0?t.bindFramebuffer(i.FRAMEBUFFER,L.__webglFramebuffer[0]):t.bindFramebuffer(i.FRAMEBUFFER,L.__webglFramebuffer),L.__webglDepthbuffer===void 0)L.__webglDepthbuffer=i.createRenderbuffer(),ke(L.__webglDepthbuffer,V,!1);else{const Pe=V.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Se=L.__webglDepthbuffer;i.bindRenderbuffer(i.RENDERBUFFER,Se),i.framebufferRenderbuffer(i.FRAMEBUFFER,Pe,i.RENDERBUFFER,Se)}}t.bindFramebuffer(i.FRAMEBUFFER,null)}function nn(V,L,re){const Ee=n.get(V);L!==void 0&&Le(Ee.__webglFramebuffer,V,V.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),re!==void 0&&ht(V)}function Pt(V){const L=V.texture,re=n.get(V),Ee=n.get(L);V.addEventListener("dispose",D);const Pe=V.textures,Se=V.isWebGLCubeRenderTarget===!0,ft=Pe.length>1;if(ft||(Ee.__webglTexture===void 0&&(Ee.__webglTexture=i.createTexture()),Ee.__version=L.version,o.memory.textures++),Se){re.__webglFramebuffer=[];for(let He=0;He<6;He++)if(L.mipmaps&&L.mipmaps.length>0){re.__webglFramebuffer[He]=[];for(let st=0;st<L.mipmaps.length;st++)re.__webglFramebuffer[He][st]=i.createFramebuffer()}else re.__webglFramebuffer[He]=i.createFramebuffer()}else{if(L.mipmaps&&L.mipmaps.length>0){re.__webglFramebuffer=[];for(let He=0;He<L.mipmaps.length;He++)re.__webglFramebuffer[He]=i.createFramebuffer()}else re.__webglFramebuffer=i.createFramebuffer();if(ft)for(let He=0,st=Pe.length;He<st;He++){const At=n.get(Pe[He]);At.__webglTexture===void 0&&(At.__webglTexture=i.createTexture(),o.memory.textures++)}if(V.samples>0&&jn(V)===!1){re.__webglMultisampledFramebuffer=i.createFramebuffer(),re.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,re.__webglMultisampledFramebuffer);for(let He=0;He<Pe.length;He++){const st=Pe[He];re.__webglColorRenderbuffer[He]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,re.__webglColorRenderbuffer[He]);const At=s.convert(st.format,st.colorSpace),Be=s.convert(st.type),Fe=E(st.internalFormat,At,Be,st.colorSpace,V.isXRRenderTarget===!0),Je=K(V);i.renderbufferStorageMultisample(i.RENDERBUFFER,Je,Fe,V.width,V.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+He,i.RENDERBUFFER,re.__webglColorRenderbuffer[He])}i.bindRenderbuffer(i.RENDERBUFFER,null),V.depthBuffer&&(re.__webglDepthRenderbuffer=i.createRenderbuffer(),ke(re.__webglDepthRenderbuffer,V,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(Se){t.bindTexture(i.TEXTURE_CUBE_MAP,Ee.__webglTexture),Y(i.TEXTURE_CUBE_MAP,L);for(let He=0;He<6;He++)if(L.mipmaps&&L.mipmaps.length>0)for(let st=0;st<L.mipmaps.length;st++)Le(re.__webglFramebuffer[He][st],V,L,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+He,st);else Le(re.__webglFramebuffer[He],V,L,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+He,0);b(L)&&x(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(ft){for(let He=0,st=Pe.length;He<st;He++){const At=Pe[He],Be=n.get(At);let Fe=i.TEXTURE_2D;(V.isWebGL3DRenderTarget||V.isWebGLArrayRenderTarget)&&(Fe=V.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(Fe,Be.__webglTexture),Y(Fe,At),Le(re.__webglFramebuffer,V,At,i.COLOR_ATTACHMENT0+He,Fe,0),b(At)&&x(Fe)}t.unbindTexture()}else{let He=i.TEXTURE_2D;if((V.isWebGL3DRenderTarget||V.isWebGLArrayRenderTarget)&&(He=V.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(He,Ee.__webglTexture),Y(He,L),L.mipmaps&&L.mipmaps.length>0)for(let st=0;st<L.mipmaps.length;st++)Le(re.__webglFramebuffer[st],V,L,i.COLOR_ATTACHMENT0,He,st);else Le(re.__webglFramebuffer,V,L,i.COLOR_ATTACHMENT0,He,0);b(L)&&x(He),t.unbindTexture()}V.depthBuffer&&ht(V)}function wt(V){const L=V.textures;for(let re=0,Ee=L.length;re<Ee;re++){const Pe=L[re];if(b(Pe)){const Se=M(V),ft=n.get(Pe).__webglTexture;t.bindTexture(Se,ft),x(Se),t.unbindTexture()}}}const qt=[],Mt=[];function un(V){if(V.samples>0){if(jn(V)===!1){const L=V.textures,re=V.width,Ee=V.height;let Pe=i.COLOR_BUFFER_BIT;const Se=V.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,ft=n.get(V),He=L.length>1;if(He)for(let At=0;At<L.length;At++)t.bindFramebuffer(i.FRAMEBUFFER,ft.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+At,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,ft.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+At,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,ft.__webglMultisampledFramebuffer);const st=V.texture.mipmaps;st&&st.length>0?t.bindFramebuffer(i.DRAW_FRAMEBUFFER,ft.__webglFramebuffer[0]):t.bindFramebuffer(i.DRAW_FRAMEBUFFER,ft.__webglFramebuffer);for(let At=0;At<L.length;At++){if(V.resolveDepthBuffer&&(V.depthBuffer&&(Pe|=i.DEPTH_BUFFER_BIT),V.stencilBuffer&&V.resolveStencilBuffer&&(Pe|=i.STENCIL_BUFFER_BIT)),He){i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,ft.__webglColorRenderbuffer[At]);const Be=n.get(L[At]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,Be,0)}i.blitFramebuffer(0,0,re,Ee,0,0,re,Ee,Pe,i.NEAREST),c===!0&&(qt.length=0,Mt.length=0,qt.push(i.COLOR_ATTACHMENT0+At),V.depthBuffer&&V.resolveDepthBuffer===!1&&(qt.push(Se),Mt.push(Se),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,Mt)),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,qt))}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),He)for(let At=0;At<L.length;At++){t.bindFramebuffer(i.FRAMEBUFFER,ft.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+At,i.RENDERBUFFER,ft.__webglColorRenderbuffer[At]);const Be=n.get(L[At]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,ft.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+At,i.TEXTURE_2D,Be,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,ft.__webglMultisampledFramebuffer)}else if(V.depthBuffer&&V.resolveDepthBuffer===!1&&c){const L=V.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[L])}}}function K(V){return Math.min(r.maxSamples,V.samples)}function jn(V){const L=n.get(V);return V.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&L.__useRenderToTexture!==!1}function en(V){const L=o.render.frame;d.get(V)!==L&&(d.set(V,L),V.update())}function mn(V,L){const re=V.colorSpace,Ee=V.format,Pe=V.type;return V.isCompressedTexture===!0||V.isVideoTexture===!0||re!==mu&&re!==Rr&&(vt.getTransfer(re)===Ye?(Ee!==si||Pe!==Hn)&&Ae("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):Re("WebGLTextures: Unsupported texture color space:",re)),L}function lt(V){return typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement?(h.width=V.naturalWidth||V.width,h.height=V.naturalHeight||V.height):typeof VideoFrame<"u"&&V instanceof VideoFrame?(h.width=V.displayWidth,h.height=V.displayHeight):(h.width=V.width,h.height=V.height),h}this.allocateTextureUnit=X,this.resetTextureUnits=H,this.setTexture2D=ne,this.setTexture2DArray=G,this.setTexture3D=z,this.setTextureCube=q,this.rebindTextures=nn,this.setupRenderTarget=Pt,this.updateRenderTargetMipmap=wt,this.updateMultisampleRenderTarget=un,this.setupDepthRenderbuffer=ht,this.setupFrameBufferTexture=Le,this.useMultisampledRTT=jn,this.isReversedDepthBuffer=function(){return t.buffers.depth.getReversed()}}function a4(i,e){function t(n,r=Rr){let s;const o=vt.getTransfer(r);if(n===Hn)return i.UNSIGNED_BYTE;if(n===z_)return i.UNSIGNED_SHORT_4_4_4_4;if(n===G_)return i.UNSIGNED_SHORT_5_5_5_1;if(n===k_)return i.UNSIGNED_INT_5_9_9_9_REV;if(n===V_)return i.UNSIGNED_INT_10F_11F_11F_REV;if(n===iu)return i.BYTE;if(n===ru)return i.SHORT;if(n===Is)return i.UNSIGNED_SHORT;if(n===Ni)return i.INT;if(n===yn)return i.UNSIGNED_INT;if(n===ri)return i.FLOAT;if(n===Zn)return i.HALF_FLOAT;if(n===BS)return i.ALPHA;if(n===Tp)return i.RGB;if(n===si)return i.RGBA;if(n===ji)return i.DEPTH_COMPONENT;if(n===pr)return i.DEPTH_STENCIL;if(n===Mp)return i.RED;if(n===kh)return i.RED_INTEGER;if(n===mr)return i.RG;if(n===Vh)return i.RG_INTEGER;if(n===Hh)return i.RGBA_INTEGER;if(n===sl||n===al||n===ol||n===ll)if(o===Ye)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(n===sl)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===al)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===ol)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===ll)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(n===sl)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===al)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===ol)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===ll)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===lp||n===up||n===cp||n===hp)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(n===lp)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===up)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===cp)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===hp)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===sh||n===ah||n===oh||n===lh||n===uh||n===du||n===ch)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(n===sh||n===ah)return o===Ye?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===oh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC;if(n===lh)return s.COMPRESSED_R11_EAC;if(n===uh)return s.COMPRESSED_SIGNED_R11_EAC;if(n===du)return s.COMPRESSED_RG11_EAC;if(n===ch)return s.COMPRESSED_SIGNED_RG11_EAC}else return null;if(n===hh||n===fh||n===dh||n===ph||n===mh||n===gh||n===_h||n===vh||n===yh||n===xh||n===bh||n===Sh||n===Th||n===Mh)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(n===hh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===fh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===dh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===ph)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===mh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===gh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===_h)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===vh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===yh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===xh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===bh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Sh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Th)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Mh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===Eh||n===xb||n===bb)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(n===Eh)return o===Ye?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===xb)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===bb)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===Ah||n===wh||n===pu||n===Rh)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(n===Ah)return s.COMPRESSED_RED_RGTC1_EXT;if(n===wh)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===pu)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Rh)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===ts?i.UNSIGNED_INT_24_8:i[n]!==void 0?i[n]:null}return{convert:t}}const o4=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,l4=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class u4{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const n=new t2(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new bs({vertexShader:o4,fragmentShader:l4,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new yi(new Lp(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class c4 extends xa{constructor(e,t){super();const n=this;let r=null,s=1,o=null,u="local-floor",c=1,h=null,d=null,p=null,g=null,_=null,v=null;const T=typeof XRWebGLBinding<"u",b=new u4,x={},M=t.getContextAttributes();let E=null,w=null;const C=[],N=[],D=new Ue;let U=null;const R=new Di;R.viewport=new Lt;const P=new Di;P.viewport=new Lt;const I=[R,P],H=new l2;let X=null,J=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(W){let ie=C[W];return ie===void 0&&(ie=new a_,C[W]=ie),ie.getTargetRaySpace()},this.getControllerGrip=function(W){let ie=C[W];return ie===void 0&&(ie=new a_,C[W]=ie),ie.getGripSpace()},this.getHand=function(W){let ie=C[W];return ie===void 0&&(ie=new a_,C[W]=ie),ie.getHandSpace()};function ne(W){const ie=N.indexOf(W.inputSource);if(ie===-1)return;const Le=C[ie];Le!==void 0&&(Le.update(W.inputSource,W.frame,h||o),Le.dispatchEvent({type:W.type,data:W.inputSource}))}function G(){r.removeEventListener("select",ne),r.removeEventListener("selectstart",ne),r.removeEventListener("selectend",ne),r.removeEventListener("squeeze",ne),r.removeEventListener("squeezestart",ne),r.removeEventListener("squeezeend",ne),r.removeEventListener("end",G),r.removeEventListener("inputsourceschange",z);for(let W=0;W<C.length;W++){const ie=N[W];ie!==null&&(N[W]=null,C[W].disconnect(ie))}X=null,J=null,b.reset();for(const W in x)delete x[W];e.setRenderTarget(E),_=null,g=null,p=null,r=null,w=null,Z.stop(),n.isPresenting=!1,e.setPixelRatio(U),e.setSize(D.width,D.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(W){s=W,n.isPresenting===!0&&Ae("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(W){u=W,n.isPresenting===!0&&Ae("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||o},this.setReferenceSpace=function(W){h=W},this.getBaseLayer=function(){return g!==null?g:_},this.getBinding=function(){return p===null&&T&&(p=new XRWebGLBinding(r,t)),p},this.getFrame=function(){return v},this.getSession=function(){return r},this.setSession=async function(W){if(r=W,r!==null){if(E=e.getRenderTarget(),r.addEventListener("select",ne),r.addEventListener("selectstart",ne),r.addEventListener("selectend",ne),r.addEventListener("squeeze",ne),r.addEventListener("squeezestart",ne),r.addEventListener("squeezeend",ne),r.addEventListener("end",G),r.addEventListener("inputsourceschange",z),M.xrCompatible!==!0&&await t.makeXRCompatible(),U=e.getPixelRatio(),e.getSize(D),T&&"createProjectionLayer"in XRWebGLBinding.prototype){let Le=null,ke=null,ze=null;M.depth&&(ze=M.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Le=M.stencil?pr:ji,ke=M.stencil?ts:yn);const ht={colorFormat:t.RGBA8,depthFormat:ze,scaleFactor:s};p=this.getBinding(),g=p.createProjectionLayer(ht),r.updateRenderState({layers:[g]}),e.setPixelRatio(1),e.setSize(g.textureWidth,g.textureHeight,!1),w=new Gs(g.textureWidth,g.textureHeight,{format:si,type:Hn,depthTexture:new vr(g.textureWidth,g.textureHeight,ke,void 0,void 0,void 0,void 0,void 0,void 0,Le),stencilBuffer:M.stencil,colorSpace:e.outputColorSpace,samples:M.antialias?4:0,resolveDepthBuffer:g.ignoreDepthValues===!1,resolveStencilBuffer:g.ignoreDepthValues===!1})}else{const Le={antialias:M.antialias,alpha:!0,depth:M.depth,stencil:M.stencil,framebufferScaleFactor:s};_=new XRWebGLLayer(r,t,Le),r.updateRenderState({baseLayer:_}),e.setPixelRatio(1),e.setSize(_.framebufferWidth,_.framebufferHeight,!1),w=new Gs(_.framebufferWidth,_.framebufferHeight,{format:si,type:Hn,colorSpace:e.outputColorSpace,stencilBuffer:M.stencil,resolveDepthBuffer:_.ignoreDepthValues===!1,resolveStencilBuffer:_.ignoreDepthValues===!1})}w.isXRRenderTarget=!0,this.setFoveation(c),h=null,o=await r.requestReferenceSpace(u),Z.setContext(r),Z.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return b.getDepthTexture()};function z(W){for(let ie=0;ie<W.removed.length;ie++){const Le=W.removed[ie],ke=N.indexOf(Le);ke>=0&&(N[ke]=null,C[ke].disconnect(Le))}for(let ie=0;ie<W.added.length;ie++){const Le=W.added[ie];let ke=N.indexOf(Le);if(ke===-1){for(let ht=0;ht<C.length;ht++)if(ht>=N.length){N.push(Le),ke=ht;break}else if(N[ht]===null){N[ht]=Le,ke=ht;break}if(ke===-1)break}const ze=C[ke];ze&&ze.connect(Le)}}const q=new k,ce=new k;function xe(W,ie,Le){q.setFromMatrixPosition(ie.matrixWorld),ce.setFromMatrixPosition(Le.matrixWorld);const ke=q.distanceTo(ce),ze=ie.projectionMatrix.elements,ht=Le.projectionMatrix.elements,nn=ze[14]/(ze[10]-1),Pt=ze[14]/(ze[10]+1),wt=(ze[9]+1)/ze[5],qt=(ze[9]-1)/ze[5],Mt=(ze[8]-1)/ze[0],un=(ht[8]+1)/ht[0],K=nn*Mt,jn=nn*un,en=ke/(-Mt+un),mn=en*-Mt;if(ie.matrixWorld.decompose(W.position,W.quaternion,W.scale),W.translateX(mn),W.translateZ(en),W.matrixWorld.compose(W.position,W.quaternion,W.scale),W.matrixWorldInverse.copy(W.matrixWorld).invert(),ze[10]===-1)W.projectionMatrix.copy(ie.projectionMatrix),W.projectionMatrixInverse.copy(ie.projectionMatrixInverse);else{const lt=nn+en,V=Pt+en,L=K-mn,re=jn+(ke-mn),Ee=wt*Pt/V*lt,Pe=qt*Pt/V*lt;W.projectionMatrix.makePerspective(L,re,Ee,Pe,lt,V),W.projectionMatrixInverse.copy(W.projectionMatrix).invert()}}function O(W,ie){ie===null?W.matrixWorld.copy(W.matrix):W.matrixWorld.multiplyMatrices(ie.matrixWorld,W.matrix),W.matrixWorldInverse.copy(W.matrixWorld).invert()}this.updateCamera=function(W){if(r===null)return;let ie=W.near,Le=W.far;b.texture!==null&&(b.depthNear>0&&(ie=b.depthNear),b.depthFar>0&&(Le=b.depthFar)),H.near=P.near=R.near=ie,H.far=P.far=R.far=Le,(X!==H.near||J!==H.far)&&(r.updateRenderState({depthNear:H.near,depthFar:H.far}),X=H.near,J=H.far),H.layers.mask=W.layers.mask|6,R.layers.mask=H.layers.mask&3,P.layers.mask=H.layers.mask&5;const ke=W.parent,ze=H.cameras;O(H,ke);for(let ht=0;ht<ze.length;ht++)O(ze[ht],ke);ze.length===2?xe(H,R,P):H.projectionMatrix.copy(R.projectionMatrix),Y(W,H,ke)};function Y(W,ie,Le){Le===null?W.matrix.copy(ie.matrixWorld):(W.matrix.copy(Le.matrixWorld),W.matrix.invert(),W.matrix.multiply(ie.matrixWorld)),W.matrix.decompose(W.position,W.quaternion,W.scale),W.updateMatrixWorld(!0),W.projectionMatrix.copy(ie.projectionMatrix),W.projectionMatrixInverse.copy(ie.projectionMatrixInverse),W.isPerspectiveCamera&&(W.fov=gu*2*Math.atan(1/W.projectionMatrix.elements[5]),W.zoom=1)}this.getCamera=function(){return H},this.getFoveation=function(){if(!(g===null&&_===null))return c},this.setFoveation=function(W){c=W,g!==null&&(g.fixedFoveation=W),_!==null&&_.fixedFoveation!==void 0&&(_.fixedFoveation=W)},this.hasDepthSensing=function(){return b.texture!==null},this.getDepthSensingMesh=function(){return b.getMesh(H)},this.getCameraTexture=function(W){return x[W]};let ue=null;function Ne(W,ie){if(d=ie.getViewerPose(h||o),v=ie,d!==null){const Le=d.views;_!==null&&(e.setRenderTargetFramebuffer(w,_.framebuffer),e.setRenderTarget(w));let ke=!1;Le.length!==H.cameras.length&&(H.cameras.length=0,ke=!0);for(let Pt=0;Pt<Le.length;Pt++){const wt=Le[Pt];let qt=null;if(_!==null)qt=_.getViewport(wt);else{const un=p.getViewSubImage(g,wt);qt=un.viewport,Pt===0&&(e.setRenderTargetTextures(w,un.colorTexture,un.depthStencilTexture),e.setRenderTarget(w))}let Mt=I[Pt];Mt===void 0&&(Mt=new Di,Mt.layers.enable(Pt),Mt.viewport=new Lt,I[Pt]=Mt),Mt.matrix.fromArray(wt.transform.matrix),Mt.matrix.decompose(Mt.position,Mt.quaternion,Mt.scale),Mt.projectionMatrix.fromArray(wt.projectionMatrix),Mt.projectionMatrixInverse.copy(Mt.projectionMatrix).invert(),Mt.viewport.set(qt.x,qt.y,qt.width,qt.height),Pt===0&&(H.matrix.copy(Mt.matrix),H.matrix.decompose(H.position,H.quaternion,H.scale)),ke===!0&&H.cameras.push(Mt)}const ze=r.enabledFeatures;if(ze&&ze.includes("depth-sensing")&&r.depthUsage=="gpu-optimized"&&T){p=n.getBinding();const Pt=p.getDepthInformation(Le[0]);Pt&&Pt.isValid&&Pt.texture&&b.init(Pt,r.renderState)}if(ze&&ze.includes("camera-access")&&T){e.state.unbindTexture(),p=n.getBinding();for(let Pt=0;Pt<Le.length;Pt++){const wt=Le[Pt].camera;if(wt){let qt=x[wt];qt||(qt=new t2,x[wt]=qt);const Mt=p.getCameraImage(wt);qt.sourceTexture=Mt}}}}for(let Le=0;Le<C.length;Le++){const ke=N[Le],ze=C[Le];ke!==null&&ze!==void 0&&ze.update(ke,ie,h||o)}ue&&ue(W,ie),ie.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:ie}),v=null}const Z=new h2;Z.setAnimationLoop(Ne),this.setAnimationLoop=function(W){ue=W},this.dispose=function(){}}}const kl=new Or,h4=new Ht;function f4(i,e){function t(b,x){b.matrixAutoUpdate===!0&&b.updateMatrix(),x.value.copy(b.matrix)}function n(b,x){x.color.getRGB(b.fogColor.value,YN(i)),x.isFog?(b.fogNear.value=x.near,b.fogFar.value=x.far):x.isFogExp2&&(b.fogDensity.value=x.density)}function r(b,x,M,E,w){x.isMeshBasicMaterial||x.isMeshLambertMaterial?s(b,x):x.isMeshToonMaterial?(s(b,x),p(b,x)):x.isMeshPhongMaterial?(s(b,x),d(b,x)):x.isMeshStandardMaterial?(s(b,x),g(b,x),x.isMeshPhysicalMaterial&&_(b,x,w)):x.isMeshMatcapMaterial?(s(b,x),v(b,x)):x.isMeshDepthMaterial?s(b,x):x.isMeshDistanceMaterial?(s(b,x),T(b,x)):x.isMeshNormalMaterial?s(b,x):x.isLineBasicMaterial?(o(b,x),x.isLineDashedMaterial&&u(b,x)):x.isPointsMaterial?c(b,x,M,E):x.isSpriteMaterial?h(b,x):x.isShadowMaterial?(b.color.value.copy(x.color),b.opacity.value=x.opacity):x.isShaderMaterial&&(x.uniformsNeedUpdate=!1)}function s(b,x){b.opacity.value=x.opacity,x.color&&b.diffuse.value.copy(x.color),x.emissive&&b.emissive.value.copy(x.emissive).multiplyScalar(x.emissiveIntensity),x.map&&(b.map.value=x.map,t(x.map,b.mapTransform)),x.alphaMap&&(b.alphaMap.value=x.alphaMap,t(x.alphaMap,b.alphaMapTransform)),x.bumpMap&&(b.bumpMap.value=x.bumpMap,t(x.bumpMap,b.bumpMapTransform),b.bumpScale.value=x.bumpScale,x.side===Pn&&(b.bumpScale.value*=-1)),x.normalMap&&(b.normalMap.value=x.normalMap,t(x.normalMap,b.normalMapTransform),b.normalScale.value.copy(x.normalScale),x.side===Pn&&b.normalScale.value.negate()),x.displacementMap&&(b.displacementMap.value=x.displacementMap,t(x.displacementMap,b.displacementMapTransform),b.displacementScale.value=x.displacementScale,b.displacementBias.value=x.displacementBias),x.emissiveMap&&(b.emissiveMap.value=x.emissiveMap,t(x.emissiveMap,b.emissiveMapTransform)),x.specularMap&&(b.specularMap.value=x.specularMap,t(x.specularMap,b.specularMapTransform)),x.alphaTest>0&&(b.alphaTest.value=x.alphaTest);const M=e.get(x),E=M.envMap,w=M.envMapRotation;E&&(b.envMap.value=E,kl.copy(w),kl.x*=-1,kl.y*=-1,kl.z*=-1,E.isCubeTexture&&E.isRenderTargetTexture===!1&&(kl.y*=-1,kl.z*=-1),b.envMapRotation.value.setFromMatrix4(h4.makeRotationFromEuler(kl)),b.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,b.reflectivity.value=x.reflectivity,b.ior.value=x.ior,b.refractionRatio.value=x.refractionRatio),x.lightMap&&(b.lightMap.value=x.lightMap,b.lightMapIntensity.value=x.lightMapIntensity,t(x.lightMap,b.lightMapTransform)),x.aoMap&&(b.aoMap.value=x.aoMap,b.aoMapIntensity.value=x.aoMapIntensity,t(x.aoMap,b.aoMapTransform))}function o(b,x){b.diffuse.value.copy(x.color),b.opacity.value=x.opacity,x.map&&(b.map.value=x.map,t(x.map,b.mapTransform))}function u(b,x){b.dashSize.value=x.dashSize,b.totalSize.value=x.dashSize+x.gapSize,b.scale.value=x.scale}function c(b,x,M,E){b.diffuse.value.copy(x.color),b.opacity.value=x.opacity,b.size.value=x.size*M,b.scale.value=E*.5,x.map&&(b.map.value=x.map,t(x.map,b.uvTransform)),x.alphaMap&&(b.alphaMap.value=x.alphaMap,t(x.alphaMap,b.alphaMapTransform)),x.alphaTest>0&&(b.alphaTest.value=x.alphaTest)}function h(b,x){b.diffuse.value.copy(x.color),b.opacity.value=x.opacity,b.rotation.value=x.rotation,x.map&&(b.map.value=x.map,t(x.map,b.mapTransform)),x.alphaMap&&(b.alphaMap.value=x.alphaMap,t(x.alphaMap,b.alphaMapTransform)),x.alphaTest>0&&(b.alphaTest.value=x.alphaTest)}function d(b,x){b.specular.value.copy(x.specular),b.shininess.value=Math.max(x.shininess,1e-4)}function p(b,x){x.gradientMap&&(b.gradientMap.value=x.gradientMap)}function g(b,x){b.metalness.value=x.metalness,x.metalnessMap&&(b.metalnessMap.value=x.metalnessMap,t(x.metalnessMap,b.metalnessMapTransform)),b.roughness.value=x.roughness,x.roughnessMap&&(b.roughnessMap.value=x.roughnessMap,t(x.roughnessMap,b.roughnessMapTransform)),x.envMap&&(b.envMapIntensity.value=x.envMapIntensity)}function _(b,x,M){b.ior.value=x.ior,x.sheen>0&&(b.sheenColor.value.copy(x.sheenColor).multiplyScalar(x.sheen),b.sheenRoughness.value=x.sheenRoughness,x.sheenColorMap&&(b.sheenColorMap.value=x.sheenColorMap,t(x.sheenColorMap,b.sheenColorMapTransform)),x.sheenRoughnessMap&&(b.sheenRoughnessMap.value=x.sheenRoughnessMap,t(x.sheenRoughnessMap,b.sheenRoughnessMapTransform))),x.clearcoat>0&&(b.clearcoat.value=x.clearcoat,b.clearcoatRoughness.value=x.clearcoatRoughness,x.clearcoatMap&&(b.clearcoatMap.value=x.clearcoatMap,t(x.clearcoatMap,b.clearcoatMapTransform)),x.clearcoatRoughnessMap&&(b.clearcoatRoughnessMap.value=x.clearcoatRoughnessMap,t(x.clearcoatRoughnessMap,b.clearcoatRoughnessMapTransform)),x.clearcoatNormalMap&&(b.clearcoatNormalMap.value=x.clearcoatNormalMap,t(x.clearcoatNormalMap,b.clearcoatNormalMapTransform),b.clearcoatNormalScale.value.copy(x.clearcoatNormalScale),x.side===Pn&&b.clearcoatNormalScale.value.negate())),x.dispersion>0&&(b.dispersion.value=x.dispersion),x.iridescence>0&&(b.iridescence.value=x.iridescence,b.iridescenceIOR.value=x.iridescenceIOR,b.iridescenceThicknessMinimum.value=x.iridescenceThicknessRange[0],b.iridescenceThicknessMaximum.value=x.iridescenceThicknessRange[1],x.iridescenceMap&&(b.iridescenceMap.value=x.iridescenceMap,t(x.iridescenceMap,b.iridescenceMapTransform)),x.iridescenceThicknessMap&&(b.iridescenceThicknessMap.value=x.iridescenceThicknessMap,t(x.iridescenceThicknessMap,b.iridescenceThicknessMapTransform))),x.transmission>0&&(b.transmission.value=x.transmission,b.transmissionSamplerMap.value=M.texture,b.transmissionSamplerSize.value.set(M.width,M.height),x.transmissionMap&&(b.transmissionMap.value=x.transmissionMap,t(x.transmissionMap,b.transmissionMapTransform)),b.thickness.value=x.thickness,x.thicknessMap&&(b.thicknessMap.value=x.thicknessMap,t(x.thicknessMap,b.thicknessMapTransform)),b.attenuationDistance.value=x.attenuationDistance,b.attenuationColor.value.copy(x.attenuationColor)),x.anisotropy>0&&(b.anisotropyVector.value.set(x.anisotropy*Math.cos(x.anisotropyRotation),x.anisotropy*Math.sin(x.anisotropyRotation)),x.anisotropyMap&&(b.anisotropyMap.value=x.anisotropyMap,t(x.anisotropyMap,b.anisotropyMapTransform))),b.specularIntensity.value=x.specularIntensity,b.specularColor.value.copy(x.specularColor),x.specularColorMap&&(b.specularColorMap.value=x.specularColorMap,t(x.specularColorMap,b.specularColorMapTransform)),x.specularIntensityMap&&(b.specularIntensityMap.value=x.specularIntensityMap,t(x.specularIntensityMap,b.specularIntensityMapTransform))}function v(b,x){x.matcap&&(b.matcap.value=x.matcap)}function T(b,x){const M=e.get(x).light;b.referencePosition.value.setFromMatrixPosition(M.matrixWorld),b.nearDistance.value=M.shadow.camera.near,b.farDistance.value=M.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:r}}function d4(i,e,t,n){let r={},s={},o=[];const u=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS);function c(M,E){const w=E.program;n.uniformBlockBinding(M,w)}function h(M,E){let w=r[M.id];w===void 0&&(v(M),w=d(M),r[M.id]=w,M.addEventListener("dispose",b));const C=E.program;n.updateUBOMapping(M,C);const N=e.render.frame;s[M.id]!==N&&(g(M),s[M.id]=N)}function d(M){const E=p();M.__bindingPointIndex=E;const w=i.createBuffer(),C=M.__size,N=M.usage;return i.bindBuffer(i.UNIFORM_BUFFER,w),i.bufferData(i.UNIFORM_BUFFER,C,N),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,E,w),w}function p(){for(let M=0;M<u;M++)if(o.indexOf(M)===-1)return o.push(M),M;return Re("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function g(M){const E=r[M.id],w=M.uniforms,C=M.__cache;i.bindBuffer(i.UNIFORM_BUFFER,E);for(let N=0,D=w.length;N<D;N++){const U=Array.isArray(w[N])?w[N]:[w[N]];for(let R=0,P=U.length;R<P;R++){const I=U[R];if(_(I,N,R,C)===!0){const H=I.__offset,X=Array.isArray(I.value)?I.value:[I.value];let J=0;for(let ne=0;ne<X.length;ne++){const G=X[ne],z=T(G);typeof G=="number"||typeof G=="boolean"?(I.__data[0]=G,i.bufferSubData(i.UNIFORM_BUFFER,H+J,I.__data)):G.isMatrix3?(I.__data[0]=G.elements[0],I.__data[1]=G.elements[1],I.__data[2]=G.elements[2],I.__data[3]=0,I.__data[4]=G.elements[3],I.__data[5]=G.elements[4],I.__data[6]=G.elements[5],I.__data[7]=0,I.__data[8]=G.elements[6],I.__data[9]=G.elements[7],I.__data[10]=G.elements[8],I.__data[11]=0):(G.toArray(I.__data,J),J+=z.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,H,I.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function _(M,E,w,C){const N=M.value,D=E+"_"+w;if(C[D]===void 0)return typeof N=="number"||typeof N=="boolean"?C[D]=N:C[D]=N.clone(),!0;{const U=C[D];if(typeof N=="number"||typeof N=="boolean"){if(U!==N)return C[D]=N,!0}else if(U.equals(N)===!1)return U.copy(N),!0}return!1}function v(M){const E=M.uniforms;let w=0;const C=16;for(let D=0,U=E.length;D<U;D++){const R=Array.isArray(E[D])?E[D]:[E[D]];for(let P=0,I=R.length;P<I;P++){const H=R[P],X=Array.isArray(H.value)?H.value:[H.value];for(let J=0,ne=X.length;J<ne;J++){const G=X[J],z=T(G),q=w%C,ce=q%z.boundary,xe=q+ce;w+=ce,xe!==0&&C-xe<z.storage&&(w+=C-xe),H.__data=new Float32Array(z.storage/Float32Array.BYTES_PER_ELEMENT),H.__offset=w,w+=z.storage}}}const N=w%C;return N>0&&(w+=C-N),M.__size=w,M.__cache={},this}function T(M){const E={boundary:0,storage:0};return typeof M=="number"||typeof M=="boolean"?(E.boundary=4,E.storage=4):M.isVector2?(E.boundary=8,E.storage=8):M.isVector3||M.isColor?(E.boundary=16,E.storage=12):M.isVector4?(E.boundary=16,E.storage=16):M.isMatrix3?(E.boundary=48,E.storage=48):M.isMatrix4?(E.boundary=64,E.storage=64):M.isTexture?Ae("WebGLRenderer: Texture samplers can not be part of an uniforms group."):Ae("WebGLRenderer: Unsupported uniform value type.",M),E}function b(M){const E=M.target;E.removeEventListener("dispose",b);const w=o.indexOf(E.__bindingPointIndex);o.splice(w,1),i.deleteBuffer(r[E.id]),delete r[E.id],delete s[E.id]}function x(){for(const M in r)i.deleteBuffer(r[M]);o=[],r={},s={}}return{bind:c,update:h,dispose:x}}const p4=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let Zs=null;function m4(){return Zs===null&&(Zs=new JS(p4,16,16,mr,Zn),Zs.name="DFG_LUT",Zs.minFilter=Gn,Zs.magFilter=Gn,Zs.wrapS=Nr,Zs.wrapT=Nr,Zs.generateMipmaps=!1,Zs.needsUpdate=!0),Zs}class g4{constructor(e={}){const{canvas:t=$N(),context:n=null,depth:r=!0,stencil:s=!1,alpha:o=!1,antialias:u=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:h=!1,powerPreference:d="default",failIfMajorPerformanceCaveat:p=!1,reversedDepthBuffer:g=!1,outputBufferType:_=Hn}=e;this.isWebGLRenderer=!0;let v;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");v=n.getContextAttributes().alpha}else v=o;const T=_,b=new Set([Hh,Vh,kh]),x=new Set([Hn,yn,Is,ts,z_,G_]),M=new Uint32Array(4),E=new Int32Array(4);let w=null,C=null;const N=[],D=[];let U=null;this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=$i,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const R=this;let P=!1;this._outputColorSpace=nr;let I=0,H=0,X=null,J=-1,ne=null;const G=new Lt,z=new Lt;let q=null;const ce=new dt(0);let xe=0,O=t.width,Y=t.height,ue=1,Ne=null,Z=null;const W=new Lt(0,0,O,Y),ie=new Lt(0,0,O,Y);let Le=!1;const ke=new Np;let ze=!1,ht=!1;const nn=new Ht,Pt=new k,wt=new Lt,qt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Mt=!1;function un(){return X===null?ue:1}let K=n;function jn(F,se){return t.getContext(F,se)}try{const F={alpha:!0,depth:r,stencil:s,antialias:u,premultipliedAlpha:c,preserveDrawingBuffer:h,powerPreference:d,failIfMajorPerformanceCaveat:p};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Tu}`),t.addEventListener("webglcontextlost",Rt,!1),t.addEventListener("webglcontextrestored",bn,!1),t.addEventListener("webglcontextcreationerror",rn,!1),K===null){const se="webgl2";if(K=jn(se,F),K===null)throw jn(se)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(F){throw Re("WebGLRenderer: "+F.message),F}let en,mn,lt,V,L,re,Ee,Pe,Se,ft,He,st,At,Be,Fe,Je,Ke,We,Gt,te,$e,Ie,Qe,Oe;function De(){en=new mG(K),en.init(),Ie=new a4(K,en),mn=new aG(K,en,e,Ie),lt=new r4(K,en),mn.reversedDepthBuffer&&g&&lt.buffers.depth.setReversed(!0),V=new vG(K),L=new Hk,re=new s4(K,en,lt,L,mn,Ie,V),Ee=new lG(R),Pe=new pG(R),Se=new SF(K),Qe=new rG(K,Se),ft=new gG(K,Se,V,Qe),He=new xG(K,ft,Se,V),Gt=new yG(K,mn,re),Je=new oG(L),st=new Vk(R,Ee,Pe,en,mn,Qe,Je),At=new f4(R,L),Be=new qk,Fe=new Qk(en),We=new iG(R,Ee,Pe,lt,He,v,c),Ke=new n4(R,He,mn),Oe=new d4(K,V,mn,lt),te=new sG(K,en,V),$e=new _G(K,en,V),V.programs=st.programs,R.capabilities=mn,R.extensions=en,R.properties=L,R.renderLists=Be,R.shadowMap=Ke,R.state=lt,R.info=V}De(),T!==Hn&&(U=new SG(T,t.width,t.height,r,s));const Ve=new c4(R,K);this.xr=Ve,this.getContext=function(){return K},this.getContextAttributes=function(){return K.getContextAttributes()},this.forceContextLoss=function(){const F=en.get("WEBGL_lose_context");F&&F.loseContext()},this.forceContextRestore=function(){const F=en.get("WEBGL_lose_context");F&&F.restoreContext()},this.getPixelRatio=function(){return ue},this.setPixelRatio=function(F){F!==void 0&&(ue=F,this.setSize(O,Y,!1))},this.getSize=function(F){return F.set(O,Y)},this.setSize=function(F,se,me=!0){if(Ve.isPresenting){Ae("WebGLRenderer: Can't change size while VR device is presenting.");return}O=F,Y=se,t.width=Math.floor(F*ue),t.height=Math.floor(se*ue),me===!0&&(t.style.width=F+"px",t.style.height=se+"px"),U!==null&&U.setSize(t.width,t.height),this.setViewport(0,0,F,se)},this.getDrawingBufferSize=function(F){return F.set(O*ue,Y*ue).floor()},this.setDrawingBufferSize=function(F,se,me){O=F,Y=se,ue=me,t.width=Math.floor(F*me),t.height=Math.floor(se*me),this.setViewport(0,0,F,se)},this.setEffects=function(F){if(T===Hn){console.error("THREE.WebGLRenderer: setEffects() requires outputBufferType set to HalfFloatType or FloatType.");return}if(F){for(let se=0;se<F.length;se++)if(F[se].isOutputPass===!0){console.warn("THREE.WebGLRenderer: OutputPass is not needed in setEffects(). Tone mapping and color space conversion are applied automatically.");break}}U.setEffects(F||[])},this.getCurrentViewport=function(F){return F.copy(G)},this.getViewport=function(F){return F.copy(W)},this.setViewport=function(F,se,me,de){F.isVector4?W.set(F.x,F.y,F.z,F.w):W.set(F,se,me,de),lt.viewport(G.copy(W).multiplyScalar(ue).round())},this.getScissor=function(F){return F.copy(ie)},this.setScissor=function(F,se,me,de){F.isVector4?ie.set(F.x,F.y,F.z,F.w):ie.set(F,se,me,de),lt.scissor(z.copy(ie).multiplyScalar(ue).round())},this.getScissorTest=function(){return Le},this.setScissorTest=function(F){lt.setScissorTest(Le=F)},this.setOpaqueSort=function(F){Ne=F},this.setTransparentSort=function(F){Z=F},this.getClearColor=function(F){return F.copy(We.getClearColor())},this.setClearColor=function(){We.setClearColor(...arguments)},this.getClearAlpha=function(){return We.getClearAlpha()},this.setClearAlpha=function(){We.setClearAlpha(...arguments)},this.clear=function(F=!0,se=!0,me=!0){let de=0;if(F){let le=!1;if(X!==null){const qe=X.texture.format;le=b.has(qe)}if(le){const qe=X.texture.type,tt=x.has(qe),je=We.getClearColor(),it=We.getClearAlpha(),at=je.r,xt=je.g,ot=je.b;tt?(M[0]=at,M[1]=xt,M[2]=ot,M[3]=it,K.clearBufferuiv(K.COLOR,0,M)):(E[0]=at,E[1]=xt,E[2]=ot,E[3]=it,K.clearBufferiv(K.COLOR,0,E))}else de|=K.COLOR_BUFFER_BIT}se&&(de|=K.DEPTH_BUFFER_BIT),me&&(de|=K.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),K.clear(de)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Rt,!1),t.removeEventListener("webglcontextrestored",bn,!1),t.removeEventListener("webglcontextcreationerror",rn,!1),We.dispose(),Be.dispose(),Fe.dispose(),L.dispose(),Ee.dispose(),Pe.dispose(),He.dispose(),Qe.dispose(),Oe.dispose(),st.dispose(),Ve.dispose(),Ve.removeEventListener("sessionstart",Du),Ve.removeEventListener("sessionend",rf),qs.stop()};function Rt(F){F.preventDefault(),dp("WebGLRenderer: Context Lost."),P=!0}function bn(){dp("WebGLRenderer: Context Restored."),P=!1;const F=V.autoReset,se=Ke.enabled,me=Ke.autoUpdate,de=Ke.needsUpdate,le=Ke.type;De(),V.autoReset=F,Ke.enabled=se,Ke.autoUpdate=me,Ke.needsUpdate=de,Ke.type=le}function rn(F){Re("WebGLRenderer: A WebGL context could not be created. Reason: ",F.statusMessage)}function Qi(F){const se=F.target;se.removeEventListener("dispose",Qi),Ms(se)}function Ms(F){Vp(F),L.remove(F)}function Vp(F){const se=L.get(F).programs;se!==void 0&&(se.forEach(function(me){st.releaseProgram(me)}),F.isShaderMaterial&&st.releaseShaderCache(F))}this.renderBufferDirect=function(F,se,me,de,le,qe){se===null&&(se=qt);const tt=le.isMesh&&le.matrixWorld.determinant()<0,je=vl(F,se,me,de,le);lt.setMaterial(de,tt);let it=me.index,at=1;if(de.wireframe===!0){if(it=ft.getWireframeAttribute(me),it===void 0)return;at=2}const xt=me.drawRange,ot=me.attributes.position;let St=xt.start*at,cn=(xt.start+xt.count)*at;qe!==null&&(St=Math.max(St,qe.start*at),cn=Math.min(cn,(qe.start+qe.count)*at)),it!==null?(St=Math.max(St,0),cn=Math.min(cn,it.count)):ot!=null&&(St=Math.max(St,0),cn=Math.min(cn,ot.count));const Xn=cn-St;if(Xn<0||Xn===1/0)return;Qe.setup(le,de,je,me,it);let kn,gn=te;if(it!==null&&(kn=Se.get(it),gn=$e,gn.setIndex(kn)),le.isMesh)de.wireframe===!0?(lt.setLineWidth(de.wireframeLinewidth*un()),gn.setMode(K.LINES)):gn.setMode(K.TRIANGLES);else if(le.isLine){let mt=de.linewidth;mt===void 0&&(mt=1),lt.setLineWidth(mt*un()),le.isLineSegments?gn.setMode(K.LINES):le.isLineLoop?gn.setMode(K.LINE_LOOP):gn.setMode(K.LINE_STRIP)}else le.isPoints?gn.setMode(K.POINTS):le.isSprite&&gn.setMode(K.TRIANGLES);if(le.isBatchedMesh)if(le._multiDrawInstances!==null)Vn("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),gn.renderMultiDrawInstances(le._multiDrawStarts,le._multiDrawCounts,le._multiDrawCount,le._multiDrawInstances);else if(en.get("WEBGL_multi_draw"))gn.renderMultiDraw(le._multiDrawStarts,le._multiDrawCounts,le._multiDrawCount);else{const mt=le._multiDrawStarts,hn=le._multiDrawCounts,Nt=le._multiDrawCount,Ui=it?Se.get(it).bytesPerElement:1,Ta=L.get(de).currentProgram.getUniforms();for(let Oi=0;Oi<Nt;Oi++)Ta.setValue(K,"_gl_DrawID",Oi),gn.render(mt[Oi]/Ui,hn[Oi])}else if(le.isInstancedMesh)gn.renderInstances(St,Xn,le.count);else if(me.isInstancedBufferGeometry){const mt=me._maxInstanceCount!==void 0?me._maxInstanceCount:1/0,hn=Math.min(me.instanceCount,mt);gn.renderInstances(St,Xn,hn)}else gn.render(St,Xn)};function tf(F,se,me){F.transparent===!0&&F.side===rr&&F.forceSinglePass===!1?(F.side=Pn,F.needsUpdate=!0,Pu(F,se,me),F.side=Jr,F.needsUpdate=!0,Pu(F,se,me),F.side=rr):Pu(F,se,me)}this.compile=function(F,se,me=null){me===null&&(me=F),C=Fe.get(me),C.init(se),D.push(C),me.traverseVisible(function(le){le.isLight&&le.layers.test(se.layers)&&(C.pushLight(le),le.castShadow&&C.pushShadow(le))}),F!==me&&F.traverseVisible(function(le){le.isLight&&le.layers.test(se.layers)&&(C.pushLight(le),le.castShadow&&C.pushShadow(le))}),C.setupLights();const de=new Set;return F.traverse(function(le){if(!(le.isMesh||le.isPoints||le.isLine||le.isSprite))return;const qe=le.material;if(qe)if(Array.isArray(qe))for(let tt=0;tt<qe.length;tt++){const je=qe[tt];tf(je,me,le),de.add(je)}else tf(qe,me,le),de.add(qe)}),C=D.pop(),de},this.compileAsync=function(F,se,me=null){const de=this.compile(F,se,me);return new Promise(le=>{function qe(){if(de.forEach(function(tt){L.get(tt).currentProgram.isReady()&&de.delete(tt)}),de.size===0){le(F);return}setTimeout(qe,10)}en.get("KHR_parallel_shader_compile")!==null?qe():setTimeout(qe,10)})};let Nu=null;function nf(F){Nu&&Nu(F)}function Du(){qs.stop()}function rf(){qs.start()}const qs=new h2;qs.setAnimationLoop(nf),typeof self<"u"&&qs.setContext(self),this.setAnimationLoop=function(F){Nu=F,Ve.setAnimationLoop(F),F===null?qs.stop():qs.start()},Ve.addEventListener("sessionstart",Du),Ve.addEventListener("sessionend",rf),this.render=function(F,se){if(se!==void 0&&se.isCamera!==!0){Re("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(P===!0)return;const me=Ve.enabled===!0&&Ve.isPresenting===!0,de=U!==null&&(X===null||me)&&U.begin(R,X);if(F.matrixWorldAutoUpdate===!0&&F.updateMatrixWorld(),se.parent===null&&se.matrixWorldAutoUpdate===!0&&se.updateMatrixWorld(),Ve.enabled===!0&&Ve.isPresenting===!0&&(U===null||U.isCompositing()===!1)&&(Ve.cameraAutoUpdate===!0&&Ve.updateCamera(se),se=Ve.getCamera()),F.isScene===!0&&F.onBeforeRender(R,F,se,X),C=Fe.get(F,D.length),C.init(se),D.push(C),nn.multiplyMatrices(se.projectionMatrix,se.matrixWorldInverse),ke.setFromProjectionMatrix(nn,gr,se.reversedDepth),ht=this.localClippingEnabled,ze=Je.init(this.clippingPlanes,ht),w=Be.get(F,N.length),w.init(),N.push(w),Ve.enabled===!0&&Ve.isPresenting===!0){const tt=R.xr.getDepthSensingMesh();tt!==null&&is(tt,se,-1/0,R.sortObjects)}is(F,se,0,R.sortObjects),w.finish(),R.sortObjects===!0&&w.sort(Ne,Z),Mt=Ve.enabled===!1||Ve.isPresenting===!1||Ve.hasDepthSensing()===!1,Mt&&We.addToRenderList(w,F),this.info.render.frame++,ze===!0&&Je.beginShadows();const le=C.state.shadowsArray;if(Ke.render(le,F,se),ze===!0&&Je.endShadows(),this.info.autoReset===!0&&this.info.reset(),(de&&U.hasRenderPass())===!1){const tt=w.opaque,je=w.transmissive;if(C.setupLights(),se.isArrayCamera){const it=se.cameras;if(je.length>0)for(let at=0,xt=it.length;at<xt;at++){const ot=it[at];Pi(tt,je,F,ot)}Mt&&We.render(F);for(let at=0,xt=it.length;at<xt;at++){const ot=it[at];fi(w,F,ot,ot.viewport)}}else je.length>0&&Pi(tt,je,F,se),Mt&&We.render(F),fi(w,F,se)}X!==null&&H===0&&(re.updateMultisampleRenderTarget(X),re.updateRenderTargetMipmap(X)),de&&U.end(R),F.isScene===!0&&F.onAfterRender(R,F,se),Qe.resetDefaultState(),J=-1,ne=null,D.pop(),D.length>0?(C=D[D.length-1],ze===!0&&Je.setGlobalState(R.clippingPlanes,C.state.camera)):C=null,N.pop(),N.length>0?w=N[N.length-1]:w=null};function is(F,se,me,de){if(F.visible===!1)return;if(F.layers.test(se.layers)){if(F.isGroup)me=F.renderOrder;else if(F.isLOD)F.autoUpdate===!0&&F.update(se);else if(F.isLight)C.pushLight(F),F.castShadow&&C.pushShadow(F);else if(F.isSprite){if(!F.frustumCulled||ke.intersectsSprite(F)){de&&wt.setFromMatrixPosition(F.matrixWorld).applyMatrix4(nn);const tt=He.update(F),je=F.material;je.visible&&w.push(F,tt,je,me,wt.z,null)}}else if((F.isMesh||F.isLine||F.isPoints)&&(!F.frustumCulled||ke.intersectsObject(F))){const tt=He.update(F),je=F.material;if(de&&(F.boundingSphere!==void 0?(F.boundingSphere===null&&F.computeBoundingSphere(),wt.copy(F.boundingSphere.center)):(tt.boundingSphere===null&&tt.computeBoundingSphere(),wt.copy(tt.boundingSphere.center)),wt.applyMatrix4(F.matrixWorld).applyMatrix4(nn)),Array.isArray(je)){const it=tt.groups;for(let at=0,xt=it.length;at<xt;at++){const ot=it[at],St=je[ot.materialIndex];St&&St.visible&&w.push(F,tt,St,me,wt.z,ot)}}else je.visible&&w.push(F,tt,je,me,wt.z,null)}}const qe=F.children;for(let tt=0,je=qe.length;tt<je;tt++)is(qe[tt],se,me,de)}function fi(F,se,me,de){const{opaque:le,transmissive:qe,transparent:tt}=F;C.setupLightsView(me),ze===!0&&Je.setGlobalState(R.clippingPlanes,me),de&&lt.viewport(G.copy(de)),le.length>0&&Es(le,se,me),qe.length>0&&Es(qe,se,me),tt.length>0&&Es(tt,se,me),lt.buffers.depth.setTest(!0),lt.buffers.depth.setMask(!0),lt.buffers.color.setMask(!0),lt.setPolygonOffset(!1)}function Pi(F,se,me,de){if((me.isScene===!0?me.overrideMaterial:null)!==null)return;if(C.state.transmissionRenderTarget[de.id]===void 0){const St=en.has("EXT_color_buffer_half_float")||en.has("EXT_color_buffer_float");C.state.transmissionRenderTarget[de.id]=new Gs(1,1,{generateMipmaps:!0,type:St?Zn:Hn,minFilter:Dr,samples:mn.samples,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:vt.workingColorSpace})}const qe=C.state.transmissionRenderTarget[de.id],tt=de.viewport||G;qe.setSize(tt.z*R.transmissionResolutionScale,tt.w*R.transmissionResolutionScale);const je=R.getRenderTarget(),it=R.getActiveCubeFace(),at=R.getActiveMipmapLevel();R.setRenderTarget(qe),R.getClearColor(ce),xe=R.getClearAlpha(),xe<1&&R.setClearColor(16777215,.5),R.clear(),Mt&&We.render(me);const xt=R.toneMapping;R.toneMapping=$i;const ot=de.viewport;if(de.viewport!==void 0&&(de.viewport=void 0),C.setupLightsView(de),ze===!0&&Je.setGlobalState(R.clippingPlanes,de),Es(F,me,de),re.updateMultisampleRenderTarget(qe),re.updateRenderTargetMipmap(qe),en.has("WEBGL_multisampled_render_to_texture")===!1){let St=!1;for(let cn=0,Xn=se.length;cn<Xn;cn++){const kn=se[cn],{object:gn,geometry:mt,material:hn,group:Nt}=kn;if(hn.side===rr&&gn.layers.test(de.layers)){const Ui=hn.side;hn.side=Pn,hn.needsUpdate=!0,Lu(gn,me,de,mt,hn,Nt),hn.side=Ui,hn.needsUpdate=!0,St=!0}}St===!0&&(re.updateMultisampleRenderTarget(qe),re.updateRenderTargetMipmap(qe))}R.setRenderTarget(je,it,at),R.setClearColor(ce,xe),ot!==void 0&&(de.viewport=ot),R.toneMapping=xt}function Es(F,se,me){const de=se.isScene===!0?se.overrideMaterial:null;for(let le=0,qe=F.length;le<qe;le++){const tt=F[le],{object:je,geometry:it,group:at}=tt;let xt=tt.material;xt.allowOverride===!0&&de!==null&&(xt=de),je.layers.test(me.layers)&&Lu(je,se,me,it,xt,at)}}function Lu(F,se,me,de,le,qe){F.onBeforeRender(R,se,me,de,le,qe),F.modelViewMatrix.multiplyMatrices(me.matrixWorldInverse,F.matrixWorld),F.normalMatrix.getNormalMatrix(F.modelViewMatrix),le.onBeforeRender(R,se,me,de,F,qe),le.transparent===!0&&le.side===rr&&le.forceSinglePass===!1?(le.side=Pn,le.needsUpdate=!0,R.renderBufferDirect(me,se,de,le,F,qe),le.side=Jr,le.needsUpdate=!0,R.renderBufferDirect(me,se,de,le,F,qe),le.side=rr):R.renderBufferDirect(me,se,de,le,F,qe),F.onAfterRender(R,se,me,de,le,qe)}function Pu(F,se,me){se.isScene!==!0&&(se=qt);const de=L.get(F),le=C.state.lights,qe=C.state.shadowsArray,tt=le.state.version,je=st.getParameters(F,le.state,qe,se,me),it=st.getProgramCacheKey(je);let at=de.programs;de.environment=F.isMeshStandardMaterial?se.environment:null,de.fog=se.fog,de.envMap=(F.isMeshStandardMaterial?Pe:Ee).get(F.envMap||de.environment),de.envMapRotation=de.environment!==null&&F.envMap===null?se.environmentRotation:F.envMapRotation,at===void 0&&(F.addEventListener("dispose",Qi),at=new Map,de.programs=at);let xt=at.get(it);if(xt!==void 0){if(de.currentProgram===xt&&de.lightsStateVersion===tt)return sf(F,je),xt}else je.uniforms=st.getUniforms(F),F.onBeforeCompile(je,R),xt=st.acquireProgram(je,it),at.set(it,xt),de.uniforms=je.uniforms;const ot=de.uniforms;return(!F.isShaderMaterial&&!F.isRawShaderMaterial||F.clipping===!0)&&(ot.clippingPlanes=Je.uniform),sf(F,je),de.needsLights=vo(F),de.lightsStateVersion=tt,de.needsLights&&(ot.ambientLightColor.value=le.state.ambient,ot.lightProbe.value=le.state.probe,ot.directionalLights.value=le.state.directional,ot.directionalLightShadows.value=le.state.directionalShadow,ot.spotLights.value=le.state.spot,ot.spotLightShadows.value=le.state.spotShadow,ot.rectAreaLights.value=le.state.rectArea,ot.ltc_1.value=le.state.rectAreaLTC1,ot.ltc_2.value=le.state.rectAreaLTC2,ot.pointLights.value=le.state.point,ot.pointLightShadows.value=le.state.pointShadow,ot.hemisphereLights.value=le.state.hemi,ot.directionalShadowMap.value=le.state.directionalShadowMap,ot.directionalShadowMatrix.value=le.state.directionalShadowMatrix,ot.spotShadowMap.value=le.state.spotShadowMap,ot.spotLightMatrix.value=le.state.spotLightMatrix,ot.spotLightMap.value=le.state.spotLightMap,ot.pointShadowMap.value=le.state.pointShadowMap,ot.pointShadowMatrix.value=le.state.pointShadowMatrix),de.currentProgram=xt,de.uniformsList=null,xt}function Hp(F){if(F.uniformsList===null){const se=F.currentProgram.getUniforms();F.uniformsList=o_.seqWithValue(se.seq,F.uniforms)}return F.uniformsList}function sf(F,se){const me=L.get(F);me.outputColorSpace=se.outputColorSpace,me.batching=se.batching,me.batchingColor=se.batchingColor,me.instancing=se.instancing,me.instancingColor=se.instancingColor,me.instancingMorph=se.instancingMorph,me.skinning=se.skinning,me.morphTargets=se.morphTargets,me.morphNormals=se.morphNormals,me.morphColors=se.morphColors,me.morphTargetsCount=se.morphTargetsCount,me.numClippingPlanes=se.numClippingPlanes,me.numIntersection=se.numClipIntersection,me.vertexAlphas=se.vertexAlphas,me.vertexTangents=se.vertexTangents,me.toneMapping=se.toneMapping}function vl(F,se,me,de,le){se.isScene!==!0&&(se=qt),re.resetTextureUnits();const qe=se.fog,tt=de.isMeshStandardMaterial?se.environment:null,je=X===null?R.outputColorSpace:X.isXRRenderTarget===!0?X.texture.colorSpace:mu,it=(de.isMeshStandardMaterial?Pe:Ee).get(de.envMap||tt),at=de.vertexColors===!0&&!!me.attributes.color&&me.attributes.color.itemSize===4,xt=!!me.attributes.tangent&&(!!de.normalMap||de.anisotropy>0),ot=!!me.morphAttributes.position,St=!!me.morphAttributes.normal,cn=!!me.morphAttributes.color;let Xn=$i;de.toneMapped&&(X===null||X.isXRRenderTarget===!0)&&(Xn=R.toneMapping);const kn=me.morphAttributes.position||me.morphAttributes.normal||me.morphAttributes.color,gn=kn!==void 0?kn.length:0,mt=L.get(de),hn=C.state.lights;if(ze===!0&&(ht===!0||F!==ne)){const Fi=F===ne&&de.id===J;Je.setState(de,F,Fi)}let Nt=!1;de.version===mt.__version?(mt.needsLights&&mt.lightsStateVersion!==hn.state.version||mt.outputColorSpace!==je||le.isBatchedMesh&&mt.batching===!1||!le.isBatchedMesh&&mt.batching===!0||le.isBatchedMesh&&mt.batchingColor===!0&&le.colorTexture===null||le.isBatchedMesh&&mt.batchingColor===!1&&le.colorTexture!==null||le.isInstancedMesh&&mt.instancing===!1||!le.isInstancedMesh&&mt.instancing===!0||le.isSkinnedMesh&&mt.skinning===!1||!le.isSkinnedMesh&&mt.skinning===!0||le.isInstancedMesh&&mt.instancingColor===!0&&le.instanceColor===null||le.isInstancedMesh&&mt.instancingColor===!1&&le.instanceColor!==null||le.isInstancedMesh&&mt.instancingMorph===!0&&le.morphTexture===null||le.isInstancedMesh&&mt.instancingMorph===!1&&le.morphTexture!==null||mt.envMap!==it||de.fog===!0&&mt.fog!==qe||mt.numClippingPlanes!==void 0&&(mt.numClippingPlanes!==Je.numPlanes||mt.numIntersection!==Je.numIntersection)||mt.vertexAlphas!==at||mt.vertexTangents!==xt||mt.morphTargets!==ot||mt.morphNormals!==St||mt.morphColors!==cn||mt.toneMapping!==Xn||mt.morphTargetsCount!==gn)&&(Nt=!0):(Nt=!0,mt.__version=de.version);let Ui=mt.currentProgram;Nt===!0&&(Ui=Pu(de,se,le));let Ta=!1,Oi=!1,rs=!1;const Sn=Ui.getUniforms(),Bi=mt.uniforms;if(lt.useProgram(Ui.program)&&(Ta=!0,Oi=!0,rs=!0),de.id!==J&&(J=de.id,Oi=!0),Ta||ne!==F){lt.buffers.depth.getReversed()&&F.reversedDepth!==!0&&(F._reversedDepth=!0,F.updateProjectionMatrix()),Sn.setValue(K,"projectionMatrix",F.projectionMatrix),Sn.setValue(K,"viewMatrix",F.matrixWorldInverse);const Ii=Sn.map.cameraPosition;Ii!==void 0&&Ii.setValue(K,Pt.setFromMatrixPosition(F.matrixWorld)),mn.logarithmicDepthBuffer&&Sn.setValue(K,"logDepthBufFC",2/(Math.log(F.far+1)/Math.LN2)),(de.isMeshPhongMaterial||de.isMeshToonMaterial||de.isMeshLambertMaterial||de.isMeshBasicMaterial||de.isMeshStandardMaterial||de.isShaderMaterial)&&Sn.setValue(K,"isOrthographic",F.isOrthographicCamera===!0),ne!==F&&(ne=F,Oi=!0,rs=!0)}if(mt.needsLights&&(hn.state.directionalShadowMap.length>0&&Sn.setValue(K,"directionalShadowMap",hn.state.directionalShadowMap,re),hn.state.spotShadowMap.length>0&&Sn.setValue(K,"spotShadowMap",hn.state.spotShadowMap,re),hn.state.pointShadowMap.length>0&&Sn.setValue(K,"pointShadowMap",hn.state.pointShadowMap,re)),le.isSkinnedMesh){Sn.setOptional(K,le,"bindMatrix"),Sn.setOptional(K,le,"bindMatrixInverse");const Fi=le.skeleton;Fi&&(Fi.boneTexture===null&&Fi.computeBoneTexture(),Sn.setValue(K,"boneTexture",Fi.boneTexture,re))}le.isBatchedMesh&&(Sn.setOptional(K,le,"batchingTexture"),Sn.setValue(K,"batchingTexture",le._matricesTexture,re),Sn.setOptional(K,le,"batchingIdTexture"),Sn.setValue(K,"batchingIdTexture",le._indirectTexture,re),Sn.setOptional(K,le,"batchingColorTexture"),le._colorsTexture!==null&&Sn.setValue(K,"batchingColorTexture",le._colorsTexture,re));const Si=me.morphAttributes;if((Si.position!==void 0||Si.normal!==void 0||Si.color!==void 0)&&Gt.update(le,me,Ui),(Oi||mt.receiveShadow!==le.receiveShadow)&&(mt.receiveShadow=le.receiveShadow,Sn.setValue(K,"receiveShadow",le.receiveShadow)),de.isMeshGouraudMaterial&&de.envMap!==null&&(Bi.envMap.value=it,Bi.flipEnvMap.value=it.isCubeTexture&&it.isRenderTargetTexture===!1?-1:1),de.isMeshStandardMaterial&&de.envMap===null&&se.environment!==null&&(Bi.envMapIntensity.value=se.environmentIntensity),Bi.dfgLUT!==void 0&&(Bi.dfgLUT.value=m4()),Oi&&(Sn.setValue(K,"toneMappingExposure",R.toneMappingExposure),mt.needsLights&&af(Bi,rs),qe&&de.fog===!0&&At.refreshFogUniforms(Bi,qe),At.refreshMaterialUniforms(Bi,de,ue,Y,C.state.transmissionRenderTarget[F.id]),o_.upload(K,Hp(mt),Bi,re)),de.isShaderMaterial&&de.uniformsNeedUpdate===!0&&(o_.upload(K,Hp(mt),Bi,re),de.uniformsNeedUpdate=!1),de.isSpriteMaterial&&Sn.setValue(K,"center",le.center),Sn.setValue(K,"modelViewMatrix",le.modelViewMatrix),Sn.setValue(K,"normalMatrix",le.normalMatrix),Sn.setValue(K,"modelMatrix",le.matrixWorld),de.isShaderMaterial||de.isRawShaderMaterial){const Fi=de.uniformsGroups;for(let Ii=0,Uu=Fi.length;Ii<Uu;Ii++){const As=Fi[Ii];Oe.update(As,Ui),Oe.bind(As,Ui)}}return Ui}function af(F,se){F.ambientLightColor.needsUpdate=se,F.lightProbe.needsUpdate=se,F.directionalLights.needsUpdate=se,F.directionalLightShadows.needsUpdate=se,F.pointLights.needsUpdate=se,F.pointLightShadows.needsUpdate=se,F.spotLights.needsUpdate=se,F.spotLightShadows.needsUpdate=se,F.rectAreaLights.needsUpdate=se,F.hemisphereLights.needsUpdate=se}function vo(F){return F.isMeshLambertMaterial||F.isMeshToonMaterial||F.isMeshPhongMaterial||F.isMeshStandardMaterial||F.isShadowMaterial||F.isShaderMaterial&&F.lights===!0}this.getActiveCubeFace=function(){return I},this.getActiveMipmapLevel=function(){return H},this.getRenderTarget=function(){return X},this.setRenderTargetTextures=function(F,se,me){const de=L.get(F);de.__autoAllocateDepthBuffer=F.resolveDepthBuffer===!1,de.__autoAllocateDepthBuffer===!1&&(de.__useRenderToTexture=!1),L.get(F.texture).__webglTexture=se,L.get(F.depthTexture).__webglTexture=de.__autoAllocateDepthBuffer?void 0:me,de.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(F,se){const me=L.get(F);me.__webglFramebuffer=se,me.__useDefaultFramebuffer=se===void 0};const yo=K.createFramebuffer();this.setRenderTarget=function(F,se=0,me=0){X=F,I=se,H=me;let de=null,le=!1,qe=!1;if(F){const je=L.get(F);if(je.__useDefaultFramebuffer!==void 0){lt.bindFramebuffer(K.FRAMEBUFFER,je.__webglFramebuffer),G.copy(F.viewport),z.copy(F.scissor),q=F.scissorTest,lt.viewport(G),lt.scissor(z),lt.setScissorTest(q),J=-1;return}else if(je.__webglFramebuffer===void 0)re.setupRenderTarget(F);else if(je.__hasExternalTextures)re.rebindTextures(F,L.get(F.texture).__webglTexture,L.get(F.depthTexture).__webglTexture);else if(F.depthBuffer){const xt=F.depthTexture;if(je.__boundDepthTexture!==xt){if(xt!==null&&L.has(xt)&&(F.width!==xt.image.width||F.height!==xt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");re.setupDepthRenderbuffer(F)}}const it=F.texture;(it.isData3DTexture||it.isDataArrayTexture||it.isCompressedArrayTexture)&&(qe=!0);const at=L.get(F).__webglFramebuffer;F.isWebGLCubeRenderTarget?(Array.isArray(at[se])?de=at[se][me]:de=at[se],le=!0):F.samples>0&&re.useMultisampledRTT(F)===!1?de=L.get(F).__webglMultisampledFramebuffer:Array.isArray(at)?de=at[me]:de=at,G.copy(F.viewport),z.copy(F.scissor),q=F.scissorTest}else G.copy(W).multiplyScalar(ue).floor(),z.copy(ie).multiplyScalar(ue).floor(),q=Le;if(me!==0&&(de=yo),lt.bindFramebuffer(K.FRAMEBUFFER,de)&&lt.drawBuffers(F,de),lt.viewport(G),lt.scissor(z),lt.setScissorTest(q),le){const je=L.get(F.texture);K.framebufferTexture2D(K.FRAMEBUFFER,K.COLOR_ATTACHMENT0,K.TEXTURE_CUBE_MAP_POSITIVE_X+se,je.__webglTexture,me)}else if(qe){const je=se;for(let it=0;it<F.textures.length;it++){const at=L.get(F.textures[it]);K.framebufferTextureLayer(K.FRAMEBUFFER,K.COLOR_ATTACHMENT0+it,at.__webglTexture,me,je)}}else if(F!==null&&me!==0){const je=L.get(F.texture);K.framebufferTexture2D(K.FRAMEBUFFER,K.COLOR_ATTACHMENT0,K.TEXTURE_2D,je.__webglTexture,me)}J=-1},this.readRenderTargetPixels=function(F,se,me,de,le,qe,tt,je=0){if(!(F&&F.isWebGLRenderTarget)){Re("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let it=L.get(F).__webglFramebuffer;if(F.isWebGLCubeRenderTarget&&tt!==void 0&&(it=it[tt]),it){lt.bindFramebuffer(K.FRAMEBUFFER,it);try{const at=F.textures[je],xt=at.format,ot=at.type;if(!mn.textureFormatReadable(xt)){Re("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!mn.textureTypeReadable(ot)){Re("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}se>=0&&se<=F.width-de&&me>=0&&me<=F.height-le&&(F.textures.length>1&&K.readBuffer(K.COLOR_ATTACHMENT0+je),K.readPixels(se,me,de,le,Ie.convert(xt),Ie.convert(ot),qe))}finally{const at=X!==null?L.get(X).__webglFramebuffer:null;lt.bindFramebuffer(K.FRAMEBUFFER,at)}}},this.readRenderTargetPixelsAsync=async function(F,se,me,de,le,qe,tt,je=0){if(!(F&&F.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let it=L.get(F).__webglFramebuffer;if(F.isWebGLCubeRenderTarget&&tt!==void 0&&(it=it[tt]),it)if(se>=0&&se<=F.width-de&&me>=0&&me<=F.height-le){lt.bindFramebuffer(K.FRAMEBUFFER,it);const at=F.textures[je],xt=at.format,ot=at.type;if(!mn.textureFormatReadable(xt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!mn.textureTypeReadable(ot))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const St=K.createBuffer();K.bindBuffer(K.PIXEL_PACK_BUFFER,St),K.bufferData(K.PIXEL_PACK_BUFFER,qe.byteLength,K.STREAM_READ),F.textures.length>1&&K.readBuffer(K.COLOR_ATTACHMENT0+je),K.readPixels(se,me,de,le,Ie.convert(xt),Ie.convert(ot),0);const cn=X!==null?L.get(X).__webglFramebuffer:null;lt.bindFramebuffer(K.FRAMEBUFFER,cn);const Xn=K.fenceSync(K.SYNC_GPU_COMMANDS_COMPLETE,0);return K.flush(),await qO(K,Xn,4),K.bindBuffer(K.PIXEL_PACK_BUFFER,St),K.getBufferSubData(K.PIXEL_PACK_BUFFER,0,qe),K.deleteBuffer(St),K.deleteSync(Xn),qe}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(F,se=null,me=0){const de=Math.pow(2,-me),le=Math.floor(F.image.width*de),qe=Math.floor(F.image.height*de),tt=se!==null?se.x:0,je=se!==null?se.y:0;re.setTexture2D(F,0),K.copyTexSubImage2D(K.TEXTURE_2D,me,0,0,tt,je,le,qe),lt.unbindTexture()};const yl=K.createFramebuffer(),xo=K.createFramebuffer();this.copyTextureToTexture=function(F,se,me=null,de=null,le=0,qe=null){qe===null&&(le!==0?(Vn("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),qe=le,le=0):qe=0);let tt,je,it,at,xt,ot,St,cn,Xn;const kn=F.isCompressedTexture?F.mipmaps[qe]:F.image;if(me!==null)tt=me.max.x-me.min.x,je=me.max.y-me.min.y,it=me.isBox3?me.max.z-me.min.z:1,at=me.min.x,xt=me.min.y,ot=me.isBox3?me.min.z:0;else{const Si=Math.pow(2,-le);tt=Math.floor(kn.width*Si),je=Math.floor(kn.height*Si),F.isDataArrayTexture?it=kn.depth:F.isData3DTexture?it=Math.floor(kn.depth*Si):it=1,at=0,xt=0,ot=0}de!==null?(St=de.x,cn=de.y,Xn=de.z):(St=0,cn=0,Xn=0);const gn=Ie.convert(se.format),mt=Ie.convert(se.type);let hn;se.isData3DTexture?(re.setTexture3D(se,0),hn=K.TEXTURE_3D):se.isDataArrayTexture||se.isCompressedArrayTexture?(re.setTexture2DArray(se,0),hn=K.TEXTURE_2D_ARRAY):(re.setTexture2D(se,0),hn=K.TEXTURE_2D),K.pixelStorei(K.UNPACK_FLIP_Y_WEBGL,se.flipY),K.pixelStorei(K.UNPACK_PREMULTIPLY_ALPHA_WEBGL,se.premultiplyAlpha),K.pixelStorei(K.UNPACK_ALIGNMENT,se.unpackAlignment);const Nt=K.getParameter(K.UNPACK_ROW_LENGTH),Ui=K.getParameter(K.UNPACK_IMAGE_HEIGHT),Ta=K.getParameter(K.UNPACK_SKIP_PIXELS),Oi=K.getParameter(K.UNPACK_SKIP_ROWS),rs=K.getParameter(K.UNPACK_SKIP_IMAGES);K.pixelStorei(K.UNPACK_ROW_LENGTH,kn.width),K.pixelStorei(K.UNPACK_IMAGE_HEIGHT,kn.height),K.pixelStorei(K.UNPACK_SKIP_PIXELS,at),K.pixelStorei(K.UNPACK_SKIP_ROWS,xt),K.pixelStorei(K.UNPACK_SKIP_IMAGES,ot);const Sn=F.isDataArrayTexture||F.isData3DTexture,Bi=se.isDataArrayTexture||se.isData3DTexture;if(F.isDepthTexture){const Si=L.get(F),Fi=L.get(se),Ii=L.get(Si.__renderTarget),Uu=L.get(Fi.__renderTarget);lt.bindFramebuffer(K.READ_FRAMEBUFFER,Ii.__webglFramebuffer),lt.bindFramebuffer(K.DRAW_FRAMEBUFFER,Uu.__webglFramebuffer);for(let As=0;As<it;As++)Sn&&(K.framebufferTextureLayer(K.READ_FRAMEBUFFER,K.COLOR_ATTACHMENT0,L.get(F).__webglTexture,le,ot+As),K.framebufferTextureLayer(K.DRAW_FRAMEBUFFER,K.COLOR_ATTACHMENT0,L.get(se).__webglTexture,qe,Xn+As)),K.blitFramebuffer(at,xt,tt,je,St,cn,tt,je,K.DEPTH_BUFFER_BIT,K.NEAREST);lt.bindFramebuffer(K.READ_FRAMEBUFFER,null),lt.bindFramebuffer(K.DRAW_FRAMEBUFFER,null)}else if(le!==0||F.isRenderTargetTexture||L.has(F)){const Si=L.get(F),Fi=L.get(se);lt.bindFramebuffer(K.READ_FRAMEBUFFER,yl),lt.bindFramebuffer(K.DRAW_FRAMEBUFFER,xo);for(let Ii=0;Ii<it;Ii++)Sn?K.framebufferTextureLayer(K.READ_FRAMEBUFFER,K.COLOR_ATTACHMENT0,Si.__webglTexture,le,ot+Ii):K.framebufferTexture2D(K.READ_FRAMEBUFFER,K.COLOR_ATTACHMENT0,K.TEXTURE_2D,Si.__webglTexture,le),Bi?K.framebufferTextureLayer(K.DRAW_FRAMEBUFFER,K.COLOR_ATTACHMENT0,Fi.__webglTexture,qe,Xn+Ii):K.framebufferTexture2D(K.DRAW_FRAMEBUFFER,K.COLOR_ATTACHMENT0,K.TEXTURE_2D,Fi.__webglTexture,qe),le!==0?K.blitFramebuffer(at,xt,tt,je,St,cn,tt,je,K.COLOR_BUFFER_BIT,K.NEAREST):Bi?K.copyTexSubImage3D(hn,qe,St,cn,Xn+Ii,at,xt,tt,je):K.copyTexSubImage2D(hn,qe,St,cn,at,xt,tt,je);lt.bindFramebuffer(K.READ_FRAMEBUFFER,null),lt.bindFramebuffer(K.DRAW_FRAMEBUFFER,null)}else Bi?F.isDataTexture||F.isData3DTexture?K.texSubImage3D(hn,qe,St,cn,Xn,tt,je,it,gn,mt,kn.data):se.isCompressedArrayTexture?K.compressedTexSubImage3D(hn,qe,St,cn,Xn,tt,je,it,gn,kn.data):K.texSubImage3D(hn,qe,St,cn,Xn,tt,je,it,gn,mt,kn):F.isDataTexture?K.texSubImage2D(K.TEXTURE_2D,qe,St,cn,tt,je,gn,mt,kn.data):F.isCompressedTexture?K.compressedTexSubImage2D(K.TEXTURE_2D,qe,St,cn,kn.width,kn.height,gn,kn.data):K.texSubImage2D(K.TEXTURE_2D,qe,St,cn,tt,je,gn,mt,kn);K.pixelStorei(K.UNPACK_ROW_LENGTH,Nt),K.pixelStorei(K.UNPACK_IMAGE_HEIGHT,Ui),K.pixelStorei(K.UNPACK_SKIP_PIXELS,Ta),K.pixelStorei(K.UNPACK_SKIP_ROWS,Oi),K.pixelStorei(K.UNPACK_SKIP_IMAGES,rs),qe===0&&se.generateMipmaps&&K.generateMipmap(hn),lt.unbindTexture()},this.initRenderTarget=function(F){L.get(F).__webglFramebuffer===void 0&&re.setupRenderTarget(F)},this.initTexture=function(F){F.isCubeTexture?re.setTextureCube(F,0):F.isData3DTexture?re.setTexture3D(F,0):F.isDataArrayTexture||F.isCompressedArrayTexture?re.setTexture2DArray(F,0):re.setTexture2D(F,0),lt.unbindTexture()},this.resetState=function(){I=0,H=0,X=null,lt.reset(),Qe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return gr}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=vt._getDrawingBufferColorSpace(e),t.unpackColorSpace=vt._getUnpackColorSpace()}}const Kc=new Bs,Ja=new Ue,g2=new k,lx=new Ue,l_=new Ue,b_=new k,wb=new k,_2=new Ht,v2=new k,y2=new k;let ir=null,ra=null;const eo=[],ul={NONE:-1,PAN:0,ROTATE:1};class _4 extends j_{constructor(e,t,n=null){super(t,n),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new c2,this.mouseButtons={LEFT:qi.PAN,MIDDLE:qi.PAN,RIGHT:qi.ROTATE},this.touches={ONE:no.PAN},this._onPointerMove=v4.bind(this),this._onPointerDown=y4.bind(this),this._onPointerCancel=x4.bind(this),this._onContextMenu=b4.bind(this),n!==null&&this.connect(n)}connect(e){super.connect(e),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();Ja.x=(e.clientX-t.left)/t.width*2-1,Ja.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if(e.pointerType==="touch")t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case qi.PAN:case no.PAN:this.state=ul.PAN;break;case qi.ROTATE:case no.ROTATE:this.state=ul.ROTATE;break;default:this.state=ul.NONE}}}function v4(i){const e=this.object,t=this.domElement,n=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(i),n.setFromCamera(Ja,e),ir)this.state===ul.PAN?n.ray.intersectPlane(Kc,b_)&&(ir.position.copy(b_.sub(g2).applyMatrix4(_2)),this.dispatchEvent({type:"drag",object:ir})):this.state===ul.ROTATE&&(lx.subVectors(Ja,l_).multiplyScalar(this.rotateSpeed),ir.rotateOnWorldAxis(v2,lx.x),ir.rotateOnWorldAxis(y2.normalize(),-lx.y),this.dispatchEvent({type:"drag",object:ir})),l_.copy(Ja);else if(i.pointerType==="mouse"||i.pointerType==="pen")if(eo.length=0,n.setFromCamera(Ja,e),n.intersectObjects(this.objects,this.recursive,eo),eo.length>0){const r=eo[0].object;Kc.setFromNormalAndCoplanarPoint(e.getWorldDirection(Kc.normal),wb.setFromMatrixPosition(r.matrixWorld)),ra!==r&&ra!==null&&(this.dispatchEvent({type:"hoveroff",object:ra}),t.style.cursor="auto",ra=null),ra!==r&&(this.dispatchEvent({type:"hoveron",object:r}),t.style.cursor="pointer",ra=r)}else ra!==null&&(this.dispatchEvent({type:"hoveroff",object:ra}),t.style.cursor="auto",ra=null);l_.copy(Ja)}}function y4(i){const e=this.object,t=this.domElement,n=this.raycaster;this.enabled!==!1&&(this._updatePointer(i),this._updateState(i),eo.length=0,n.setFromCamera(Ja,e),n.intersectObjects(this.objects,this.recursive,eo),eo.length>0&&(this.transformGroup===!0?ir=x2(eo[0].object):ir=eo[0].object,Kc.setFromNormalAndCoplanarPoint(e.getWorldDirection(Kc.normal),wb.setFromMatrixPosition(ir.matrixWorld)),n.ray.intersectPlane(Kc,b_)&&(this.state===ul.PAN?(_2.copy(ir.parent.matrixWorld).invert(),g2.copy(b_).sub(wb.setFromMatrixPosition(ir.matrixWorld)),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:ir})):this.state===ul.ROTATE&&(v2.set(0,1,0).applyQuaternion(e.quaternion).normalize(),y2.set(1,0,0).applyQuaternion(e.quaternion).normalize(),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:ir})))),l_.copy(Ja))}function x4(){this.enabled!==!1&&(ir&&(this.dispatchEvent({type:"dragend",object:ir}),ir=null),this.domElement.style.cursor=ra?"pointer":"auto",this.state=ul.NONE)}function b4(i){this.enabled!==!1&&i.preventDefault()}function x2(i,e=null){return i.isGroup&&(e=i),i.parent===null?e:x2(i.parent,e)}function S4(i,e,t){var n,r=1;i==null&&(i=0),e==null&&(e=0),t==null&&(t=0);function s(){var o,u=n.length,c,h=0,d=0,p=0;for(o=0;o<u;++o)c=n[o],h+=c.x||0,d+=c.y||0,p+=c.z||0;for(h=(h/u-i)*r,d=(d/u-e)*r,p=(p/u-t)*r,o=0;o<u;++o)c=n[o],h&&(c.x-=h),d&&(c.y-=d),p&&(c.z-=p)}return s.initialize=function(o){n=o},s.x=function(o){return arguments.length?(i=+o,s):i},s.y=function(o){return arguments.length?(e=+o,s):e},s.z=function(o){return arguments.length?(t=+o,s):t},s.strength=function(o){return arguments.length?(r=+o,s):r},s}function T4(i){const e=+this._x.call(null,i);return b2(this.cover(e),e,i)}function b2(i,e,t){if(isNaN(e))return i;var n,r=i._root,s={data:t},o=i._x0,u=i._x1,c,h,d,p,g;if(!r)return i._root=s,i;for(;r.length;)if((d=e>=(c=(o+u)/2))?o=c:u=c,n=r,!(r=r[p=+d]))return n[p]=s,i;if(h=+i._x.call(null,r.data),e===h)return s.next=r,n?n[p]=s:i._root=s,i;do n=n?n[p]=new Array(2):i._root=new Array(2),(d=e>=(c=(o+u)/2))?o=c:u=c;while((p=+d)==(g=+(h>=c)));return n[g]=r,n[p]=s,i}function M4(i){Array.isArray(i)||(i=Array.from(i));const e=i.length,t=new Float64Array(e);let n=1/0,r=-1/0;for(let s=0,o;s<e;++s)isNaN(o=+this._x.call(null,i[s]))||(t[s]=o,o<n&&(n=o),o>r&&(r=o));if(n>r)return this;this.cover(n).cover(r);for(let s=0;s<e;++s)b2(this,t[s],i[s]);return this}function E4(i){if(isNaN(i=+i))return this;var e=this._x0,t=this._x1;if(isNaN(e))t=(e=Math.floor(i))+1;else{for(var n=t-e||1,r=this._root,s,o;e>i||i>=t;)switch(o=+(i<e),s=new Array(2),s[o]=r,r=s,n*=2,o){case 0:t=e+n;break;case 1:e=t-n;break}this._root&&this._root.length&&(this._root=r)}return this._x0=e,this._x1=t,this}function A4(){var i=[];return this.visit(function(e){if(!e.length)do i.push(e.data);while(e=e.next)}),i}function w4(i){return arguments.length?this.cover(+i[0][0]).cover(+i[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function co(i,e,t){this.node=i,this.x0=e,this.x1=t}function R4(i,e){var t,n=this._x0,r,s,o=this._x1,u=[],c=this._root,h,d;for(c&&u.push(new co(c,n,o)),e==null?e=1/0:(n=i-e,o=i+e);h=u.pop();)if(!(!(c=h.node)||(r=h.x0)>o||(s=h.x1)<n))if(c.length){var p=(r+s)/2;u.push(new co(c[1],p,s),new co(c[0],r,p)),(d=+(i>=p))&&(h=u[u.length-1],u[u.length-1]=u[u.length-1-d],u[u.length-1-d]=h)}else{var g=Math.abs(i-+this._x.call(null,c.data));g<e&&(e=g,n=i-g,o=i+g,t=c.data)}return t}function C4(i){if(isNaN(c=+this._x.call(null,i)))return this;var e,t=this._root,n,r,s,o=this._x0,u=this._x1,c,h,d,p,g;if(!t)return this;if(t.length)for(;;){if((d=c>=(h=(o+u)/2))?o=h:u=h,e=t,!(t=t[p=+d]))return this;if(!t.length)break;e[p+1&1]&&(n=e,g=p)}for(;t.data!==i;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[p]=s:delete e[p],(t=e[0]||e[1])&&t===(e[1]||e[0])&&!t.length&&(n?n[g]=t:this._root=t),this):(this._root=s,this)}function N4(i){for(var e=0,t=i.length;e<t;++e)this.remove(i[e]);return this}function D4(){return this._root}function L4(){var i=0;return this.visit(function(e){if(!e.length)do++i;while(e=e.next)}),i}function P4(i){var e=[],t,n=this._root,r,s,o;for(n&&e.push(new co(n,this._x0,this._x1));t=e.pop();)if(!i(n=t.node,s=t.x0,o=t.x1)&&n.length){var u=(s+o)/2;(r=n[1])&&e.push(new co(r,u,o)),(r=n[0])&&e.push(new co(r,s,u))}return this}function U4(i){var e=[],t=[],n;for(this._root&&e.push(new co(this._root,this._x0,this._x1));n=e.pop();){var r=n.node;if(r.length){var s,o=n.x0,u=n.x1,c=(o+u)/2;(s=r[0])&&e.push(new co(s,o,c)),(s=r[1])&&e.push(new co(s,c,u))}t.push(n)}for(;n=t.pop();)i(n.node,n.x0,n.x1);return this}function O4(i){return i[0]}function B4(i){return arguments.length?(this._x=i,this):this._x}function S2(i,e){var t=new lT(e??O4,NaN,NaN);return i==null?t:t.addAll(i)}function lT(i,e,t){this._x=i,this._x0=e,this._x1=t,this._root=void 0}function Gw(i){for(var e={data:i.data},t=e;i=i.next;)t=t.next={data:i.data};return e}var Ir=S2.prototype=lT.prototype;Ir.copy=function(){var i=new lT(this._x,this._x0,this._x1),e=this._root,t,n;if(!e)return i;if(!e.length)return i._root=Gw(e),i;for(t=[{source:e,target:i._root=new Array(2)}];e=t.pop();)for(var r=0;r<2;++r)(n=e.source[r])&&(n.length?t.push({source:n,target:e.target[r]=new Array(2)}):e.target[r]=Gw(n));return i};Ir.add=T4;Ir.addAll=M4;Ir.cover=E4;Ir.data=A4;Ir.extent=w4;Ir.find=R4;Ir.remove=C4;Ir.removeAll=N4;Ir.root=D4;Ir.size=L4;Ir.visit=P4;Ir.visitAfter=U4;Ir.x=B4;function F4(i){const e=+this._x.call(null,i),t=+this._y.call(null,i);return T2(this.cover(e,t),e,t,i)}function T2(i,e,t,n){if(isNaN(e)||isNaN(t))return i;var r,s=i._root,o={data:n},u=i._x0,c=i._y0,h=i._x1,d=i._y1,p,g,_,v,T,b,x,M;if(!s)return i._root=o,i;for(;s.length;)if((T=e>=(p=(u+h)/2))?u=p:h=p,(b=t>=(g=(c+d)/2))?c=g:d=g,r=s,!(s=s[x=b<<1|T]))return r[x]=o,i;if(_=+i._x.call(null,s.data),v=+i._y.call(null,s.data),e===_&&t===v)return o.next=s,r?r[x]=o:i._root=o,i;do r=r?r[x]=new Array(4):i._root=new Array(4),(T=e>=(p=(u+h)/2))?u=p:h=p,(b=t>=(g=(c+d)/2))?c=g:d=g;while((x=b<<1|T)===(M=(v>=g)<<1|_>=p));return r[M]=s,r[x]=o,i}function I4(i){var e,t,n=i.length,r,s,o=new Array(n),u=new Array(n),c=1/0,h=1/0,d=-1/0,p=-1/0;for(t=0;t<n;++t)isNaN(r=+this._x.call(null,e=i[t]))||isNaN(s=+this._y.call(null,e))||(o[t]=r,u[t]=s,r<c&&(c=r),r>d&&(d=r),s<h&&(h=s),s>p&&(p=s));if(c>d||h>p)return this;for(this.cover(c,h).cover(d,p),t=0;t<n;++t)T2(this,o[t],u[t],i[t]);return this}function z4(i,e){if(isNaN(i=+i)||isNaN(e=+e))return this;var t=this._x0,n=this._y0,r=this._x1,s=this._y1;if(isNaN(t))r=(t=Math.floor(i))+1,s=(n=Math.floor(e))+1;else{for(var o=r-t||1,u=this._root,c,h;t>i||i>=r||n>e||e>=s;)switch(h=(e<n)<<1|i<t,c=new Array(4),c[h]=u,u=c,o*=2,h){case 0:r=t+o,s=n+o;break;case 1:t=r-o,s=n+o;break;case 2:r=t+o,n=s-o;break;case 3:t=r-o,n=s-o;break}this._root&&this._root.length&&(this._root=u)}return this._x0=t,this._y0=n,this._x1=r,this._y1=s,this}function G4(){var i=[];return this.visit(function(e){if(!e.length)do i.push(e.data);while(e=e.next)}),i}function k4(i){return arguments.length?this.cover(+i[0][0],+i[0][1]).cover(+i[1][0],+i[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function dr(i,e,t,n,r){this.node=i,this.x0=e,this.y0=t,this.x1=n,this.y1=r}function V4(i,e,t){var n,r=this._x0,s=this._y0,o,u,c,h,d=this._x1,p=this._y1,g=[],_=this._root,v,T;for(_&&g.push(new dr(_,r,s,d,p)),t==null?t=1/0:(r=i-t,s=e-t,d=i+t,p=e+t,t*=t);v=g.pop();)if(!(!(_=v.node)||(o=v.x0)>d||(u=v.y0)>p||(c=v.x1)<r||(h=v.y1)<s))if(_.length){var b=(o+c)/2,x=(u+h)/2;g.push(new dr(_[3],b,x,c,h),new dr(_[2],o,x,b,h),new dr(_[1],b,u,c,x),new dr(_[0],o,u,b,x)),(T=(e>=x)<<1|i>=b)&&(v=g[g.length-1],g[g.length-1]=g[g.length-1-T],g[g.length-1-T]=v)}else{var M=i-+this._x.call(null,_.data),E=e-+this._y.call(null,_.data),w=M*M+E*E;if(w<t){var C=Math.sqrt(t=w);r=i-C,s=e-C,d=i+C,p=e+C,n=_.data}}return n}function H4(i){if(isNaN(d=+this._x.call(null,i))||isNaN(p=+this._y.call(null,i)))return this;var e,t=this._root,n,r,s,o=this._x0,u=this._y0,c=this._x1,h=this._y1,d,p,g,_,v,T,b,x;if(!t)return this;if(t.length)for(;;){if((v=d>=(g=(o+c)/2))?o=g:c=g,(T=p>=(_=(u+h)/2))?u=_:h=_,e=t,!(t=t[b=T<<1|v]))return this;if(!t.length)break;(e[b+1&3]||e[b+2&3]||e[b+3&3])&&(n=e,x=b)}for(;t.data!==i;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[b]=s:delete e[b],(t=e[0]||e[1]||e[2]||e[3])&&t===(e[3]||e[2]||e[1]||e[0])&&!t.length&&(n?n[x]=t:this._root=t),this):(this._root=s,this)}function W4(i){for(var e=0,t=i.length;e<t;++e)this.remove(i[e]);return this}function q4(){return this._root}function $4(){var i=0;return this.visit(function(e){if(!e.length)do++i;while(e=e.next)}),i}function j4(i){var e=[],t,n=this._root,r,s,o,u,c;for(n&&e.push(new dr(n,this._x0,this._y0,this._x1,this._y1));t=e.pop();)if(!i(n=t.node,s=t.x0,o=t.y0,u=t.x1,c=t.y1)&&n.length){var h=(s+u)/2,d=(o+c)/2;(r=n[3])&&e.push(new dr(r,h,d,u,c)),(r=n[2])&&e.push(new dr(r,s,d,h,c)),(r=n[1])&&e.push(new dr(r,h,o,u,d)),(r=n[0])&&e.push(new dr(r,s,o,h,d))}return this}function X4(i){var e=[],t=[],n;for(this._root&&e.push(new dr(this._root,this._x0,this._y0,this._x1,this._y1));n=e.pop();){var r=n.node;if(r.length){var s,o=n.x0,u=n.y0,c=n.x1,h=n.y1,d=(o+c)/2,p=(u+h)/2;(s=r[0])&&e.push(new dr(s,o,u,d,p)),(s=r[1])&&e.push(new dr(s,d,u,c,p)),(s=r[2])&&e.push(new dr(s,o,p,d,h)),(s=r[3])&&e.push(new dr(s,d,p,c,h))}t.push(n)}for(;n=t.pop();)i(n.node,n.x0,n.y0,n.x1,n.y1);return this}function Y4(i){return i[0]}function K4(i){return arguments.length?(this._x=i,this):this._x}function Q4(i){return i[1]}function Z4(i){return arguments.length?(this._y=i,this):this._y}function M2(i,e,t){var n=new uT(e??Y4,t??Q4,NaN,NaN,NaN,NaN);return i==null?n:n.addAll(i)}function uT(i,e,t,n,r,s){this._x=i,this._y=e,this._x0=t,this._y0=n,this._x1=r,this._y1=s,this._root=void 0}function kw(i){for(var e={data:i.data},t=e;i=i.next;)t=t.next={data:i.data};return e}var yr=M2.prototype=uT.prototype;yr.copy=function(){var i=new uT(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,t,n;if(!e)return i;if(!e.length)return i._root=kw(e),i;for(t=[{source:e,target:i._root=new Array(4)}];e=t.pop();)for(var r=0;r<4;++r)(n=e.source[r])&&(n.length?t.push({source:n,target:e.target[r]=new Array(4)}):e.target[r]=kw(n));return i};yr.add=F4;yr.addAll=I4;yr.cover=z4;yr.data=G4;yr.extent=k4;yr.find=V4;yr.remove=H4;yr.removeAll=W4;yr.root=q4;yr.size=$4;yr.visit=j4;yr.visitAfter=X4;yr.x=K4;yr.y=Z4;function J4(i){const e=+this._x.call(null,i),t=+this._y.call(null,i),n=+this._z.call(null,i);return E2(this.cover(e,t,n),e,t,n,i)}function E2(i,e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n))return i;var s,o=i._root,u={data:r},c=i._x0,h=i._y0,d=i._z0,p=i._x1,g=i._y1,_=i._z1,v,T,b,x,M,E,w,C,N,D,U;if(!o)return i._root=u,i;for(;o.length;)if((w=e>=(v=(c+p)/2))?c=v:p=v,(C=t>=(T=(h+g)/2))?h=T:g=T,(N=n>=(b=(d+_)/2))?d=b:_=b,s=o,!(o=o[D=N<<2|C<<1|w]))return s[D]=u,i;if(x=+i._x.call(null,o.data),M=+i._y.call(null,o.data),E=+i._z.call(null,o.data),e===x&&t===M&&n===E)return u.next=o,s?s[D]=u:i._root=u,i;do s=s?s[D]=new Array(8):i._root=new Array(8),(w=e>=(v=(c+p)/2))?c=v:p=v,(C=t>=(T=(h+g)/2))?h=T:g=T,(N=n>=(b=(d+_)/2))?d=b:_=b;while((D=N<<2|C<<1|w)===(U=(E>=b)<<2|(M>=T)<<1|x>=v));return s[U]=o,s[D]=u,i}function eV(i){Array.isArray(i)||(i=Array.from(i));const e=i.length,t=new Float64Array(e),n=new Float64Array(e),r=new Float64Array(e);let s=1/0,o=1/0,u=1/0,c=-1/0,h=-1/0,d=-1/0;for(let p=0,g,_,v,T;p<e;++p)isNaN(_=+this._x.call(null,g=i[p]))||isNaN(v=+this._y.call(null,g))||isNaN(T=+this._z.call(null,g))||(t[p]=_,n[p]=v,r[p]=T,_<s&&(s=_),_>c&&(c=_),v<o&&(o=v),v>h&&(h=v),T<u&&(u=T),T>d&&(d=T));if(s>c||o>h||u>d)return this;this.cover(s,o,u).cover(c,h,d);for(let p=0;p<e;++p)E2(this,t[p],n[p],r[p],i[p]);return this}function tV(i,e,t){if(isNaN(i=+i)||isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,s=this._z0,o=this._x1,u=this._y1,c=this._z1;if(isNaN(n))o=(n=Math.floor(i))+1,u=(r=Math.floor(e))+1,c=(s=Math.floor(t))+1;else{for(var h=o-n||1,d=this._root,p,g;n>i||i>=o||r>e||e>=u||s>t||t>=c;)switch(g=(t<s)<<2|(e<r)<<1|i<n,p=new Array(8),p[g]=d,d=p,h*=2,g){case 0:o=n+h,u=r+h,c=s+h;break;case 1:n=o-h,u=r+h,c=s+h;break;case 2:o=n+h,r=u-h,c=s+h;break;case 3:n=o-h,r=u-h,c=s+h;break;case 4:o=n+h,u=r+h,s=c-h;break;case 5:n=o-h,u=r+h,s=c-h;break;case 6:o=n+h,r=u-h,s=c-h;break;case 7:n=o-h,r=u-h,s=c-h;break}this._root&&this._root.length&&(this._root=d)}return this._x0=n,this._y0=r,this._z0=s,this._x1=o,this._y1=u,this._z1=c,this}function nV(){var i=[];return this.visit(function(e){if(!e.length)do i.push(e.data);while(e=e.next)}),i}function iV(i){return arguments.length?this.cover(+i[0][0],+i[0][1],+i[0][2]).cover(+i[1][0],+i[1][1],+i[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function Fn(i,e,t,n,r,s,o){this.node=i,this.x0=e,this.y0=t,this.z0=n,this.x1=r,this.y1=s,this.z1=o}function rV(i,e,t,n){var r,s=this._x0,o=this._y0,u=this._z0,c,h,d,p,g,_,v=this._x1,T=this._y1,b=this._z1,x=[],M=this._root,E,w;for(M&&x.push(new Fn(M,s,o,u,v,T,b)),n==null?n=1/0:(s=i-n,o=e-n,u=t-n,v=i+n,T=e+n,b=t+n,n*=n);E=x.pop();)if(!(!(M=E.node)||(c=E.x0)>v||(h=E.y0)>T||(d=E.z0)>b||(p=E.x1)<s||(g=E.y1)<o||(_=E.z1)<u))if(M.length){var C=(c+p)/2,N=(h+g)/2,D=(d+_)/2;x.push(new Fn(M[7],C,N,D,p,g,_),new Fn(M[6],c,N,D,C,g,_),new Fn(M[5],C,h,D,p,N,_),new Fn(M[4],c,h,D,C,N,_),new Fn(M[3],C,N,d,p,g,D),new Fn(M[2],c,N,d,C,g,D),new Fn(M[1],C,h,d,p,N,D),new Fn(M[0],c,h,d,C,N,D)),(w=(t>=D)<<2|(e>=N)<<1|i>=C)&&(E=x[x.length-1],x[x.length-1]=x[x.length-1-w],x[x.length-1-w]=E)}else{var U=i-+this._x.call(null,M.data),R=e-+this._y.call(null,M.data),P=t-+this._z.call(null,M.data),I=U*U+R*R+P*P;if(I<n){var H=Math.sqrt(n=I);s=i-H,o=e-H,u=t-H,v=i+H,T=e+H,b=t+H,r=M.data}}return r}const sV=(i,e,t,n,r,s)=>Math.sqrt((i-n)**2+(e-r)**2+(t-s)**2);function aV(i,e,t,n){const r=[],s=i-n,o=e-n,u=t-n,c=i+n,h=e+n,d=t+n;return this.visit((p,g,_,v,T,b,x)=>{if(!p.length)do{const M=p.data;sV(i,e,t,this._x(M),this._y(M),this._z(M))<=n&&r.push(M)}while(p=p.next);return g>c||_>h||v>d||T<s||b<o||x<u}),r}function oV(i){if(isNaN(g=+this._x.call(null,i))||isNaN(_=+this._y.call(null,i))||isNaN(v=+this._z.call(null,i)))return this;var e,t=this._root,n,r,s,o=this._x0,u=this._y0,c=this._z0,h=this._x1,d=this._y1,p=this._z1,g,_,v,T,b,x,M,E,w,C,N;if(!t)return this;if(t.length)for(;;){if((M=g>=(T=(o+h)/2))?o=T:h=T,(E=_>=(b=(u+d)/2))?u=b:d=b,(w=v>=(x=(c+p)/2))?c=x:p=x,e=t,!(t=t[C=w<<2|E<<1|M]))return this;if(!t.length)break;(e[C+1&7]||e[C+2&7]||e[C+3&7]||e[C+4&7]||e[C+5&7]||e[C+6&7]||e[C+7&7])&&(n=e,N=C)}for(;t.data!==i;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[C]=s:delete e[C],(t=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&t===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!t.length&&(n?n[N]=t:this._root=t),this):(this._root=s,this)}function lV(i){for(var e=0,t=i.length;e<t;++e)this.remove(i[e]);return this}function uV(){return this._root}function cV(){var i=0;return this.visit(function(e){if(!e.length)do++i;while(e=e.next)}),i}function hV(i){var e=[],t,n=this._root,r,s,o,u,c,h,d;for(n&&e.push(new Fn(n,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=e.pop();)if(!i(n=t.node,s=t.x0,o=t.y0,u=t.z0,c=t.x1,h=t.y1,d=t.z1)&&n.length){var p=(s+c)/2,g=(o+h)/2,_=(u+d)/2;(r=n[7])&&e.push(new Fn(r,p,g,_,c,h,d)),(r=n[6])&&e.push(new Fn(r,s,g,_,p,h,d)),(r=n[5])&&e.push(new Fn(r,p,o,_,c,g,d)),(r=n[4])&&e.push(new Fn(r,s,o,_,p,g,d)),(r=n[3])&&e.push(new Fn(r,p,g,u,c,h,_)),(r=n[2])&&e.push(new Fn(r,s,g,u,p,h,_)),(r=n[1])&&e.push(new Fn(r,p,o,u,c,g,_)),(r=n[0])&&e.push(new Fn(r,s,o,u,p,g,_))}return this}function fV(i){var e=[],t=[],n;for(this._root&&e.push(new Fn(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));n=e.pop();){var r=n.node;if(r.length){var s,o=n.x0,u=n.y0,c=n.z0,h=n.x1,d=n.y1,p=n.z1,g=(o+h)/2,_=(u+d)/2,v=(c+p)/2;(s=r[0])&&e.push(new Fn(s,o,u,c,g,_,v)),(s=r[1])&&e.push(new Fn(s,g,u,c,h,_,v)),(s=r[2])&&e.push(new Fn(s,o,_,c,g,d,v)),(s=r[3])&&e.push(new Fn(s,g,_,c,h,d,v)),(s=r[4])&&e.push(new Fn(s,o,u,v,g,_,p)),(s=r[5])&&e.push(new Fn(s,g,u,v,h,_,p)),(s=r[6])&&e.push(new Fn(s,o,_,v,g,d,p)),(s=r[7])&&e.push(new Fn(s,g,_,v,h,d,p))}t.push(n)}for(;n=t.pop();)i(n.node,n.x0,n.y0,n.z0,n.x1,n.y1,n.z1);return this}function dV(i){return i[0]}function pV(i){return arguments.length?(this._x=i,this):this._x}function mV(i){return i[1]}function gV(i){return arguments.length?(this._y=i,this):this._y}function _V(i){return i[2]}function vV(i){return arguments.length?(this._z=i,this):this._z}function A2(i,e,t,n){var r=new cT(e??dV,t??mV,n??_V,NaN,NaN,NaN,NaN,NaN,NaN);return i==null?r:r.addAll(i)}function cT(i,e,t,n,r,s,o,u,c){this._x=i,this._y=e,this._z=t,this._x0=n,this._y0=r,this._z0=s,this._x1=o,this._y1=u,this._z1=c,this._root=void 0}function Vw(i){for(var e={data:i.data},t=e;i=i.next;)t=t.next={data:i.data};return e}var Ki=A2.prototype=cT.prototype;Ki.copy=function(){var i=new cT(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,t,n;if(!e)return i;if(!e.length)return i._root=Vw(e),i;for(t=[{source:e,target:i._root=new Array(8)}];e=t.pop();)for(var r=0;r<8;++r)(n=e.source[r])&&(n.length?t.push({source:n,target:e.target[r]=new Array(8)}):e.target[r]=Vw(n));return i};Ki.add=J4;Ki.addAll=eV;Ki.cover=tV;Ki.data=nV;Ki.extent=iV;Ki.find=rV;Ki.findAllWithinRadius=aV;Ki.remove=oV;Ki.removeAll=lV;Ki.root=uV;Ki.size=cV;Ki.visit=hV;Ki.visitAfter=fV;Ki.x=pV;Ki.y=gV;Ki.z=vV;function so(i){return function(){return i}}function Qa(i){return(i()-.5)*1e-6}function yV(i){return i.index}function Hw(i,e){var t=i.get(e);if(!t)throw new Error("node not found: "+e);return t}function xV(i){var e=yV,t=g,n,r=so(30),s,o,u,c,h,d,p=1;i==null&&(i=[]);function g(x){return 1/Math.min(c[x.source.index],c[x.target.index])}function _(x){for(var M=0,E=i.length;M<p;++M)for(var w=0,C,N,D,U=0,R=0,P=0,I,H;w<E;++w)C=i[w],N=C.source,D=C.target,U=D.x+D.vx-N.x-N.vx||Qa(d),u>1&&(R=D.y+D.vy-N.y-N.vy||Qa(d)),u>2&&(P=D.z+D.vz-N.z-N.vz||Qa(d)),I=Math.sqrt(U*U+R*R+P*P),I=(I-s[w])/I*x*n[w],U*=I,R*=I,P*=I,D.vx-=U*(H=h[w]),u>1&&(D.vy-=R*H),u>2&&(D.vz-=P*H),N.vx+=U*(H=1-H),u>1&&(N.vy+=R*H),u>2&&(N.vz+=P*H)}function v(){if(o){var x,M=o.length,E=i.length,w=new Map(o.map((N,D)=>[e(N,D,o),N])),C;for(x=0,c=new Array(M);x<E;++x)C=i[x],C.index=x,typeof C.source!="object"&&(C.source=Hw(w,C.source)),typeof C.target!="object"&&(C.target=Hw(w,C.target)),c[C.source.index]=(c[C.source.index]||0)+1,c[C.target.index]=(c[C.target.index]||0)+1;for(x=0,h=new Array(E);x<E;++x)C=i[x],h[x]=c[C.source.index]/(c[C.source.index]+c[C.target.index]);n=new Array(E),T(),s=new Array(E),b()}}function T(){if(o)for(var x=0,M=i.length;x<M;++x)n[x]=+t(i[x],x,i)}function b(){if(o)for(var x=0,M=i.length;x<M;++x)s[x]=+r(i[x],x,i)}return _.initialize=function(x,...M){o=x,d=M.find(E=>typeof E=="function")||Math.random,u=M.find(E=>[1,2,3].includes(E))||2,v()},_.links=function(x){return arguments.length?(i=x,v(),_):i},_.id=function(x){return arguments.length?(e=x,_):e},_.iterations=function(x){return arguments.length?(p=+x,_):p},_.strength=function(x){return arguments.length?(t=typeof x=="function"?x:so(+x),T(),_):t},_.distance=function(x){return arguments.length?(r=typeof x=="function"?x:so(+x),b(),_):r},_}var bV={value:()=>{}};function w2(){for(var i=0,e=arguments.length,t={},n;i<e;++i){if(!(n=arguments[i]+"")||n in t||/[\s.]/.test(n))throw new Error("illegal type: "+n);t[n]=[]}return new u_(t)}function u_(i){this._=i}function SV(i,e){return i.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}u_.prototype=w2.prototype={constructor:u_,on:function(i,e){var t=this._,n=SV(i+"",t),r,s=-1,o=n.length;if(arguments.length<2){for(;++s<o;)if((r=(i=n[s]).type)&&(r=TV(t[r],i.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(i=n[s]).type)t[r]=Ww(t[r],i.name,e);else if(e==null)for(r in t)t[r]=Ww(t[r],i.name,null);return this},copy:function(){var i={},e=this._;for(var t in e)i[t]=e[t].slice();return new u_(i)},call:function(i,e){if((r=arguments.length-2)>0)for(var t=new Array(r),n=0,r,s;n<r;++n)t[n]=arguments[n+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(s=this._[i],n=0,r=s.length;n<r;++n)s[n].value.apply(e,t)},apply:function(i,e,t){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var n=this._[i],r=0,s=n.length;r<s;++r)n[r].value.apply(e,t)}};function TV(i,e){for(var t=0,n=i.length,r;t<n;++t)if((r=i[t]).name===e)return r.value}function Ww(i,e,t){for(var n=0,r=i.length;n<r;++n)if(i[n].name===e){i[n]=bV,i=i.slice(0,n).concat(i.slice(n+1));break}return t!=null&&i.push({name:e,value:t}),i}var Lh=0,Cd=0,ad=0,R2=1e3,S_,Nd,T_=0,_u=0,K_=0,mp=typeof performance=="object"&&performance.now?performance:Date,C2=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function N2(){return _u||(C2(MV),_u=mp.now()+K_)}function MV(){_u=0}function Rb(){this._call=this._time=this._next=null}Rb.prototype=D2.prototype={constructor:Rb,restart:function(i,e,t){if(typeof i!="function")throw new TypeError("callback is not a function");t=(t==null?N2():+t)+(e==null?0:+e),!this._next&&Nd!==this&&(Nd?Nd._next=this:S_=this,Nd=this),this._call=i,this._time=t,Cb()},stop:function(){this._call&&(this._call=null,this._time=1/0,Cb())}};function D2(i,e,t){var n=new Rb;return n.restart(i,e,t),n}function EV(){N2(),++Lh;for(var i=S_,e;i;)(e=_u-i._time)>=0&&i._call.call(void 0,e),i=i._next;--Lh}function qw(){_u=(T_=mp.now())+K_,Lh=Cd=0;try{EV()}finally{Lh=0,wV(),_u=0}}function AV(){var i=mp.now(),e=i-T_;e>R2&&(K_-=e,T_=i)}function wV(){for(var i,e=S_,t,n=1/0;e;)e._call?(n>e._time&&(n=e._time),i=e,e=e._next):(t=e._next,e._next=null,e=i?i._next=t:S_=t);Nd=i,Cb(n)}function Cb(i){if(!Lh){Cd&&(Cd=clearTimeout(Cd));var e=i-_u;e>24?(i<1/0&&(Cd=setTimeout(qw,i-mp.now()-K_)),ad&&(ad=clearInterval(ad))):(ad||(T_=mp.now(),ad=setInterval(AV,R2)),Lh=1,C2(qw))}}const RV=1664525,CV=1013904223,$w=4294967296;function NV(){let i=1;return()=>(i=(RV*i+CV)%$w)/$w}var jw=3;function ux(i){return i.x}function Xw(i){return i.y}function DV(i){return i.z}var LV=10,PV=Math.PI*(3-Math.sqrt(5)),UV=Math.PI*20/(9+Math.sqrt(221));function OV(i,e){e=e||2;var t=Math.min(jw,Math.max(1,Math.round(e))),n,r=1,s=.001,o=1-Math.pow(s,1/300),u=0,c=.6,h=new Map,d=D2(_),p=w2("tick","end"),g=NV();i==null&&(i=[]);function _(){v(),p.call("tick",n),r<s&&(d.stop(),p.call("end",n))}function v(x){var M,E=i.length,w;x===void 0&&(x=1);for(var C=0;C<x;++C)for(r+=(u-r)*o,h.forEach(function(N){N(r)}),M=0;M<E;++M)w=i[M],w.fx==null?w.x+=w.vx*=c:(w.x=w.fx,w.vx=0),t>1&&(w.fy==null?w.y+=w.vy*=c:(w.y=w.fy,w.vy=0)),t>2&&(w.fz==null?w.z+=w.vz*=c:(w.z=w.fz,w.vz=0));return n}function T(){for(var x=0,M=i.length,E;x<M;++x){if(E=i[x],E.index=x,E.fx!=null&&(E.x=E.fx),E.fy!=null&&(E.y=E.fy),E.fz!=null&&(E.z=E.fz),isNaN(E.x)||t>1&&isNaN(E.y)||t>2&&isNaN(E.z)){var w=LV*(t>2?Math.cbrt(.5+x):t>1?Math.sqrt(.5+x):x),C=x*PV,N=x*UV;t===1?E.x=w:t===2?(E.x=w*Math.cos(C),E.y=w*Math.sin(C)):(E.x=w*Math.sin(C)*Math.cos(N),E.y=w*Math.cos(C),E.z=w*Math.sin(C)*Math.sin(N))}(isNaN(E.vx)||t>1&&isNaN(E.vy)||t>2&&isNaN(E.vz))&&(E.vx=0,t>1&&(E.vy=0),t>2&&(E.vz=0))}}function b(x){return x.initialize&&x.initialize(i,g,t),x}return T(),n={tick:v,restart:function(){return d.restart(_),n},stop:function(){return d.stop(),n},numDimensions:function(x){return arguments.length?(t=Math.min(jw,Math.max(1,Math.round(x))),h.forEach(b),n):t},nodes:function(x){return arguments.length?(i=x,T(),h.forEach(b),n):i},alpha:function(x){return arguments.length?(r=+x,n):r},alphaMin:function(x){return arguments.length?(s=+x,n):s},alphaDecay:function(x){return arguments.length?(o=+x,n):+o},alphaTarget:function(x){return arguments.length?(u=+x,n):u},velocityDecay:function(x){return arguments.length?(c=1-x,n):1-c},randomSource:function(x){return arguments.length?(g=x,h.forEach(b),n):g},force:function(x,M){return arguments.length>1?(M==null?h.delete(x):h.set(x,b(M)),n):h.get(x)},find:function(){var x=Array.prototype.slice.call(arguments),M=x.shift()||0,E=(t>1?x.shift():null)||0,w=(t>2?x.shift():null)||0,C=x.shift()||1/0,N=0,D=i.length,U,R,P,I,H,X;for(C*=C,N=0;N<D;++N)H=i[N],U=M-H.x,R=E-(H.y||0),P=w-(H.z||0),I=U*U+R*R+P*P,I<C&&(X=H,C=I);return X},on:function(x,M){return arguments.length>1?(p.on(x,M),n):p.on(x)}}}function BV(){var i,e,t,n,r,s=so(-30),o,u=1,c=1/0,h=.81;function d(v){var T,b=i.length,x=(e===1?S2(i,ux):e===2?M2(i,ux,Xw):e===3?A2(i,ux,Xw,DV):null).visitAfter(g);for(r=v,T=0;T<b;++T)t=i[T],x.visit(_)}function p(){if(i){var v,T=i.length,b;for(o=new Array(T),v=0;v<T;++v)b=i[v],o[b.index]=+s(b,v,i)}}function g(v){var T=0,b,x,M=0,E,w,C,N,D=v.length;if(D){for(E=w=C=N=0;N<D;++N)(b=v[N])&&(x=Math.abs(b.value))&&(T+=b.value,M+=x,E+=x*(b.x||0),w+=x*(b.y||0),C+=x*(b.z||0));T*=Math.sqrt(4/D),v.x=E/M,e>1&&(v.y=w/M),e>2&&(v.z=C/M)}else{b=v,b.x=b.data.x,e>1&&(b.y=b.data.y),e>2&&(b.z=b.data.z);do T+=o[b.data.index];while(b=b.next)}v.value=T}function _(v,T,b,x,M){if(!v.value)return!0;var E=[b,x,M][e-1],w=v.x-t.x,C=e>1?v.y-t.y:0,N=e>2?v.z-t.z:0,D=E-T,U=w*w+C*C+N*N;if(D*D/h<U)return U<c&&(w===0&&(w=Qa(n),U+=w*w),e>1&&C===0&&(C=Qa(n),U+=C*C),e>2&&N===0&&(N=Qa(n),U+=N*N),U<u&&(U=Math.sqrt(u*U)),t.vx+=w*v.value*r/U,e>1&&(t.vy+=C*v.value*r/U),e>2&&(t.vz+=N*v.value*r/U)),!0;if(v.length||U>=c)return;(v.data!==t||v.next)&&(w===0&&(w=Qa(n),U+=w*w),e>1&&C===0&&(C=Qa(n),U+=C*C),e>2&&N===0&&(N=Qa(n),U+=N*N),U<u&&(U=Math.sqrt(u*U)));do v.data!==t&&(D=o[v.data.index]*r/U,t.vx+=w*D,e>1&&(t.vy+=C*D),e>2&&(t.vz+=N*D));while(v=v.next)}return d.initialize=function(v,...T){i=v,n=T.find(b=>typeof b=="function")||Math.random,e=T.find(b=>[1,2,3].includes(b))||2,p()},d.strength=function(v){return arguments.length?(s=typeof v=="function"?v:so(+v),p(),d):s},d.distanceMin=function(v){return arguments.length?(u=v*v,d):Math.sqrt(u)},d.distanceMax=function(v){return arguments.length?(c=v*v,d):Math.sqrt(c)},d.theta=function(v){return arguments.length?(h=v*v,d):Math.sqrt(h)},d}function FV(i,e,t,n){var r,s,o=so(.1),u,c;typeof i!="function"&&(i=so(+i)),e==null&&(e=0),t==null&&(t=0),n==null&&(n=0);function h(p){for(var g=0,_=r.length;g<_;++g){var v=r[g],T=v.x-e||1e-6,b=(v.y||0)-t||1e-6,x=(v.z||0)-n||1e-6,M=Math.sqrt(T*T+b*b+x*x),E=(c[g]-M)*u[g]*p/M;v.vx+=T*E,s>1&&(v.vy+=b*E),s>2&&(v.vz+=x*E)}}function d(){if(r){var p,g=r.length;for(u=new Array(g),c=new Array(g),p=0;p<g;++p)c[p]=+i(r[p],p,r),u[p]=isNaN(c[p])?0:+o(r[p],p,r)}}return h.initialize=function(p,...g){r=p,s=g.find(_=>[1,2,3].includes(_))||2,d()},h.strength=function(p){return arguments.length?(o=typeof p=="function"?p:so(+p),d(),h):o},h.radius=function(p){return arguments.length?(i=typeof p=="function"?p:so(+p),d(),h):i},h.x=function(p){return arguments.length?(e=+p,h):e},h.y=function(p){return arguments.length?(t=+p,h):t},h.z=function(p){return arguments.length?(n=+p,h):n},h}function IV(i){GV(i);const e=zV(i);return i.on=e.on,i.off=e.off,i.fire=e.fire,i}function zV(i){let e=Object.create(null);return{on:function(t,n,r){if(typeof n!="function")throw new Error("callback is expected to be a function");let s=e[t];return s||(s=e[t]=[]),s.push({callback:n,ctx:r}),i},off:function(t,n){if(typeof t>"u")return e=Object.create(null),i;if(e[t])if(typeof n!="function")delete e[t];else{const o=e[t];for(let u=0;u<o.length;++u)o[u].callback===n&&o.splice(u,1)}return i},fire:function(t){const n=e[t];if(!n)return i;let r;arguments.length>1&&(r=Array.prototype.slice.call(arguments,1));for(let s=0;s<n.length;++s){const o=n[s];o.callback.apply(o.ctx,r)}return i}}}function GV(i){if(!i)throw new Error("Eventify cannot use falsy object as events subject");const e=["on","fire","off"];for(let t=0;t<e.length;++t)if(i.hasOwnProperty(e[t]))throw new Error("Subject cannot be eventified, since it already has property '"+e[t]+"'")}function kV(i){if(i=i||{},"uniqueLinkId"in i&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),i.multigraph=i.uniqueLinkId),i.multigraph===void 0&&(i.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var e=new Map,t=new Map,n={},r=0,s=i.multigraph?w:E,o=[],u=z,c=z,h=z,d=z,p={version:20,addNode:T,addLink:M,removeLink:U,removeNode:x,getNode:b,getNodeCount:C,getLinkCount:N,getEdgeCount:N,getLinksCount:N,getNodesCount:C,getLinks:D,forEachNode:xe,forEachLinkedNode:J,forEachLink:X,beginUpdate:h,endUpdate:d,clear:H,hasLink:P,hasNode:b,getLink:P,getLinkById:I};return IV(p),g(),p;function g(){var O=p.on;p.on=Y;function Y(){return p.beginUpdate=h=q,p.endUpdate=d=ce,u=_,c=v,p.on=O,O.apply(p,arguments)}}function _(O,Y){o.push({link:O,changeType:Y})}function v(O,Y){o.push({node:O,changeType:Y})}function T(O,Y){if(O===void 0)throw new Error("Invalid node identifier");h();var ue=b(O);return ue?(ue.data=Y,c(ue,"update")):(ue=new VV(O,Y),c(ue,"add")),e.set(O,ue),d(),ue}function b(O){return e.get(O)}function x(O){var Y=b(O);if(!Y)return!1;h();var ue=Y.links;return ue&&(ue.forEach(R),Y.links=null),e.delete(O),c(Y,"remove"),d(),!0}function M(O,Y,ue){h();var Ne=b(O)||T(O),Z=b(Y)||T(Y),W=s(O,Y,ue),ie=t.has(W.id);return t.set(W.id,W),Yw(Ne,W),O!==Y&&Yw(Z,W),u(W,ie?"update":"add"),d(),W}function E(O,Y,ue){var Ne=Eg(O,Y),Z=t.get(Ne);return Z?(Z.data=ue,Z):new Kw(O,Y,ue,Ne)}function w(O,Y,ue){var Ne=Eg(O,Y),Z=n.hasOwnProperty(Ne);if(Z||P(O,Y)){Z||(n[Ne]=0);var W="@"+ ++n[Ne];Ne=Eg(O+W,Y+W)}return new Kw(O,Y,ue,Ne)}function C(){return e.size}function N(){return t.size}function D(O){var Y=b(O);return Y?Y.links:null}function U(O,Y){return Y!==void 0&&(O=P(O,Y)),R(O)}function R(O){if(!O||!t.get(O.id))return!1;h(),t.delete(O.id);var Y=b(O.fromId),ue=b(O.toId);return Y&&Y.links.delete(O),ue&&ue.links.delete(O),u(O,"remove"),d(),!0}function P(O,Y){if(!(O===void 0||Y===void 0))return t.get(Eg(O,Y))}function I(O){if(O!==void 0)return t.get(O)}function H(){h(),xe(function(O){x(O.id)}),d()}function X(O){if(typeof O=="function")for(var Y=t.values(),ue=Y.next();!ue.done;){if(O(ue.value))return!0;ue=Y.next()}}function J(O,Y,ue){var Ne=b(O);if(Ne&&Ne.links&&typeof Y=="function")return ue?G(Ne.links,O,Y):ne(Ne.links,O,Y)}function ne(O,Y,ue){for(var Ne,Z=O.values(),W=Z.next();!W.done;){var ie=W.value,Le=ie.fromId===Y?ie.toId:ie.fromId;if(Ne=ue(e.get(Le),ie),Ne)return!0;W=Z.next()}}function G(O,Y,ue){for(var Ne,Z=O.values(),W=Z.next();!W.done;){var ie=W.value;if(ie.fromId===Y&&(Ne=ue(e.get(ie.toId),ie),Ne))return!0;W=Z.next()}}function z(){}function q(){r+=1}function ce(){r-=1,r===0&&o.length>0&&(p.fire("changed",o),o.length=0)}function xe(O){if(typeof O!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+O);for(var Y=e.values(),ue=Y.next();!ue.done;){if(O(ue.value))return!0;ue=Y.next()}}}function VV(i,e){this.id=i,this.links=null,this.data=e}function Yw(i,e){i.links?i.links.add(e):i.links=new Set([e])}function Kw(i,e,t,n){this.fromId=i,this.toId=e,this.data=t,this.id=n}function Eg(i,e){return i.toString()+" "+e.toString()}var Ag={exports:{}},Nc={exports:{}},cx,Qw;function L2(){return Qw||(Qw=1,cx=function(e){return e===0?"x":e===1?"y":e===2?"z":"c"+(e+1)}),cx}var hx,Zw;function $h(){if(Zw)return hx;Zw=1;const i=L2();return hx=function(t){return n;function n(r,s){let o=s&&s.indent||0,u=s&&s.join!==void 0?s.join:`
`,c=Array(o+1).join(" "),h=[];for(let d=0;d<t;++d){let p=i(d),g=d===0?"":c;h.push(g+r.replace(/{var}/g,p))}return h.join(u)}},hx}var Jw;function HV(){if(Jw)return Nc.exports;Jw=1;const i=$h();Nc.exports=e,Nc.exports.generateCreateBodyFunctionBody=t,Nc.exports.getVectorCode=r,Nc.exports.getBodyCode=n;function e(s,o){let u=t(s,o),{Body:c}=new Function(u)();return c}function t(s,o){return`
${r(s,o)}
${n(s)}
return {Body: Body, Vector: Vector};
`}function n(s){let o=i(s),u=o("{var}",{join:", "});return`
function Body(${u}) {
  this.isPinned = false;
  this.pos = new Vector(${u});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${u}) {
  ${o("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function r(s,o){let u=i(s),c="";return o&&(c=`${u(`
	   var v{var};
	Object.defineProperty(this, '{var}', {
	  set: function(v) { 
	    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');
	    v{var} = v; 
	  },
	  get: function() { return v{var}; }
	});`)}`),`function Vector(${u("{var}",{join:", "})}) {
  ${c}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${u('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${u("this.{var} = v.{var};",{indent:4})}
    } else {
      ${u('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${u("this.{var} = ",{join:""})}0;
  };`}return Nc.exports}var $a={exports:{}},eR;function WV(){if(eR)return $a.exports;eR=1;const i=$h(),e=L2();$a.exports=t,$a.exports.generateQuadTreeFunctionBody=n,$a.exports.getInsertStackCode=c,$a.exports.getQuadNodeCode=u,$a.exports.isSamePosition=r,$a.exports.getChildBodyCode=o,$a.exports.setChildBodyCode=s;function t(h){let d=n(h);return new Function(d)()}function n(h){let d=i(h),p=Math.pow(2,h);return`
${c()}
${u(h)}
${r(h)}
${o(h)}
${s(h)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${T("      node.")}
      node.body = null;
      node.mass = ${d("node.mass_{var} = ",{join:""})}0;
      ${d("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${d("var d{var};",{indent:4})}
    var r; 
    ${d("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${d("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${d("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${d("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${d("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${d("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${d("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${d("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${d("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${d("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < , treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${e(0)} - node.min_${e(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${d("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${v()}
        }
      }
    }

    ${d("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${d("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${d("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${d("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${d("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${d("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${d("root.min_{var} = {var}min;",{indent:4})}
    ${d("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${d("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${d("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${d("var min_{var} = node.min_{var};",{indent:8})}
        ${d("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${_(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${d("child.min_{var} = min_{var};",{indent:10})}
          ${d("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${d("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${d("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`;function _(b){let x=[],M=Array(b+1).join(" ");for(let E=0;E<h;++E)x.push(M+`if (${e(E)} > max_${e(E)}) {`),x.push(M+`  quadIdx = quadIdx + ${Math.pow(2,E)};`),x.push(M+`  min_${e(E)} = max_${e(E)};`),x.push(M+`  max_${e(E)} = node.max_${e(E)};`),x.push(M+"}");return x.join(`
`)}function v(){let b=Array(11).join(" "),x=[];for(let M=0;M<p;++M)x.push(b+`if (node.quad${M}) {`),x.push(b+`  queue[pushIdx] = node.quad${M};`),x.push(b+"  queueLength += 1;"),x.push(b+"  pushIdx += 1;"),x.push(b+"}");return x.join(`
`)}function T(b){let x=[];for(let M=0;M<p;++M)x.push(`${b}quad${M} = null;`);return x.join(`
`)}}function r(h){let d=i(h);return`
  function isSamePosition(point1, point2) {
    ${d("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${d("d{var} < 1e-8",{join:" && "})};
  }  
`}function s(h){var d=Math.pow(2,h);return`
function setChild(node, idx, child) {
  ${p()}
}`;function p(){let g=[];for(let _=0;_<d;++_){let v=_===0?"  ":"  else ";g.push(`${v}if (idx === ${_}) node.quad${_} = child;`)}return g.join(`
`)}}function o(h){return`function getChild(node, idx) {
${d()}
  return null;
}`;function d(){let p=[],g=Math.pow(2,h);for(let _=0;_<g;++_)p.push(`  if (idx === ${_}) return node.quad${_};`);return p.join(`
`)}}function u(h){let d=i(h),p=Math.pow(2,h);var g=`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${_("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${d("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${d("this.min_{var} = 0;",{indent:2})}
  ${d("this.max_{var} = 0;",{indent:2})}
}
`;return g;function _(v){let T=[];for(let b=0;b<p;++b)T.push(`${v}quad${b} = null;`);return T.join(`
`)}}function c(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}return $a.exports}var wg={exports:{}},tR;function qV(){if(tR)return wg.exports;tR=1,wg.exports=e,wg.exports.generateFunctionBody=t;const i=$h();function e(n){let r=t(n);return new Function("bodies","settings","random",r)}function t(n){let r=i(n);return`
  var boundingBox = {
    ${r("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${r("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${r("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${r("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${r("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${r("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${r("var max_{var} = -Infinity;",{indent:4})}
    ${r("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${r("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${r("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${r("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${r("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${r("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}return wg.exports}var Rg={exports:{}},nR;function $V(){if(nR)return Rg.exports;nR=1;const i=$h();Rg.exports=e,Rg.exports.generateCreateDragForceFunctionBody=t;function e(n){let r=t(n);return new Function("options",r)}function t(n){return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${i(n)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}return Rg.exports}var Cg={exports:{}},iR;function jV(){if(iR)return Cg.exports;iR=1;const i=$h();Cg.exports=e,Cg.exports.generateCreateSpringForceFunctionBody=t;function e(n){let r=t(n);return new Function("options","random",r)}function t(n){let r=i(n);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${r("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${r("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${r("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${r("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${r("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${r("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}return Cg.exports}var Ng={exports:{}},rR;function XV(){if(rR)return Ng.exports;rR=1;const i=$h();Ng.exports=e,Ng.exports.generateIntegratorFunctionBody=t;function e(n){let r=t(n);return new Function("bodies","timeStep","adaptiveTimeStepWeight",r)}function t(n){let r=i(n);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${r("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${r("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${r("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${r("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${r("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${r("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${r("body.pos.{var} += d{var};",{indent:4})}

    ${r("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${r("t{var} * t{var}",{join:" + "})})/length;
`}return Ng.exports}var fx,sR;function YV(){if(sR)return fx;sR=1,fx=i;function i(e,t,n,r){this.from=e,this.to=t,this.length=n,this.coefficient=r}return fx}var dx,aR;function KV(){if(aR)return dx;aR=1,dx=i;function i(e,t){var n;if(e||(e={}),t){for(n in t)if(t.hasOwnProperty(n)){var r=e.hasOwnProperty(n),s=typeof t[n],o=!r||typeof e[n]!==s;o?e[n]=t[n]:s==="object"&&(e[n]=i(e[n],t[n]))}}return e}return dx}var px,oR;function P2(){if(oR)return px;oR=1;function i(n){t(n);const r=e(n);return n.on=r.on,n.off=r.off,n.fire=r.fire,n}function e(n){let r=Object.create(null);return{on:function(s,o,u){if(typeof o!="function")throw new Error("callback is expected to be a function");let c=r[s];return c||(c=r[s]=[]),c.push({callback:o,ctx:u}),n},off:function(s,o){if(typeof s>"u")return r=Object.create(null),n;if(r[s])if(typeof o!="function")delete r[s];else{const u=r[s];for(let c=0;c<u.length;++c)u[c].callback===o&&u.splice(c,1)}return n},fire:function(s){const o=r[s];if(!o)return n;let u;arguments.length>1&&(u=Array.prototype.slice.call(arguments,1));for(let c=0;c<o.length;++c){const h=o[c];h.callback.apply(h.ctx,u)}return n}}}function t(n){if(!n)throw new Error("Eventify cannot use falsy object as events subject");const r=["on","fire","off"];for(let s=0;s<r.length;++s)if(n.hasOwnProperty(r[s]))throw new Error("Subject cannot be eventified, since it already has property '"+r[s]+"'")}return px=i,px}var od={exports:{}},lR;function QV(){if(lR)return od.exports;lR=1,od.exports=i,od.exports.random=i,od.exports.randomIterator=u;function i(c){var h=typeof c=="number"?c:+new Date;return new e(h)}function e(c){this.seed=c}e.prototype.next=o,e.prototype.nextDouble=s,e.prototype.uniform=s,e.prototype.gaussian=t,e.prototype.random=s;function t(){var c,h,d;do h=this.nextDouble()*2-1,d=this.nextDouble()*2-1,c=h*h+d*d;while(c>=1||c===0);return h*Math.sqrt(-2*Math.log(c)/c)}e.prototype.levy=n;function n(){var c=1.5,h=Math.pow(r(1+c)*Math.sin(Math.PI*c/2)/(r((1+c)/2)*c*Math.pow(2,(c-1)/2)),1/c);return this.gaussian()*h/Math.pow(Math.abs(this.gaussian()),1/c)}function r(c){return Math.sqrt(2*Math.PI/c)*Math.pow(1/Math.E*(c+1/(12*c-1/(10*c))),c)}function s(){var c=this.seed;return c=c+2127912214+(c<<12)&4294967295,c=(c^3345072700^c>>>19)&4294967295,c=c+374761393+(c<<5)&4294967295,c=(c+3550635116^c<<9)&4294967295,c=c+4251993797+(c<<3)&4294967295,c=(c^3042594569^c>>>16)&4294967295,this.seed=c,(c&268435455)/268435456}function o(c){return Math.floor(this.nextDouble()*c)}function u(c,h){var d=h||i();if(typeof d.next!="function")throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:g,shuffle:p};function p(){var _,v,T;for(_=c.length-1;_>0;--_)v=d.next(_+1),T=c[v],c[v]=c[_],c[_]=T;return c}function g(_){var v,T,b;for(v=c.length-1;v>0;--v)T=d.next(v+1),b=c[T],c[T]=c[v],c[v]=b,_(b);c.length&&_(c[0])}}return od.exports}var mx,uR;function cR(){if(uR)return mx;uR=1,mx=u;var i=HV(),e=WV(),t=qV(),n=$V(),r=jV(),s=XV(),o={};function u(d){var p=YV(),g=KV(),_=P2();if(d){if(d.springCoeff!==void 0)throw new Error("springCoeff was renamed to springCoefficient");if(d.dragCoeff!==void 0)throw new Error("dragCoeff was renamed to dragCoefficient")}d=g(d,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var v=o[d.dimensions];if(!v){var T=d.dimensions;v={Body:i(T,d.debug),createQuadTree:e(T),createBounds:t(T),createDragForce:n(T),createSpringForce:r(T),integrate:s(T)},o[T]=v}var b=v.Body,x=v.createQuadTree,M=v.createBounds,E=v.createDragForce,w=v.createSpringForce,C=v.integrate,N=Z=>new b(Z),D=QV().random(42),U=[],R=[],P=x(d,D),I=M(U,d,D),H=w(d,D),X=E(d),J=0,ne=[],G=new Map,z=0;xe("nbody",ue),xe("spring",Ne);var q={bodies:U,quadTree:P,springs:R,settings:d,addForce:xe,removeForce:O,getForces:Y,step:function(){for(var Z=0;Z<ne.length;++Z)ne[Z](z);var W=C(U,d.timeStep,d.adaptiveTimeStepWeight);return z+=1,W},addBody:function(Z){if(!Z)throw new Error("Body is required");return U.push(Z),Z},addBodyAt:function(Z){if(!Z)throw new Error("Body position is required");var W=N(Z);return U.push(W),W},removeBody:function(Z){if(Z){var W=U.indexOf(Z);if(!(W<0))return U.splice(W,1),U.length===0&&I.reset(),!0}},addSpring:function(Z,W,ie,Le){if(!Z||!W)throw new Error("Cannot add null spring to force simulator");typeof ie!="number"&&(ie=-1);var ke=new p(Z,W,ie,Le>=0?Le:-1);return R.push(ke),ke},getTotalMovement:function(){return J},removeSpring:function(Z){if(Z){var W=R.indexOf(Z);if(W>-1)return R.splice(W,1),!0}},getBestNewBodyPosition:function(Z){return I.getBestNewPosition(Z)},getBBox:ce,getBoundingBox:ce,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(Z){return Z!==void 0?(d.gravity=Z,P.options({gravity:Z}),this):d.gravity},theta:function(Z){return Z!==void 0?(d.theta=Z,P.options({theta:Z}),this):d.theta},random:D};return c(d,q),_(q),q;function ce(){return I.update(),I.box}function xe(Z,W){if(G.has(Z))throw new Error("Force "+Z+" is already added");G.set(Z,W),ne.push(W)}function O(Z){var W=ne.indexOf(G.get(Z));W<0||(ne.splice(W,1),G.delete(Z))}function Y(){return G}function ue(){if(U.length!==0){P.insertBodies(U);for(var Z=U.length;Z--;){var W=U[Z];W.isPinned||(W.reset(),P.updateBodyForce(W),X.update(W))}}}function Ne(){for(var Z=R.length;Z--;)H.update(R[Z])}}function c(d,p){for(var g in d)h(d,p,g)}function h(d,p,g){if(d.hasOwnProperty(g)&&typeof p[g]!="function"){var _=Number.isFinite(d[g]);_?p[g]=function(v){if(v!==void 0){if(!Number.isFinite(v))throw new Error("Value of "+g+" should be a valid number.");return d[g]=v,p}return d[g]}:p[g]=function(v){return v!==void 0?(d[g]=v,p):d[g]}}}return mx}var hR;function ZV(){if(hR)return Ag.exports;hR=1,Ag.exports=e,Ag.exports.simulator=cR();var i=P2();function e(n,r){if(!n)throw new Error("Graph structure cannot be undefined");var s=r&&r.createSimulator||cR(),o=s(r);if(Array.isArray(r))throw new Error("Physics settings is expected to be an object");var u=n.version>19?G:ne;r&&typeof r.nodeMass=="function"&&(u=r.nodeMass);var c=new Map,h={},d=0,p=o.settings.springTransform||t;N(),E();var g=!1,_={step:function(){if(d===0)return v(!0),!0;var z=o.step();_.lastMove=z,_.fire("step");var q=z/d,ce=q<=.01;return v(ce),ce},getNodePosition:function(z){return J(z).pos},setNodePosition:function(z){var q=J(z);q.setPosition.apply(q,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(z){var q=h[z];if(q)return{from:q.from.pos,to:q.to.pos}},getGraphRect:function(){return o.getBBox()},forEachBody:T,pinNode:function(z,q){var ce=J(z.id);ce.isPinned=!!q},isNodePinned:function(z){return J(z.id).isPinned},dispose:function(){n.off("changed",C),_.fire("disposed")},getBody:M,getSpring:x,getForceVectorLength:b,simulator:o,graph:n,lastMove:0};return i(_),_;function v(z){g!==z&&(g=z,w(z))}function T(z){c.forEach(z)}function b(){var z=0,q=0;return T(function(ce){z+=Math.abs(ce.force.x),q+=Math.abs(ce.force.y)}),Math.sqrt(z*z+q*q)}function x(z,q){var ce;if(q===void 0)typeof z!="object"?ce=z:ce=z.id;else{var xe=n.hasLink(z,q);if(!xe)return;ce=xe.id}return h[ce]}function M(z){return c.get(z)}function E(){n.on("changed",C)}function w(z){_.fire("stable",z)}function C(z){for(var q=0;q<z.length;++q){var ce=z[q];ce.changeType==="add"?(ce.node&&D(ce.node.id),ce.link&&R(ce.link)):ce.changeType==="remove"&&(ce.node&&U(ce.node),ce.link&&P(ce.link))}d=n.getNodesCount()}function N(){d=0,n.forEachNode(function(z){D(z.id),d+=1}),n.forEachLink(R)}function D(z){var q=c.get(z);if(!q){var ce=n.getNode(z);if(!ce)throw new Error("initBody() was called with unknown node id");var xe=ce.position;if(!xe){var O=I(ce);xe=o.getBestNewBodyPosition(O)}q=o.addBodyAt(xe),q.id=z,c.set(z,q),H(z),X(ce)&&(q.isPinned=!0)}}function U(z){var q=z.id,ce=c.get(q);ce&&(c.delete(q),o.removeBody(ce))}function R(z){H(z.fromId),H(z.toId);var q=c.get(z.fromId),ce=c.get(z.toId),xe=o.addSpring(q,ce,z.length);p(z,xe),h[z.id]=xe}function P(z){var q=h[z.id];if(q){var ce=n.getNode(z.fromId),xe=n.getNode(z.toId);ce&&H(ce.id),xe&&H(xe.id),delete h[z.id],o.removeSpring(q)}}function I(z){var q=[];if(!z.links)return q;for(var ce=Math.min(z.links.length,2),xe=0;xe<ce;++xe){var O=z.links[xe],Y=O.fromId!==z.id?c.get(O.fromId):c.get(O.toId);Y&&Y.pos&&q.push(Y)}return q}function H(z){var q=c.get(z);if(q.mass=u(z),Number.isNaN(q.mass))throw new Error("Node mass should be a number")}function X(z){return z&&(z.isPinned||z.data&&z.data.isPinned)}function J(z){var q=c.get(z);return q||(D(z),q=c.get(z)),q}function ne(z){var q=n.getLinks(z);return q?1+q.length/3:1}function G(z){var q=n.getLinks(z);return q?1+q.size/3:1}}function t(){}return Ag.exports}var JV=ZV();const e5=gS(JV);function Nb(i){var e=typeof i;return i!=null&&(e=="object"||e=="function")}var t5=typeof global=="object"&&global&&global.Object===Object&&global,n5=typeof self=="object"&&self&&self.Object===Object&&self,U2=t5||n5||Function("return this")(),gx=function(){return U2.Date.now()},i5=/\s/;function r5(i){for(var e=i.length;e--&&i5.test(i.charAt(e)););return e}var s5=/^\s+/;function a5(i){return i&&i.slice(0,r5(i)+1).replace(s5,"")}var M_=U2.Symbol,O2=Object.prototype,o5=O2.hasOwnProperty,l5=O2.toString,ld=M_?M_.toStringTag:void 0;function u5(i){var e=o5.call(i,ld),t=i[ld];try{i[ld]=void 0;var n=!0}catch{}var r=l5.call(i);return n&&(e?i[ld]=t:delete i[ld]),r}var c5=Object.prototype,h5=c5.toString;function f5(i){return h5.call(i)}var d5="[object Null]",p5="[object Undefined]",fR=M_?M_.toStringTag:void 0;function m5(i){return i==null?i===void 0?p5:d5:fR&&fR in Object(i)?u5(i):f5(i)}function g5(i){return i!=null&&typeof i=="object"}var _5="[object Symbol]";function v5(i){return typeof i=="symbol"||g5(i)&&m5(i)==_5}var dR=NaN,y5=/^[-+]0x[0-9a-f]+$/i,x5=/^0b[01]+$/i,b5=/^0o[0-7]+$/i,S5=parseInt;function pR(i){if(typeof i=="number")return i;if(v5(i))return dR;if(Nb(i)){var e=typeof i.valueOf=="function"?i.valueOf():i;i=Nb(e)?e+"":e}if(typeof i!="string")return i===0?i:+i;i=a5(i);var t=x5.test(i);return t||b5.test(i)?S5(i.slice(2),t?2:8):y5.test(i)?dR:+i}var T5="Expected a function",M5=Math.max,E5=Math.min;function A5(i,e,t){var n,r,s,o,u,c,h=0,d=!1,p=!1,g=!0;if(typeof i!="function")throw new TypeError(T5);e=pR(e)||0,Nb(t)&&(d=!!t.leading,p="maxWait"in t,s=p?M5(pR(t.maxWait)||0,e):s,g="trailing"in t?!!t.trailing:g);function _(N){var D=n,U=r;return n=r=void 0,h=N,o=i.apply(U,D),o}function v(N){return h=N,u=setTimeout(x,e),d?_(N):o}function T(N){var D=N-c,U=N-h,R=e-D;return p?E5(R,s-U):R}function b(N){var D=N-c,U=N-h;return c===void 0||D>=e||D<0||p&&U>=s}function x(){var N=gx();if(b(N))return M(N);u=setTimeout(x,T(N))}function M(N){return u=void 0,g&&n?_(N):(n=r=void 0,o)}function E(){u!==void 0&&clearTimeout(u),h=0,n=c=r=u=void 0}function w(){return u===void 0?o:M(gx())}function C(){var N=gx(),D=b(N);if(n=arguments,r=this,c=N,D){if(u===void 0)return v(c);if(p)return clearTimeout(u),u=setTimeout(x,e),_(c)}return u===void 0&&(u=setTimeout(x,e)),o}return C.cancel=E,C.flush=w,C}function mR(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function w5(i){if(Array.isArray(i))return i}function R5(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function C5(i,e,t){return Object.defineProperty(i,"prototype",{writable:!1}),i}function N5(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,h=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){h=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(h)throw r}}return u}}function D5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function L5(i,e){return w5(i)||N5(i,e)||P5(i,e)||D5()}function P5(i,e){if(i){if(typeof i=="string")return mR(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?mR(i,e):void 0}}var U5=C5(function i(e,t){var n=t.default,r=n===void 0?null:n,s=t.triggerUpdate,o=s===void 0?!0:s,u=t.onChange,c=u===void 0?function(h,d){}:u;R5(this,i),this.name=e,this.defaultVal=r,this.triggerUpdate=o,this.onChange=c});function Q_(i){var e=i.stateInit,t=e===void 0?function(){return{}}:e,n=i.props,r=n===void 0?{}:n,s=i.methods,o=s===void 0?{}:s,u=i.aliases,c=u===void 0?{}:u,h=i.init,d=h===void 0?function(){}:h,p=i.update,g=p===void 0?function(){}:p,_=Object.keys(r).map(function(v){return new U5(v,r[v])});return function v(){for(var T=arguments.length,b=new Array(T),x=0;x<T;x++)b[x]=arguments[x];var M=!!(this instanceof v&&this.constructor),E=M?b.shift():void 0,w=b[0],C=w===void 0?{}:w,N=Object.assign({},t instanceof Function?t(C):t,{initialised:!1}),D={};function U(I){return R(I,C),P(),U}var R=function(H,X){d.call(U,H,N,X),N.initialised=!0},P=A5(function(){N.initialised&&(g.call(U,N,D),D={})},1);return _.forEach(function(I){U[I.name]=H(I);function H(X){var J=X.name,ne=X.triggerUpdate,G=ne===void 0?!1:ne,z=X.onChange,q=z===void 0?function(O,Y){}:z,ce=X.defaultVal,xe=ce===void 0?null:ce;return function(O){var Y=N[J];if(!arguments.length)return Y;var ue=O===void 0?xe:O;return N[J]=ue,q.call(U,ue,N,Y),!D.hasOwnProperty(J)&&(D[J]=Y),G&&P(),U}}}),Object.keys(o).forEach(function(I){U[I]=function(){for(var H,X=arguments.length,J=new Array(X),ne=0;ne<X;ne++)J[ne]=arguments[ne];return(H=o[I]).call.apply(H,[U,N].concat(J))}}),Object.entries(c).forEach(function(I){var H=L5(I,2),X=H[0],J=H[1];return U[X]=U[J]}),U.resetProps=function(){return _.forEach(function(I){U[I.name](I.defaultVal)}),U},U.resetProps(),N._rerender=P,M&&E&&U(E),U}}var Yt=(function(i){return typeof i=="function"?i:typeof i=="string"?function(e){return e[i]}:function(e){return i}});class gR extends Map{constructor(e,t=F5){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[n,r]of e)this.set(n,r)}get(e){return super.get(_R(this,e))}has(e){return super.has(_R(this,e))}set(e,t){return super.set(O5(this,e),t)}delete(e){return super.delete(B5(this,e))}}function _R({_intern:i,_key:e},t){const n=e(t);return i.has(n)?i.get(n):t}function O5({_intern:i,_key:e},t){const n=e(t);return i.has(n)?i.get(n):(i.set(n,t),t)}function B5({_intern:i,_key:e},t){const n=e(t);return i.has(n)&&(t=i.get(n),i.delete(n)),t}function F5(i){return i!==null&&typeof i=="object"?i.valueOf():i}function I5(i,e){let t;if(e===void 0)for(const n of i)n!=null&&(t<n||t===void 0&&n>=n)&&(t=n);else{let n=-1;for(let r of i)(r=e(r,++n,i))!=null&&(t<r||t===void 0&&r>=r)&&(t=r)}return t}function z5(i,e){let t;if(e===void 0)for(const n of i)n!=null&&(t>n||t===void 0&&n>=n)&&(t=n);else{let n=-1;for(let r of i)(r=e(r,++n,i))!=null&&(t>r||t===void 0&&r>=r)&&(t=r)}return t}function Db(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function G5(i){if(Array.isArray(i))return i}function k5(i){if(Array.isArray(i))return Db(i)}function B2(i,e,t){if(typeof i=="function"?i===e:i.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function V5(i,e){if(e.has(i))throw new TypeError("Cannot initialize the same private elements twice on an object")}function H5(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function tr(i,e){return i.get(B2(i,e))}function Dc(i,e,t){V5(i,e),e.set(i,t)}function Dg(i,e,t){return i.set(B2(i,e),t),t}function W5(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,J5(n.key),n)}}function q5(i,e,t){return e&&W5(i.prototype,e),Object.defineProperty(i,"prototype",{writable:!1}),i}function $5(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function j5(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,h=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){h=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(h)throw r}}return u}}function X5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Y5(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function K5(i,e){return G5(i)||j5(i,e)||F2(i,e)||X5()}function Q5(i){return k5(i)||$5(i)||F2(i)||Y5()}function Z5(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function J5(i){var e=Z5(i,"string");return typeof e=="symbol"?e:e+""}function F2(i,e){if(i){if(typeof i=="string")return Db(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Db(i,e):void 0}}var Lc=new WeakMap,ud=new WeakMap,Pc=new WeakMap,_x=new WeakMap,vx=new WeakMap,yx=new WeakMap,e6=(function(){function i(){H5(this,i),Dc(this,Lc,new Map),Dc(this,ud,new Map),Dc(this,Pc,function(e){return e}),Dc(this,_x,function(){return{}}),Dc(this,vx,function(){}),Dc(this,yx,function(){})}return q5(i,[{key:"getObj",value:function(t){return tr(Lc,this).get(tr(Pc,this).call(this,t))}},{key:"getData",value:function(t){return tr(ud,this).get(t)}},{key:"entries",value:function(){return Q5(tr(ud,this).entries()).map(function(t){var n=K5(t,2),r=n[0],s=n[1];return[s,r]})}},{key:"id",value:function(t){return Dg(Pc,this,Yt(t)),this}},{key:"onCreateObj",value:function(t){return Dg(_x,this,t),this}},{key:"onUpdateObj",value:function(t){return Dg(vx,this,t),this}},{key:"onRemoveObj",value:function(t){return Dg(yx,this,t),this}},{key:"digest",value:function(t){var n=this;t.filter(function(s){return!tr(Lc,n).has(tr(Pc,n).call(n,s))}).forEach(function(s){var o=tr(_x,n).call(n,s);tr(Lc,n).set(tr(Pc,n).call(n,s),o),tr(ud,n).set(o,s)});var r=new Map(t.map(function(s){return[tr(Pc,n).call(n,s),s]}));return tr(Lc,this).forEach(function(s,o){r.has(o)?tr(vx,n).call(n,s,r.get(o)):(tr(yx,n).call(n,s,o),tr(Lc,n).delete(o),tr(ud,n).delete(s))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])})();function t6(i,e){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(e).domain(i);break}return this}const vR=Symbol("implicit");function I2(){var i=new gR,e=[],t=[],n=vR;function r(s){let o=i.get(s);if(o===void 0){if(n!==vR)return n;i.set(s,o=e.push(s)-1)}return t[o%t.length]}return r.domain=function(s){if(!arguments.length)return e.slice();e=[],i=new gR;for(const o of s)i.has(o)||i.set(o,e.push(o)-1);return r},r.range=function(s){return arguments.length?(t=Array.from(s),r):t.slice()},r.unknown=function(s){return arguments.length?(n=s,r):n},r.copy=function(){return I2(e,t).unknown(n)},t6.apply(r,arguments),r}function n6(i){for(var e=i.length/6|0,t=new Array(e),n=0;n<e;)t[n]="#"+i.slice(n*6,++n*6);return t}const i6=n6("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function E_(i){"@babel/helpers - typeof";return E_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E_(i)}var r6=/^\s+/,s6=/\s+$/;function pt(i,e){if(i=i||"",e=e||{},i instanceof pt)return i;if(!(this instanceof pt))return new pt(i,e);var t=a6(i);this._originalInput=i,this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||t.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=t.ok}pt.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t,n,r,s,o,u;return t=e.r/255,n=e.g/255,r=e.b/255,t<=.03928?s=t/12.92:s=Math.pow((t+.055)/1.055,2.4),n<=.03928?o=n/12.92:o=Math.pow((n+.055)/1.055,2.4),r<=.03928?u=r/12.92:u=Math.pow((r+.055)/1.055,2.4),.2126*s+.7152*o+.0722*u},setAlpha:function(e){return this._a=z2(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=xR(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=xR(this._r,this._g,this._b),t=Math.round(e.h*360),n=Math.round(e.s*100),r=Math.round(e.v*100);return this._a==1?"hsv("+t+", "+n+"%, "+r+"%)":"hsva("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=yR(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=yR(this._r,this._g,this._b),t=Math.round(e.h*360),n=Math.round(e.s*100),r=Math.round(e.l*100);return this._a==1?"hsl("+t+", "+n+"%, "+r+"%)":"hsla("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return bR(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return c6(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(Qn(this._r,255)*100)+"%",g:Math.round(Qn(this._g,255)*100)+"%",b:Math.round(Qn(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(Qn(this._r,255)*100)+"%, "+Math.round(Qn(this._g,255)*100)+"%, "+Math.round(Qn(this._b,255)*100)+"%)":"rgba("+Math.round(Qn(this._r,255)*100)+"%, "+Math.round(Qn(this._g,255)*100)+"%, "+Math.round(Qn(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:S6[bR(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+SR(this._r,this._g,this._b,this._a),n=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var s=pt(e);n="#"+SR(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,r=this._a<1&&this._a>=0,s=!t&&r&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return s?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(n=this.toRgbString()),e==="prgb"&&(n=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(n=this.toHexString()),e==="hex3"&&(n=this.toHexString(!0)),e==="hex4"&&(n=this.toHex8String(!0)),e==="hex8"&&(n=this.toHex8String()),e==="name"&&(n=this.toName()),e==="hsl"&&(n=this.toHslString()),e==="hsv"&&(n=this.toHsvString()),n||this.toHexString())},clone:function(){return pt(this.toString())},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(p6,arguments)},brighten:function(){return this._applyModification(m6,arguments)},darken:function(){return this._applyModification(g6,arguments)},desaturate:function(){return this._applyModification(h6,arguments)},saturate:function(){return this._applyModification(f6,arguments)},greyscale:function(){return this._applyModification(d6,arguments)},spin:function(){return this._applyModification(_6,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(x6,arguments)},complement:function(){return this._applyCombination(v6,arguments)},monochromatic:function(){return this._applyCombination(b6,arguments)},splitcomplement:function(){return this._applyCombination(y6,arguments)},triad:function(){return this._applyCombination(TR,[3])},tetrad:function(){return this._applyCombination(TR,[4])}};pt.fromRatio=function(i,e){if(E_(i)=="object"){var t={};for(var n in i)i.hasOwnProperty(n)&&(n==="a"?t[n]=i[n]:t[n]=Dd(i[n]));i=t}return pt(i,e)};function a6(i){var e={r:0,g:0,b:0},t=1,n=null,r=null,s=null,o=!1,u=!1;return typeof i=="string"&&(i=A6(i)),E_(i)=="object"&&(ja(i.r)&&ja(i.g)&&ja(i.b)?(e=o6(i.r,i.g,i.b),o=!0,u=String(i.r).substr(-1)==="%"?"prgb":"rgb"):ja(i.h)&&ja(i.s)&&ja(i.v)?(n=Dd(i.s),r=Dd(i.v),e=u6(i.h,n,r),o=!0,u="hsv"):ja(i.h)&&ja(i.s)&&ja(i.l)&&(n=Dd(i.s),s=Dd(i.l),e=l6(i.h,n,s),o=!0,u="hsl"),i.hasOwnProperty("a")&&(t=i.a)),t=z2(t),{ok:o,format:i.format||u,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}function o6(i,e,t){return{r:Qn(i,255)*255,g:Qn(e,255)*255,b:Qn(t,255)*255}}function yR(i,e,t){i=Qn(i,255),e=Qn(e,255),t=Qn(t,255);var n=Math.max(i,e,t),r=Math.min(i,e,t),s,o,u=(n+r)/2;if(n==r)s=o=0;else{var c=n-r;switch(o=u>.5?c/(2-n-r):c/(n+r),n){case i:s=(e-t)/c+(e<t?6:0);break;case e:s=(t-i)/c+2;break;case t:s=(i-e)/c+4;break}s/=6}return{h:s,s:o,l:u}}function l6(i,e,t){var n,r,s;i=Qn(i,360),e=Qn(e,100),t=Qn(t,100);function o(h,d,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?h+(d-h)*6*p:p<1/2?d:p<2/3?h+(d-h)*(2/3-p)*6:h}if(e===0)n=r=s=t;else{var u=t<.5?t*(1+e):t+e-t*e,c=2*t-u;n=o(c,u,i+1/3),r=o(c,u,i),s=o(c,u,i-1/3)}return{r:n*255,g:r*255,b:s*255}}function xR(i,e,t){i=Qn(i,255),e=Qn(e,255),t=Qn(t,255);var n=Math.max(i,e,t),r=Math.min(i,e,t),s,o,u=n,c=n-r;if(o=n===0?0:c/n,n==r)s=0;else{switch(n){case i:s=(e-t)/c+(e<t?6:0);break;case e:s=(t-i)/c+2;break;case t:s=(i-e)/c+4;break}s/=6}return{h:s,s:o,v:u}}function u6(i,e,t){i=Qn(i,360)*6,e=Qn(e,100),t=Qn(t,100);var n=Math.floor(i),r=i-n,s=t*(1-e),o=t*(1-r*e),u=t*(1-(1-r)*e),c=n%6,h=[t,o,s,s,u,t][c],d=[u,t,t,o,s,s][c],p=[s,s,u,t,t,o][c];return{r:h*255,g:d*255,b:p*255}}function bR(i,e,t,n){var r=[zs(Math.round(i).toString(16)),zs(Math.round(e).toString(16)),zs(Math.round(t).toString(16))];return n&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function c6(i,e,t,n,r){var s=[zs(Math.round(i).toString(16)),zs(Math.round(e).toString(16)),zs(Math.round(t).toString(16)),zs(G2(n))];return r&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function SR(i,e,t,n){var r=[zs(G2(n)),zs(Math.round(i).toString(16)),zs(Math.round(e).toString(16)),zs(Math.round(t).toString(16))];return r.join("")}pt.equals=function(i,e){return!i||!e?!1:pt(i).toRgbString()==pt(e).toRgbString()};pt.random=function(){return pt.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function h6(i,e){e=e===0?0:e||10;var t=pt(i).toHsl();return t.s-=e/100,t.s=Z_(t.s),pt(t)}function f6(i,e){e=e===0?0:e||10;var t=pt(i).toHsl();return t.s+=e/100,t.s=Z_(t.s),pt(t)}function d6(i){return pt(i).desaturate(100)}function p6(i,e){e=e===0?0:e||10;var t=pt(i).toHsl();return t.l+=e/100,t.l=Z_(t.l),pt(t)}function m6(i,e){e=e===0?0:e||10;var t=pt(i).toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),pt(t)}function g6(i,e){e=e===0?0:e||10;var t=pt(i).toHsl();return t.l-=e/100,t.l=Z_(t.l),pt(t)}function _6(i,e){var t=pt(i).toHsl(),n=(t.h+e)%360;return t.h=n<0?360+n:n,pt(t)}function v6(i){var e=pt(i).toHsl();return e.h=(e.h+180)%360,pt(e)}function TR(i,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var t=pt(i).toHsl(),n=[pt(i)],r=360/e,s=1;s<e;s++)n.push(pt({h:(t.h+s*r)%360,s:t.s,l:t.l}));return n}function y6(i){var e=pt(i).toHsl(),t=e.h;return[pt(i),pt({h:(t+72)%360,s:e.s,l:e.l}),pt({h:(t+216)%360,s:e.s,l:e.l})]}function x6(i,e,t){e=e||6,t=t||30;var n=pt(i).toHsl(),r=360/t,s=[pt(i)];for(n.h=(n.h-(r*e>>1)+720)%360;--e;)n.h=(n.h+r)%360,s.push(pt(n));return s}function b6(i,e){e=e||6;for(var t=pt(i).toHsv(),n=t.h,r=t.s,s=t.v,o=[],u=1/e;e--;)o.push(pt({h:n,s:r,v:s})),s=(s+u)%1;return o}pt.mix=function(i,e,t){t=t===0?0:t||50;var n=pt(i).toRgb(),r=pt(e).toRgb(),s=t/100,o={r:(r.r-n.r)*s+n.r,g:(r.g-n.g)*s+n.g,b:(r.b-n.b)*s+n.b,a:(r.a-n.a)*s+n.a};return pt(o)};pt.readability=function(i,e){var t=pt(i),n=pt(e);return(Math.max(t.getLuminance(),n.getLuminance())+.05)/(Math.min(t.getLuminance(),n.getLuminance())+.05)};pt.isReadable=function(i,e,t){var n=pt.readability(i,e),r,s;switch(s=!1,r=w6(t),r.level+r.size){case"AAsmall":case"AAAlarge":s=n>=4.5;break;case"AAlarge":s=n>=3;break;case"AAAsmall":s=n>=7;break}return s};pt.mostReadable=function(i,e,t){var n=null,r=0,s,o,u,c;t=t||{},o=t.includeFallbackColors,u=t.level,c=t.size;for(var h=0;h<e.length;h++)s=pt.readability(i,e[h]),s>r&&(r=s,n=pt(e[h]));return pt.isReadable(i,n,{level:u,size:c})||!o?n:(t.includeFallbackColors=!1,pt.mostReadable(i,["#fff","#000"],t))};var Lb=pt.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},S6=pt.hexNames=T6(Lb);function T6(i){var e={};for(var t in i)i.hasOwnProperty(t)&&(e[i[t]]=t);return e}function z2(i){return i=parseFloat(i),(isNaN(i)||i<0||i>1)&&(i=1),i}function Qn(i,e){M6(i)&&(i="100%");var t=E6(i);return i=Math.min(e,Math.max(0,parseFloat(i))),t&&(i=parseInt(i*e,10)/100),Math.abs(i-e)<1e-6?1:i%e/parseFloat(e)}function Z_(i){return Math.min(1,Math.max(0,i))}function Kr(i){return parseInt(i,16)}function M6(i){return typeof i=="string"&&i.indexOf(".")!=-1&&parseFloat(i)===1}function E6(i){return typeof i=="string"&&i.indexOf("%")!=-1}function zs(i){return i.length==1?"0"+i:""+i}function Dd(i){return i<=1&&(i=i*100+"%"),i}function G2(i){return Math.round(parseFloat(i)*255).toString(16)}function MR(i){return Kr(i)/255}var Us=(function(){var i="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",t="(?:"+e+")|(?:"+i+")",n="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",r="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+r),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+r),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+r),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}})();function ja(i){return!!Us.CSS_UNIT.exec(i)}function A6(i){i=i.replace(r6,"").replace(s6,"").toLowerCase();var e=!1;if(Lb[i])i=Lb[i],e=!0;else if(i=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t;return(t=Us.rgb.exec(i))?{r:t[1],g:t[2],b:t[3]}:(t=Us.rgba.exec(i))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=Us.hsl.exec(i))?{h:t[1],s:t[2],l:t[3]}:(t=Us.hsla.exec(i))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=Us.hsv.exec(i))?{h:t[1],s:t[2],v:t[3]}:(t=Us.hsva.exec(i))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=Us.hex8.exec(i))?{r:Kr(t[1]),g:Kr(t[2]),b:Kr(t[3]),a:MR(t[4]),format:e?"name":"hex8"}:(t=Us.hex6.exec(i))?{r:Kr(t[1]),g:Kr(t[2]),b:Kr(t[3]),format:e?"name":"hex"}:(t=Us.hex4.exec(i))?{r:Kr(t[1]+""+t[1]),g:Kr(t[2]+""+t[2]),b:Kr(t[3]+""+t[3]),a:MR(t[4]+""+t[4]),format:e?"name":"hex8"}:(t=Us.hex3.exec(i))?{r:Kr(t[1]+""+t[1]),g:Kr(t[2]+""+t[2]),b:Kr(t[3]+""+t[3]),format:e?"name":"hex"}:!1}function w6(i){var e,t;return i=i||{level:"AA",size:"small"},e=(i.level||"AA").toUpperCase(),t=(i.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),t!=="small"&&t!=="large"&&(t="small"),{level:e,size:t}}function Pb(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function R6(i){if(Array.isArray(i))return i}function C6(i){if(Array.isArray(i))return Pb(i)}function k2(i,e,t){if(typeof i=="function"?i===e:i.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function N6(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function V2(i,e,t){return e=Ph(e),I6(i,hT()?Reflect.construct(e,t||[],Ph(i).constructor):e.apply(i,t))}function D6(i,e){if(e.has(i))throw new TypeError("Cannot initialize the same private elements twice on an object")}function H2(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function xx(i,e){return i.get(k2(i,e))}function ER(i,e,t){D6(i,e),e.set(i,t)}function AR(i,e,t){return i.set(k2(i,e),t),t}function W2(i,e,t){if(hT())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var r=new(i.bind.apply(i,n));return r}function L6(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,j2(n.key),n)}}function q2(i,e,t){return e&&L6(i.prototype,e),Object.defineProperty(i,"prototype",{writable:!1}),i}function J_(i,e,t){return(e=j2(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ub(){return Ub=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(i,e,t){var n=z6(i,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?i:t):r.value}},Ub.apply(null,arguments)}function Ph(i){return Ph=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ph(i)}function $2(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),e&&Ob(i,e)}function hT(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hT=function(){return!!i})()}function P6(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function U6(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,h=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){h=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(h)throw r}}return u}}function O6(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function B6(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wR(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function F6(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?wR(Object(t),!0).forEach(function(n){J_(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):wR(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function I6(i,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return N6(i)}function Ob(i,e){return Ob=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},Ob(i,e)}function kd(i,e){return R6(i)||U6(i,e)||X2(i,e)||O6()}function z6(i,e){for(;!{}.hasOwnProperty.call(i,e)&&(i=Ph(i))!==null;);return i}function bx(i,e,t,n){var r=Ub(Ph(i.prototype),e,t);return typeof r=="function"?function(s){return r.apply(t,s)}:r}function Os(i){return C6(i)||P6(i)||X2(i)||B6()}function G6(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function j2(i){var e=G6(i,"string");return typeof e=="symbol"?e:e+""}function Bb(i){"@babel/helpers - typeof";return Bb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bb(i)}function X2(i,e){if(i){if(typeof i=="string")return Pb(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Pb(i,e):void 0}}var Y2=function(e){e instanceof Array?e.forEach(Y2):(e.map&&e.map.dispose(),e.dispose())},K2=function(e){e.geometry&&e.geometry.dispose(),e.material&&Y2(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(K2)},Fb=function(e){for(;e.children.length;){var t=e.children[0];e.remove(t),K2(t)}},Sx=new WeakMap,Lg=new WeakMap,cd=(function(i){function e(t){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=r.dataBindAttr,o=s===void 0?"__data":s,u=r.objBindAttr,c=u===void 0?"__threeObj":u;return H2(this,e),n=V2(this,e),J_(n,"scene",void 0),ER(n,Sx,void 0),ER(n,Lg,void 0),n.scene=t,AR(Sx,n,o),AR(Lg,n,c),n.onRemoveObj(function(){}),n}return $2(e,i),q2(e,[{key:"onCreateObj",value:function(n){var r=this;return bx(e,"onCreateObj",this)([function(s){var o=n(s);return s[xx(Lg,r)]=o,o[xx(Sx,r)]=s,r.scene.add(o),o}]),this}},{key:"onRemoveObj",value:function(n){var r=this;return bx(e,"onRemoveObj",this)([function(s,o){var u=bx(e,"getData",r)([s]);n(s,o),r.scene.remove(s),Fb(s),delete u[xx(Lg,r)]}]),this}}])})(e6),hd=function(e){return isNaN(e)?parseInt(pt(e).toHex(),16):e},Tx=function(e){return isNaN(e)?pt(e).getAlpha():1},k6=I2(i6);function RR(i,e,t){!e||typeof t!="string"||i.filter(function(n){return!n[t]}).forEach(function(n){n[t]=k6(e(n))})}function V6(i,e){var t=i.nodes,n=i.links,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=r.nodeFilter,o=s===void 0?function(){return!0}:s,u=r.onLoopError,c=u===void 0?function(_){throw"Invalid DAG structure! Found cycle in node path: ".concat(_.join(" -> "),".")}:u,h={};t.forEach(function(_){return h[e(_)]={data:_,out:[],depth:-1,skip:!o(_)}}),n.forEach(function(_){var v=_.source,T=_.target,b=w(v),x=w(T);if(!h.hasOwnProperty(b))throw"Missing source node with id: ".concat(b);if(!h.hasOwnProperty(x))throw"Missing target node with id: ".concat(x);var M=h[b],E=h[x];M.out.push(E);function w(C){return Bb(C)==="object"?e(C):C}});var d=[];g(Object.values(h));var p=Object.assign.apply(Object,[{}].concat(Os(Object.entries(h).filter(function(_){var v=kd(_,2),T=v[1];return!T.skip}).map(function(_){var v=kd(_,2),T=v[0],b=v[1];return J_({},T,b.depth)}))));return p;function g(_){for(var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,b=function(){var w=_[x];if(v.indexOf(w)!==-1){var C=[].concat(Os(v.slice(v.indexOf(w))),[w]).map(function(N){return e(N.data)});return d.some(function(N){return N.length===C.length&&N.every(function(D,U){return D===C[U]})})||(d.push(C),c(C)),1}T>w.depth&&(w.depth=T,g(w.out,[].concat(Os(v),[w]),T+(w.skip?0:1)))},x=0,M=_.length;x<M;x++)b()}}var Et=window.THREE?window.THREE:{Group:Hc,Mesh:yi,MeshLambertMaterial:s2,Color:dt,BufferGeometry:wi,BufferAttribute:Xi,Matrix4:Ht,Vector3:k,SphereGeometry:Pp,CylinderGeometry:Dp,TubeGeometry:rT,ConeGeometry:tT,Line:UB,LineBasicMaterial:q_,QuadraticBezierCurve3:iT,CubicBezierCurve3:i2,Box3:Eu},CR={graph:kV,forcelayout:e5},H6=2,Mx=new Et.BufferGeometry().setAttribute?"setAttribute":"addAttribute",Pg=new Et.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",W6=Q_({props:{jsonUrl:{onChange:function(e,t){var n=this;e&&!t.fetchingJson&&(t.fetchingJson=!0,t.onLoading(),fetch(e).then(function(r){return r.json()}).then(function(r){t.fetchingJson=!1,t.onFinishLoading(r),n.graphData(r)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,t){t.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,t){var n=t.d3ForceLayout.force("charge");n&&n.strength(e>2?-60:-30),e<3&&r(t.graphData.nodes,"z"),e<2&&r(t.graphData.nodes,"y");function r(s,o){s.forEach(function(u){delete u[o],delete u["v".concat(o)]})}}},dagMode:{onChange:function(e,t){!e&&t.forceEngine==="d3"&&(t.graphData.nodes||[]).forEach(function(n){return n.fx=n.fy=n.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleOffset:{default:0,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},linkDirectionalParticleThreeObject:{},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,t,n){return n===void 0?e.d3ForceLayout.force(t):(e.d3ForceLayout.force(t,n),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var t=e.forceEngine!=="ngraph";return e.engineRunning&&n(),r(),s(),this;function n(){++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||t&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[t?"tick":"step"](),e.onEngineTick());var o=Yt(e.nodeThreeObjectExtend);e.nodeDataMapper.entries().forEach(function(g){var _=kd(g,2),v=_[0],T=_[1];if(T){var b=t?v:e.layout.getNodePosition(v[e.nodeId]),x=o(v);(!e.nodePositionUpdate||!e.nodePositionUpdate(x?T.children[0]:T,{x:b.x,y:b.y,z:b.z},v)||x)&&(T.position.x=b.x,T.position.y=b.y||0,T.position.z=b.z||0)}});var u=Yt(e.linkWidth),c=Yt(e.linkCurvature),h=Yt(e.linkCurveRotation),d=Yt(e.linkThreeObjectExtend);e.linkDataMapper.entries().forEach(function(g){var _=kd(g,2),v=_[0],T=_[1];if(T){var b=t?v:e.layout.getLinkPosition(e.layout.graph.getLink(v.source,v.target).id),x=b[t?"source":"from"],M=b[t?"target":"to"];if(!(!x||!M||!x.hasOwnProperty("x")||!M.hasOwnProperty("x"))){p(v);var E=d(v);if(!(e.linkPositionUpdate&&e.linkPositionUpdate(E?T.children[1]:T,{start:{x:x.x,y:x.y,z:x.z},end:{x:M.x,y:M.y,z:M.z}},v)&&!E)){var w=30,C=v.__curve,N=T.children.length?T.children[0]:T;if(N.type==="Line"){if(C){var U=C.getPoints(w);N.geometry.getAttribute("position").array.length!==U.length*3&&N.geometry[Mx]("position",new Et.BufferAttribute(new Float32Array(U.length*3),3)),N.geometry.setFromPoints(U)}else{var D=N.geometry.getAttribute("position");(!D||!D.array||D.array.length!==6)&&N.geometry[Mx]("position",D=new Et.BufferAttribute(new Float32Array(6),3)),D.array[0]=x.x,D.array[1]=x.y||0,D.array[2]=x.z||0,D.array[3]=M.x,D.array[4]=M.y||0,D.array[5]=M.z||0,D.needsUpdate=!0}N.geometry.computeBoundingSphere()}else if(N.type==="Mesh")if(C){N.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(N.position.set(0,0,0),N.rotation.set(0,0,0),N.scale.set(1,1,1));var ne=Math.ceil(u(v)*10)/10,G=ne/2,z=new Et.TubeGeometry(C,w,G,e.linkResolution,!1);N.geometry.dispose(),N.geometry=z}else{if(!N.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var R=Math.ceil(u(v)*10)/10,P=R/2,I=new Et.CylinderGeometry(P,P,1,e.linkResolution,1,!1);I[Pg](new Et.Matrix4().makeTranslation(0,1/2,0)),I[Pg](new Et.Matrix4().makeRotationX(Math.PI/2)),N.geometry.dispose(),N.geometry=I}var H=new Et.Vector3(x.x,x.y||0,x.z||0),X=new Et.Vector3(M.x,M.y||0,M.z||0),J=H.distanceTo(X);N.position.x=H.x,N.position.y=H.y,N.position.z=H.z,N.scale.z=J,N.parent.localToWorld(X),N.lookAt(X)}}}}});function p(g){var _=t?g:e.layout.getLinkPosition(e.layout.graph.getLink(g.source,g.target).id),v=_[t?"source":"from"],T=_[t?"target":"to"];if(!(!v||!T||!v.hasOwnProperty("x")||!T.hasOwnProperty("x"))){var b=c(g);if(!b)g.__curve=null;else{var x=new Et.Vector3(v.x,v.y||0,v.z||0),M=new Et.Vector3(T.x,T.y||0,T.z||0),E=x.distanceTo(M),w,C=h(g);if(E>0){var N=T.x-v.x,D=T.y-v.y||0,U=new Et.Vector3().subVectors(M,x),R=U.clone().multiplyScalar(b).cross(N!==0||D!==0?new Et.Vector3(0,0,1):new Et.Vector3(0,1,0)).applyAxisAngle(U.normalize(),C).add(new Et.Vector3().addVectors(x,M).divideScalar(2));w=new Et.QuadraticBezierCurve3(x,R,M)}else{var P=b*70,I=-C,H=I+Math.PI/2;w=new Et.CubicBezierCurve3(x,new Et.Vector3(P*Math.cos(H),P*Math.sin(H),0).add(x),new Et.Vector3(P*Math.cos(I),P*Math.sin(I),0).add(x),M)}g.__curve=w}}}}function r(){var o=Yt(e.linkDirectionalArrowRelPos),u=Yt(e.linkDirectionalArrowLength),c=Yt(e.nodeVal);e.arrowDataMapper.entries().forEach(function(h){var d=kd(h,2),p=d[0],g=d[1];if(g){var _=t?p:e.layout.getLinkPosition(e.layout.graph.getLink(p.source,p.target).id),v=_[t?"source":"from"],T=_[t?"target":"to"];if(!(!v||!T||!v.hasOwnProperty("x")||!T.hasOwnProperty("x"))){var b=Math.cbrt(Math.max(0,c(v)||1))*e.nodeRelSize,x=Math.cbrt(Math.max(0,c(T)||1))*e.nodeRelSize,M=u(p),E=o(p),w=p.__curve?function(P){return p.__curve.getPoint(P)}:function(P){var I=function(X,J,ne,G){return J[X]+(ne[X]-J[X])*G||0};return{x:I("x",v,T,P),y:I("y",v,T,P),z:I("z",v,T,P)}},C=p.__curve?p.__curve.getLength():Math.sqrt(["x","y","z"].map(function(P){return Math.pow((T[P]||0)-(v[P]||0),2)}).reduce(function(P,I){return P+I},0)),N=b+M+(C-b-x-M)*E,D=w(N/C),U=w((N-M)/C);["x","y","z"].forEach(function(P){return g.position[P]=U[P]});var R=W2(Et.Vector3,Os(["x","y","z"].map(function(P){return D[P]})));g.parent.localToWorld(R),g.lookAt(R)}}})}function s(){var o=Yt(e.linkDirectionalParticleSpeed),u=Yt(e.linkDirectionalParticleOffset);e.graphData.links.forEach(function(c){var h=e.particlesDataMapper.getObj(c),d=h&&h.children,p=c.__singleHopPhotonsObj&&c.__singleHopPhotonsObj.children;if(!((!p||!p.length)&&(!d||!d.length))){var g=t?c:e.layout.getLinkPosition(e.layout.graph.getLink(c.source,c.target).id),_=g[t?"source":"from"],v=g[t?"target":"to"];if(!(!_||!v||!_.hasOwnProperty("x")||!v.hasOwnProperty("x"))){var T=o(c),b=Math.abs(u(c)),x=c.__curve?function(E){return c.__curve.getPoint(E)}:function(E){var w=function(N,D,U,R){return D[N]+(U[N]-D[N])*R||0};return{x:w("x",_,v,E),y:w("y",_,v,E),z:w("z",_,v,E)}},M=[].concat(Os(d||[]),Os(p||[]));M.forEach(function(E,w){var C=E.parent.__linkThreeObjType==="singleHopPhotons";if(E.hasOwnProperty("__progressRatio")||(E.__progressRatio=C?0:(w+b)/d.length),E.__progressRatio+=T,E.__progressRatio>=1)if(!C)E.__progressRatio=E.__progressRatio%1;else{E.parent.remove(E),Fb(E);return}var N=E.__progressRatio,D=x(N);E.geometry.type!=="SphereGeometry"&&E.lookAt(D.x,D.y,D.z),["x","y","z"].forEach(function(U){return E.position[U]=D[U]})})}}})}},emitParticle:function(e,t){if(t&&e.graphData.links.includes(t)){if(!t.__singleHopPhotonsObj){var n=new Et.Group;n.__linkThreeObjType="singleHopPhotons",t.__singleHopPhotonsObj=n,e.graphScene.add(n)}var r=Yt(e.linkDirectionalParticleThreeObject)(t);if(r&&e.linkDirectionalParticleThreeObject===r&&(r=r.clone()),!r){var s=Yt(e.linkDirectionalParticleWidth),o=Math.ceil(s(t)*10)/10/2,u=e.linkDirectionalParticleResolution,c=new Et.SphereGeometry(o,u,u),h=Yt(e.linkColor),d=Yt(e.linkDirectionalParticleColor),p=d(t)||h(t)||"#f0f0f0",g=new Et.Color(hd(p)),_=e.linkOpacity*3,v=new Et.MeshLambertMaterial({color:g,transparent:!0,opacity:_});r=new Et.Mesh(c,v)}t.__singleHopPhotonsObj.add(r)}return this},getGraphBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!e.initialised)return null;var n=(function r(s){var o=[];if(s.geometry){s.geometry.computeBoundingBox();var u=new Et.Box3;u.copy(s.geometry.boundingBox).applyMatrix4(s.matrixWorld),o.push(u)}return o.concat.apply(o,Os((s.children||[]).filter(function(c){return!c.hasOwnProperty("__graphObjType")||c.__graphObjType==="node"&&t(c.__data)}).map(r)))})(e.graphScene);return n.length?Object.assign.apply(Object,Os(["x","y","z"].map(function(r){return J_({},r,[z5(n,function(s){return s.min[r]}),I5(n,function(s){return s.max[r]})])}))):null}},stateInit:function(){return{d3ForceLayout:OV().force("link",xV()).force("charge",BV()).force("center",S4()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,t){t.graphScene=e,t.nodeDataMapper=new cd(e,{objBindAttr:"__threeObj"}),t.linkDataMapper=new cd(e,{objBindAttr:"__lineObj"}),t.arrowDataMapper=new cd(e,{objBindAttr:"__arrowObj"}),t.particlesDataMapper=new cd(e,{objBindAttr:"__photonsObj"})},update:function(e,t){var n=function(W){return W.some(function(ie){return t.hasOwnProperty(ie)})};if(e.engineRunning=!1,typeof e.onUpdate=="function"&&e.onUpdate(),e.nodeAutoColorBy!==null&&n(["nodeAutoColorBy","graphData","nodeColor"])&&RR(e.graphData.nodes,Yt(e.nodeAutoColorBy),e.nodeColor),e.linkAutoColorBy!==null&&n(["linkAutoColorBy","graphData","linkColor"])&&RR(e.graphData.links,Yt(e.linkAutoColorBy),e.linkColor),e._flushObjects||n(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var r=Yt(e.nodeThreeObject),s=Yt(e.nodeThreeObjectExtend),o=Yt(e.nodeVal),u=Yt(e.nodeColor),c=Yt(e.nodeVisibility),h={},d={};(e._flushObjects||n(["nodeThreeObject","nodeThreeObjectExtend"]))&&e.nodeDataMapper.clear(),e.nodeDataMapper.onCreateObj(function(Z){var W=r(Z),ie=s(Z);W&&e.nodeThreeObject===W&&(W=W.clone());var Le;return W&&!ie?Le=W:(Le=new Et.Mesh,Le.__graphDefaultObj=!0,W&&ie&&Le.add(W)),Le.__graphObjType="node",Le}).onUpdateObj(function(Z,W){if(Z.__graphDefaultObj){var ie=o(W)||1,Le=Math.cbrt(ie)*e.nodeRelSize,ke=e.nodeResolution;(!Z.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||Z.geometry.parameters.radius!==Le||Z.geometry.parameters.widthSegments!==ke)&&(h.hasOwnProperty(ie)||(h[ie]=new Et.SphereGeometry(Le,ke,ke)),Z.geometry.dispose(),Z.geometry=h[ie]);var ze=u(W),ht=new Et.Color(hd(ze||"#ffffaa")),nn=e.nodeOpacity*Tx(ze);(Z.material.type!=="MeshLambertMaterial"||!Z.material.color.equals(ht)||Z.material.opacity!==nn)&&(d.hasOwnProperty(ze)||(d[ze]=new Et.MeshLambertMaterial({color:ht,transparent:!0,opacity:nn})),Z.material.dispose(),Z.material=d[ze])}}).digest(e.graphData.nodes.filter(c))}if(e._flushObjects||n(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","linkDirectionalParticleThreeObject"])){var p=Yt(e.linkThreeObject),g=Yt(e.linkThreeObjectExtend),_=Yt(e.linkMaterial),v=Yt(e.linkVisibility),T=Yt(e.linkColor),b=Yt(e.linkWidth),x={},M={},E={},w=e.graphData.links.filter(v);if((e._flushObjects||n(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&e.linkDataMapper.clear(),e.linkDataMapper.onRemoveObj(function(Z){var W=Z.__data&&Z.__data.__singleHopPhotonsObj;W&&(W.parent.remove(W),Fb(W),delete Z.__data.__singleHopPhotonsObj)}).onCreateObj(function(Z){var W=p(Z),ie=g(Z);W&&e.linkThreeObject===W&&(W=W.clone());var Le;if(!W||ie){var ke=!!b(Z);if(ke)Le=new Et.Mesh;else{var ze=new Et.BufferGeometry;ze[Mx]("position",new Et.BufferAttribute(new Float32Array(6),3)),Le=new Et.Line(ze)}}var ht;return W?ie?(ht=new Et.Group,ht.__graphDefaultObj=!0,ht.add(Le),ht.add(W)):ht=W:(ht=Le,ht.__graphDefaultObj=!0),ht.renderOrder=10,ht.__graphObjType="link",ht}).onUpdateObj(function(Z,W){if(Z.__graphDefaultObj){var ie=Z.children.length?Z.children[0]:Z,Le=Math.ceil(b(W)*10)/10,ke=!!Le;if(ke){var ze=Le/2,ht=e.linkResolution;if(!ie.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||ie.geometry.parameters.radiusTop!==ze||ie.geometry.parameters.radialSegments!==ht){if(!x.hasOwnProperty(Le)){var nn=new Et.CylinderGeometry(ze,ze,1,ht,1,!1);nn[Pg](new Et.Matrix4().makeTranslation(0,1/2,0)),nn[Pg](new Et.Matrix4().makeRotationX(Math.PI/2)),x[Le]=nn}ie.geometry.dispose(),ie.geometry=x[Le]}}var Pt=_(W);if(Pt)ie.material=Pt;else{var wt=T(W),qt=new Et.Color(hd(wt||"#f0f0f0")),Mt=e.linkOpacity*Tx(wt),un=ke?"MeshLambertMaterial":"LineBasicMaterial";if(ie.material.type!==un||!ie.material.color.equals(qt)||ie.material.opacity!==Mt){var K=ke?M:E;K.hasOwnProperty(wt)||(K[wt]=new Et[un]({color:qt,transparent:Mt<1,opacity:Mt,depthWrite:Mt>=1})),ie.material.dispose(),ie.material=K[wt]}}}}).digest(w),e.linkDirectionalArrowLength||t.hasOwnProperty("linkDirectionalArrowLength")){var C=Yt(e.linkDirectionalArrowLength),N=Yt(e.linkDirectionalArrowColor);e.arrowDataMapper.onCreateObj(function(){var Z=new Et.Mesh(void 0,new Et.MeshLambertMaterial({transparent:!0}));return Z.__linkThreeObjType="arrow",Z}).onUpdateObj(function(Z,W){var ie=C(W),Le=e.linkDirectionalArrowResolution;if(!Z.geometry.type.match(/^Cone(Buffer)?Geometry$/)||Z.geometry.parameters.height!==ie||Z.geometry.parameters.radialSegments!==Le){var ke=new Et.ConeGeometry(ie*.25,ie,Le);ke.translate(0,ie/2,0),ke.rotateX(Math.PI/2),Z.geometry.dispose(),Z.geometry=ke}var ze=N(W)||T(W)||"#f0f0f0";Z.material.color=new Et.Color(hd(ze)),Z.material.opacity=e.linkOpacity*3*Tx(ze)}).digest(w.filter(C))}if(e.linkDirectionalParticles||t.hasOwnProperty("linkDirectionalParticles")){var D=Yt(e.linkDirectionalParticles),U=Yt(e.linkDirectionalParticleWidth),R=Yt(e.linkDirectionalParticleColor),P=Yt(e.linkDirectionalParticleThreeObject),I={},H={};e.particlesDataMapper.onCreateObj(function(){var Z=new Et.Group;return Z.__linkThreeObjType="photons",Z.__photonDataMapper=new cd(Z),Z}).onUpdateObj(function(Z,W){var ie=!!Z.children.length&&Z.children[0],Le=P(W),ke,ze;if(Le)ke=Le.geometry,ze=Le.material;else{var ht=Math.ceil(U(W)*10)/10/2,nn=e.linkDirectionalParticleResolution;ie&&ie.geometry.parameters.radius===ht&&ie.geometry.parameters.widthSegments===nn?ke=ie.geometry:(H.hasOwnProperty(ht)||(H[ht]=new Et.SphereGeometry(ht,nn,nn)),ke=H[ht]);var Pt=R(W)||T(W)||"#f0f0f0",wt=new Et.Color(hd(Pt)),qt=e.linkOpacity*3;ie&&ie.material.color.equals(wt)&&ie.material.opacity===qt?ze=ie.material:(I.hasOwnProperty(Pt)||(I[Pt]=new Et.MeshLambertMaterial({color:wt,transparent:!0,opacity:qt})),ze=I[Pt])}ie&&(ie.geometry!==ke&&ie.geometry.dispose(),ie.material!==ze&&ie.material.dispose());var Mt=Math.round(Math.abs(D(W)));Z.__photonDataMapper.id(function(un){return un.idx}).onCreateObj(function(){return new Et.Mesh(ke,ze)}).onUpdateObj(function(un){un.geometry=ke,un.material=ze}).digest(Os(new Array(Mt)).map(function(un,K){return{idx:K}}))}).digest(w.filter(D))}}if(e._flushObjects=!1,n(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach(function(Z){Z.source=Z[e.linkSource],Z.target=Z[e.linkTarget]});var X=e.forceEngine!=="ngraph",J;if(X){(J=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var ne=e.d3ForceLayout.force("link");ne&&ne.id(function(Z){return Z[e.nodeId]}).links(e.graphData.links);var G=e.dagMode&&V6(e.graphData,function(Z){return Z[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),z=Math.max.apply(Math,Os(Object.values(G||[]))),q=e.dagLevelDistance||e.graphData.nodes.length/(z||1)*H6*(["radialin","radialout"].indexOf(e.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var ce=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(Z){return delete Z[ce]})}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var xe=["rl","td","zout"].includes(e.dagMode),O=function(W){return(G[W[e.nodeId]]-z/2)*q*(xe?-1:1)},Y=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(Z){return Z[Y]=O(Z)})}e.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(e.dagMode)!==-1?FV(function(Z){var W=G[Z[e.nodeId]]||-1;return(e.dagMode==="radialin"?z-W:W)*q}).strength(function(Z){return e.dagNodeFilter(Z)?1:0}):null)}else{var ue=CR.graph();e.graphData.nodes.forEach(function(Z){ue.addNode(Z[e.nodeId])}),e.graphData.links.forEach(function(Z){ue.addLink(Z.source,Z.target)}),J=CR.forcelayout(ue,F6({dimensions:e.numDimensions},e.ngraphPhysics)),J.graph=ue}for(var Ne=0;Ne<e.warmupTicks&&!(X&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);Ne++)J[X?"tick":"step"]();e.layout=J,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}});function q6(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=(function(r){function s(){var o;H2(this,s);for(var u=arguments.length,c=new Array(u),h=0;h<u;h++)c[h]=arguments[h];return o=V2(this,s,[].concat(c)),o.__kapsuleInstance=W2(i,[].concat(Os(t?[o]:[]),c)),o}return $2(s,r),q2(s)})(e);return Object.keys(i()).forEach(function(r){return n.prototype[r]=function(){var s,o=(s=this.__kapsuleInstance)[r].apply(s,arguments);return o===this.__kapsuleInstance?this:o}}),n}var $6=window.THREE?window.THREE:{Group:Hc},Q2=q6(W6,$6.Group,!0);const j6=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],Ex=new WeakMap;class X6{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=j6,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:n,material:r,object:s}=e;if(t={material:this.getMaterialData(r),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:u}=e.context;t.bufferWidth=o,t.bufferHeight=u}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const r=e[n];t[n]={version:r.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return!!(e.context.modelViewMatrix||e.context.modelNormalViewMatrix||e.context.getAO||e.context.getShadow)}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const r=e[n];r!=null&&(typeof r=="object"&&r.clone!==void 0?r.isTexture===!0?t[n]={id:r.id,version:r.version}:t[n]=r.clone():t[n]=r)}return t}equals(e,t){const{object:n,material:r,geometry:s}=e,o=this.getRenderObjectData(e);if(o.worldMatrix.equals(n.matrixWorld)!==!0)return o.worldMatrix.copy(n.matrixWorld),!1;const u=o.material;for(const b in u){const x=u[b],M=r[b];if(x.equals!==void 0){if(x.equals(M)===!1)return x.copy(M),!1}else if(M.isTexture===!0){if(x.id!==M.id||x.version!==M.version)return x.id=M.id,x.version=M.version,!1}else if(x!==M)return u[b]=M,!1}if(u.transmission>0){const{width:b,height:x}=e.context;if(o.bufferWidth!==b||o.bufferHeight!==x)return o.bufferWidth=b,o.bufferHeight=x,!1}const c=o.geometry,h=s.attributes,d=c.attributes,p=Object.keys(d),g=Object.keys(h);if(c.id!==s.id)return c.id=s.id,!1;if(p.length!==g.length)return o.geometry.attributes=this.getAttributesData(h),!1;for(const b of p){const x=d[b],M=h[b];if(M===void 0)return delete d[b],!1;if(x.version!==M.version)return x.version=M.version,!1}const _=s.index,v=c.indexVersion,T=_?_.version:null;if(v!==T)return c.indexVersion=T,!1;if(c.drawRange.start!==s.drawRange.start||c.drawRange.count!==s.drawRange.count)return c.drawRange.start=s.drawRange.start,c.drawRange.count=s.drawRange.count,!1;if(o.morphTargetInfluences){let b=!1;for(let x=0;x<o.morphTargetInfluences.length;x++)o.morphTargetInfluences[x]!==n.morphTargetInfluences[x]&&(o.morphTargetInfluences[x]=n.morphTargetInfluences[x],b=!0);if(b)return!1}if(o.lights){for(let b=0;b<t.length;b++)if(o.lights[b].map!==t[b].map)return!1}return o.center&&o.center.equals(n.center)===!1?(o.center.copy(n.center),!0):(e.bundle!==null&&(o.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const n of e)n.isSpotLight===!0&&n.map!==null&&t.push({map:n.map.version});return t}getLights(e,t){if(Ex.has(e)){const r=Ex.get(e);if(r.renderId===t)return r.lightsData}const n=this.getLightsData(e.getLights());return Ex.set(e,{renderId:t,lightsData:n}),n}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const r=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(r||s)return!1;const o=this.getLights(e.lightsNode,n);return this.equals(e,o)!==!0}}function fT(i,e=0){let t=3735928559^e,n=1103547991^e;if(i instanceof Array)for(let r=0,s;r<i.length;r++)s=i[r],t=Math.imul(t^s,2654435761),n=Math.imul(n^s,1597334677);else for(let r=0,s;r<i.length;r++)s=i.charCodeAt(r),t=Math.imul(t^s,2654435761),n=Math.imul(n^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&n)+(t>>>0)}const e0=i=>fT(i),Up=i=>fT(i),Vd=(...i)=>fT(i),Y6=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),NR=new WeakMap;function Z2(i){return Y6.get(i)}function A_(i){if(i==null)return null;const e=typeof i;return i.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":i.isVector2===!0?"vec2":i.isVector3===!0?"vec3":i.isVector4===!0?"vec4":i.isMatrix2===!0?"mat2":i.isMatrix3===!0?"mat3":i.isMatrix4===!0?"mat4":i.isColor===!0?"color":i instanceof ArrayBuffer?"ArrayBuffer":null}function dT(i,...e){const t=i?i.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),i==="color"?new dt(...e):t==="vec2"?new Ue(...e):t==="vec3"?new k(...e):t==="vec4"?new Lt(...e):t==="mat2"?new $_(...e):t==="mat3"?new Ct(...e):t==="mat4"?new Ht(...e):i==="bool"?e[0]||!1:i==="float"||i==="int"||i==="uint"?e[0]||0:i==="string"?e[0]||"":i==="ArrayBuffer"?Q6(e[0]):null}function J2(i){let e=NR.get(i);return e===void 0&&(e={},NR.set(i,e)),e}function K6(i){let e="";const t=new Uint8Array(i);for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function Q6(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0)).buffer}const Ug={VERTEX:"vertex"},Ot={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},vs={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},Z6=["fragment","vertex"],DR=["setup","analyze","generate"],LR=[...Z6,"compute"],jh=["x","y","z","w"],J6={analyze:"setup",generate:"analyze"};let e8=0;class ct extends xa{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Ot.NONE,this.updateBeforeType=Ot.NONE,this.updateAfterType=Ot.NONE,this.uuid=v_.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:e8++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,Ot.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Ot.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Ot.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const n of Object.getOwnPropertyNames(this)){const r=this[n];if(!(n.startsWith("_")===!0||e.has(r))){if(Array.isArray(r)===!0)for(let s=0;s<r.length;s++){const o=r[s];o&&o.isNode===!0&&t.push({property:n,index:s,childNode:o})}else if(r&&r.isNode===!0)t.push({property:n,childNode:r});else if(r&&Object.getPrototypeOf(r)===Object.prototype)for(const s in r){if(s.startsWith("_")===!0)continue;const o=r[s];o&&o.isNode===!0&&t.push({property:n,index:s,childNode:o})}}}return t}getCacheKey(e=!1,t=null){if(e=e||this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);const n=[];for(const{property:r,childNode:s}of this._getChildren(t))n.push(e0(r.slice(0,-4)),s.getCacheKey(e,t));this._cacheKey=Vd(Up(n),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let n=0;for(const r of this.getChildren())t["node"+n++]=r;return t.outputNode||null}analyze(e,t=null){const n=e.increaseUsage(this);if(this.parents===!0){const r=e.getDataFromNode(this,"any");r.stages=r.stages||{},r.stages[e.shaderStage]=r.stages[e.shaderStage]||[],r.stages[e.shaderStage].push(t)}if(n===1){const r=e.getNodeProperties(this);for(const s of Object.values(r))s&&s.isNode===!0&&s.build(e,this)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(e,t)}updateBefore(){Ae("Abstract function.")}updateAfter(){Ae("Abstract function.")}update(){Ae("Abstract function.")}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const n=this.getShared(e);if(this!==n)return n.build(e,t);if(this._beforeNodes!==null){const c=this._beforeNodes;this._beforeNodes=null;for(const h of c)h.build(e,t);this._beforeNodes=c}const r=e.getDataFromNode(this);r.buildStages=r.buildStages||{},r.buildStages[e.buildStage]=!0;const s=J6[e.buildStage];if(s&&r.buildStages[s]!==!0){const c=e.getBuildStage();e.setBuildStage(s),this.build(e),e.setBuildStage(c)}e.addNode(this),e.addChain(this);let o=null;const u=e.getBuildStage();if(u==="setup"){this.updateReference(e);const c=e.getNodeProperties(this);if(c.initialized!==!0){c.initialized=!0,c.outputNode=this.setup(e)||c.outputNode||null;for(const h of Object.values(c))if(h&&h.isNode===!0){if(h.parents===!0){const d=e.getNodeProperties(h);d.parents=d.parents||[],d.parents.push(this)}h.build(e)}}o=c.outputNode}else if(u==="analyze")this.analyze(e,t);else if(u==="generate"){if(this.generate.length<2){const h=this.getNodeType(e),d=e.getDataFromNode(this);o=d.snippet,o===void 0?d.generated===void 0?(d.generated=!0,o=this.generate(e)||"",d.snippet=o):(Ae("Node: Recursion detected.",this),o="/* Recursion detected. */"):d.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,h,t)}else o=this.generate(e,t)||"";o===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(Re(`TSL: Invalid generated code, expected a "${t}".`),o=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),o}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:r,index:s,childNode:o}of t)s!==void 0?(n[r]===void 0&&(n[r]=Number.isInteger(s)?[]:{}),n[r][s]=o.toJSON(e.meta).uuid):n[r]=o.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const r=[];for(const s of e.inputNodes[n])r.push(t[s]);this[n]=r}else if(typeof e.inputNodes[n]=="object"){const r={};for(const s in e.inputNodes[n]){const o=e.inputNodes[n][s];r[s]=t[o]}this[n]=r}else{const r=e.inputNodes[n];this[n]=t[r]}}}toJSON(e){const{uuid:t,type:n}=this,r=e===void 0||typeof e=="string";r&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:n,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},r!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function o(u){const c=[];for(const h in u){const d=u[h];delete d.metadata,c.push(d)}return c}if(r){const u=o(e.textures),c=o(e.images),h=o(e.nodes);u.length>0&&(s.textures=u),c.length>0&&(s.images=c),h.length>0&&(s.nodes=h)}return s}}class Xh extends ct{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}generate(e){const t=this.indexNode.getNodeType(e),n=this.node.build(e),r=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${n}[ ${r} ]`}}class eD extends ct{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const r of this.convertTo.split("|"))(n===null||e.getTypeLength(t)===e.getTypeLength(r))&&(n=r);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,r=this.getNodeType(e),s=n.build(e,r);return e.format(s,r,t)}}class xi extends ct{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const r=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,r,t);if(r!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,r),u=e.getVarFromNode(this,null,r),c=e.getPropertyName(u);return e.addLineFlowCode(`${c} = ${o}`,this),s.snippet=o,s.propertyName=c,e.format(s.propertyName,r,t)}}return super.build(e,t)}}class t8 extends xi{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),r=e.getTypeLength(n),s=this.nodes,o=e.getComponentType(n),u=[];let c=0;for(const d of s){if(c>=r){Re(`TSL: Length of parameters exceeds maximum length of function '${n}()' type.`);break}let p=d.getNodeType(e),g=e.getTypeLength(p),_;if(c+g>r&&(Re(`TSL: Length of '${n}()' data exceeds maximum length of output type.`),g=r-c,p=e.getTypeFromLength(g)),c+=g,_=d.build(e,p),e.getComponentType(p)!==o){const T=e.getTypeFromLength(g,o);_=e.format(_,p,T)}u.push(_)}const h=`${e.getType(n)}( ${u.join(", ")} )`;return e.format(h,n,t)}}const n8=jh.join("");class i8 extends ct{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(jh.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const n=this.node,r=e.getTypeLength(n.getNodeType(e));let s=null;if(r>1){let o=null;this.getVectorLength()>=r&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=n.build(e,o);this.components.length===r&&this.components===n8.slice(0,this.components.length)?s=e.format(c,o,t):s=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else s=n.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class r8 extends xi{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:r}=this,s=this.getNodeType(e),o=e.getComponentType(r.getNodeType(e)),u=e.getTypeFromLength(n.length,o),c=r.build(e,u),h=t.build(e,s),d=e.getTypeLength(s),p=[];for(let g=0;g<d;g++){const _=jh[g];_===n[0]?(p.push(c),g+=n.length-1):p.push(h+"."+_)}return`${e.getType(s)}( ${p.join(", ")} )`}}class s8 extends xi{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,r=this.getNodeType(e),s=n.build(e),o=e.getVarFromNode(this),u=e.getPropertyName(o);e.addLineFlowCode(u+" = "+s,this);const c=e.getTypeLength(r),h=[];let d=0;for(let p=0;p<c;p++){const g=jh[p];g===t[d]?(h.push("1.0 - "+(u+"."+g)),d++):h.push(u+"."+g)}return`${e.getType(r)}( ${h.join(", ")} )`}}class pT extends ct{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?A_(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=A_(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=K6(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?dT(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){Ae("Abstract function.")}}const PR=/float|u?int/;class ba extends pT{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return PR.test(n)&&PR.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}}class a8 extends ct{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){Ae(`TSL: Member "${this.property}" does not exist in struct.`);const n=this.getNodeType(e);return e.generateConst(n)}return this.structNode.build(e)+"."+this.property}}let vu=null;const Ib=new Map;function ye(i,e){if(Ib.has(i)){Ae(`TSL: Redefinition of method chaining '${i}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${i} is not a function`);Ib.set(i,e),i!=="assign"&&(ct.prototype[i]=function(...t){return this.isStackNode?this.addToStack(e(...t)):e(this,...t)},ct.prototype[i+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const o8=i=>i.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),UR=i=>o8(i).split("").sort().join("");ct.prototype.assign=function(...i){if(this.isStackNode!==!0)return vu!==null?vu.assign(this,...i):Re("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const e=Ib.get("assign");return this.addToStack(e(...i))}};ct.prototype.toVarIntent=function(){return this};ct.prototype.get=function(i){return new a8(this,i)};const Hd={};function Og(i,e,t){Hd[i]=Hd[e]=Hd[t]={get(){this._cache=this._cache||{};let o=this._cache[i];return o===void 0&&(o=new i8(this,i),this._cache[i]=o),o},set(o){this[i].assign(Ze(o))}};const n=i.toUpperCase(),r=e.toUpperCase(),s=t.toUpperCase();ct.prototype["set"+n]=ct.prototype["set"+r]=ct.prototype["set"+s]=function(o){const u=UR(i);return new r8(this,u,Ze(o))},ct.prototype["flip"+n]=ct.prototype["flip"+r]=ct.prototype["flip"+s]=function(){const o=UR(i);return new s8(this,o)}}const Js=["x","y","z","w"],ea=["r","g","b","a"],ta=["s","t","p","q"];for(let i=0;i<4;i++){let e=Js[i],t=ea[i],n=ta[i];Og(e,t,n);for(let r=0;r<4;r++){e=Js[i]+Js[r],t=ea[i]+ea[r],n=ta[i]+ta[r],Og(e,t,n);for(let s=0;s<4;s++){e=Js[i]+Js[r]+Js[s],t=ea[i]+ea[r]+ea[s],n=ta[i]+ta[r]+ta[s],Og(e,t,n);for(let o=0;o<4;o++)e=Js[i]+Js[r]+Js[s]+Js[o],t=ea[i]+ea[r]+ea[s]+ea[o],n=ta[i]+ta[r]+ta[s]+ta[o],Og(e,t,n)}}}for(let i=0;i<32;i++)Hd[i]={get(){this._cache=this._cache||{};let e=this._cache[i];return e===void 0&&(e=new Xh(this,new ba(i,"uint")),this._cache[i]=e),e},set(e){this[i].assign(Ze(e))}};Object.defineProperties(ct.prototype,Hd);const OR=new WeakMap,l8=function(i,e=null){const t=A_(i);return t==="node"?i:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?Ze(zb(i,e)):t==="shader"?i.isFn?i:Te(i):i},u8=function(i,e=null){for(const t in i)i[t]=Ze(i[t],e);return i},c8=function(i,e=null){const t=i.length;for(let n=0;n<t;n++)i[n]=Ze(i[n],e);return i},tD=function(i,e=null,t=null,n=null){function r(d){return n!==null?(d=Ze(Object.assign(d,n)),n.intent===!0&&(d=d.toVarIntent())):d=Ze(d),d}let s,o=e,u,c;function h(d){let p;return o?p=/[a-z]/i.test(o)?o+"()":o:p=i.type,u!==void 0&&d.length<u?(Re(`TSL: "${p}" parameter length is less than minimum required.`),d.concat(new Array(u-d.length).fill(0))):c!==void 0&&d.length>c?(Re(`TSL: "${p}" parameter length exceeds limit.`),d.slice(0,c)):d}return e===null?s=(...d)=>r(new i(...Qc(h(d)))):t!==null?(t=Ze(t),s=(...d)=>r(new i(e,...Qc(h(d)),t))):s=(...d)=>r(new i(e,...Qc(h(d)))),s.setParameterLength=(...d)=>(d.length===1?u=c=d[0]:d.length===2&&([u,c]=d),s),s.setName=d=>(o=d,s),s},h8=function(i,...e){return new i(...Qc(e))};class f8 extends ct{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:n}=this,r=e.getNodeProperties(t),s=e.getClosestSubBuild(t.subBuilds)||"",o=s||"default";if(r[o])return r[o];const u=e.subBuildFn,c=e.fnCall;e.subBuildFn=s,e.fnCall=this;let h=null;if(t.layout){let d=OR.get(e.constructor);d===void 0&&(d=new WeakMap,OR.set(e.constructor,d));let p=d.get(t);p===void 0&&(p=Ze(e.buildFunctionNode(t)),d.set(t,p)),e.addInclude(p);const g=n?d8(n):null;h=Ze(p.call(g))}else{const d=new Proxy(e,{get:(T,b,x)=>{let M;return Symbol.iterator===b?M=function*(){yield void 0}:M=Reflect.get(T,b,x),M}}),p=n?p8(n):null,g=Array.isArray(n)?n.length>0:n!==null,_=t.jsFunc,v=g||_.length>1?_(p,d):_(d);h=Ze(v)}return e.subBuildFn=u,e.fnCall=c,t.once&&(r[o]=h),h}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),n=e.getSubBuildOutput(this);return t[n]=t[n]||this.setupOutput(e),t[n].subBuild=e.getClosestSubBuild(this),t[n]}build(e,t=null){let n=null;const r=e.getBuildStage(),s=e.getNodeProperties(this),o=e.getSubBuildOutput(this),u=this.getOutputNode(e),c=e.fnCall;if(e.fnCall=this,r==="setup"){const h=e.getSubBuildProperty("initialized",this);if(s[h]!==!0&&(s[h]=!0,s[o]=this.getOutputNode(e),s[o].build(e),this.shaderNode.subBuilds))for(const d of e.chaining){const p=e.getDataFromNode(d,"any");p.subBuilds=p.subBuilds||new Set;for(const g of this.shaderNode.subBuilds)p.subBuilds.add(g)}n=s[o]}else r==="analyze"?u.build(e,t):r==="generate"&&(n=u.build(e,t)||"");return e.fnCall=c,n}}function d8(i){let e;return vT(i),i[0]&&(i[0].isNode||Object.getPrototypeOf(i[0])!==Object.prototype)?e=[...i]:e=i[0],e}function p8(i){let e=0;return vT(i),new Proxy(i,{get:(t,n,r)=>{let s;if(n==="length")return s=i.length,s;if(Symbol.iterator===n)s=function*(){for(const o of i)yield Ze(o)};else{if(i.length>0)if(Object.getPrototypeOf(i[0])===Object.prototype){const o=i[0];o[n]===void 0?s=o[e++]:s=Reflect.get(o,n,r)}else i[0]instanceof ct&&(i[n]===void 0?s=i[e++]:s=Reflect.get(i,n,r));else s=Reflect.get(t,n,r);s=Ze(s)}return s}})}class m8 extends ct{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new f8(this,e)}setup(){return this.call()}}const g8=[!1,!0],_8=[0,1,2,3],v8=[-1,-2],nD=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],mT=new Map;for(const i of g8)mT.set(i,new ba(i));const gT=new Map;for(const i of _8)gT.set(i,new ba(i,"uint"));const _T=new Map([...gT].map(i=>new ba(i.value,"int")));for(const i of v8)_T.set(i,new ba(i,"int"));const t0=new Map([..._T].map(i=>new ba(i.value)));for(const i of nD)t0.set(i,new ba(i));for(const i of nD)t0.set(-i,new ba(-i));const n0={bool:mT,uint:gT,ints:_T,float:t0},BR=new Map([...mT,...t0]),zb=(i,e)=>BR.has(i)?BR.get(i):i.isNode===!0?i:new ba(i,e),bi=function(i,e=null){return(...t)=>{for(const r of t)if(r===void 0)return Re(`TSL: Invalid parameter for the type "${i}".`),new ba(0,i);if((t.length===0||!["bool","float","int","uint"].includes(i)&&t.every(r=>{const s=typeof r;return s!=="object"&&s!=="function"}))&&(t=[dT(i,...t)]),t.length===1&&e!==null&&e.has(t[0]))return Bg(e.get(t[0]));if(t.length===1){const r=zb(t[0],i);return r.nodeType===i?Bg(r):Bg(new eD(r,i))}const n=t.map(r=>zb(r));return Bg(new t8(n,i))}},FR=i=>typeof i=="object"&&i!==null?i.value:i,y8=i=>i!=null?i.nodeType||i.convertTo||(typeof i=="string"?i:null):null;function Ld(i,e){return new m8(i,e)}const Ze=(i,e=null)=>l8(i,e),Bg=(i,e=null)=>Ze(i,e).toVarIntent(),vT=(i,e=null)=>new u8(i,e),Qc=(i,e=null)=>new c8(i,e),sn=(i,e=null,t=null,n=null)=>new tD(i,e,t,n),Ge=(i,...e)=>new h8(i,...e),et=(i,e=null,t=null,n={})=>new tD(i,e,t,{...n,intent:!0});let x8=0;class b8 extends ct{constructor(e,t=null){super();let n=null;t!==null&&(typeof t=="object"?n=t.return:(typeof t=="string"?n=t:Re("TSL: Invalid layout type."),t=null)),this.shaderNode=new Ld(e,n),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const n={name:"fn"+x8++,type:t,inputs:[]};for(const r in e)r!=="return"&&n.inputs.push({name:r,type:e[r]});e=n}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return Re('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),e.generateConst(t)}}function Te(i,e=null){const t=new b8(i,e);return new Proxy(()=>{},{apply(n,r,s){return t.call(...s)},get(n,r,s){return Reflect.get(t,r,s)},set(n,r,s,o){return Reflect.set(t,r,s,o)}})}const w_=i=>{vu=i},iD=()=>vu,wn=(...i)=>vu.If(...i);function rD(i){return vu&&vu.addToStack(i),i}ye("toStack",rD);const S8=new bi("color"),ge=new bi("float",n0.float),In=new bi("int",n0.ints),Wt=new bi("uint",n0.uint),yT=new bi("bool",n0.bool),nt=new bi("vec2"),aa=new bi("ivec2"),sD=new bi("uvec2"),T8=new bi("bvec2"),ve=new bi("vec3"),aD=new bi("ivec3"),oD=new bi("uvec3"),M8=new bi("bvec3"),Dt=new bi("vec4"),lD=new bi("ivec4"),uD=new bi("uvec4"),E8=new bi("bvec4"),xT=new bi("mat2"),or=new bi("mat3"),su=new bi("mat4");ye("toColor",S8);ye("toFloat",ge);ye("toInt",In);ye("toUint",Wt);ye("toBool",yT);ye("toVec2",nt);ye("toIVec2",aa);ye("toUVec2",sD);ye("toBVec2",T8);ye("toVec3",ve);ye("toIVec3",aD);ye("toUVec3",oD);ye("toBVec3",M8);ye("toVec4",Dt);ye("toIVec4",lD);ye("toUVec4",uD);ye("toBVec4",E8);ye("toMat2",xT);ye("toMat3",or);ye("toMat4",su);const A8=sn(Xh).setParameterLength(2),w8=(i,e)=>Ze(new eD(Ze(i),e));ye("element",A8);ye("convert",w8);ye("append",i=>(Ae("TSL: .append() has been renamed to .toStack()."),rD(i)));class ln extends ct{static get type(){return"PropertyNode"}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return e0(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const cl=(i,e)=>new ln(i,e),R_=(i,e)=>new ln(i,e,!0),_n=Ge(ln,"vec4","DiffuseColor"),kc=Ge(ln,"vec3","DiffuseContribution"),IR=Ge(ln,"vec3","EmissiveColor"),to=Ge(ln,"float","Roughness"),il=Ge(ln,"float","Metalness"),Gb=Ge(ln,"float","Clearcoat"),C_=Ge(ln,"float","ClearcoatRoughness"),ps=Ge(ln,"vec3","Sheen"),Kl=Ge(ln,"float","SheenRoughness"),bT=Ge(ln,"float","Iridescence"),kb=Ge(ln,"float","IridescenceIOR"),Vb=Ge(ln,"float","IridescenceThickness"),Hb=Ge(ln,"float","AlphaT"),jl=Ge(ln,"float","Anisotropy"),c_=Ge(ln,"vec3","AnisotropyT"),Zc=Ge(ln,"vec3","AnisotropyB"),yu=Ge(ln,"color","SpecularColor"),Wc=Ge(ln,"color","SpecularColorBlended"),Wd=Ge(ln,"float","SpecularF90"),Wb=Ge(ln,"float","Shininess"),qd=Ge(ln,"vec4","Output"),Ax=Ge(ln,"float","dashSize"),zR=Ge(ln,"float","gapSize"),h_=Ge(ln,"float","IOR"),qb=Ge(ln,"float","Transmission"),cD=Ge(ln,"float","Thickness"),hD=Ge(ln,"float","AttenuationDistance"),fD=Ge(ln,"color","AttenuationColor"),dD=Ge(ln,"float","Dispersion");class pD extends ct{static get type(){return"UniformGroupNode"}constructor(e,t=!1,n=1){super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const R8=i=>new pD(i),ST=(i,e=0)=>new pD(i,!0,e),C8=ST("frame"),yt=ST("render"),mD=R8("object");class Op extends pT{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=mD}setName(e){return this.name=e,this}label(e){return Ae('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(n=>{const r=e(n,this);r!==void 0&&(this.value=r)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const n=this.getNodeType(e),r=this.getUniformHash(e);let s=e.getNodeFromHash(r);s===void 0&&(e.setHashNode(this,r),s=this);const o=s.getInputType(e),u=e.getUniformFromNode(s,o,e.shaderStage,this.name||e.context.nodeName),c=e.getPropertyName(u);e.context.nodeName!==void 0&&delete e.context.nodeName;let h=c;if(n==="bool"){const d=e.getDataFromNode(this);let p=d.propertyName;if(p===void 0){const g=e.getVarFromNode(this,null,"bool");p=e.getPropertyName(g),d.propertyName=p,h=e.format(c,o,n),e.addLineFlowCode(`${p} = ${h}`,this)}h=p}return e.format(h,n,t)}}const bt=(i,e)=>{const t=y8(e||i);if(t===i&&(i=dT(t)),i&&i.isNode===!0){let n=i.value;i.traverse(r=>{r.isConstNode===!0&&(n=r.value)}),i=n}return new Op(i,t)};class GR extends xi{static get type(){return"ArrayNode"}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null?this.values[0].getNodeType(e):this.nodeType}getElementType(e){return this.getNodeType(e)}getMemberType(e,t){return this.nodeType===null?this.values[0].getMemberType(e,t):super.getMemberType(e,t)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const N8=(...i)=>{let e;if(i.length===1){const t=i[0];e=new GR(null,t.length,t)}else{const t=i[0],n=i[1];e=new GR(t,n)}return Ze(e)};ye("toArray",(i,e)=>N8(Array(e).fill(i)));class D8 extends xi{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return jh.join("").slice(0,n)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:n}=this,r=t.getScope(),s=e.getDataFromNode(r);s.assign=!0;const o=e.getNodeProperties(this);o.sourceNode=n,o.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:n,sourceNode:r}=e.getNodeProperties(this),s=this.needsSplitAssign(e),o=n.build(e),u=n.getNodeType(e),c=r.build(e,u),h=r.getNodeType(e),d=e.getDataFromNode(this);let p;if(d.initialized===!0)t!=="void"&&(p=o);else if(s){const g=e.getVarFromNode(this,null,u),_=e.getPropertyName(g);e.addLineFlowCode(`${_} = ${c}`,this);const v=n.node,b=v.node.context({assign:!0}).build(e);for(let x=0;x<v.components.length;x++){const M=v.components[x];e.addLineFlowCode(`${b}.${M} = ${_}[ ${x} ]`,this)}t!=="void"&&(p=o)}else p=`${o} = ${c}`,(t==="void"||h==="void")&&(e.addLineFlowCode(p,this),t!=="void"&&(p=o));return d.initialized=!0,e.format(p,u,t)}}const L8=sn(D8).setParameterLength(2);ye("assign",L8);class P8 extends xi{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],n=this.functionNode,r=n.getInputs(e),s=this.parameters,o=(c,h)=>{const d=h.type,p=d==="pointer";let g;return p?g="&"+c.build(e):g=c.build(e,d),g};if(Array.isArray(s)){if(s.length>r.length)Re("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),s.length=r.length;else if(s.length<r.length)for(Re("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");s.length<r.length;)s.push(ge(0));for(let c=0;c<s.length;c++)t.push(o(s[c],r[c]))}else for(const c of r){const h=s[c.name];h!==void 0?t.push(o(h,c)):(Re(`TSL: Input '${c.name}' not found in 'Fn()'.`),t.push(o(ge(0),c)))}return`${n.build(e,"property")}( ${t.join(", ")} )`}}const U8=(i,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Qc(e):vT(e[0]),new P8(Ze(i),e));ye("call",U8);const O8={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class ei extends xi{static get type(){return"OperatorNode"}constructor(e,t,n,...r){if(super(),r.length>0){let s=new ei(e,t,n);for(let o=0;o<r.length-1;o++)s=new ei(e,s,r[o]);t=s,n=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(O8[this.op],t)}getNodeType(e,t=null){const n=this.op,r=this.aNode,s=this.bNode,o=r.getNodeType(e),u=s?s.getNodeType(e):null;if(o==="void"||u==="void")return t||"void";if(n==="%")return o;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return e.getIntegerType(o);if(n==="!"||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">="){const c=Math.max(e.getTypeLength(o),e.getTypeLength(u));return c>1?`bvec${c}`:"bool"}else{if(e.isMatrix(o)){if(u==="float")return o;if(e.isVector(u))return e.getVectorFromMatrix(o);if(e.isMatrix(u))return o}else if(e.isMatrix(u)){if(o==="float")return u;if(e.isVector(o))return e.getVectorFromMatrix(u)}return e.getTypeLength(u)>e.getTypeLength(o)?u:o}}generate(e,t){const n=this.op,{aNode:r,bNode:s}=this,o=this.getNodeType(e,t);let u=null,c=null;o!=="void"?(u=r.getNodeType(e),c=s?s.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="||n==="!="?e.isVector(u)?c=u:e.isVector(c)?u=c:u!==c&&(u=c="float"):n===">>"||n==="<<"?(u=o,c=e.changeComponentType(c,"uint")):n==="%"?(u=o,c=e.isInteger(u)&&e.isInteger(c)?c:u):e.isMatrix(u)?c==="float"?c="float":e.isVector(c)?c=e.getVectorFromMatrix(u):e.isMatrix(c)||(u=c=o):e.isMatrix(c)?u==="float"?u="float":e.isVector(u)?u=e.getVectorFromMatrix(c):u=c=o:u=c=o):u=c=o;const h=r.build(e,u),d=s?s.build(e,c):null,p=e.getFunctionOperator(n);if(t!=="void"){const g=e.renderer.coordinateSystem===gr;if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">=")return g?e.isVector(u)?e.format(`${this.getOperatorMethod(e,t)}( ${h}, ${d} )`,o,t):e.format(`( ${h} ${n} ${d} )`,o,t):e.format(`( ${h} ${n} ${d} )`,o,t);if(n==="%")return e.isInteger(c)?e.format(`( ${h} % ${d} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${h}, ${d} )`,o,t);if(n==="!"||n==="~")return e.format(`(${n}${h})`,u,t);if(p)return e.format(`${p}( ${h}, ${d} )`,o,t);if(e.isMatrix(u)&&c==="float")return e.format(`( ${d} ${n} ${h} )`,o,t);if(u==="float"&&e.isMatrix(c))return e.format(`${h} ${n} ${d}`,o,t);{let _=`( ${h} ${n} ${d} )`;return!g&&o==="bool"&&e.isVector(u)&&e.isVector(c)&&(_=`all${_}`),e.format(_,o,t)}}else if(u!=="void")return p?e.format(`${p}( ${h}, ${d} )`,o,t):e.isMatrix(u)&&c==="float"?e.format(`${d} ${n} ${h}`,o,t):e.format(`${h} ${n} ${d}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Br=et(ei,"+").setParameterLength(2,1/0).setName("add"),wr=et(ei,"-").setParameterLength(2,1/0).setName("sub"),Bt=et(ei,"*").setParameterLength(2,1/0).setName("mul"),ga=et(ei,"/").setParameterLength(2,1/0).setName("div"),TT=et(ei,"%").setParameterLength(2).setName("mod"),gD=et(ei,"==").setParameterLength(2).setName("equal"),B8=et(ei,"!=").setParameterLength(2).setName("notEqual"),F8=et(ei,"<").setParameterLength(2).setName("lessThan"),I8=et(ei,">").setParameterLength(2).setName("greaterThan"),z8=et(ei,"<=").setParameterLength(2).setName("lessThanEqual"),G8=et(ei,">=").setParameterLength(2).setName("greaterThanEqual"),k8=et(ei,"&&").setParameterLength(2,1/0).setName("and"),V8=et(ei,"||").setParameterLength(2,1/0).setName("or"),H8=et(ei,"!").setParameterLength(1).setName("not"),W8=et(ei,"^^").setParameterLength(2).setName("xor"),q8=et(ei,"&").setParameterLength(2).setName("bitAnd"),$8=et(ei,"~").setParameterLength(1).setName("bitNot"),j8=et(ei,"|").setParameterLength(2).setName("bitOr"),X8=et(ei,"^").setParameterLength(2).setName("bitXor"),Y8=et(ei,"<<").setParameterLength(2).setName("shiftLeft"),K8=et(ei,">>").setParameterLength(2).setName("shiftRight"),Q8=Te(([i])=>(i.addAssign(1),i)),Z8=Te(([i])=>(i.subAssign(1),i)),J8=Te(([i])=>{const e=In(i).toConst();return i.addAssign(1),e}),eH=Te(([i])=>{const e=In(i).toConst();return i.subAssign(1),e});ye("add",Br);ye("sub",wr);ye("mul",Bt);ye("div",ga);ye("mod",TT);ye("equal",gD);ye("notEqual",B8);ye("lessThan",F8);ye("greaterThan",I8);ye("lessThanEqual",z8);ye("greaterThanEqual",G8);ye("and",k8);ye("or",V8);ye("not",H8);ye("xor",W8);ye("bitAnd",q8);ye("bitNot",$8);ye("bitOr",j8);ye("bitXor",X8);ye("shiftLeft",Y8);ye("shiftRight",K8);ye("incrementBefore",Q8);ye("decrementBefore",Z8);ye("increment",J8);ye("decrement",eH);const tH=(i,e)=>(Ae('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),TT(In(i),In(e)));ye("modInt",tH);class oe extends xi{static get type(){return"MathNode"}constructor(e,t,n=null,r=null){if(super(),(e===oe.MAX||e===oe.MIN)&&arguments.length>3){let s=new oe(e,t,n);for(let o=2;o<arguments.length-1;o++)s=new oe(e,s,arguments[o]);t=s,n=arguments[arguments.length-1],r=null}this.method=e,this.aNode=t,this.bNode=n,this.cNode=r,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(n)?0:e.getTypeLength(n),u=e.isMatrix(r)?0:e.getTypeLength(r);return s>o&&s>u?t:o>u?n:u>s?r:t}getNodeType(e){const t=this.method;return t===oe.LENGTH||t===oe.DISTANCE||t===oe.DOT?"float":t===oe.CROSS?"vec3":t===oe.ALL||t===oe.ANY?"bool":t===oe.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:n,method:r}=this;let s=null;if(r===oe.ONE_MINUS)s=wr(1,t);else if(r===oe.RECIPROCAL)s=ga(1,t);else if(r===oe.DIFFERENCE)s=Zr(wr(t,n));else if(r===oe.TRANSFORM_DIRECTION){let o=t,u=n;e.isMatrix(o.getNodeType(e))?u=Dt(ve(u),0):o=Dt(ve(o),0);const c=Bt(o,u).xyz;s=ks(c)}return s!==null?s:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let r=this.method;const s=this.getNodeType(e),o=this.getInputType(e),u=this.aNode,c=this.bNode,h=this.cNode,d=e.renderer.coordinateSystem;if(r===oe.NEGATE)return e.format("( - "+u.build(e,o)+" )",s,t);{const p=[];return r===oe.CROSS?p.push(u.build(e,s),c.build(e,s)):d===gr&&r===oe.STEP?p.push(u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":o),c.build(e,o)):d===gr&&(r===oe.MIN||r===oe.MAX)?p.push(u.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):r===oe.REFRACT?p.push(u.build(e,o),c.build(e,o),h.build(e,"float")):r===oe.MIX?p.push(u.build(e,o),c.build(e,o),h.build(e,e.getTypeLength(h.getNodeType(e))===1?"float":o)):(d===ma&&r===oe.ATAN&&c!==null&&(r="atan2"),e.shaderStage!=="fragment"&&(r===oe.DFDX||r===oe.DFDY)&&(Ae(`TSL: '${r}' is not supported in the ${e.shaderStage} stage.`),r="/*"+r+"*/"),p.push(u.build(e,o)),c!==null&&p.push(c.build(e,o)),h!==null&&p.push(h.build(e,o))),e.format(`${e.getMethod(r,s)}( ${p.join(", ")} )`,s,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}oe.ALL="all";oe.ANY="any";oe.RADIANS="radians";oe.DEGREES="degrees";oe.EXP="exp";oe.EXP2="exp2";oe.LOG="log";oe.LOG2="log2";oe.SQRT="sqrt";oe.INVERSE_SQRT="inversesqrt";oe.FLOOR="floor";oe.CEIL="ceil";oe.NORMALIZE="normalize";oe.FRACT="fract";oe.SIN="sin";oe.COS="cos";oe.TAN="tan";oe.ASIN="asin";oe.ACOS="acos";oe.ATAN="atan";oe.ABS="abs";oe.SIGN="sign";oe.LENGTH="length";oe.NEGATE="negate";oe.ONE_MINUS="oneMinus";oe.DFDX="dFdx";oe.DFDY="dFdy";oe.ROUND="round";oe.RECIPROCAL="reciprocal";oe.TRUNC="trunc";oe.FWIDTH="fwidth";oe.TRANSPOSE="transpose";oe.DETERMINANT="determinant";oe.INVERSE="inverse";oe.EQUALS="equals";oe.MIN="min";oe.MAX="max";oe.STEP="step";oe.REFLECT="reflect";oe.DISTANCE="distance";oe.DIFFERENCE="difference";oe.DOT="dot";oe.CROSS="cross";oe.POW="pow";oe.TRANSFORM_DIRECTION="transformDirection";oe.MIX="mix";oe.CLAMP="clamp";oe.REFRACT="refract";oe.SMOOTHSTEP="smoothstep";oe.FACEFORWARD="faceforward";const _D=ge(1e-6),nH=ge(Math.PI),iH=et(oe,oe.ALL).setParameterLength(1),rH=et(oe,oe.ANY).setParameterLength(1),sH=et(oe,oe.RADIANS).setParameterLength(1),aH=et(oe,oe.DEGREES).setParameterLength(1),vD=et(oe,oe.EXP).setParameterLength(1),gp=et(oe,oe.EXP2).setParameterLength(1),yD=et(oe,oe.LOG).setParameterLength(1),ho=et(oe,oe.LOG2).setParameterLength(1),ao=et(oe,oe.SQRT).setParameterLength(1),oH=et(oe,oe.INVERSE_SQRT).setParameterLength(1),au=et(oe,oe.FLOOR).setParameterLength(1),MT=et(oe,oe.CEIL).setParameterLength(1),ks=et(oe,oe.NORMALIZE).setParameterLength(1),_a=et(oe,oe.FRACT).setParameterLength(1),Qr=et(oe,oe.SIN).setParameterLength(1),oa=et(oe,oe.COS).setParameterLength(1),lH=et(oe,oe.TAN).setParameterLength(1),uH=et(oe,oe.ASIN).setParameterLength(1),xD=et(oe,oe.ACOS).setParameterLength(1),bD=et(oe,oe.ATAN).setParameterLength(1,2),Zr=et(oe,oe.ABS).setParameterLength(1),SD=et(oe,oe.SIGN).setParameterLength(1),fo=et(oe,oe.LENGTH).setParameterLength(1),TD=et(oe,oe.NEGATE).setParameterLength(1),cH=et(oe,oe.ONE_MINUS).setParameterLength(1),MD=et(oe,oe.DFDX).setParameterLength(1),ED=et(oe,oe.DFDY).setParameterLength(1),hH=et(oe,oe.ROUND).setParameterLength(1),fH=et(oe,oe.RECIPROCAL).setParameterLength(1),dH=et(oe,oe.TRUNC).setParameterLength(1),AD=et(oe,oe.FWIDTH).setParameterLength(1),pH=et(oe,oe.TRANSPOSE).setParameterLength(1),mH=et(oe,oe.DETERMINANT).setParameterLength(1),gH=et(oe,oe.INVERSE).setParameterLength(1),_H=(i,e)=>(Ae('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),gD(i,e)),Uh=et(oe,oe.MIN).setParameterLength(2,1/0),Yi=et(oe,oe.MAX).setParameterLength(2,1/0),wD=et(oe,oe.STEP).setParameterLength(2),vH=et(oe,oe.REFLECT).setParameterLength(2),yH=et(oe,oe.DISTANCE).setParameterLength(2),xH=et(oe,oe.DIFFERENCE).setParameterLength(2),xu=et(oe,oe.DOT).setParameterLength(2),bu=et(oe,oe.CROSS).setParameterLength(2),i0=et(oe,oe.POW).setParameterLength(2),RD=i=>Bt(i,i),bH=i=>Bt(i,i,i),CD=i=>Bt(i,i,i,i),SH=et(oe,oe.TRANSFORM_DIRECTION).setParameterLength(2),TH=i=>Bt(SD(i),i0(Zr(i),1/3)),ND=i=>xu(i,i),An=et(oe,oe.MIX).setParameterLength(3),fl=(i,e=0,t=1)=>Ze(new oe(oe.CLAMP,Ze(i),Ze(e),Ze(t))),ET=i=>fl(i),DD=et(oe,oe.REFRACT).setParameterLength(3),po=et(oe,oe.SMOOTHSTEP).setParameterLength(3),MH=et(oe,oe.FACEFORWARD).setParameterLength(3),EH=Te(([i])=>{const n=43758.5453,r=xu(i.xy,nt(12.9898,78.233)),s=TT(r,nH);return _a(Qr(s).mul(n))}),AH=(i,e,t)=>An(e,t,i),wH=(i,e,t)=>po(e,t,i),RH=(i,e)=>wD(e,i),CH=(i,e)=>(Ae('TSL: "atan2" is overloaded. Use "atan" instead.'),bD(i,e));ye("all",iH);ye("any",rH);ye("equals",_H);ye("radians",sH);ye("degrees",aH);ye("exp",vD);ye("exp2",gp);ye("log",yD);ye("log2",ho);ye("sqrt",ao);ye("inverseSqrt",oH);ye("floor",au);ye("ceil",MT);ye("normalize",ks);ye("fract",_a);ye("sin",Qr);ye("cos",oa);ye("tan",lH);ye("asin",uH);ye("acos",xD);ye("atan",bD);ye("abs",Zr);ye("sign",SD);ye("length",fo);ye("lengthSq",ND);ye("negate",TD);ye("oneMinus",cH);ye("dFdx",MD);ye("dFdy",ED);ye("round",hH);ye("reciprocal",fH);ye("trunc",dH);ye("fwidth",AD);ye("atan2",CH);ye("min",Uh);ye("max",Yi);ye("step",RH);ye("reflect",vH);ye("distance",yH);ye("dot",xu);ye("cross",bu);ye("pow",i0);ye("pow2",RD);ye("pow3",bH);ye("pow4",CD);ye("transformDirection",SH);ye("mix",AH);ye("clamp",fl);ye("refract",DD);ye("smoothstep",wH);ye("faceForward",MH);ye("difference",xH);ye("saturate",ET);ye("cbrt",TH);ye("transpose",pH);ye("determinant",mH);ye("inverse",gH);ye("rand",EH);class NH extends ct{static get type(){return"ConditionalNode"}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const r=t.getNodeType(e);if(n!==null){const s=n.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(r))return s}return r}setup(e){const t=this.condNode,n=this.ifNode.isolate(),r=this.elseNode?this.elseNode.isolate():null,s=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=s,r!==null&&(e.getDataFromNode(r).parentNodeBlock=s);const o=e.context.uniformFlow,u=e.getNodeProperties(this);u.condNode=t,u.ifNode=o?n:n.context({nodeBlock:n}),u.elseNode=r?o?r:r.context({nodeBlock:r}):null}generate(e,t){const n=this.getNodeType(e),r=e.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;const{condNode:s,ifNode:o,elseNode:u}=e.getNodeProperties(this),c=e.currentFunctionNode,h=t!=="void",d=h?cl(n).build(e):"";r.nodeProperty=d;const p=s.build(e,"bool");if(e.context.uniformFlow&&u!==null){const v=o.build(e,n),T=u.build(e,n),b=e.getTernary(p,v,T);return e.format(b,n,t)}e.addFlowCode(`
${e.tab}if ( ${p} ) {

`).addFlowTab();let _=o.build(e,n);if(_&&(h?_=d+" = "+_+";":(_="return "+_+";",c===null&&(Ae("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),_="// "+_))),e.removeFlowTab().addFlowCode(e.tab+"	"+_+`

`+e.tab+"}"),u!==null){e.addFlowCode(` else {

`).addFlowTab();let v=u.build(e,n);v&&(h?v=d+" = "+v+";":(v="return "+v+";",c===null&&(Ae("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),v="// "+v))),e.removeFlowTab().addFlowCode(e.tab+"	"+v+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(d,n,t)}}const Lr=sn(NH).setParameterLength(2,3);ye("select",Lr);class LD extends ct{static get type(){return"ContextNode"}constructor(e=null,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getFlowContextData(){const e=[];return this.traverse(t=>{t.isContextNode===!0&&e.push(t.value)}),Object.assign({},...e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const n=e.addContext(this.value),r=this.node.build(e,t);return e.setContext(n),r}}const Ru=(i=null,e={})=>{let t=i;return(t===null||t.isNode!==!0)&&(e=t||e,t=null),new LD(t,e)},DH=i=>Ru(i,{uniformFlow:!0}),PD=(i,e)=>Ru(i,{nodeName:e});function LH(i,e,t=null){return Ru(t,{getShadow:({light:n,shadowColorNode:r})=>e===n?r.mul(i):r})}function PH(i,e=null){return Ru(e,{getAO:(t,{material:n})=>n.transparent===!0?t:t!==null?t.mul(i):i})}function UH(i,e){return Ae('TSL: "label()" has been deprecated. Use "setName()" instead.'),PD(i,e)}ye("context",Ru);ye("label",UH);ye("uniformFlow",DH);ye("setName",PD);ye("builtinShadowContext",(i,e,t)=>LH(e,t,i));ye("builtinAOContext",(i,e)=>PH(e,i));class f_ extends ct{static get type(){return"VarNode"}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}isIntent(e){return e.getDataFromNode(this).forceDeclaration===!0?!1:this.intent}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){return e.getDataFromNode(this).assign}build(...e){const t=e[0];if(this._hasStack(t)===!1&&t.buildStage==="setup"&&(t.context.nodeLoop||t.context.nodeBlock)){let n=!1;if(this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&t.fnCall&&t.fnCall.shaderNode&&t.getDataFromNode(this.node.shaderNode).hasLoop){const o=t.getDataFromNode(this);o.forceDeclaration=!0,n=!0}const r=t.getBaseStack();n?r.addToStackBefore(this):r.addToStack(this)}return this.isIntent(t)&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:n,readOnly:r}=this,{renderer:s}=e,o=s.backend.isWebGPUBackend===!0;let u=!1,c=!1;r&&(u=e.isDeterministic(t),c=o?r:u);const h=this.getNodeType(e);if(h=="void")return this.isIntent(e)!==!0&&Re('TSL: ".toVar()" can not be used with void type.'),t.build(e);const d=e.getVectorType(h),p=t.build(e,d),g=e.getVarFromNode(this,n,d,void 0,c),_=e.getPropertyName(g);let v=_;if(c)if(o)v=u?`const ${_}`:`let ${_}`;else{const T=t.getArrayCount(e);v=`const ${e.getVar(g.type,_,T)}`}return e.addLineFlowCode(`${v} = ${p}`,this),_}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}}const AT=sn(f_),OH=(i,e=null)=>AT(i,e).toStack(),BH=(i,e=null)=>AT(i,e,!0).toStack(),FH=i=>AT(i).setIntent(!0).toStack();ye("toVar",OH);ye("toConst",BH);ye("toVarIntent",FH);class IH extends ct{static get type(){return"SubBuild"}constructor(e,t,n=null){super(n),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const n=this.node.build(e,...t);return e.removeSubBuild(),n}}const $d=(i,e,t=null)=>Ze(new IH(Ze(i),e,t));class zH extends ct{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(n===void 0){const r=this.name,s=this.getNodeType(e),o=this.interpolationType,u=this.interpolationSampling;t.varying=n=e.getVaryingFromNode(this,r,s,o,u),t.node=$d(this.node,"VERTEX")}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(Ug.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(Ug.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),n=e.getNodeProperties(this),r=this.setupVarying(e);if(n[t]===void 0){const s=this.getNodeType(e),o=e.getPropertyName(r,Ug.VERTEX);e.flowNodeFromShaderStage(Ug.VERTEX,n.node,s,o),n[t]=o}return e.getPropertyName(r)}}const go=sn(zH).setParameterLength(1,2),GH=i=>go(i);ye("toVarying",go);ye("toVertexStage",GH);ye("varying",(...i)=>(Ae("TSL: .varying() has been renamed to .toVarying()."),go(...i)));ye("vertexStage",(...i)=>(Ae("TSL: .vertexStage() has been renamed to .toVertexStage()."),go(...i)));const kH=Te(([i])=>{const e=i.mul(.9478672986).add(.0521327014).pow(2.4),t=i.mul(.0773993808),n=i.lessThanEqual(.04045);return An(e,t,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),VH=Te(([i])=>{const e=i.pow(.41666).mul(1.055).sub(.055),t=i.mul(12.92),n=i.lessThanEqual(.0031308);return An(e,t,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),wT="WorkingColorSpace",HH="OutputColorSpace";class UD extends xi{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===wT?vt.workingColorSpace:t===HH?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let s=t;return vt.enabled===!1||n===r||!n||!r||(vt.getTransfer(n)===Ye&&(s=Dt(kH(s.rgb),s.a)),vt.getPrimaries(n)!==vt.getPrimaries(r)&&(s=Dt(or(vt._getMatrix(new Ct,n,r)).mul(s.rgb),s.a)),vt.getTransfer(r)===Ye&&(s=Dt(VH(s.rgb),s.a))),s}}const WH=(i,e)=>Ze(new UD(Ze(i),wT,e)),RT=(i,e)=>Ze(new UD(Ze(i),e,wT));ye("workingToColorSpace",WH);ye("colorSpaceToWorking",RT);let qH=class extends Xh{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}};class OD extends ct{static get type(){return"ReferenceBaseNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=Ot.OBJECT}setGroup(e){return this.group=e,this}element(e){return new qH(this,Ze(e))}setNodeType(e){const t=bt(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const $H=(i,e,t)=>new OD(i,e,t);class jH extends OD{static get type(){return"RendererReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(yt)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const XH=(i,e,t=null)=>new jH(i,e,t);class YH extends xi{static get type(){return"ToneMappingNode"}constructor(e,t=QH,n=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return Vd(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,n=this._toneMapping;if(n===$i)return t;let r=null;const s=e.renderer.library.getToneMappingFunction(n);return s!==null?r=Dt(s(t.rgb,this.exposureNode),t.a):(Re("ToneMappingNode: Unsupported Tone Mapping configuration.",n),r=t),r}}const KH=(i,e,t)=>Ze(new YH(i,Ze(e),Ze(t))),QH=XH("toneMappingExposure","float");ye("toneMapping",(i,e,t)=>KH(e,t,i));const kR=new WeakMap;function VR(i,e){let t=kR.get(i);return t===void 0&&(t=new QS(i,e),kR.set(i,t)),t}class Ko extends pT{static get type(){return"BufferAttributeNode"}constructor(e,t=null,n=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=r,this.usage=Nh,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&e.itemSize<=4&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),n=e.getTypeLength(t),r=this.value,s=this.bufferStride||n,o=this.bufferOffset;let u;r.isInterleavedBuffer===!0?u=r:r.isBufferAttribute===!0?u=VR(r.array,s):u=VR(r,s);const c=new pp(u,n,o);u.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(n);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=r,s=r):s=go(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}function CT(i,e=null,t=0,n=0,r=Nh,s=!1){return e==="mat3"||e===null&&i.itemSize===9?or(new Ko(i,"vec3",9,0).setUsage(r).setInstanced(s),new Ko(i,"vec3",9,3).setUsage(r).setInstanced(s),new Ko(i,"vec3",9,6).setUsage(r).setInstanced(s)):e==="mat4"||e===null&&i.itemSize===16?su(new Ko(i,"vec4",16,0).setUsage(r).setInstanced(s),new Ko(i,"vec4",16,4).setUsage(r).setInstanced(s),new Ko(i,"vec4",16,8).setUsage(r).setInstanced(s),new Ko(i,"vec4",16,12).setUsage(r).setInstanced(s)):new Ko(i,e,t,n)}const BD=(i,e=null,t=0,n=0)=>CT(i,e,t,n),HR=(i,e=null,t=0,n=0)=>CT(i,e,t,n,Nh,!0),WR=(i,e=null,t=0,n=0)=>CT(i,e,t,n,Vc,!0);ye("toAttribute",i=>BD(i.value));class ZH extends ct{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=Ot.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return Ae('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const n=e.getNodeProperties(this);n.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:n}=e;if(n==="compute"){const r=this.computeNode.build(e,"void");r!==""&&e.addLineFlowCode(r,this)}else{const s=e.getNodeProperties(this).outputComputeNode;if(s)return s.build(e,t)}}}const FD=(i,e=[64])=>{(e.length===0||e.length>3)&&Re("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let t=0;t<e.length;t++){const n=e[t];(typeof n!="number"||n<=0||!Number.isInteger(n))&&Re(`TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`)}for(;e.length<3;)e.push(1);return Ze(new ZH(Ze(i),e))},JH=(i,e,t)=>FD(i,t).setCount(e);ye("compute",JH);ye("computeKernel",FD);class e9 extends ct{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){const n=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const s=this.node.build(e,...t);return e.setCache(n),s}setParent(e){return this.parent=e,this}getParent(){return this.parent}}const jd=i=>new e9(Ze(i));function t9(i,e=!0){return Ae('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),jd(i).setParent(e)}ye("cache",t9);ye("isolate",jd);class n9 extends ct{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const i9=sn(n9).setParameterLength(2);ye("bypass",i9);class ID extends ct{static get type(){return"RemapNode"}constructor(e,t,n,r=ge(0),s=ge(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=r,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:r,outHighNode:s,doClamp:o}=this;let u=e.sub(t).div(n.sub(t));return o===!0&&(u=u.clamp()),u.mul(s.sub(r)).add(r)}}const r9=sn(ID,null,null,{doClamp:!1}).setParameterLength(3,5),s9=sn(ID).setParameterLength(3,5);ye("remap",r9);ye("remapClamp",s9);class d_ extends ct{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const n=this.getNodeType(e),r=this.snippet;if(n==="void")e.addLineFlowCode(r,this);else return e.format(r,n,t)}}const Oh=sn(d_).setParameterLength(1,2),a9=i=>(i?Lr(i,Oh("discard")):Oh("discard")).toStack();ye("discard",a9);class o9 extends xi{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const n=(this._toneMapping!==null?this._toneMapping:e.toneMapping)||$i,r=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Rr;return n!==$i&&(t=t.toneMapping(n)),r!==Rr&&r!==vt.workingColorSpace&&(t=t.workingToColorSpace(r)),t}}const l9=(i,e=null,t=null)=>Ze(new o9(Ze(i),e,t));ye("renderOutput",l9);class u9 extends xi{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,n=this.node.build(e),r="--- TSL debug - "+e.shaderStage+" shader ---",s="-".repeat(r.length);let o="";return o+="// #"+r+`#
`,o+=e.flow.code.replace(/^\t/mg,"")+`
`,o+="/* ... */ "+n+` /* ... */
`,o+="// #"+s+`#
`,t!==null?t(e,o):dp(o),n}}const c9=(i,e=null)=>Ze(new u9(Ze(i),e)).toStack();ye("debug",c9);class zD{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class h9 extends ct{static get type(){return"InspectorNode"}constructor(e,t="",n=null){super(),this.node=e,this.name=t,this.callback=n,this.updateType=Ot.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==zD&&Vn('TSL: ".toInspector()" is only available with WebGPU.'),t}}function f9(i,e="",t=null){return i=Ze(i),i.before(new h9(i,e,t))}ye("toInspector",f9);class GD extends ct{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const r=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(s),u=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(u.name,o,n):go(this).build(e,n)}else return Ae(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const dl=(i,e=null)=>new GD(i,e),Yh=(i=0)=>dl("uv"+(i>0?i:""),"vec2");class d9 extends ct{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),r=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${r} )`,this.getNodeType(e),t)}}const ou=sn(d9).setParameterLength(1,2);class p9 extends Op{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Ot.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&n.width!==void 0){const{width:r,height:s}=n;this.value=Math.log2(Math.max(r,s))}}}const m9=sn(p9).setParameterLength(1),kD=new ui;class Kh extends Op{static get type(){return"TextureNode"}constructor(e=kD,t=null,n=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Ot.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===yn?"uvec4":this.value.type===Ni?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Yh(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=bt(this.value.matrix)),this._matrixUniform.mul(ve(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=bt(!1)),t=t.toVar(),this.sampler?t=this._flipYUniform.select(t.flipY(),t):t=this._flipYUniform.select(t.setY(In(ou(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");const r=Te(()=>{let o=this.uvNode;return(o===null||e.context.forceUVContext===!0)&&e.context.getUV&&(o=e.context.getUV(this,e)),o||(o=this.getDefaultUV()),this.updateMatrix===!0&&(o=this.getTransformedUV(o)),o=this.setupUV(e,o),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?Ot.OBJECT:Ot.NONE,o})();let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=r,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,n,r,s,o,u,c,h){const d=this.value;let p;return s?p=e.generateTextureBias(d,t,n,s,o,h):c?p=e.generateTextureGrad(d,t,n,c,o,h):u?p=e.generateTextureCompare(d,t,n,u,o,h):this.sampler===!1?p=e.generateTextureLoad(d,t,n,r,o,h):r?p=e.generateTextureLevel(d,t,n,r,o,h):p=e.generateTexture(d,t,n,o,h),p}generate(e,t){const n=this.value,r=e.getNodeProperties(this),s=super.generate(e,"property");if(/^sampler/.test(t))return s+"_sampler";if(e.isReference(t))return s;{const o=e.getDataFromNode(this);let u=o.propertyName;if(u===void 0){const{uvNode:d,levelNode:p,biasNode:g,compareNode:_,depthNode:v,gradNode:T,offsetNode:b}=r,x=this.generateUV(e,d),M=p?p.build(e,"float"):null,E=g?g.build(e,"float"):null,w=v?v.build(e,"int"):null,C=_?_.build(e,"float"):null,N=T?[T[0].build(e,"vec2"),T[1].build(e,"vec2")]:null,D=b?this.generateOffset(e,b):null,U=e.getVarFromNode(this);u=e.getPropertyName(U);const R=this.generateSnippet(e,s,x,M,E,w,C,N,D);e.addLineFlowCode(`${u} = ${R}`,this),o.snippet=R,o.propertyName=u}let c=u;const h=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(c=RT(Oh(c,h),n.colorSpace).setup(e).build(e,h)),e.format(c,h,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return Ae("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=Ze(e),t.referenceNode=this.getBase(),Ze(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=Ze(e).mul(m9(t)),t.referenceNode=this.getBase();const n=t.value;return t.generateMipmaps===!1&&(n&&n.generateMipmaps===!1||n.minFilter===xn||n.magFilter===xn)&&(Ae("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),Ze(t)}level(e){const t=this.clone();return t.levelNode=Ze(e),t.referenceNode=this.getBase(),Ze(t)}size(e){return ou(this,e)}bias(e){const t=this.clone();return t.biasNode=Ze(e),t.referenceNode=this.getBase(),Ze(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=Ze(e),t.referenceNode=this.getBase(),Ze(t)}grad(e,t){const n=this.clone();return n.gradNode=[Ze(e),Ze(t)],n.referenceNode=this.getBase(),Ze(n)}depth(e){const t=this.clone();return t.depthNode=Ze(e),t.referenceNode=this.getBase(),Ze(t)}offset(e){const t=this.clone();return t.offsetNode=Ze(e),t.referenceNode=this.getBase(),Ze(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();const n=this._flipYUniform;n!==null&&(n.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}const g9=sn(Kh).setParameterLength(1,4).setName("texture"),zn=(i=kD,e=null,t=null,n=null)=>{let r;return i&&i.isTextureNode===!0?(r=Ze(i.clone()),r.referenceNode=i.getBase(),e!==null&&(r.uvNode=Ze(e)),t!==null&&(r.levelNode=Ze(t)),n!==null&&(r.biasNode=Ze(n))):r=g9(i,e,t,n),r},ms=(...i)=>zn(...i).setSampler(!1);class NT extends Op{static get type(){return"BufferNode"}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n,this.updateRanges=[]}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const VD=(i,e,t)=>new NT(i,e,t);class _9 extends Xh{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,n)}}class v9 extends NT{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?A_(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Ot.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let r=0;r<e.length;r++){const s=r*4;t[s]=e[r]}else if(n==="color")for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.r,t[s+1]=o.g,t[s+2]=o.b||0}else if(n==="mat2")for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+3]=o.elements[3]}else if(n==="mat3")for(let r=0;r<e.length;r++){const s=r*16,o=e[r];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+4]=o.elements[3],t[s+5]=o.elements[4],t[s+6]=o.elements[5],t[s+8]=o.elements[6],t[s+9]=o.elements[7],t[s+10]=o.elements[8],t[s+15]=1}else if(n==="mat4")for(let r=0;r<e.length;r++){const s=r*16,o=e[r];for(let u=0;u<o.elements.length;u++)t[s+u]=o.elements[u]}else for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.x,t[s+1]=o.y,t[s+2]=o.z||0,t[s+3]=o.w||0}}setup(e){const t=this.array.length,n=this.elementType;let r=Float32Array;const s=this.paddedType,o=e.getTypeLength(s);return n.charAt(0)==="i"&&(r=Int32Array),n.charAt(0)==="u"&&(r=Uint32Array),this.value=new r(t*o),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return new _9(this,Ze(e))}}const Fs=(i,e)=>new v9(i,e);class y9 extends ct{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const Bp=sn(y9).setParameterLength(1);let fd,dd;class On extends ct{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===On.DPR?"float":this.scope===On.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Ot.NONE;return(this.scope===On.SIZE||this.scope===On.VIEWPORT||this.scope===On.DPR)&&(e=Ot.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===On.VIEWPORT?t!==null?dd.copy(t.viewport):(e.getViewport(dd),dd.multiplyScalar(e.getPixelRatio())):this.scope===On.DPR?this._output.value=e.getPixelRatio():t!==null?(fd.width=t.width,fd.height=t.height):e.getDrawingBufferSize(fd)}setup(){const e=this.scope;let t=null;return e===On.SIZE?t=bt(fd||(fd=new Ue)):e===On.VIEWPORT?t=bt(dd||(dd=new Lt)):e===On.DPR?t=bt(1):t=nt(Qh.div($b)),this._output=t,t}generate(e){if(this.scope===On.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties($b).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}}On.COORDINATE="coordinate";On.VIEWPORT="viewport";On.SIZE="size";On.UV="uv";On.DPR="dpr";const x9=Ge(On,On.DPR),Jc=Ge(On,On.UV),$b=Ge(On,On.SIZE),Qh=Ge(On,On.COORDINATE),HD=Ge(On,On.VIEWPORT),b9=HD.zw;HD.xy;const DT=bt(0,"uint").setName("u_cameraIndex").setGroup(ST("cameraIndex")).toVarying("v_cameraIndex"),Ql=bt("float").setName("cameraNear").setGroup(yt).onRenderUpdate(({camera:i})=>i.near),Zl=bt("float").setName("cameraFar").setGroup(yt).onRenderUpdate(({camera:i})=>i.far),Xd=Te(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const r of i.cameras)t.push(r.projectionMatrix);e=Fs(t).setGroup(yt).setName("cameraProjectionMatrices").element(i.isMultiViewCamera?Bp("gl_ViewID_OVR"):DT).toConst("cameraProjectionMatrix")}else e=bt("mat4").setName("cameraProjectionMatrix").setGroup(yt).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),_o=Te(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const r of i.cameras)t.push(r.matrixWorldInverse);e=Fs(t).setGroup(yt).setName("cameraViewMatrices").element(i.isMultiViewCamera?Bp("gl_ViewID_OVR"):DT).toConst("cameraViewMatrix")}else e=bt("mat4").setName("cameraViewMatrix").setGroup(yt).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),S9=Te(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(let r=0,s=i.cameras.length;r<s;r++)t.push(new k);e=Fs(t).setGroup(yt).setName("cameraPositions").onRenderUpdate(({camera:r},s)=>{const o=r.cameras,u=s.array;for(let c=0,h=o.length;c<h;c++)u[c].setFromMatrixPosition(o[c].matrixWorld)}).element(i.isMultiViewCamera?Bp("gl_ViewID_OVR"):DT).toConst("cameraPosition")}else e=bt(new k).setName("cameraPosition").setGroup(yt).onRenderUpdate(({camera:t},n)=>n.value.setFromMatrixPosition(t.matrixWorld));return e}).once()(),qR=new Rp;class Dn extends ct{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Ot.OBJECT,this.uniformNode=new Op(null)}getNodeType(){const e=this.scope;if(e===Dn.WORLD_MATRIX)return"mat4";if(e===Dn.POSITION||e===Dn.VIEW_POSITION||e===Dn.DIRECTION||e===Dn.SCALE)return"vec3";if(e===Dn.RADIUS)return"float"}update(e){const t=this.object3d,n=this.uniformNode,r=this.scope;if(r===Dn.WORLD_MATRIX)n.value=t.matrixWorld;else if(r===Dn.POSITION)n.value=n.value||new k,n.value.setFromMatrixPosition(t.matrixWorld);else if(r===Dn.SCALE)n.value=n.value||new k,n.value.setFromMatrixScale(t.matrixWorld);else if(r===Dn.DIRECTION)n.value=n.value||new k,t.getWorldDirection(n.value);else if(r===Dn.VIEW_POSITION){const s=e.camera;n.value=n.value||new k,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(s.matrixWorldInverse)}else if(r===Dn.RADIUS){const s=e.object.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),qR.copy(s.boundingSphere).applyMatrix4(t.matrixWorld),n.value=qR.radius}}generate(e){const t=this.scope;return t===Dn.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===Dn.POSITION||t===Dn.VIEW_POSITION||t===Dn.DIRECTION||t===Dn.SCALE?this.uniformNode.nodeType="vec3":t===Dn.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Dn.WORLD_MATRIX="worldMatrix";Dn.POSITION="position";Dn.SCALE="scale";Dn.VIEW_POSITION="viewPosition";Dn.DIRECTION="direction";Dn.RADIUS="radius";const T9=sn(Dn,Dn.POSITION).setParameterLength(1);class Ss extends Dn{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}Ss.DIRECTION;const Su=Ge(Ss,Ss.WORLD_MATRIX);Ss.POSITION;Ss.SCALE;Ss.VIEW_POSITION;Ss.RADIUS;const M9=bt(new Ct).onObjectUpdate(({object:i},e)=>e.value.getNormalMatrix(i.matrixWorld)),Fp=Te(i=>i.context.modelViewMatrix||E9).once()().toVar("modelViewMatrix"),E9=_o.mul(Su),$R=Te(i=>(i.context.isHighPrecisionModelViewMatrix=!0,bt("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),jR=Te(i=>{const e=i.context.isHighPrecisionModelViewMatrix;return bt("mat3").onObjectUpdate(({object:t,camera:n})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),r0=dl("position","vec3"),Li=r0.toVarying("positionLocal"),XR=r0.toVarying("positionPrevious"),Bh=Te(i=>Su.mul(Li).xyz.toVarying(i.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),WD=Te(()=>Li.transformDirection(Su).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),li=Te(i=>i.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),Bn=Te(i=>{let e;return i.camera.isOrthographicCamera?e=ve(0,0,1):e=li.negate().toVarying("v_positionViewDirection").normalize(),e.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class A9 extends ct{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===Pn?"false":e.getFrontFacing()}}const w9=Ge(A9),qD=ge(w9).mul(2).sub(1),Ip=Te(([i],{material:e})=>{const t=e.side;return t===Pn?i=i.mul(-1):t===rr&&(i=i.mul(qD)),i}),$D=dl("normal","vec3"),va=Te(i=>i.geometry.hasAttribute("normal")===!1?(Ae('TSL: Vertex attribute "normal" not found on geometry.'),ve(0,1,0)):$D,"vec3").once()().toVar("normalLocal"),R9=li.dFdx().cross(li.dFdy()).normalize().toVar("normalFlat"),_p=Te(i=>{let e;return i.material.flatShading===!0?e=R9:e=jD(va).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),C9=Te(i=>{let e=_p.transformDirection(_o);return i.material.flatShading!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),Jt=Te(({subBuildFn:i,material:e,context:t})=>{let n;return i==="NORMAL"||i==="VERTEX"?(n=_p,e.flatShading!==!0&&(n=Ip(n))):n=t.setupNormal().context({getUV:null}),n},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),Zh=Jt.transformDirection(_o).toVar("normalWorld"),qc=Te(({subBuildFn:i,context:e})=>{let t;return i==="NORMAL"||i==="VERTEX"?t=Jt:t=e.setupClearcoatNormal().context({getUV:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),N9=Te(([i,e=Su])=>{const t=or(e),n=i.div(ve(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(n).xyz}),jD=Te(([i],e)=>{const t=e.context.modelNormalViewMatrix;if(t)return t.transformDirection(i);const n=M9.mul(i);return _o.transformDirection(n)});Te(()=>(Ae('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),Jt)).once(["NORMAL","VERTEX"])();Te(()=>(Ae('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),Zh)).once(["NORMAL","VERTEX"])();Te(()=>(Ae('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),qc)).once(["NORMAL","VERTEX"])();const YR=new Or,wx=new Ht,D9=bt(0).onReference(({material:i})=>i).onObjectUpdate(({material:i})=>i.refractionRatio),Rx=bt(1).onReference(({material:i})=>i).onObjectUpdate(function({material:i,scene:e}){return i.envMap?i.envMapIntensity:e.environmentIntensity}),XD=bt(new Ht).onReference(function(i){return i.material}).onObjectUpdate(function({material:i,scene:e}){const t=e.environment!==null&&i.envMap===null?e.environmentRotation:i.envMapRotation;return t?(YR.copy(t),wx.makeRotationFromEuler(YR)):wx.identity(),wx}),L9=Bn.negate().reflect(Jt),P9=Bn.negate().refract(Jt,D9),U9=L9.transformDirection(_o).toVar("reflectVector"),O9=P9.transformDirection(_o).toVar("reflectVector"),B9=new Cp;class F9 extends Kh{static get type(){return"CubeTextureNode"}constructor(e,t=null,n=null,r=null){super(e,t,n,r),this.isCubeTextureNode=!0}getInputType(){return this.value.isDepthTexture===!0?"cubeDepthTexture":"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===Vs?U9:e.mapping===pa?O9:(Re('CubeTextureNode: Mapping "%s" not supported.',e.mapping),ve(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return n.isDepthTexture===!0?e.renderer.coordinateSystem===ma?ve(t.x,t.y.negate(),t.z):t:((e.renderer.coordinateSystem===ma||!n.isRenderTargetTexture)&&(t=ve(t.x.negate(),t.yz)),XD.mul(t))}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}}const I9=sn(F9).setParameterLength(1,4).setName("cubeTexture"),Cr=(i=B9,e=null,t=null,n=null)=>{let r;return i&&i.isCubeTextureNode===!0?(r=Ze(i.clone()),r.referenceNode=i,e!==null&&(r.uvNode=Ze(e)),t!==null&&(r.levelNode=Ze(t)),n!==null&&(r.biasNode=Ze(n))):r=I9(i,e,t,n),r};class z9 extends Xh{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}}class LT extends ct{static get type(){return"ReferenceNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=Ot.OBJECT}element(e){return new z9(this,Ze(e))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return Ae('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=VD(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Fs(null,e):e==="texture"?t=zn(null):e==="cubeTexture"?t=Cr(null):t=bt(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const En=(i,e,t)=>new LT(i,e,t),KR=(i,e,t,n)=>new LT(i,e,n,t);class G9 extends LT{static get type(){return"MaterialReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const el=(i,e,t=null)=>new G9(i,e,t),YD=Yh(),k9=li.dFdx(),V9=li.dFdy(),KD=YD.dFdx(),QD=YD.dFdy(),ZD=Jt,JD=V9.cross(ZD),e3=ZD.cross(k9),jb=JD.mul(KD.x).add(e3.mul(QD.x)),Xb=JD.mul(KD.y).add(e3.mul(QD.y)),QR=jb.dot(jb).max(Xb.dot(Xb)),t3=QR.equal(0).select(0,QR.inverseSqrt()),H9=jb.mul(t3).toVar("tangentViewFrame"),W9=Xb.mul(t3).toVar("bitangentViewFrame"),n3=dl("tangent","vec4"),PT=n3.xyz.toVar("tangentLocal"),i3=Te(({subBuildFn:i,geometry:e,material:t})=>{let n;return i==="VERTEX"||e.hasAttribute("tangent")?n=Fp.mul(Dt(PT,0)).xyz.toVarying("v_tangentView").normalize():n=H9,t.flatShading!==!0&&(n=Ip(n)),n},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),q9=Te(([i,e],{subBuildFn:t,material:n})=>{let r=i.mul(n3.w).xyz;return t==="NORMAL"&&n.flatShading!==!0&&(r=r.toVarying(e)),r}).once(["NORMAL"]),$9=Te(({subBuildFn:i,geometry:e,material:t})=>{let n;return i==="VERTEX"||e.hasAttribute("tangent")?n=q9(Jt.cross(i3),"v_bitangentView").normalize():n=W9,t.flatShading!==!0&&(n=Ip(n)),n},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),Pd=or(i3,$9,Jt).toVar("TBNViewMatrix"),j9=Te(()=>{let i=Zc.cross(Bn);return i=i.cross(Zc).normalize(),i=An(i,Jt,jl.mul(to.oneMinus()).oneMinus().pow2().pow2()).normalize(),i}).once()(),X9=i=>Ze(i).mul(.5).add(.5),ZR=i=>ve(i,ao(ET(ge(1).sub(xu(i,i)))));class Y9 extends xi{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=da,this.unpackNormalMode=wy}setup({material:e}){const{normalMapType:t,scaleNode:n,unpackNormalMode:r}=this;let s=this.node.mul(2).sub(1);if(t===da?r===qN?s=ZR(s.xy):r===NO?s=ZR(s.yw):r!==wy&&console.error(`THREE.NodeMaterial: Unexpected unpack normal mode: ${r}`):r!==wy&&console.error(`THREE.NodeMaterial: Normal map type '${t}' is not compatible with unpack normal mode '${r}'`),n!==null){let u=n;e.flatShading===!0&&(u=Ip(u)),s=ve(s.xy.mul(u),s.z)}let o=null;return t===WN?o=jD(s):t===da?o=Pd.mul(s).normalize():(Re(`NodeMaterial: Unsupported normal map type: ${t}`),o=Jt),o}}const JR=sn(Y9).setParameterLength(1,2),K9=Te(({textureNode:i,bumpScale:e})=>{const t=r=>i.isolate().context({getUV:s=>r(s.uvNode||Yh()),forceUVContext:!0}),n=ge(t(r=>r));return nt(ge(t(r=>r.add(r.dFdx()))).sub(n),ge(t(r=>r.add(r.dFdy()))).sub(n)).mul(e)}),Q9=Te(i=>{const{surf_pos:e,surf_norm:t,dHdxy:n}=i,r=e.dFdx().normalize(),s=e.dFdy().normalize(),o=t,u=s.cross(o),c=o.cross(r),h=r.dot(u).mul(qD),d=h.sign().mul(n.x.mul(u).add(n.y.mul(c)));return h.abs().mul(t).sub(d).normalize()});class Z9 extends xi{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=K9({textureNode:this.textureNode,bumpScale:e});return Q9({surf_pos:li,surf_norm:Jt,dHdxy:t})}}const J9=sn(Z9).setParameterLength(1,2),eC=new Map;class be extends ct{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=eC.get(e);return n===void 0&&(n=el(e,t),eC.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let r=null;if(n===be.COLOR){const s=t.color!==void 0?this.getColor(n):ve();t.map&&t.map.isTexture===!0?r=s.mul(this.getTexture("map")):r=s}else if(n===be.OPACITY){const s=this.getFloat(n);t.alphaMap&&t.alphaMap.isTexture===!0?r=s.mul(this.getTexture("alpha")):r=s}else if(n===be.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?r=this.getTexture("specular").r:r=ge(1);else if(n===be.SPECULAR_INTENSITY){const s=this.getFloat(n);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?r=s.mul(this.getTexture(n).a):r=s}else if(n===be.SPECULAR_COLOR){const s=this.getColor(n);t.specularColorMap&&t.specularColorMap.isTexture===!0?r=s.mul(this.getTexture(n).rgb):r=s}else if(n===be.ROUGHNESS){const s=this.getFloat(n);t.roughnessMap&&t.roughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).g):r=s}else if(n===be.METALNESS){const s=this.getFloat(n);t.metalnessMap&&t.metalnessMap.isTexture===!0?r=s.mul(this.getTexture(n).b):r=s}else if(n===be.EMISSIVE){const s=this.getFloat("emissiveIntensity"),o=this.getColor(n).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?r=o.mul(this.getTexture(n)):r=o}else if(n===be.NORMAL)t.normalMap?(r=JR(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType,(t.normalMap.format==mr||t.normalMap.format==pu||t.normalMap.format==du)&&(r.unpackNormalMode=qN)):t.bumpMap?r=J9(this.getTexture("bump").r,this.getFloat("bumpScale")):r=Jt;else if(n===be.CLEARCOAT){const s=this.getFloat(n);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?r=s.mul(this.getTexture(n).r):r=s}else if(n===be.CLEARCOAT_ROUGHNESS){const s=this.getFloat(n);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).r):r=s}else if(n===be.CLEARCOAT_NORMAL)t.clearcoatNormalMap?r=JR(this.getTexture(n),this.getCache(n+"Scale","vec2")):r=Jt;else if(n===be.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?r=s.mul(this.getTexture("sheenColor").rgb):r=s}else if(n===be.SHEEN_ROUGHNESS){const s=this.getFloat(n);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).a):r=s,r=r.clamp(1e-4,1)}else if(n===be.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(n);r=xT(pd.x,pd.y,pd.y.negate(),pd.x).mul(s.rg.mul(2).sub(nt(1)).normalize().mul(s.b))}else r=pd;else if(n===be.IRIDESCENCE_THICKNESS){const s=En("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=En("0","float",t.iridescenceThicknessRange);r=s.sub(o).mul(this.getTexture(n).g).add(o)}else r=s}else if(n===be.TRANSMISSION){const s=this.getFloat(n);t.transmissionMap?r=s.mul(this.getTexture(n).r):r=s}else if(n===be.THICKNESS){const s=this.getFloat(n);t.thicknessMap?r=s.mul(this.getTexture(n).g):r=s}else if(n===be.IOR)r=this.getFloat(n);else if(n===be.LIGHT_MAP)r=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===be.AO)r=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(n===be.LINE_DASH_OFFSET)r=t.dashOffset?this.getFloat(n):ge(0);else{const s=this.getNodeType(e);r=this.getCache(n,s)}return r}}be.ALPHA_TEST="alphaTest";be.COLOR="color";be.OPACITY="opacity";be.SHININESS="shininess";be.SPECULAR="specular";be.SPECULAR_STRENGTH="specularStrength";be.SPECULAR_INTENSITY="specularIntensity";be.SPECULAR_COLOR="specularColor";be.REFLECTIVITY="reflectivity";be.ROUGHNESS="roughness";be.METALNESS="metalness";be.NORMAL="normal";be.CLEARCOAT="clearcoat";be.CLEARCOAT_ROUGHNESS="clearcoatRoughness";be.CLEARCOAT_NORMAL="clearcoatNormal";be.EMISSIVE="emissive";be.ROTATION="rotation";be.SHEEN="sheen";be.SHEEN_ROUGHNESS="sheenRoughness";be.ANISOTROPY="anisotropy";be.IRIDESCENCE="iridescence";be.IRIDESCENCE_IOR="iridescenceIOR";be.IRIDESCENCE_THICKNESS="iridescenceThickness";be.IOR="ior";be.TRANSMISSION="transmission";be.THICKNESS="thickness";be.ATTENUATION_DISTANCE="attenuationDistance";be.ATTENUATION_COLOR="attenuationColor";be.LINE_SCALE="scale";be.LINE_DASH_SIZE="dashSize";be.LINE_GAP_SIZE="gapSize";be.LINE_WIDTH="linewidth";be.LINE_DASH_OFFSET="dashOffset";be.POINT_SIZE="size";be.DISPERSION="dispersion";be.LIGHT_MAP="light";be.AO="ao";const eW=Ge(be,be.ALPHA_TEST),tW=Ge(be,be.COLOR),nW=Ge(be,be.SHININESS),iW=Ge(be,be.EMISSIVE),r3=Ge(be,be.OPACITY),rW=Ge(be,be.SPECULAR),tC=Ge(be,be.SPECULAR_INTENSITY),sW=Ge(be,be.SPECULAR_COLOR),p_=Ge(be,be.SPECULAR_STRENGTH),Cx=Ge(be,be.REFLECTIVITY),aW=Ge(be,be.ROUGHNESS),oW=Ge(be,be.METALNESS),lW=Ge(be,be.NORMAL),uW=Ge(be,be.CLEARCOAT),cW=Ge(be,be.CLEARCOAT_ROUGHNESS),hW=Ge(be,be.CLEARCOAT_NORMAL),fW=Ge(be,be.ROTATION),dW=Ge(be,be.SHEEN),pW=Ge(be,be.SHEEN_ROUGHNESS),mW=Ge(be,be.ANISOTROPY),gW=Ge(be,be.IRIDESCENCE),_W=Ge(be,be.IRIDESCENCE_IOR),vW=Ge(be,be.IRIDESCENCE_THICKNESS),yW=Ge(be,be.TRANSMISSION),xW=Ge(be,be.THICKNESS),bW=Ge(be,be.IOR),SW=Ge(be,be.ATTENUATION_DISTANCE),TW=Ge(be,be.ATTENUATION_COLOR),MW=Ge(be,be.LINE_SCALE),EW=Ge(be,be.LINE_DASH_SIZE),AW=Ge(be,be.LINE_GAP_SIZE);be.LINE_WIDTH;const wW=Ge(be,be.LINE_DASH_OFFSET),RW=Ge(be,be.POINT_SIZE),CW=Ge(be,be.DISPERSION),s3=Ge(be,be.LIGHT_MAP),NW=Ge(be,be.AO),pd=bt(new Ue).onReference(function(i){return i.material}).onRenderUpdate(function({material:i}){this.value.set(i.anisotropy*Math.cos(i.anisotropyRotation),i.anisotropy*Math.sin(i.anisotropyRotation))}),DW=Te(i=>i.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class LW extends Xh{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const n=this.storageBufferNode.structTypeNode;return n?n.getMemberType(e,t):"void"}setup(e){return e.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let n;const r=e.context.assign;if(e.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&r!==!0&&(this.node.value.isInstancedBufferAttribute||e.shaderStage!=="compute")?n=e.generatePBO(this):n=this.node.build(e):n=super.generate(e),r!==!0){const s=this.getNodeType(e);n=e.format(n,s,t)}return n}}const PW=sn(LW).setParameterLength(2);class UW extends NT{static get type(){return"StorageBufferNode"}constructor(e,t=null,n=0){let r,s=null;t&&t.isStruct?(r="struct",s=t.layout,(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(n=e.count)):t===null&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(r=Z2(e.itemSize),n=e.count):r=t,super(e,r,n),this.isStorageBufferNode=!0,this.structTypeNode=s,this.access=vs.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return PW(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(vs.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=BD(this.value),this._varying=go(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}getMemberType(e,t){return this.structTypeNode!==null?this.structTypeNode.getMemberType(e,t):"void"}generate(e){if(this.structTypeNode!==null&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:n}=this.getAttributeData(),r=n.build(e);return e.registerTransform(r,t),r}}const nC=(i,e=null,t=0)=>new UW(i,e,t);class $n extends ct{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let r;if(n===$n.VERTEX)r=e.getVertexIndex();else if(n===$n.INSTANCE)r=e.getInstanceIndex();else if(n===$n.DRAW)r=e.getDrawIndex();else if(n===$n.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(n===$n.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else if(n===$n.SUBGROUP)r=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=r:s=go(this).build(e,t),s}}$n.VERTEX="vertex";$n.INSTANCE="instance";$n.SUBGROUP="subgroup";$n.INVOCATION_LOCAL="invocationLocal";$n.INVOCATION_SUBGROUP="invocationSubgroup";$n.DRAW="draw";const OW=Ge($n,$n.VERTEX),Yd=Ge($n,$n.INSTANCE);$n.SUBGROUP;$n.INVOCATION_SUBGROUP;$n.INVOCATION_LOCAL;const BW=Ge($n,$n.DRAW);class FW extends ct{static get type(){return"InstanceNode"}constructor(e,t,n=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Ot.FRAME,this.buffer=null,this.bufferColor=null}get isStorageMatrix(){const{instanceMatrix:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}get isStorageColor(){const{instanceColor:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}setup(e){const{instanceMatrix:t,instanceColor:n,isStorageMatrix:r,isStorageColor:s}=this,{count:o}=t;let{instanceMatrixNode:u,instanceColorNode:c}=this;if(u===null){if(r)u=nC(t,"mat4",Math.max(o,1)).element(Yd);else if(o<=1e3)u=VD(t.array,"mat4",Math.max(o,1)).element(Yd);else{const d=new xF(t.array,16,1);this.buffer=d;const p=t.usage===Vc?WR:HR,g=[p(d,"vec4",16,0),p(d,"vec4",16,4),p(d,"vec4",16,8),p(d,"vec4",16,12)];u=su(...g)}this.instanceMatrixNode=u}if(n&&c===null){if(s)c=nC(n,"vec3",Math.max(n.count,1)).element(Yd);else{const d=new NB(n.array,3),p=n.usage===Vc?WR:HR;this.bufferColor=d,c=ve(p(d,"vec3",3,0))}this.instanceColorNode=c}const h=u.mul(Li).xyz;if(Li.assign(h),e.hasGeometryAttribute("normal")){const d=N9(va,u);va.assign(d)}this.instanceColorNode!==null&&R_("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.buffer!==null&&this.isStorageMatrix!==!0&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.usage!==Vc&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&this.isStorageColor!==!0&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.usage!==Vc&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}}class IW extends FW{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:r}=e;super(t,n,r),this.instancedMesh=e}}const zW=sn(IW).setParameterLength(1);class GW extends ct{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=Yd:this.batchingIdNode=BW);const n=Te(([v])=>{const T=In(ou(ms(this.batchMesh._indirectTexture),0).x).toConst(),b=In(v).mod(T).toConst(),x=In(v).div(T).toConst();return ms(this.batchMesh._indirectTexture,aa(b,x)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(In(this.batchingIdNode)),r=this.batchMesh._matricesTexture,s=In(ou(ms(r),0).x).toConst(),o=ge(n).mul(4).toInt().toConst(),u=o.mod(s).toConst(),c=o.div(s).toConst(),h=su(ms(r,aa(u,c)),ms(r,aa(u.add(1),c)),ms(r,aa(u.add(2),c)),ms(r,aa(u.add(3),c))),d=this.batchMesh._colorsTexture;if(d!==null){const T=Te(([b])=>{const x=In(ou(ms(d),0).x).toConst(),M=b,E=M.mod(x).toConst(),w=M.div(x).toConst();return ms(d,aa(E,w)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(n);R_("vec3","vBatchColor").assign(T)}const p=or(h);Li.assign(h.mul(Li));const g=va.div(ve(p[0].dot(p[0]),p[1].dot(p[1]),p[2].dot(p[2]))),_=p.mul(g).xyz;va.assign(_),e.hasGeometryAttribute("tangent")&&PT.mulAssign(p)}}const kW=sn(GW).setParameterLength(1),iC=new WeakMap;class VW extends ct{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Ot.OBJECT,this.skinIndexNode=dl("skinIndex","uvec4"),this.skinWeightNode=dl("skinWeight","vec4"),this.bindMatrixNode=En("bindMatrix","mat4"),this.bindMatrixInverseNode=En("bindMatrixInverse","mat4"),this.boneMatricesNode=KR("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=Li,this.toPositionNode=Li,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:o}=this,u=e.element(n.x),c=e.element(n.y),h=e.element(n.z),d=e.element(n.w),p=s.mul(t),g=Br(u.mul(r.x).mul(p),c.mul(r.y).mul(p),h.mul(r.z).mul(p),d.mul(r.w).mul(p));return o.mul(g).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=va){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:o}=this,u=e.element(n.x),c=e.element(n.y),h=e.element(n.z),d=e.element(n.w);let p=Br(r.x.mul(u),r.y.mul(c),r.z.mul(h),r.w.mul(d));return p=o.mul(p).mul(s),p.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=KR("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,XR)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||J2(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&XR.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const n=this.getSkinnedNormal();va.assign(n),e.hasGeometryAttribute("tangent")&&PT.assign(n)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;iC.get(t)!==e.frameId&&(iC.set(t,e.frameId),this.previousBoneMatricesNode!==null&&(t.previousBoneMatrices===null&&(t.previousBoneMatrices=new Float32Array(t.boneMatrices)),t.previousBoneMatrices.set(t.boneMatrices)),t.update())}}const HW=i=>new VW(i);class WW extends ct{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const n={};for(let u=0,c=this.params.length-1;u<c;u++){const h=this.params[u],d=h.isNode!==!0&&h.name||this.getVarName(u),p=h.isNode!==!0&&h.type||"int";n[d]=Oh(d,p)}const r=e.addStack(),s=this.params[this.params.length-1](n);t.returnsNode=s.context({nodeLoop:s}),t.stackNode=r;const o=this.params[0];if(o.isNode!==!0&&typeof o.update=="function"){const u=Te(this.params[0].update)(n);t.updateNode=u.context({nodeLoop:u})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){const t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){const t=this.getProperties(e),n=this.params,r=t.stackNode;for(let o=0,u=n.length-1;o<u;o++){const c=n[o];let h=!1,d=null,p=null,g=null,_=null,v=null,T=null;c.isNode?c.getNodeType(e)==="bool"?(h=!0,_="bool",p=c.build(e,_)):(_="int",g=this.getVarName(o),d="0",p=c.build(e,_),v="<"):(_=c.type||"int",g=c.name||this.getVarName(o),d=c.start,p=c.end,v=c.condition,T=c.update,typeof d=="number"?d=e.generateConst(_,d):d&&d.isNode&&(d=d.build(e,_)),typeof p=="number"?p=e.generateConst(_,p):p&&p.isNode&&(p=p.build(e,_)),d!==void 0&&p===void 0?(d=d+" - 1",p="0",v=">="):p!==void 0&&d===void 0&&(d="0",v="<"),v===void 0&&(Number(d)>Number(p)?v=">=":v="<"));let b;if(h)b=`while ( ${p} )`;else{const x={start:d,end:p},M=x.start,E=x.end;let w;const C=()=>v.includes("<")?"+=":"-=";if(T!=null)switch(typeof T){case"function":w=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":w=g+" "+C()+" "+e.generateConst(_,T);break;case"string":w=g+" "+T;break;default:T.isNode?w=g+" "+C()+" "+T.build(e):(Re("TSL: 'Loop( { update: ... } )' is not a function, string or number."),w="break /* invalid update */")}else _==="int"||_==="uint"?T=v.includes("<")?"++":"--":T=C()+" 1.",w=g+" "+T;const N=e.getVar(_,g)+" = "+M,D=g+" "+v+" "+E;b=`for ( ${N}; ${D}; ${w} )`}e.addFlowCode((o===0?`
`:"")+e.tab+b+` {

`).addFlowTab()}const s=r.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let o=0,u=this.params.length-1;o<u;o++)e.addFlowCode((o===0?"":e.tab)+`}

`).removeFlowTab();e.addFlowTab()}}const _s=(...i)=>new WW(Qc(i,"int")).toStack(),qW=()=>Oh("break").toStack(),Nx=new WeakMap,Yr=new Lt,rC=Te(({bufferMap:i,influence:e,stride:t,width:n,depth:r,offset:s})=>{const o=In(OW).mul(t).add(s),u=o.div(n),c=o.sub(u.mul(n));return ms(i,aa(c,u)).depth(r).xyz.mul(e)});function $W(i){const e=i.morphAttributes.position!==void 0,t=i.morphAttributes.normal!==void 0,n=i.morphAttributes.color!==void 0,r=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,s=r!==void 0?r.length:0;let o=Nx.get(i);if(o===void 0||o.count!==s){let M=function(){b.dispose(),Nx.delete(i),i.removeEventListener("dispose",M)};var u=M;o!==void 0&&o.texture.dispose();const c=i.morphAttributes.position||[],h=i.morphAttributes.normal||[],d=i.morphAttributes.color||[];let p=0;e===!0&&(p=1),t===!0&&(p=2),n===!0&&(p=3);let g=i.attributes.position.count*p,_=1;const v=4096;g>v&&(_=Math.ceil(g/v),g=v);const T=new Float32Array(g*_*4*s),b=new qS(T,g,_,s);b.type=ri,b.needsUpdate=!0;const x=p*4;for(let E=0;E<s;E++){const w=c[E],C=h[E],N=d[E],D=g*_*4*E;for(let U=0;U<w.count;U++){const R=U*x;e===!0&&(Yr.fromBufferAttribute(w,U),T[D+R+0]=Yr.x,T[D+R+1]=Yr.y,T[D+R+2]=Yr.z,T[D+R+3]=0),t===!0&&(Yr.fromBufferAttribute(C,U),T[D+R+4]=Yr.x,T[D+R+5]=Yr.y,T[D+R+6]=Yr.z,T[D+R+7]=0),n===!0&&(Yr.fromBufferAttribute(N,U),T[D+R+8]=Yr.x,T[D+R+9]=Yr.y,T[D+R+10]=Yr.z,T[D+R+11]=N.itemSize===4?Yr.w:1)}}o={count:s,texture:b,stride:p,size:new Ue(g,_)},Nx.set(i,o),i.addEventListener("dispose",M)}return o}class jW extends ct{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=bt(1),this.updateType=Ot.OBJECT}setup(e){const{geometry:t}=e,n=t.morphAttributes.position!==void 0,r=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=s!==void 0?s.length:0,{texture:u,stride:c,size:h}=$W(t);n===!0&&Li.mulAssign(this.morphBaseInfluence),r===!0&&va.mulAssign(this.morphBaseInfluence);const d=In(h.width);_s(o,({i:p})=>{const g=ge(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?g.assign(ms(this.mesh.morphTexture,aa(In(p).add(1),In(Yd))).r):g.assign(En("morphTargetInfluences","float").element(p).toVar()),wn(g.notEqual(0),()=>{n===!0&&Li.addAssign(rC({bufferMap:u,influence:g,stride:c,width:d,depth:p,offset:In(0)})),r===!0&&va.addAssign(rC({bufferMap:u,influence:g,stride:c,width:d,depth:p,offset:In(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,n)=>t+n,0)}}const XW=sn(jW).setParameterLength(1);class Jh extends ct{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class YW extends Jh{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class KW extends LD{static get type(){return"LightingContextNode"}constructor(e,t=null,n=null,r=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n=ve().toVar("directDiffuse"),r=ve().toVar("directSpecular"),s=ve().toVar("indirectDiffuse"),o=ve().toVar("indirectSpecular"),u={directDiffuse:n,directSpecular:r,indirectDiffuse:s,indirectSpecular:o};return{radiance:ve().toVar("radiance"),irradiance:ve().toVar("irradiance"),iblIrradiance:ve().toVar("iblIrradiance"),ambientOcclusion:ge(1).toVar("ambientOcclusion"),reflectedLight:u,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const QW=sn(KW);class ZW extends Jh{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}const Uc=new Ue;class a3 extends Kh{static get type(){return"ViewportTextureNode"}constructor(e=Jc,t=null,n=null){let r=null;n===null?(r=new JN,r.minFilter=Dr,n=r):r=n,super(n,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=r,this.isOutputTextureNode=!0,this.updateBeforeType=Ot.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,n;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,n=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,n=this._cacheTextures),e===null)return t;if(n.has(e)===!1){const r=t.clone();n.set(e,r)}return n.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,n=t.getRenderTarget();n===null?t.getDrawingBufferSize(Uc):Uc.set(n.width,n.height);const r=this.getTextureForReference(n);(r.image.width!==Uc.width||r.image.height!==Uc.height)&&(r.image.width=Uc.width,r.image.height=Uc.height,r.needsUpdate=!0);const s=r.generateMipmaps;r.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(r),r.generateMipmaps=s}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const o3=sn(a3,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let Fg=null;class JW extends a3{static get type(){return"ViewportDepthTextureNode"}constructor(e=Jc,t=null){Fg===null&&(Fg=new vr),super(e,t,Fg)}getTextureForReference(){return Fg}}const eq=sn(JW).setParameterLength(0,2);class Pr extends ct{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Pr.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,n=this.valueNode;let r=null;if(t===Pr.DEPTH_BASE)n!==null&&(r=c3().assign(n));else if(t===Pr.DEPTH)e.isPerspectiveCamera?r=tq(li.z,Ql,Zl):r=Kd(li.z,Ql,Zl);else if(t===Pr.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const s=l3(n,Ql,Zl);r=Kd(s,Ql,Zl)}else r=n;else r=Kd(li.z,Ql,Zl);return r}}Pr.DEPTH_BASE="depthBase";Pr.DEPTH="depth";Pr.LINEAR_DEPTH="linearDepth";const Kd=(i,e,t)=>i.add(e).div(e.sub(t)),tq=(i,e,t)=>e.add(i).mul(t).div(t.sub(e).mul(i)),l3=(i,e,t)=>e.mul(t).div(t.sub(e).mul(i).sub(t)),u3=(i,e,t)=>{e=e.max(1e-6).toVar();const n=ho(i.negate().div(e)),r=ho(t.div(e));return n.div(r)},c3=sn(Pr,Pr.DEPTH_BASE),h3=Ge(Pr,Pr.DEPTH),nq=sn(Pr,Pr.LINEAR_DEPTH).setParameterLength(0,1);eq();h3.assign=i=>c3(i);class xs extends ct{static get type(){return"ClippingNode"}constructor(e=xs.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===xs.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,r):this.scope===xs.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(n,r)}setupAlphaToCoverage(e,t){return Te(()=>{const n=ge().toVar("distanceToPlane"),r=ge().toVar("distanceToGradient"),s=ge(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const c=Fs(t).setGroup(yt);_s(o,({i:h})=>{const d=c.element(h);n.assign(li.dot(d.xyz).negate().add(d.w)),r.assign(n.fwidth().div(2)),s.mulAssign(po(r.negate(),r,n))})}const u=e.length;if(u>0){const c=Fs(e).setGroup(yt),h=ge(1).toVar("intersectionClipOpacity");_s(u,({i:d})=>{const p=c.element(d);n.assign(li.dot(p.xyz).negate().add(p.w)),r.assign(n.fwidth().div(2)),h.mulAssign(po(r.negate(),r,n).oneMinus())}),s.mulAssign(h.oneMinus())}_n.a.mulAssign(s),_n.a.equal(0).discard()})()}setupDefault(e,t){return Te(()=>{const n=t.length;if(this.hardwareClipping===!1&&n>0){const s=Fs(t).setGroup(yt);_s(n,({i:o})=>{const u=s.element(o);li.dot(u.xyz).greaterThan(u.w).discard()})}const r=e.length;if(r>0){const s=Fs(e).setGroup(yt),o=yT(!0).toVar("clipped");_s(r,({i:u})=>{const c=s.element(u);o.assign(li.dot(c.xyz).greaterThan(c.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),Te(()=>{const r=Fs(e).setGroup(yt),s=Bp(t.getClipDistance());_s(n,({i:o})=>{const u=r.element(o),c=li.dot(u.xyz).sub(u.w).negate();s.element(o).assign(c)})})()}}xs.ALPHA_TO_COVERAGE="alphaToCoverage";xs.DEFAULT="default";xs.HARDWARE="hardware";const iq=()=>new xs,rq=()=>new xs(xs.ALPHA_TO_COVERAGE),sq=()=>new xs(xs.HARDWARE),aq=.05,sC=Te(([i])=>_a(Bt(1e4,Qr(Bt(17,i.x).add(Bt(.1,i.y)))).mul(Br(.1,Zr(Qr(Bt(13,i.y).add(i.x))))))),aC=Te(([i])=>sC(nt(sC(i.xy),i.z))),oq=Te(([i])=>{const e=Yi(fo(MD(i.xyz)),fo(ED(i.xyz))),t=ge(1).div(ge(aq).mul(e)).toVar("pixScale"),n=nt(gp(au(ho(t))),gp(MT(ho(t)))),r=nt(aC(au(n.x.mul(i.xyz))),aC(au(n.y.mul(i.xyz)))),s=_a(ho(t)),o=Br(Bt(s.oneMinus(),r.x),Bt(s,r.y)),u=Uh(s,s.oneMinus()),c=ve(o.mul(o).div(Bt(2,u).mul(wr(1,u))),o.sub(Bt(.5,u)).div(wr(1,u)),wr(1,wr(1,o).mul(wr(1,o)).div(Bt(2,u).mul(wr(1,u))))),h=o.lessThan(u.oneMinus()).select(o.lessThan(u).select(c.x,c.y),c.z);return fl(h,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class lq extends GD{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),n=e.hasGeometryAttribute(t);let r;return n===!0?r=super.generate(e):r=e.generateConst(this.nodeType,new Lt(1,1,1,1)),r}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const uq=(i=0)=>new lq(i),cq=Te(([i])=>Dt(i.rgb.mul(i.a),i.a),{color:"vec4",return:"vec4"});class hi extends ar{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,this.contextNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{Ae('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(t.startsWith("_")===!0)continue;const n=this[t];n&&n.isNode===!0&&e.push({property:t,childNode:n})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:n}of this._getNodeChildren())e.push(e0(t.slice(0,-4)),n.getCacheKey());return this.type+Up(e)}build(e){this.setup(e)}setupObserver(e){return new X6(e)}setup(e){e.context.setupNormal=()=>$d(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();t.contextNode.isContextNode===!0?e.context={...e.context,...t.contextNode.getFlowContextData()}:Re('NodeMaterial: "renderer.contextNode" must be an instance of `context()`.'),this.contextNode!==null&&(this.contextNode.isContextNode===!0?e.context={...e.context,...this.contextNode.getFlowContextData()}:Re('NodeMaterial: "material.contextNode" must be an instance of `context()`.')),e.addStack();const r=$d(this.setupVertex(e),"VERTEX"),s=this.vertexNode||r;e.stack.outputNode=s,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let o;const u=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(n!==null?n.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const c=this.setupLighting(e);u!==null&&e.stack.addToStack(u);const h=Dt(c,_n.a).max(0);o=this.setupOutput(e,h),qd.assign(o);const d=this.outputNode!==null;if(d&&(o=this.outputNode),e.context.getOutput&&(o=e.context.getOutput(o,e)),n!==null){const p=t.getMRT(),g=this.mrtNode;p!==null?(d&&qd.assign(o),o=p,g!==null&&(o=p.merge(g))):g!==null&&(o=g)}}else{let c=this.fragmentNode;c.isOutputStructNode!==!0&&(c=Dt(c)),o=this.setupOutput(e,c)}e.stack.outputNode=o,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let r=null;if(t.length>0||n.length>0){const s=e.renderer.currentSamples;this.alphaToCoverage&&s>1?r=rq():e.stack.addToStack(iq())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(sq()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let r=this.depthNode;if(r===null){const s=t.getMRT();s&&s.has("depth")?r=s.get("depth"):t.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?r=u3(li.z,Ql,Zl):r=Kd(li.z,Ql,Zl))}r!==null&&h3.assign(r).toStack()}setupPositionView(){return Fp.mul(Li).xyz}setupModelViewProjection(){return Xd.mul(li)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),DW}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&XW(t).toStack(),t.isSkinnedMesh===!0&&HW(t).toStack(),this.displacementMap){const r=el("displacementMap","texture"),s=el("displacementScale","float"),o=el("displacementBias","float");Li.addAssign(va.normalize().mul(r.x.mul(s).add(o)))}return t.isBatchedMesh&&kW(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&zW(t).toStack(),this.positionNode!==null&&Li.assign($d(this.positionNode,"POSITION","vec3")),Li}setupDiffuseColor(e){const{object:t,geometry:n}=e;this.maskNode!==null&&yT(this.maskNode).not().discard();let r=this.colorNode?Dt(this.colorNode):tW;this.vertexColors===!0&&n.hasAttribute("color")&&(r=r.mul(uq())),t.instanceColor&&(r=R_("vec3","vInstanceColor").mul(r)),t.isBatchedMesh&&t._colorsTexture&&(r=R_("vec3","vBatchColor").mul(r)),_n.assign(r);const s=this.opacityNode?ge(this.opacityNode):r3;_n.a.assign(_n.a.mul(s));let o=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(o=this.alphaTestNode!==null?ge(this.alphaTestNode):eW,this.alphaToCoverage===!0?(_n.a=po(o,o.add(AD(_n.a)),_n.a),_n.a.lessThanEqual(0).discard()):_n.a.lessThanEqual(o).discard()),this.alphaHash===!0&&_n.a.lessThan(oq(Li)).discard(),e.isOpaque()&&_n.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?ve(0):_n.rgb}setupNormal(){return this.normalNode?ve(this.normalNode):lW}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?el("envMap","cubeTexture"):el("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new ZW(s3)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const r=this.setupLightMap(e);r&&r.isLightingNode&&t.push(r);let s=this.aoNode;s===null&&e.material.aoMap&&(s=NW),e.context.getAO&&(s=e.context.getAO(s,e)),s&&t.push(new YW(s));let o=this.lightsNode||e.lightsNode;return t.length>0&&(o=e.renderer.lighting.createNode([...o.getLights(),...t])),o}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:r,emissiveNode:s}=this,u=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=this.setupOutgoingLight(e);if(u&&u.getScope().hasLights){const h=this.setupLightingModel(e)||null;c=QW(u,h,n,r)}else n!==null&&(c=ve(r!==null?An(c,n,r):n));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(IR.assign(ve(s||iW)),c=c.add(IR)),c}setupFog(e,t){const n=e.fogNode;return n&&(qd.assign(t),t=Dt(n.toVar())),t}setupPremultipliedAlpha(e,t){return cq(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const n in e){const r=e[n];this[n]===void 0&&(this[n]=r,r&&r.clone&&(this[n]=r.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&t[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const n=ar.prototype.toJSON.call(this,e);n.inputNodes={};for(const{property:s,childNode:o}of this._getNodeChildren())n.inputNodes[s]=o.toJSON(e).uuid;function r(s){const o=[];for(const u in s){const c=s[u];delete c.metadata,o.push(c)}return o}if(t){const s=r(e.textures),o=r(e.images),u=r(e.nodes);s.length>0&&(n.textures=s),o.length>0&&(n.images=o),u.length>0&&(n.nodes=u)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,this.contextNode=e.contextNode,super.copy(e)}}const hq=new q_;class fq extends hi{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(hq),this.setValues(e)}}const dq=new oF;class pq extends hi{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(dq),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?ge(this.offsetNode):wW,t=this.dashScaleNode?ge(this.dashScaleNode):MW,n=this.dashSizeNode?ge(this.dashSizeNode):EW,r=this.gapSizeNode?ge(this.gapSizeNode):AW;Ax.assign(n),zR.assign(r);const s=go(dl("lineDistance").mul(t));(e?s.add(e):s).mod(Ax.add(zR)).greaterThan(Ax).discard()}}const mq=new iF;class gq extends hi{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(mq),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?ge(this.opacityNode):r3;_n.assign(RT(Dt(X9(Jt),e),nr))}}const f3=Te(([i=WD])=>{const e=i.z.atan(i.x).mul(1/(Math.PI*2)).add(.5),t=i.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return nt(e,t)});class d3 extends KS{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new Au(5,5,5),o=f3(WD),u=new hi;u.colorNode=zn(t,o,0),u.side=Pn,u.blending=_r;const c=new yi(s,u),h=new W_;h.add(c),t.minFilter===Dr&&(t.minFilter=Gn);const d=new QN(1,10,this),p=e.getMRT();return e.setMRT(null),d.update(e,h),e.setMRT(p),t.minFilter=n,t.currentGenerateMipmaps=r,c.geometry.dispose(),c.material.dispose(),this}}const Qd=new WeakMap;class _q extends xi{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=Cr(null);const t=new Cp;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Ot.RENDER}updateBefore(e){const{renderer:t,material:n}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const s=r.isTextureNode?r.value:n[r.property];if(s&&s.isTexture){const o=s.mapping;if(o===ih||o===rh){if(Qd.has(s)){const u=Qd.get(s);oC(u,s.mapping),this._cubeTexture=u}else{const u=s.image;if(vq(u)){const c=new d3(u.height);c.fromEquirectangularTexture(t,s),oC(c.texture,s.mapping),this._cubeTexture=c.texture,Qd.set(s,c.texture),s.addEventListener("dispose",p3)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function vq(i){return i==null?!1:i.height>0}function p3(i){const e=i.target;e.removeEventListener("dispose",p3);const t=Qd.get(e);t!==void 0&&(Qd.delete(e),t.dispose())}function oC(i,e){e===ih?i.mapping=Vs:e===rh&&(i.mapping=pa)}const m3=sn(_q).setParameterLength(1);class UT extends Jh{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=m3(this.envNode)}}class yq extends Jh{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=ge(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class s0{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class g3 extends s0{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,n=e.reflectedLight,r=e.irradianceLightMap;n.indirectDiffuse.assign(Dt(0)),r?n.indirectDiffuse.addAssign(r):n.indirectDiffuse.addAssign(Dt(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(_n.rgb)}finish(e){const{material:t,context:n}=e,r=n.outgoingLight,s=e.context.environment;if(s)switch(t.combine){case Sp:r.rgb.assign(An(r.rgb,r.rgb.mul(s.rgb),p_.mul(Cx)));break;case kN:r.rgb.assign(An(r.rgb,s.rgb,p_.mul(Cx)));break;case VN:r.rgb.addAssign(s.rgb.mul(p_.mul(Cx)));break;default:Ae("BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const xq=new la;class bq extends hi{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(xq),this.setValues(e)}setupNormal(){return Ip(_p)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new UT(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new yq(s3)),t}setupOutgoingLight(){return _n.rgb}setupLightingModel(){return new g3}}const vp=Te(({f0:i,f90:e,dotVH:t})=>{const n=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return i.mul(n.oneMinus()).add(e.mul(n))}),Fh=Te(i=>i.diffuseColor.mul(1/Math.PI)),Sq=()=>ge(.25),Tq=Te(({dotNH:i})=>Wb.mul(ge(.5)).add(1).mul(ge(1/Math.PI)).mul(i.pow(Wb))),Mq=Te(({lightDirection:i})=>{const e=i.add(Bn).normalize(),t=Jt.dot(e).clamp(),n=Bn.dot(e).clamp(),r=vp({f0:yu,f90:1,dotVH:n}),s=Sq(),o=Tq({dotNH:t});return r.mul(s).mul(o)});class _3 extends g3{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const s=Jt.dot(e).clamp().mul(t);n.directDiffuse.addAssign(s.mul(Fh({diffuseColor:_n.rgb}))),this.specular===!0&&n.directSpecular.addAssign(s.mul(Mq({lightDirection:e})).mul(p_))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(Fh({diffuseColor:_n}))),r.indirectDiffuse.mulAssign(t)}}const Eq=new s2;class Aq extends hi{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Eq),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new UT(t):null}setupLightingModel(){return new _3(!1)}}const wq=new tF;class Rq extends hi{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(wq),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new UT(t):null}setupLightingModel(){return new _3}setupVariants(){const e=(this.shininessNode?ge(this.shininessNode):nW).max(1e-4);Wb.assign(e);const t=this.specularNode||rW;yu.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const Cq=Te(i=>{if(i.geometry.hasAttribute("normal")===!1)return ge(0);const e=_p.dFdx().abs().max(_p.dFdy().abs());return e.x.max(e.y).max(e.z)}),v3=Te(i=>{const{roughness:e}=i,t=Cq();let n=e.max(.0525);return n=n.add(t),n=n.min(1),n}),Nq=Te(({alpha:i,dotNL:e,dotNV:t})=>{const n=i.pow2(),r=e.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt());return ga(.5,r.add(s).max(_D))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),Dq=Te(({alphaT:i,alphaB:e,dotTV:t,dotBV:n,dotTL:r,dotBL:s,dotNV:o,dotNL:u})=>{const c=u.mul(ve(i.mul(t),e.mul(n),o).length()),h=o.mul(ve(i.mul(r),e.mul(s),u).length());return ga(.5,c.add(h))}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),Lq=Te(({alpha:i,dotNH:e})=>{const t=i.pow2(),n=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Pq=ge(1/Math.PI),Uq=Te(({alphaT:i,alphaB:e,dotNH:t,dotTH:n,dotBH:r})=>{const s=i.mul(e),o=ve(e.mul(n),i.mul(r),s.mul(t)),u=o.dot(o),c=s.div(u);return Pq.mul(s.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),y3=Te(({lightDirection:i,f0:e,f90:t,roughness:n,f:r,normalView:s=Jt,USE_IRIDESCENCE:o,USE_ANISOTROPY:u})=>{const c=n.pow2(),h=i.add(Bn).normalize(),d=s.dot(i).clamp(),p=s.dot(Bn).clamp(),g=s.dot(h).clamp(),_=Bn.dot(h).clamp();let v=vp({f0:e,f90:t,dotVH:_}),T,b;if(FR(o)&&(v=bT.mix(v,r)),FR(u)){const x=c_.dot(i),M=c_.dot(Bn),E=c_.dot(h),w=Zc.dot(i),C=Zc.dot(Bn),N=Zc.dot(h);T=Dq({alphaT:Hb,alphaB:c,dotTV:M,dotBV:C,dotTL:x,dotBL:w,dotNV:p,dotNL:d}),b=Uq({alphaT:Hb,alphaB:c,dotNH:g,dotTH:E,dotBH:N})}else T=Nq({alpha:c,dotNL:d,dotNV:p}),b=Lq({alpha:c,dotNH:g});return v.mul(T).mul(b)}),Oq=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let na=null;const N_=Te(({roughness:i,dotNV:e})=>{na===null&&(na=new JS(Oq,16,16,mr,Zn),na.name="DFG_LUT",na.minFilter=Gn,na.magFilter=Gn,na.wrapS=Nr,na.wrapT=Nr,na.generateMipmaps=!1,na.needsUpdate=!0);const t=nt(i,e);return zn(na,t).rg}),Bq=Te(({lightDirection:i,f0:e,f90:t,roughness:n,f:r,USE_IRIDESCENCE:s,USE_ANISOTROPY:o})=>{const u=y3({lightDirection:i,f0:e,f90:t,roughness:n,f:r,USE_IRIDESCENCE:s,USE_ANISOTROPY:o}),c=Jt.dot(i).clamp(),h=Jt.dot(Bn).clamp(),d=N_({roughness:n,dotNV:h}),p=N_({roughness:n,dotNV:c}),g=e.mul(d.x).add(t.mul(d.y)),_=e.mul(p.x).add(t.mul(p.y)),v=d.x.add(d.y),T=p.x.add(p.y),b=ge(1).sub(v),x=ge(1).sub(T),M=e.add(e.oneMinus().mul(.047619)),E=g.mul(_).mul(M).div(ge(1).sub(b.mul(x).mul(M).mul(M)).add(_D)),w=b.mul(x),C=E.mul(w);return u.add(C)}),x3=Te(i=>{const{dotNV:e,specularColor:t,specularF90:n,roughness:r}=i,s=N_({dotNV:e,roughness:r});return t.mul(s.x).add(n.mul(s.y))}),lC=Te(({f:i,f90:e,dotVH:t})=>{const n=t.oneMinus().saturate(),r=n.mul(n),s=n.mul(r,r).clamp(0,.9999);return i.sub(ve(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Fq=Te(({roughness:i,dotNH:e})=>{const t=i.pow2(),n=ge(1).div(t),s=e.pow2().oneMinus().max(.0078125);return ge(2).add(n).mul(s.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Iq=Te(({dotNV:i,dotNL:e})=>ge(1).div(ge(4).mul(e.add(i).sub(e.mul(i))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),zq=Te(({lightDirection:i})=>{const e=i.add(Bn).normalize(),t=Jt.dot(i).clamp(),n=Jt.dot(Bn).clamp(),r=Jt.dot(e).clamp(),s=Fq({roughness:Kl,dotNH:r}),o=Iq({dotNV:n,dotNL:t});return ps.mul(s).mul(o)}),Gq=Te(({N:i,V:e,roughness:t})=>{const s=.0078125,o=i.dot(e).saturate(),u=nt(t,o.oneMinus().sqrt());return u.assign(u.mul(.984375).add(s)),u}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),kq=Te(({f:i})=>{const e=i.length();return Yi(e.mul(e).add(i.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),Ig=Te(({v1:i,v2:e})=>{const t=i.dot(e),n=t.abs().toVar(),r=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),s=n.add(4.1616724).mul(n).add(3.417594).toVar(),o=r.div(s),u=t.greaterThan(0).select(o,Yi(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return i.cross(e).mul(u)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),uC=Te(({N:i,V:e,P:t,mInv:n,p0:r,p1:s,p2:o,p3:u})=>{const c=s.sub(r).toVar(),h=u.sub(r).toVar(),d=c.cross(h),p=ve().toVar();return wn(d.dot(t.sub(r)).greaterThanEqual(0),()=>{const g=e.sub(i.mul(e.dot(i))).normalize(),_=i.cross(g).negate(),v=n.mul(or(g,_,i).transpose()).toVar(),T=v.mul(r.sub(t)).normalize().toVar(),b=v.mul(s.sub(t)).normalize().toVar(),x=v.mul(o.sub(t)).normalize().toVar(),M=v.mul(u.sub(t)).normalize().toVar(),E=ve(0).toVar();E.addAssign(Ig({v1:T,v2:b})),E.addAssign(Ig({v1:b,v2:x})),E.addAssign(Ig({v1:x,v2:M})),E.addAssign(Ig({v1:M,v2:T})),p.assign(ve(kq({f:E})))}),p}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),a0=1/6,b3=i=>Bt(a0,Bt(i,Bt(i,i.negate().add(3)).sub(3)).add(1)),Yb=i=>Bt(a0,Bt(i,Bt(i,Bt(3,i).sub(6))).add(4)),S3=i=>Bt(a0,Bt(i,Bt(i,Bt(-3,i).add(3)).add(3)).add(1)),Kb=i=>Bt(a0,i0(i,3)),cC=i=>b3(i).add(Yb(i)),hC=i=>S3(i).add(Kb(i)),fC=i=>Br(-1,Yb(i).div(b3(i).add(Yb(i)))),dC=i=>Br(1,Kb(i).div(S3(i).add(Kb(i)))),pC=(i,e,t)=>{const n=i.uvNode,r=Bt(n,e.zw).add(.5),s=au(r),o=_a(r),u=cC(o.x),c=hC(o.x),h=fC(o.x),d=dC(o.x),p=fC(o.y),g=dC(o.y),_=nt(s.x.add(h),s.y.add(p)).sub(.5).mul(e.xy),v=nt(s.x.add(d),s.y.add(p)).sub(.5).mul(e.xy),T=nt(s.x.add(h),s.y.add(g)).sub(.5).mul(e.xy),b=nt(s.x.add(d),s.y.add(g)).sub(.5).mul(e.xy),x=cC(o.y).mul(Br(u.mul(i.sample(_).level(t)),c.mul(i.sample(v).level(t)))),M=hC(o.y).mul(Br(u.mul(i.sample(T).level(t)),c.mul(i.sample(b).level(t))));return x.add(M)},Vq=Te(([i,e])=>{const t=nt(i.size(In(e))),n=nt(i.size(In(e.add(1)))),r=ga(1,t),s=ga(1,n),o=pC(i,Dt(r,t),au(e)),u=pC(i,Dt(s,n),MT(e));return _a(e).mix(o,u)}),mC=Te(([i,e,t,n,r])=>{const s=ve(DD(e.negate(),ks(i),ga(1,n))),o=ve(fo(r[0].xyz),fo(r[1].xyz),fo(r[2].xyz));return ks(s).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),Hq=Te(([i,e])=>i.mul(fl(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),Wq=o3(),qq=o3(),gC=Te(([i,e,t],{material:n})=>{const s=(n.side===Pn?Wq:qq).sample(i),o=ho($b.x).mul(Hq(e,t));return Vq(s,o)}),_C=Te(([i,e,t])=>(wn(t.notEqual(0),()=>{const n=yD(e).negate().div(t);return vD(n.negate().mul(i))}),ve(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),$q=Te(([i,e,t,n,r,s,o,u,c,h,d,p,g,_,v])=>{let T,b;if(v){T=Dt().toVar(),b=ve().toVar();const C=d.sub(1).mul(v.mul(.025)),N=ve(d.sub(C),d,d.add(C));_s({start:0,end:3},({i:D})=>{const U=N.element(D),R=mC(i,e,p,U,u),P=o.add(R),I=h.mul(c.mul(Dt(P,1))),H=nt(I.xy.div(I.w)).toVar();H.addAssign(1),H.divAssign(2),H.assign(nt(H.x,H.y.oneMinus()));const X=gC(H,t,U);T.element(D).assign(X.element(D)),T.a.addAssign(X.a),b.element(D).assign(n.element(D).mul(_C(fo(R),g,_).element(D)))}),T.a.divAssign(3)}else{const C=mC(i,e,p,d,u),N=o.add(C),D=h.mul(c.mul(Dt(N,1))),U=nt(D.xy.div(D.w)).toVar();U.addAssign(1),U.divAssign(2),U.assign(nt(U.x,U.y.oneMinus())),T=gC(U,t,d),b=n.mul(_C(fo(C),g,_))}const x=b.rgb.mul(T.rgb),M=i.dot(e).clamp(),E=ve(x3({dotNV:M,specularColor:r,specularF90:s,roughness:t})),w=b.r.add(b.g,b.b).div(3);return Dt(E.oneMinus().mul(x),T.a.oneMinus().mul(w).oneMinus())}),jq=or(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Xq=i=>{const e=i.sqrt();return ve(1).add(e).div(ve(1).sub(e))},vC=(i,e)=>i.sub(e).div(i.add(e)).pow2(),Yq=(i,e)=>{const t=i.mul(2*Math.PI*1e-9),n=ve(54856e-17,44201e-17,52481e-17),r=ve(1681e3,1795300,2208400),s=ve(43278e5,93046e5,66121e5),o=ge(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let u=n.mul(s.mul(2*Math.PI).sqrt()).mul(r.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return u=ve(u.x.add(o),u.y,u.z).div(10685e-11),jq.mul(u)},yC=Te(({outsideIOR:i,eta2:e,cosTheta1:t,thinFilmThickness:n,baseF0:r})=>{const s=An(i,e,po(0,.03,n)),u=i.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();wn(u.lessThan(0),()=>ve(1));const c=u.sqrt(),h=vC(s,i),d=vp({f0:h,f90:1,dotVH:t}),p=d.oneMinus(),g=s.lessThan(i).select(Math.PI,0),_=ge(Math.PI).sub(g),v=Xq(r.clamp(0,.9999)),T=vC(v,s.toVec3()),b=vp({f0:T,f90:1,dotVH:c}),x=ve(v.x.lessThan(s).select(Math.PI,0),v.y.lessThan(s).select(Math.PI,0),v.z.lessThan(s).select(Math.PI,0)),M=s.mul(n,c,2),E=ve(_).add(x),w=d.mul(b).clamp(1e-5,.9999),C=w.sqrt(),N=p.pow2().mul(b).div(ve(1).sub(w)),U=d.add(N).toVar(),R=N.sub(p).toVar();return _s({start:1,end:2,condition:"<=",name:"m"},({m:P})=>{R.mulAssign(C);const I=Yq(ge(P).mul(M),ge(P).mul(E)).mul(2);U.addAssign(R.mul(I))}),U.max(ve(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),md=Te(({normal:i,viewDir:e,roughness:t})=>{const n=i.dot(e).saturate(),r=t.mul(t),s=t.add(.1).reciprocal(),o=ge(-1.9362).add(t.mul(1.0678)).add(r.mul(.4573)).sub(s.mul(.8469)),u=ge(-.6014).add(t.mul(.5538)).sub(r.mul(.467)).sub(s.mul(.1255));return o.mul(n).add(u).exp().saturate()}),Dx=ve(.04),Lx=ge(1);class T3 extends s0{constructor(e=!1,t=!1,n=!1,r=!1,s=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=r,this.transmission=s,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null,this.iridescenceF0Dielectric=null,this.iridescenceF0Metallic=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=ve().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=ve().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=ve().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=ve().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=ve().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=Jt.dot(Bn).clamp(),n=yC({outsideIOR:ge(1),eta2:kb,cosTheta1:t,thinFilmThickness:Vb,baseF0:yu}),r=yC({outsideIOR:ge(1),eta2:kb,cosTheta1:t,thinFilmThickness:Vb,baseF0:_n.rgb});this.iridescenceFresnel=An(n,r,il),this.iridescenceF0Dielectric=lC({f:n,f90:1,dotVH:t}),this.iridescenceF0Metallic=lC({f:r,f90:1,dotVH:t}),this.iridescenceF0=An(this.iridescenceF0Dielectric,this.iridescenceF0Metallic,il)}if(this.transmission===!0){const t=Bh,n=S9.sub(Bh).normalize(),r=Zh,s=e.context;s.backdrop=$q(r,n,to,kc,Wc,Wd,t,Su,_o,Xd,h_,cD,fD,hD,this.dispersion?dD:null),s.backdropAlpha=qb,_n.a.mulAssign(An(1,s.backdrop.a,qb))}super.start(e)}computeMultiscattering(e,t,n,r,s=null){const o=Jt.dot(Bn).clamp(),u=N_({roughness:to,dotNV:o}),c=s?bT.mix(r,s):r,h=c.mul(u.x).add(n.mul(u.y)),p=u.x.add(u.y).oneMinus(),g=c.add(c.oneMinus().mul(.047619)),_=h.mul(g).div(p.mul(g).oneMinus());e.addAssign(h),t.addAssign(_.mul(p))}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const s=Jt.dot(e).clamp().mul(t).toVar();if(this.sheen===!0){this.sheenSpecularDirect.addAssign(s.mul(zq({lightDirection:e})));const o=md({normal:Jt,viewDir:Bn,roughness:Kl}),u=md({normal:Jt,viewDir:e,roughness:Kl}),c=ps.r.max(ps.g).max(ps.b).mul(o.max(u)).oneMinus();s.mulAssign(c)}if(this.clearcoat===!0){const u=qc.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(u.mul(y3({lightDirection:e,f0:Dx,f90:Lx,roughness:C_,normalView:qc})))}n.directDiffuse.addAssign(s.mul(Fh({diffuseColor:kc}))),n.directSpecular.addAssign(s.mul(Bq({lightDirection:e,f0:Wc,f90:1,roughness:to,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:r,reflectedLight:s,ltc_1:o,ltc_2:u}){const c=t.add(n).sub(r),h=t.sub(n).sub(r),d=t.sub(n).add(r),p=t.add(n).add(r),g=Jt,_=Bn,v=li.toVar(),T=Gq({N:g,V:_,roughness:to}),b=o.sample(T).toVar(),x=u.sample(T).toVar(),M=or(ve(b.x,0,b.y),ve(0,1,0),ve(b.z,0,b.w)).toVar(),E=Wc.mul(x.x).add(Wc.oneMinus().mul(x.y)).toVar();s.directSpecular.addAssign(e.mul(E).mul(uC({N:g,V:_,P:v,mInv:M,p0:c,p1:h,p2:d,p3:p}))),s.directDiffuse.addAssign(e.mul(kc).mul(uC({N:g,V:_,P:v,mInv:or(1,0,0,0,1,0,0,0,1),p0:c,p1:h,p2:d,p3:p})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context,r=t.mul(Fh({diffuseColor:kc})).toVar();if(this.sheen===!0){const s=md({normal:Jt,viewDir:Bn,roughness:Kl}),o=ps.r.max(ps.g).max(ps.b).mul(s).oneMinus();r.mulAssign(o)}n.indirectDiffuse.addAssign(r)}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:r}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(n.mul(ps,md({normal:Jt,viewDir:Bn,roughness:Kl}))),this.clearcoat===!0){const b=qc.dot(Bn).clamp(),x=x3({dotNV:b,specularColor:Dx,specularF90:Lx,roughness:C_});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(x))}const s=ve().toVar("singleScatteringDielectric"),o=ve().toVar("multiScatteringDielectric"),u=ve().toVar("singleScatteringMetallic"),c=ve().toVar("multiScatteringMetallic");this.computeMultiscattering(s,o,Wd,yu,this.iridescenceF0Dielectric),this.computeMultiscattering(u,c,Wd,_n.rgb,this.iridescenceF0Metallic);const h=An(s,u,il),d=An(o,c,il),p=s.add(o),g=kc.mul(p.oneMinus()),_=n.mul(1/Math.PI),v=t.mul(h).add(d.mul(_)).toVar(),T=g.mul(_).toVar();if(this.sheen===!0){const b=md({normal:Jt,viewDir:Bn,roughness:Kl}),x=ps.r.max(ps.g).max(ps.b).mul(b).oneMinus();v.mulAssign(x),T.mulAssign(x)}r.indirectSpecular.addAssign(v),r.indirectDiffuse.addAssign(T)}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,s=Jt.dot(Bn).clamp().add(t),o=to.mul(-16).oneMinus().negate().exp2(),u=t.sub(s.pow(o).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(u)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const n=qc.dot(Bn).clamp(),r=vp({dotVH:n,f0:Dx,f90:Lx}),s=t.mul(Gb.mul(r).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Gb));t.assign(s)}if(this.sheen===!0){const n=t.add(this.sheenSpecularDirect,this.sheenSpecularIndirect.mul(1/Math.PI));t.assign(n)}}}const xC=ge(1),Qb=ge(-2),zg=ge(.8),Px=ge(-1),Gg=ge(.4),Ux=ge(2),kg=ge(.305),Ox=ge(3),bC=ge(.21),Kq=ge(4),SC=ge(4),Qq=ge(16),Zq=Te(([i])=>{const e=ve(Zr(i)).toVar(),t=ge(-1).toVar();return wn(e.x.greaterThan(e.z),()=>{wn(e.x.greaterThan(e.y),()=>{t.assign(Lr(i.x.greaterThan(0),0,3))}).Else(()=>{t.assign(Lr(i.y.greaterThan(0),1,4))})}).Else(()=>{wn(e.z.greaterThan(e.y),()=>{t.assign(Lr(i.z.greaterThan(0),2,5))}).Else(()=>{t.assign(Lr(i.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),Jq=Te(([i,e])=>{const t=nt().toVar();return wn(e.equal(0),()=>{t.assign(nt(i.z,i.y).div(Zr(i.x)))}).ElseIf(e.equal(1),()=>{t.assign(nt(i.x.negate(),i.z.negate()).div(Zr(i.y)))}).ElseIf(e.equal(2),()=>{t.assign(nt(i.x.negate(),i.y).div(Zr(i.z)))}).ElseIf(e.equal(3),()=>{t.assign(nt(i.z.negate(),i.y).div(Zr(i.x)))}).ElseIf(e.equal(4),()=>{t.assign(nt(i.x.negate(),i.z).div(Zr(i.y)))}).Else(()=>{t.assign(nt(i.x,i.y).div(Zr(i.z)))}),Bt(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),e$=Te(([i])=>{const e=ge(0).toVar();return wn(i.greaterThanEqual(zg),()=>{e.assign(xC.sub(i).mul(Px.sub(Qb)).div(xC.sub(zg)).add(Qb))}).ElseIf(i.greaterThanEqual(Gg),()=>{e.assign(zg.sub(i).mul(Ux.sub(Px)).div(zg.sub(Gg)).add(Px))}).ElseIf(i.greaterThanEqual(kg),()=>{e.assign(Gg.sub(i).mul(Ox.sub(Ux)).div(Gg.sub(kg)).add(Ux))}).ElseIf(i.greaterThanEqual(bC),()=>{e.assign(kg.sub(i).mul(Kq.sub(Ox)).div(kg.sub(bC)).add(Ox))}).Else(()=>{e.assign(ge(-2).mul(ho(Bt(1.16,i))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),t$=Te(([i,e])=>{const t=i.toVar();t.assign(Bt(2,t).sub(1));const n=ve(t,1).toVar();return wn(e.equal(0),()=>{n.assign(n.zyx)}).ElseIf(e.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),n$=Te(([i,e,t,n,r,s])=>{const o=ge(t),u=ve(e),c=fl(e$(o),Qb,s),h=_a(c),d=au(c),p=ve(yp(i,u,d,n,r,s)).toVar();return wn(h.notEqual(0),()=>{const g=ve(yp(i,u,d.add(1),n,r,s)).toVar();p.assign(An(p,g,h))}),p}),yp=Te(([i,e,t,n,r,s])=>{const o=ge(t).toVar(),u=ve(e),c=ge(Zq(u)).toVar(),h=ge(Yi(SC.sub(o),0)).toVar();o.assign(Yi(o,SC));const d=ge(gp(o)).toVar(),p=nt(Jq(u,c).mul(d.sub(2)).add(1)).toVar();return wn(c.greaterThan(2),()=>{p.y.addAssign(d),c.subAssign(3)}),p.x.addAssign(c.mul(d)),p.x.addAssign(h.mul(Bt(3,Qq))),p.y.addAssign(Bt(4,gp(s).sub(d))),p.x.mulAssign(n),p.y.mulAssign(r),i.sample(p).grad(nt(),nt())}),Bx=Te(({envMap:i,mipInt:e,outputDirection:t,theta:n,axis:r,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:u})=>{const c=oa(n),h=t.mul(c).add(r.cross(t).mul(Qr(n))).add(r.mul(r.dot(t).mul(c.oneMinus())));return yp(i,h,e,s,o,u)}),i$=Te(({n:i,latitudinal:e,poleAxis:t,outputDirection:n,weights:r,samples:s,dTheta:o,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p})=>{const g=ve(Lr(e,t,bu(t,n))).toVar();wn(g.equal(ve(0)),()=>{g.assign(ve(n.z,0,n.x.negate()))}),g.assign(ks(g));const _=ve().toVar();return _.addAssign(r.element(0).mul(Bx({theta:0,axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p}))),_s({start:In(1),end:i},({i:v})=>{wn(v.greaterThanEqual(s),()=>{qW()});const T=ge(o.mul(ge(v))).toVar();_.addAssign(r.element(v).mul(Bx({theta:T.mul(-1),axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p}))),_.addAssign(r.element(v).mul(Bx({theta:T,axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p})))}),Dt(_,1)}),r$=Te(([i])=>{const e=Wt(i).toVar();return e.assign(e.shiftLeft(Wt(16)).bitOr(e.shiftRight(Wt(16)))),e.assign(e.bitAnd(Wt(1431655765)).shiftLeft(Wt(1)).bitOr(e.bitAnd(Wt(2863311530)).shiftRight(Wt(1)))),e.assign(e.bitAnd(Wt(858993459)).shiftLeft(Wt(2)).bitOr(e.bitAnd(Wt(3435973836)).shiftRight(Wt(2)))),e.assign(e.bitAnd(Wt(252645135)).shiftLeft(Wt(4)).bitOr(e.bitAnd(Wt(4042322160)).shiftRight(Wt(4)))),e.assign(e.bitAnd(Wt(16711935)).shiftLeft(Wt(8)).bitOr(e.bitAnd(Wt(4278255360)).shiftRight(Wt(8)))),ge(e).mul(23283064365386963e-26)}),s$=Te(([i,e])=>nt(ge(i).div(ge(e)),r$(i))),a$=Te(([i,e,t])=>{const n=ve(e).toVar(),r=ge(t),s=r.mul(r).toVar(),o=ks(ve(s.mul(n.x),s.mul(n.y),n.z)).toVar(),u=o.x.mul(o.x).add(o.y.mul(o.y)),c=Lr(u.greaterThan(0),ve(o.y.negate(),o.x,0).div(ao(u)),ve(1,0,0)).toVar(),h=bu(o,c).toVar(),d=ao(i.x),p=Bt(2,3.14159265359).mul(i.y),g=d.mul(oa(p)).toVar(),_=d.mul(Qr(p)).toVar(),v=Bt(.5,o.z.add(1));_.assign(v.oneMinus().mul(ao(g.mul(g).oneMinus())).add(v.mul(_)));const T=c.mul(g).add(h.mul(_)).add(o.mul(ao(Yi(0,g.mul(g).add(_.mul(_)).oneMinus()))));return ks(ve(s.mul(T.x),s.mul(T.y),Yi(0,T.z)))}),o$=Te(({roughness:i,mipInt:e,envMap:t,N_immutable:n,GGX_SAMPLES:r,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:u})=>{const c=ve(n).toVar(),h=ve(0).toVar(),d=ge(0).toVar();return wn(i.lessThan(.001),()=>{h.assign(yp(t,c,e,s,o,u))}).Else(()=>{const p=Lr(Zr(c.z).lessThan(.999),ve(0,0,1),ve(1,0,0)),g=ks(bu(p,c)).toVar(),_=bu(c,g).toVar();_s({start:Wt(0),end:r},({i:v})=>{const T=s$(v,r),b=a$(T,ve(0,0,1),i),x=ks(g.mul(b.x).add(_.mul(b.y)).add(c.mul(b.z))),M=ks(x.mul(xu(c,x).mul(2)).sub(c)),E=Yi(xu(c,M),0);wn(E.greaterThan(0),()=>{const w=yp(t,M,e,s,o,u);h.addAssign(w.mul(E)),d.addAssign(E)})}),wn(d.greaterThan(0),()=>{h.assign(h.div(d))})}),Dt(h,1)}),rl=4,TC=[.125,.215,.35,.446,.526,.582],Jl=20,l$=512,gd=new Wh(-1,1,1,-1,0,1),u$=new Di(90,1),MC=new dt;let Fx=null,Ix=0,zx=0;const c$=new k,D_=new WeakMap,h$=[3,1,5,0,4,2],Gx=t$(Yh(),dl("faceIndex")).normalize(),o0=ve(Gx.x,Gx.y,Gx.z);class f${constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,n=.1,r=100,s={}){const{size:o=256,position:u=c$,renderTarget:c=null}=s;if(this._setSize(o),this._hasInitialized===!1){Ae('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const d=c||this._allocateTarget();return s.renderTarget=d,this.fromSceneAsync(e,t,n,r,s),d}Fx=this._renderer.getRenderTarget(),Ix=this._renderer.getActiveCubeFace(),zx=this._renderer.getActiveMipmapLevel();const h=c||this._allocateTarget();return h.depthBuffer=!0,this._init(h),this._sceneToCubeUV(e,n,r,h,u),t>0&&this._blur(h,0,0,t),this._applyPMREM(h),this._cleanup(h),h}async fromSceneAsync(e,t=0,n=.1,r=100,s={}){return Vn('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(e,t,n,r,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){Ae('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return Vn('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){Ae("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return Vn('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=AC(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=wC(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===Vs||e.mapping===pa?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(Fx,Ix,zx),e.scissorTest=!1,Oc(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),Fx=this._renderer.getRenderTarget(),Ix=this._renderer.getActiveCubeFace(),zx=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTarget();return this._init(n),this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return EC(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=EC(e.width,e.height);const{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=d$(t)),this._blurMaterial=p$(t,e.width,e.height),this._ggxMaterial=m$(t,e.width,e.height)}}async _compileMaterial(e){const t=new yi(new wi,e);await this._renderer.compile(t,gd)}_sceneToCubeUV(e,t,n,r,s){const o=u$;o.near=t,o.far=n;const u=[1,1,1,1,-1,1],c=[1,-1,1,-1,1,-1],h=this._renderer,d=h.autoClear;h.getClearColor(MC),h.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new yi(new Au,new la({name:"PMREM.Background",side:Pn,depthWrite:!1,depthTest:!1})));const p=this._backgroundBox,g=p.material;let _=!1;const v=e.background;v?v.isColor&&(g.color.copy(v),e.background=null,_=!0):(g.color.copy(MC),_=!0),h.setRenderTarget(r),h.clear(),_&&h.render(p,o);for(let T=0;T<6;T++){const b=T%3;b===0?(o.up.set(0,u[T],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x+c[T],s.y,s.z)):b===1?(o.up.set(0,0,u[T]),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y+c[T],s.z)):(o.up.set(0,u[T],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y,s.z+c[T]));const x=this._cubeSize;Oc(r,b*x,T>2?x:0,x,x),h.render(e,o)}h.autoClear=d,e.background=v}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===Vs||e.mapping===pa;r?this._cubemapMaterial===null&&(this._cubemapMaterial=AC(e)):this._equirectMaterial===null&&(this._equirectMaterial=wC(e));const s=r?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=s;const u=this._cubeSize;Oc(t,0,0,3*u,2*u),n.setRenderTarget(t),n.render(o,gd)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodMeshes.length;for(let s=1;s<r;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=n}_applyGGXFilter(e,t,n){const r=this._renderer,s=this._pingPongRenderTarget,o=this._ggxMaterial,u=this._lodMeshes[n];u.material=o;const c=D_.get(o),h=n/(this._lodMeshes.length-1),d=t/(this._lodMeshes.length-1),p=Math.sqrt(h*h-d*d),g=0+h*1.25,_=p*g,{_lodMax:v}=this,T=this._sizeLods[n],b=3*T*(n>v-rl?n-v+rl:0),x=4*(this._cubeSize-T);e.texture.frame=(e.texture.frame||0)+1,c.envMap.value=e.texture,c.roughness.value=_,c.mipInt.value=v-t,Oc(s,b,x,3*T,2*T),r.setRenderTarget(s),r.render(u,gd),s.texture.frame=(s.texture.frame||0)+1,c.envMap.value=s.texture,c.roughness.value=0,c.mipInt.value=v-n,Oc(e,b,x,3*T,2*T),r.setRenderTarget(e),r.render(u,gd)}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,u){const c=this._renderer,h=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&Re("blur direction must be either latitudinal or longitudinal!");const d=3,p=this._lodMeshes[r];p.material=h;const g=D_.get(h),_=this._sizeLods[n]-1,v=isFinite(s)?Math.PI/(2*_):2*Math.PI/(2*Jl-1),T=s/v,b=isFinite(s)?1+Math.floor(d*T):Jl;b>Jl&&Ae(`sigmaRadians, ${s}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${Jl}`);const x=[];let M=0;for(let D=0;D<Jl;++D){const U=D/T,R=Math.exp(-U*U/2);x.push(R),D===0?M+=R:D<b&&(M+=2*R)}for(let D=0;D<x.length;D++)x[D]=x[D]/M;e.texture.frame=(e.texture.frame||0)+1,g.envMap.value=e.texture,g.samples.value=b,g.weights.array=x,g.latitudinal.value=o==="latitudinal"?1:0,u&&(g.poleAxis.value=u);const{_lodMax:E}=this;g.dTheta.value=v,g.mipInt.value=E-n;const w=this._sizeLods[r],C=3*w*(r>E-rl?r-E+rl:0),N=4*(this._cubeSize-w);Oc(t,C,N,3*w,2*w),c.setRenderTarget(t),c.render(p,gd)}}function d$(i){const e=[],t=[],n=[];let r=i;const s=i-rl+1+TC.length;for(let o=0;o<s;o++){const u=Math.pow(2,r);e.push(u);let c=1/u;o>i-rl?c=TC[o-i+rl-1]:o===0&&(c=0),t.push(c);const h=1/(u-2),d=-h,p=1+h,g=[d,d,p,d,p,p,d,d,p,p,d,p],_=6,v=6,T=3,b=2,x=1,M=new Float32Array(T*v*_),E=new Float32Array(b*v*_),w=new Float32Array(x*v*_);for(let N=0;N<_;N++){const D=N%3*2/3-1,U=N>2?0:-1,R=[D,U,0,D+2/3,U,0,D+2/3,U+1,0,D,U,0,D+2/3,U+1,0,D,U+1,0],P=h$[N];M.set(R,T*v*P),E.set(g,b*v*P);const I=[P,P,P,P,P,P];w.set(I,x*v*P)}const C=new wi;C.setAttribute("position",new Xi(M,T)),C.setAttribute("uv",new Xi(E,b)),C.setAttribute("faceIndex",new Xi(w,x)),n.push(new yi(C,null)),r>rl&&r--}return{lodMeshes:n,sizeLods:e,sigmas:t}}function EC(i,e){const t={magFilter:Gn,minFilter:Gn,generateMipmaps:!1,type:Zn,format:si,colorSpace:mu},n=new Mu(i,e,t);return n.texture.mapping=cu,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function Oc(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function l0(i){const e=new hi;return e.depthTest=!1,e.depthWrite=!1,e.blending=_r,e.name=`PMREM_${i}`,e}function p$(i,e,t){const n=Fs(new Array(Jl).fill(0)),r=bt(new k(0,1,0)),s=bt(0),o=ge(Jl),u=bt(0),c=bt(1),h=zn(),d=bt(0),p=ge(1/e),g=ge(1/t),_=ge(i),v={n:o,latitudinal:u,weights:n,poleAxis:r,outputDirection:o0,dTheta:s,samples:c,envMap:h,mipInt:d,CUBEUV_TEXEL_WIDTH:p,CUBEUV_TEXEL_HEIGHT:g,CUBEUV_MAX_MIP:_},T=l0("blur");return T.fragmentNode=i$({...v,latitudinal:u.equal(1)}),D_.set(T,v),T}function m$(i,e,t){const n=zn(),r=bt(0),s=bt(0),o=ge(1/e),u=ge(1/t),c=ge(i),h={envMap:n,roughness:r,mipInt:s,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:c},d=l0("ggx");return d.fragmentNode=o$({...h,N_immutable:o0,GGX_SAMPLES:Wt(l$)}),D_.set(d,h),d}function AC(i){const e=l0("cubemap");return e.fragmentNode=Cr(i,o0),e}function wC(i){const e=l0("equirect");return e.fragmentNode=zn(i,f3(o0),0),e}const RC=new WeakMap;function g$(i){const e=Math.log2(i)-2,t=1/i;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:t,maxMip:e}}function _$(i,e,t){const n=v$(e);let r=n.get(i);if((r!==void 0?r.pmremVersion:-1)!==i.pmremVersion){const o=i.image;if(i.isCubeTexture)if(x$(o))r=t.fromCubemap(i,r);else return null;else if(b$(o))r=t.fromEquirectangular(i,r);else return null;r.pmremVersion=i.pmremVersion,n.set(i,r)}return r.texture}function v$(i){let e=RC.get(i);return e===void 0&&(e=new WeakMap,RC.set(i,e)),e}class y$ extends xi{static get type(){return"PMREMNode"}constructor(e,t=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const r=new ui;r.isRenderTargetTexture=!0,this._texture=zn(r),this._width=bt(0),this._height=bt(0),this._maxMip=bt(0),this.updateBeforeType=Ot.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=g$(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,r=this._value;n!==r.pmremVersion&&(r.isPMREMTexture===!0?t=r:t=_$(r,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new f$(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this,e)),t=XD.mul(ve(t.x,t.y.negate(),t.z));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),n$(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function x$(i){if(i==null)return!1;let e=0;const t=6;for(let n=0;n<t;n++)i[n]!==void 0&&e++;return e===t}function b$(i){return i==null?!1:i.height>0}const M3=sn(y$).setParameterLength(1,3),CC=new WeakMap;class S$ extends Jh{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const p=n.isTextureNode?n.value:t[n.property];let g=CC.get(p);g===void 0&&(g=M3(p),CC.set(p,g)),n=g}const s=t.useAnisotropy===!0||t.anisotropy>0?j9:Jt,o=n.context(NC(to,s)).mul(Rx),u=n.context(T$(Zh)).mul(Math.PI).mul(Rx),c=jd(o),h=jd(u);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(h);const d=e.context.lightingModel.clearcoatRadiance;if(d){const p=n.context(NC(C_,qc)).mul(Rx),g=jd(p);d.addAssign(g)}}}const NC=(i,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Bn.negate().reflect(e),t=CD(i).mix(t,e).normalize(),t=t.transformDirection(_o)),t),getTextureLevel:()=>i}},T$=i=>({getUV:()=>i,getTextureLevel:()=>ge(1)}),M$=new r2;class E3 extends hi{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(M$),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new S$(t):null}setupLightingModel(){return new T3}setupSpecular(){const e=An(ve(.04),_n.rgb,il);yu.assign(ve(.04)),Wc.assign(e),Wd.assign(1)}setupVariants(){const e=this.metalnessNode?ge(this.metalnessNode):oW;il.assign(e);let t=this.roughnessNode?ge(this.roughnessNode):aW;t=v3({roughness:t}),to.assign(t),this.setupSpecular(),kc.assign(_n.rgb.mul(e.oneMinus()))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const E$=new eF;class A$ extends E3{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(E$),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?ge(this.iorNode):bW;h_.assign(e),yu.assign(Uh(RD(h_.sub(1).div(h_.add(1))).mul(sW),ve(1)).mul(tC)),Wc.assign(An(yu,_n.rgb,il)),Wd.assign(An(tC,1,il))}setupLightingModel(){return new T3(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?ge(this.clearcoatNode):uW,n=this.clearcoatRoughnessNode?ge(this.clearcoatRoughnessNode):cW;Gb.assign(t),C_.assign(v3({roughness:n}))}if(this.useSheen){const t=this.sheenNode?ve(this.sheenNode):dW,n=this.sheenRoughnessNode?ge(this.sheenRoughnessNode):pW;ps.assign(t),Kl.assign(n)}if(this.useIridescence){const t=this.iridescenceNode?ge(this.iridescenceNode):gW,n=this.iridescenceIORNode?ge(this.iridescenceIORNode):_W,r=this.iridescenceThicknessNode?ge(this.iridescenceThicknessNode):vW;bT.assign(t),kb.assign(n),Vb.assign(r)}if(this.useAnisotropy){const t=(this.anisotropyNode?nt(this.anisotropyNode):mW).toVar();jl.assign(t.length()),wn(jl.equal(0),()=>{t.assign(nt(1,0))}).Else(()=>{t.divAssign(nt(jl)),jl.assign(jl.saturate())}),Hb.assign(jl.pow2().mix(to.pow2(),1)),c_.assign(Pd[0].mul(t.x).add(Pd[1].mul(t.y))),Zc.assign(Pd[1].mul(t.x).sub(Pd[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?ge(this.transmissionNode):yW,n=this.thicknessNode?ge(this.thicknessNode):xW,r=this.attenuationDistanceNode?ge(this.attenuationDistanceNode):SW,s=this.attenuationColorNode?ve(this.attenuationColorNode):TW;if(qb.assign(t),cD.assign(n),hD.assign(r),fD.assign(s),this.useDispersion){const o=this.dispersionNode?ge(this.dispersionNode):CW;dD.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?ve(this.clearcoatNormalNode):hW}setup(e){e.context.setupClearcoatNormal=()=>$d(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const w$=Te(({normal:i,lightDirection:e,builder:t})=>{const n=i.dot(e),r=nt(n.mul(.5).add(.5),0);if(t.material.gradientMap){const s=el("gradientMap","texture").context({getUV:()=>r});return ve(s.r)}else{const s=r.fwidth().mul(.5);return An(ve(.7),ve(1),po(ge(.7).sub(s.x),ge(.7).add(s.x),r.x))}});class R$ extends s0{direct({lightDirection:e,lightColor:t,reflectedLight:n},r){const s=w$({normal:$D,lightDirection:e,builder:r}).mul(t);n.directDiffuse.addAssign(s.mul(Fh({diffuseColor:_n.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(Fh({diffuseColor:_n}))),r.indirectDiffuse.mulAssign(t)}}const C$=new nF;class N$ extends hi{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(C$),this.setValues(e)}setupLightingModel(){return new R$}}const D$=Te(()=>{const i=ve(Bn.z,0,Bn.x.negate()).normalize(),e=Bn.cross(i);return nt(i.dot(Jt),e.dot(Jt)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),L$=new aF;class P$ extends hi{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(L$),this.setValues(e)}setupVariants(e){const t=D$;let n;e.material.matcap?n=el("matcap","texture").context({getUV:()=>t}):n=ve(An(.2,.8,t.y)),_n.rgb.mulAssign(n.rgb)}}class U$ extends xi{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),o=t.sin();return xT(s,o,o.negate(),s).mul(n)}else{const s=t,o=su(Dt(1,0,0,0),Dt(0,oa(s.x),Qr(s.x).negate(),0),Dt(0,Qr(s.x),oa(s.x),0),Dt(0,0,0,1)),u=su(Dt(oa(s.y),0,Qr(s.y),0),Dt(0,1,0,0),Dt(Qr(s.y).negate(),0,oa(s.y),0),Dt(0,0,0,1)),c=su(Dt(oa(s.z),Qr(s.z).negate(),0,0),Dt(Qr(s.z),oa(s.z),0,0),Dt(0,0,1,0),Dt(0,0,0,1));return o.mul(u).mul(c).mul(Dt(n,1)).xyz}}}const A3=sn(U$).setParameterLength(2),O$=new ZS;class w3 extends hi{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(O$),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,{positionNode:r,rotationNode:s,scaleNode:o,sizeAttenuation:u}=this,c=Fp.mul(ve(r||0));let h=nt(Su[0].xyz.length(),Su[1].xyz.length());o!==null&&(h=h.mul(nt(o))),n.isPerspectiveCamera&&u===!1&&(h=h.mul(c.z.negate()));let d=r0.xy;if(t.center&&t.center.isVector2===!0){const _=$H("center","vec2",t);d=d.sub(_.sub(.5))}d=d.mul(h);const p=ge(s||fW),g=A3(d,p);return Dt(c.xy.add(g),c.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const B$=new OB,F$=new Ue;class I$ extends w3{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(B$),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return Fp.mul(ve(e||Li)).xyz}setupVertexSprite(e){const{material:t,camera:n}=e,{rotationNode:r,scaleNode:s,sizeNode:o,sizeAttenuation:u}=this;let c=super.setupVertex(e);if(t.isNodeMaterial!==!0)return c;let h=o!==null?nt(o):RW;h=h.mul(x9),n.isPerspectiveCamera&&u===!0&&(h=h.mul(z$.div(li.z.negate()))),s&&s.isNode&&(h=h.mul(nt(s)));let d=r0.xy;if(r&&r.isNode){const p=ge(r);d=A3(d,p)}return d=d.mul(h),d=d.div(b9.div(2)),d=d.mul(c.w),c=c.add(Dt(d,0,0)),c}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const z$=bt(1).onFrameUpdate(function({renderer:i}){const e=i.getSize(F$);this.value=.5*e.y});class G$ extends s0{constructor(){super(),this.shadowNode=ge(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){_n.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(_n.rgb)}}const k$=new ZB;class V$ extends hi{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(k$),this.setValues(e)}setupLightingModel(){return new G$}}cl("vec3");cl("vec3");cl("vec3");class H${constructor(e,t,n){this.renderer=e,this.nodes=t,this.info=n,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(t,n),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class Ws{constructor(){this.weakMaps={}}_getWeakMap(e){const t=e.length;let n=this.weakMaps[t];return n===void 0&&(n=new WeakMap,this.weakMaps[t]=n),n}get(e){let t=this._getWeakMap(e);for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let n=this._getWeakMap(e);for(let r=0;r<e.length-1;r++){const s=e[r];n.has(s)===!1&&n.set(s,new WeakMap),n=n.get(s)}return n.set(e[e.length-1],t),this}delete(e){let t=this._getWeakMap(e);for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return!1;return t.delete(e[e.length-1])}}let W$=0;function q$(i){const e=Object.keys(i);let t=Object.getPrototypeOf(i);for(;t;){const n=Object.getOwnPropertyDescriptors(t);for(const r in n)if(n[r]!==void 0){const s=n[r];s&&typeof s.get=="function"&&e.push(r)}t=Object.getPrototypeOf(t)}return e}class $${constructor(e,t,n,r,s,o,u,c,h,d){this.id=W$++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=r,this.material=s,this.scene=o,this.camera=u,this.lightsNode=c,this.context=h,this.geometry=r.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=d,this.clippingContextCacheKey=d!==null?d.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getIndirectOffset(){return this._geometries.getIndirectOffset(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],r=new Set,s={};for(const o of e){let u;if(o.node&&o.node.attribute?u=o.node.attribute:(u=t.getAttribute(o.name),s[o.name]=u.version),u===void 0)continue;n.push(u);const c=u.isInterleavedBufferAttribute?u.data:u;r.add(c)}return this.attributes=n,this.attributesId=s,this.vertexBuffers=Array.from(r.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:r,drawRange:s}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),u=this.getIndex(),c=u!==null;let h=1;if(n.isInstancedBufferGeometry===!0?h=n.instanceCount:e.count!==void 0&&(h=Math.max(0,e.count)),h===0)return null;if(o.instanceCount=h,e.isBatchedMesh===!0)return o;let d=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(d=2);let p=s.start*d,g=(s.start+s.count)*d;r!==null&&(p=Math.max(p,r.start*d),g=Math.min(g,(r.start+r.count)*d));const _=n.attributes.position;let v=1/0;c?v=u.count:_!=null&&(v=_.count),p=Math.max(p,0),g=Math.min(g,v);const T=g-p;return T<0||T===1/0?null:(o.vertexCount=T,o.firstVertex=p,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const r=e.attributes[n];t+=n+",",r.data&&(t+=r.data.stride+","),r.offset&&(t+=r.offset+","),r.itemSize&&(t+=r.itemSize+","),r.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const r=e.morphAttributes[n];t+="morph-"+n+",";for(let s=0,o=r.length;s<o;s++){const u=r[s];t+=u.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:n}=this;let r=t.customProgramCacheKey();for(const s of q$(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(s))continue;const o=t[s];let u;if(o!==null){const c=typeof o;c==="number"?u=o!==0?"1":"0":c==="object"?(u="{",o.isTexture&&(u+=o.mapping,n.backend.isWebGPUBackend===!0&&(u+=o.magFilter,u+=o.minFilter,u+=o.wrapS,u+=o.wrapT,u+=o.wrapR)),u+="}"):u=String(o)}else u=String(o);r+=u+","}return r+=this.clippingContextCacheKey+",",e.geometry&&(r+=this.getGeometryCacheKey()),e.skeleton&&(r+=e.skeleton.bones.length+","),e.isBatchedMesh&&(r+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(r+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(r+=e.uuid+","),r+=this.context.id+",",r+=e.receiveShadow+",",e0(r)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const n=this.geometry.getAttribute(t);if(n===void 0||e[t]!==n.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=Vd(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=Vd(e,1)),e=Vd(e,this.camera.id,this.renderer.contextNode.id,this.renderer.contextNode.version),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const Vl=[];class j${constructor(e,t,n,r,s,o){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=r,this.bindings=s,this.info=o,this.chainMaps={}}get(e,t,n,r,s,o,u,c){const h=this.getChainMap(c);Vl[0]=e,Vl[1]=t,Vl[2]=o,Vl[3]=s;let d=h.get(Vl);return d===void 0?(d=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,r,s,o,u,c),h.set(Vl,d)):(d.updateClipping(u),d.needsGeometryUpdate&&d.setGeometry(e.geometry),(d.version!==t.version||d.needsUpdate)&&(d.initialCacheKey!==d.getCacheKey()?(d.dispose(),d=this.get(e,t,n,r,s,o,u,c)):d.version=t.version)),Vl.length=0,d}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Ws)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,r,s,o,u,c,h,d,p){const g=this.getChainMap(p),_=new $$(e,t,n,r,s,o,u,c,h,d);return _.onDispose=()=>{this.pipelines.delete(_),this.bindings.deleteForRender(_),this.nodes.delete(_),g.delete(_.getChainArray())},_}}class pl{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const ys={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},tl=16,X$=211,Y$=212;class K$ extends pl{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(n.version===void 0)t===ys.VERTEX?this.backend.createAttribute(e):t===ys.INDEX?this.backend.createIndexAttribute(e):t===ys.STORAGE?this.backend.createStorageAttribute(e):t===ys.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const r=this._getBufferAttribute(e);(n.version<r.version||r.usage===Vc)&&(this.backend.updateAttribute(e),n.version=r.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function R3(i){return i.index!==null?i.index.version:i.attributes.position.version}function DC(i){const e=[],t=i.index,n=i.attributes.position;if(t!==null){const s=t.array;for(let o=0,u=s.length;o<u;o+=3){const c=s[o+0],h=s[o+1],d=s[o+2];e.push(c,h,h,d,d,c)}}else{const s=n.array;for(let o=0,u=s.length/3-1;o<u;o+=3){const c=o+0,h=o+1,d=o+2;e.push(c,h,h,d,d,c)}}const r=new(VS(e)?XS:jS)(e,1);return r.version=R3(i),r}class Q$ extends pl{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,n=this.get(t);n.initialized=!0,this.info.memory.geometries++;const r=()=>{this.info.memory.geometries--;const s=t.index,o=e.getAttributes();s!==null&&this.attributes.delete(s);for(const c of o)this.attributes.delete(c);const u=this.wireframes.get(t);u!==void 0&&this.attributes.delete(u),t.removeEventListener("dispose",r),this._geometryDisposeListeners.delete(t)};t.addEventListener("dispose",r),this._geometryDisposeListeners.set(t,r)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,ys.STORAGE):this.updateAttribute(s,ys.VERTEX);const n=this.getIndex(e);n!==null&&this.updateAttribute(n,ys.INDEX);const r=e.geometry.indirect;r!==null&&this.updateAttribute(r,ys.INDIRECT)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndirectOffset(e){return e.geometry.indirectOffset}getIndex(e){const{geometry:t,material:n}=e;let r=t.index;if(n.wireframe===!0){const s=this.wireframes;let o=s.get(t);o===void 0?(o=DC(t),s.set(t,o)):o.version!==R3(t)&&(this.attributes.delete(o),o=DC(t),s.set(t,o)),r=o}return r}dispose(){for(const[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener("dispose",t);this._geometryDisposeListeners.clear()}}class Z${constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):Re("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class C3{constructor(e){this.cacheKey=e,this.usedTimes=0}}class J$ extends C3{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}}class e7 extends C3{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let t7=0;class kx{constructor(e,t,n,r=null,s=null){this.id=t7++,this.code=e,this.stage=t,this.name=n,this.transforms=r,this.attributes=s,this.usedTimes=0}}class n7 extends pl{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,r=this.get(e);if(this._needsComputeUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let u=this.programs.compute.get(o.computeShader);u===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),u=new kx(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,u),n.createProgram(u));const c=this._getComputeCacheKey(e,u);let h=this.caches.get(c);h===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),h=this._getComputePipeline(e,u,c,t)),h.usedTimes++,u.usedTimes++,r.version=e.version,r.pipeline=h}return r.pipeline}getForRender(e,t=null){const{backend:n}=this,r=this.get(e);if(this._needsRenderUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),u=e.material?e.material.name:"";let c=this.programs.vertex.get(o.vertexShader);c===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),c=new kx(o.vertexShader,"vertex",u),this.programs.vertex.set(o.vertexShader,c),n.createProgram(c));let h=this.programs.fragment.get(o.fragmentShader);h===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),h=new kx(o.fragmentShader,"fragment",u),this.programs.fragment.set(o.fragmentShader,h),n.createProgram(h));const d=this._getRenderCacheKey(e,c,h);let p=this.caches.get(d);p===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),p=this._getRenderPipeline(e,c,h,d,t)):e.pipeline=p,p.usedTimes++,c.usedTimes++,h.usedTimes++,r.pipeline=p}return r.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,r){n=n||this._getComputeCacheKey(e,t);let s=this.caches.get(n);return s===void 0&&(s=new e7(n,t),this.caches.set(n,s),this.backend.createComputePipeline(s,r)),s}_getRenderPipeline(e,t,n,r,s){r=r||this._getRenderCacheKey(e,t,n);let o=this.caches.get(r);return o===void 0&&(o=new J$(r,t,n),this.caches.set(r,o),e.pipeline=o,this.backend.createRenderPipeline(e,s)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class i7 extends pl{constructor(e,t,n,r,s,o){super(),this.backend=e,this.textures=n,this.pipelines=s,this.attributes=r,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const n of t){const r=this.get(n);r.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),r.bindGroup=n)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t){const r=this.get(n);r.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),r.bindGroup=n)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t)this.backend.deleteBindGroupData(n),this.delete(n)}deleteForRender(e){const t=e.getBindings();for(const n of t)this.backend.deleteBindGroupData(n),this.delete(n)}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){const n=t.attribute,r=n.isIndirectStorageBufferAttribute?ys.INDIRECT:ys.STORAGE;this.attributes.update(n,r)}}_update(e,t){const{backend:n}=this;let r=!1,s=!0,o=0,u=0;for(const c of e.bindings)if(this.nodes.updateGroup(c)!==!1){if(c.isStorageBuffer){const d=c.attribute,p=d.isIndirectStorageBufferAttribute?ys.INDIRECT:ys.STORAGE;this.attributes.update(d,p)}if(c.isUniformBuffer)c.update()&&n.updateBinding(c);else if(c.isSampledTexture){const d=c.update(),p=c.texture,g=this.textures.get(p);if(d&&(this.textures.updateTexture(p),c.generation!==g.generation&&(c.generation=g.generation,r=!0,s=!1)),n.get(p).externalTexture!==void 0||g.isDefaultTexture?s=!1:(o=o*10+p.id,u+=p.version),p.isStorageTexture===!0&&p.mipmapsAutoUpdate===!0){const v=this.get(p);c.store===!0?v.needsMipmap=!0:this.textures.needsMipmaps(p)&&v.needsMipmap===!0&&(this.backend.generateMipmaps(p),v.needsMipmap=!1)}}else if(c.isSampler&&c.update()){const p=this.textures.updateSampler(c.texture);c.samplerKey!==p&&(c.samplerKey=p,r=!0,s=!1)}}r===!0&&this.backend.updateBindings(e,t,s?o:0,u)}}function r7(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?i.z-e.z:i.id-e.id}function LC(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function PC(i){return(i.transmission>0||i.transmissionNode&&i.transmissionNode.isNode)&&i.side===rr&&i.forceSinglePass===!1}class s7{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,r,s,o,u){let c=this.renderItems[this.renderItemsIndex];return c===void 0?(c={id:e.id,object:e,geometry:t,material:n,groupOrder:r,renderOrder:e.renderOrder,z:s,group:o,clippingContext:u},this.renderItems[this.renderItemsIndex]=c):(c.id=e.id,c.object=e,c.geometry=t,c.material=n,c.groupOrder=r,c.renderOrder=e.renderOrder,c.z=s,c.group=o,c.clippingContext=u),this.renderItemsIndex++,c}push(e,t,n,r,s,o,u){const c=this.getNextRenderItem(e,t,n,r,s,o,u);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(PC(n)&&this.transparentDoublePass.push(c),this.transparent.push(c)):this.opaque.push(c)}unshift(e,t,n,r,s,o,u){const c=this.getNextRenderItem(e,t,n,r,s,o,u);n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(PC(n)&&this.transparentDoublePass.unshift(c),this.transparent.unshift(c)):this.opaque.unshift(c)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||r7),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||LC),this.transparent.length>1&&this.transparent.sort(t||LC)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const n=this.renderItems[e];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null,n.clippingContext=null}}}const _d=[];class a7{constructor(e){this.lighting=e,this.lists=new Ws}get(e,t){const n=this.lists;_d[0]=e,_d[1]=t;let r=n.get(_d);return r===void 0&&(r=new s7(this.lighting,e,t),n.set(_d,r)),_d.length=0,r}dispose(){this.lists=new Ws}}let o7=0;class l7{constructor(){this.id=o7++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new Lt,this.scissor=!1,this.scissorValue=new Lt,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return N3(this)}}function N3(i){const{textures:e,activeCubeFace:t,activeMipmapLevel:n}=i,r=[t,n];for(const s of e)r.push(s.id);return Up(r)}const Bc=[],u7=new W_,c7=new YS;class h7{constructor(){this.chainMaps={}}get(e,t,n=null,r=null){Bc[0]=e,Bc[1]=t,r!==null&&(Bc[2]=r);let s;if(n===null)s="default";else{const c=n.texture.format;s=`${n.textures.length}:${c}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const o=this._getChainMap(s);let u=o.get(Bc);return u===void 0&&(u=new l7,o.set(Bc,u)),Bc.length=0,n!==null&&(u.sampleCount=n.samples===0?1:n.samples),u}getForClear(e=null){return this.get(u7,c7,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Ws)}dispose(){this.chainMaps={}}}const f7=new k;class d7 extends pl{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e,t=0){const n=this.get(e),r=e.samples===0?1:e.samples,s=n.depthTextureMips||(n.depthTextureMips={}),o=e.textures,u=this.getSize(o[0]),c=u.width>>t,h=u.height>>t;let d=e.depthTexture||s[t];const p=e.depthBuffer===!0||e.stencilBuffer===!0;let g=!1;d===void 0&&p&&(d=new vr,d.format=e.stencilBuffer?pr:ji,d.type=e.stencilBuffer?ts:yn,d.image.width=c,d.image.height=h,d.image.depth=u.depth,d.renderTarget=e,d.isArrayTexture=e.multiview===!0&&u.depth>1,s[t]=d),(n.width!==u.width||u.height!==n.height)&&(g=!0,d&&(d.needsUpdate=!0,d.image.width=c,d.image.height=h,d.image.depth=d.isArrayTexture?d.image.depth:1)),n.width=u.width,n.height=u.height,n.textures=o,n.depthTexture=d||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==r&&(g=!0,d&&(d.needsUpdate=!0),n.sampleCount=r);const _={sampleCount:r};if(e.isXRRenderTarget!==!0){for(let v=0;v<o.length;v++){const T=o[v];g&&(T.needsUpdate=!0),this.updateTexture(T,_)}d&&this.updateTexture(d,_)}n.initialized!==!0&&(n.initialized=!0,n.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener("dispose",n.onDispose))}updateTexture(e,t={}){const n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;const r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(r&&n.initialized===!0&&s.destroyTexture(e),e.isFramebufferTexture){const h=this.renderer.getRenderTarget();h?e.type=h.texture.type:e.type=Hn}const{width:o,height:u,depth:c}=this.getSize(e);if(t.width=o,t.height=u,t.depth=c,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,u):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,r||e.isStorageTexture===!0||e.isExternalTexture===!0)s.createTexture(e,t),n.generation=e.version;else if(e.version>0){const h=e.image;if(h===void 0)Ae("Renderer: Texture marked for update but image is undefined.");else if(h.complete===!1)Ae("Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const p=[];for(const g of e.images)p.push(g);t.images=p}else t.image=h;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(s.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t);const d=e.isStorageTexture===!0&&e.mipmapsAutoUpdate===!1;t.needsMipmaps&&e.mipmaps.length===0&&!d&&s.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else s.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;n.initialized!==!0&&(n.initialized=!0,n.generation=e.version,this.info.memory.textures++,e.isVideoTexture&&vt.enabled===!0&&vt.getTransfer(e.colorSpace)!==Ye&&Ae("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),n.onDispose=()=>{this._destroyTexture(e)},e.addEventListener("dispose",n.onDispose)),n.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=f7){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?(t.width=n.videoWidth||1,t.height=n.videoHeight||1,t.depth=1):typeof VideoFrame<"u"&&n instanceof VideoFrame?(t.width=n.displayWidth||1,t.height=n.displayHeight||1,t.depth=1):(t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let r;return e.mipmaps.length>0?r=e.mipmaps.length:e.isCompressedTexture===!0?r=1:r=Math.floor(Math.log2(Math.max(t,n)))+1,r}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyRenderTarget(e){if(this.has(e)===!0){const t=this.get(e),n=t.textures,r=t.depthTexture;e.removeEventListener("dispose",t.onDispose);for(let s=0;s<n.length;s++)this._destroyTexture(n[s]);r&&this._destroyTexture(r),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(this.has(e)===!0){const t=this.get(e);e.removeEventListener("dispose",t.onDispose);const n=t.isDefaultTexture;this.backend.destroyTexture(e,n),this.delete(e),this.info.memory.textures--}}}class OT extends dt{constructor(e,t,n,r=1){super(e,t,n),this.a=r}set(e,t,n,r=1){return this.a=r,super.set(e,t,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class p7 extends ln{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){const n=this.getNodeType(e),r=e.getStructTypeNode(n);let s;return r!==null?s=r.getMemberType(e,t):(Re(`TSL: Member "${t}" not found in struct "${n}".`),s="float"),s}getHash(){return this.uuid}generate(){return this.name}}class m7 extends ct{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this._currentNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput?this.outputNode.getElementType(e):"void"}getNodeType(e){return this.hasOutput?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput?this.outputNode.getMemberType(e,t):"void"}addToStack(e,t=this.nodes.length){return e.isNode!==!0?(Re("TSL: Invalid node added to stack."),this):(this.nodes.splice(t,0,e),this)}addToStackBefore(e){const t=this._currentNode?this.nodes.indexOf(this._currentNode):0;return this.addToStack(e,t)}If(e,t){const n=new Ld(t);return this._currentCond=Lr(e,n),this.addToStack(this._currentCond)}ElseIf(e,t){const n=new Ld(t),r=Lr(e,n);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new Ld(e),this}Switch(e){return this._expressionNode=Ze(e),this}Case(...e){const t=[];if(e.length>=2)for(let u=0;u<e.length-1;u++)t.push(this._expressionNode.equal(Ze(e[u])));else Re("TSL: Invalid parameter length. Case() requires at least two parameters.");const n=e[e.length-1],r=new Ld(n);let s=t[0];for(let u=1;u<t.length;u++)s=s.or(t[u]);const o=Lr(s,r);return this._currentCond===null?(this._currentCond=o,this.addToStack(this._currentCond)):(this._currentCond.elseNode=o,this._currentCond=o,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const r of this.getChildren())r.isVarNode&&r.isIntent(e)&&r.isAssign(e)!==!0||(t["node"+n++]=r);return t.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(e,...t){const n=iD(),r=e.buildStage;w_(this),e.setActiveStack(this);const s=h=>{if(this._currentNode=h,!(h.isVarNode&&h.isIntent(e)&&h.isAssign(e)!==!0)){if(r==="setup")h.build(e);else if(r==="analyze")h.build(e,this);else if(r==="generate"){const d=e.getDataFromNode(h,"any").stages,p=d&&d[e.shaderStage];if(h.isVarNode&&p&&p.length===1&&p[0]&&p[0].isStackNode)return;h.build(e,"void")}}},o=[...this.nodes];for(const h of o)s(h);this._currentNode=null;const u=this.nodes.filter(h=>o.indexOf(h)===-1);for(const h of u)s(h);let c;return this.hasOutput?c=this.outputNode.build(e,...t):c=super.build(e,...t),w_(n),e.removeActiveStack(this),c}}const Vx=sn(m7).setParameterLength(0,1);class D3 extends xi{static get type(){return"BitcastNode"}constructor(e,t,n=null){super(),this.valueNode=e,this.conversionType=t,this.inputType=n,this.isBitcastNode=!0}getNodeType(e){if(this.inputType!==null){const t=this.valueNode.getNodeType(e),n=e.getTypeLength(t);return e.getTypeFromLength(n,this.conversionType)}return this.conversionType}generate(e){const t=this.getNodeType(e);let n="";if(this.inputType!==null){const r=this.valueNode.getNodeType(e);n=e.getTypeLength(r)===1?this.inputType:e.changeComponentType(r,this.inputType)}else n=this.valueNode.getNodeType(e);return`${e.getBitcastMethod(t,n)}( ${this.valueNode.build(e,n)} )`}}const g7=et(D3).setParameterLength(2),_7=i=>new D3(i,"uint","float"),Vg={};class lu extends oe{static get type(){return"BitcountNode"}constructor(e,t){super(e,t),this.isBitcountNode=!0}_resolveElementType(e,t,n){n==="int"?t.assign(g7(e,"uint")):t.assign(e)}_returnDataNode(e){switch(e){case"uint":return Wt;case"int":return In;case"uvec2":return sD;case"uvec3":return oD;case"uvec4":return uD;case"ivec2":return aa;case"ivec3":return aD;case"ivec4":return lD}}_createTrailingZerosBaseLayout(e,t){const n=this._returnDataNode(t);return Te(([s])=>{const o=Wt(0);this._resolveElementType(s,o,t);const u=ge(o.bitAnd(TD(o))),h=_7(u).shiftRight(23).sub(127);return n(h)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createLeadingZerosBaseLayout(e,t){const n=this._returnDataNode(t);return Te(([s])=>{wn(s.equal(Wt(0)),()=>Wt(32));const o=Wt(0),u=Wt(0);return this._resolveElementType(s,o,t),wn(o.shiftRight(16).equal(0),()=>{u.addAssign(16),o.shiftLeftAssign(16)}),wn(o.shiftRight(24).equal(0),()=>{u.addAssign(8),o.shiftLeftAssign(8)}),wn(o.shiftRight(28).equal(0),()=>{u.addAssign(4),o.shiftLeftAssign(4)}),wn(o.shiftRight(30).equal(0),()=>{u.addAssign(2),o.shiftLeftAssign(2)}),wn(o.shiftRight(31).equal(0),()=>{u.addAssign(1)}),n(u)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createOneBitsBaseLayout(e,t){const n=this._returnDataNode(t);return Te(([s])=>{const o=Wt(0);this._resolveElementType(s,o,t),o.assign(o.sub(o.shiftRight(Wt(1)).bitAnd(Wt(1431655765)))),o.assign(o.bitAnd(Wt(858993459)).add(o.shiftRight(Wt(2)).bitAnd(Wt(858993459))));const u=o.add(o.shiftRight(Wt(4))).bitAnd(Wt(252645135)).mul(Wt(16843009)).shiftRight(Wt(24));return n(u)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createMainLayout(e,t,n,r){const s=this._returnDataNode(t);return Te(([u])=>{if(n===1)return s(r(u));{const c=s(0),h=["x","y","z","w"];for(let d=0;d<n;d++){const p=h[d];c[p].assign(r(u[p]))}return c}}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}setup(e){const{method:t,aNode:n}=this,{renderer:r}=e;if(r.backend.isWebGPUBackend)return super.setup(e);const s=this.getInputType(e),o=e.getElementType(s),u=e.getTypeLength(s),c=`${t}_base_${o}`,h=`${t}_${s}`;let d=Vg[c];if(d===void 0){switch(t){case lu.COUNT_LEADING_ZEROS:{d=this._createLeadingZerosBaseLayout(c,o);break}case lu.COUNT_TRAILING_ZEROS:{d=this._createTrailingZerosBaseLayout(c,o);break}case lu.COUNT_ONE_BITS:{d=this._createOneBitsBaseLayout(c,o);break}}Vg[c]=d}let p=Vg[h];return p===void 0&&(p=this._createMainLayout(h,s,u,d),Vg[h]=p),Te(()=>p(n))()}}lu.COUNT_TRAILING_ZEROS="countTrailingZeros";lu.COUNT_LEADING_ZEROS="countLeadingZeros";lu.COUNT_ONE_BITS="countOneBits";new Bs;new k;new k;new k;new Ht;new k(0,0,-1);new Lt;new k;new k;new Lt;new Ue;const v7=new Mu;Jc.flipX();v7.depthTexture=new vr(1,1);const Hx=new Wh(-1,1,1,-1,0,1);class y7 extends wi{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new ti([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ti(t,2))}}const x7=new y7;class BT extends yi{constructor(e=null){super(x7,e),this.camera=Hx,this.isQuadMesh=!0}async renderAsync(e){Vn('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await e.init(),e.render(this,Hx)}render(e){e.render(this,Hx)}}const L3=Te(([i])=>_a(ge(52.9829189).mul(_a(xu(i,nt(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]}),ua=Te(([i,e,t])=>{const n=ge(2.399963229728653),r=ao(ge(i).add(.5).div(ge(e))),s=ge(i).mul(n).add(t);return nt(oa(s),Qr(s)).mul(r)}).setLayout({name:"vogelDiskSample",type:"vec2",inputs:[{name:"sampleIndex",type:"int"},{name:"samplesCount",type:"int"},{name:"phi",type:"float"}]});class oo extends ct{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===oo.OBJECT?this.updateType=Ot.OBJECT:e===oo.MATERIAL?this.updateType=Ot.RENDER:e===oo.BEFORE_OBJECT?this.updateBeforeType=Ot.OBJECT:e===oo.BEFORE_MATERIAL&&(this.updateBeforeType=Ot.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}}oo.OBJECT="object";oo.MATERIAL="material";oo.BEFORE_OBJECT="beforeObject";oo.BEFORE_MATERIAL="beforeMaterial";const vd=new Or,Wx=new Ht;class Ur extends ct{static get type(){return"SceneNode"}constructor(e=Ur.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,n=this.scene!==null?this.scene:e.scene;let r;return t===Ur.BACKGROUND_BLURRINESS?r=En("backgroundBlurriness","float",n):t===Ur.BACKGROUND_INTENSITY?r=En("backgroundIntensity","float",n):t===Ur.BACKGROUND_ROTATION?r=bt("mat4").setName("backgroundRotation").setGroup(yt).onRenderUpdate(()=>{const s=n.background;return s!==null&&s.isTexture&&s.mapping!==US?(vd.copy(n.backgroundRotation),vd.x*=-1,vd.y*=-1,vd.z*=-1,Wx.makeRotationFromEuler(vd)):Wx.identity(),Wx}):Re("SceneNode: Unknown scope:",t),r}}Ur.BACKGROUND_BLURRINESS="backgroundBlurriness";Ur.BACKGROUND_INTENSITY="backgroundIntensity";Ur.BACKGROUND_ROTATION="backgroundRotation";const b7=Ge(Ur,Ur.BACKGROUND_BLURRINESS),UC=Ge(Ur,Ur.BACKGROUND_INTENSITY),S7=Ge(Ur,Ur.BACKGROUND_ROTATION),T7=Te(({texture:i,uv:e})=>{const n=ve().toVar();return wn(e.x.lessThan(1e-4),()=>{n.assign(ve(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{n.assign(ve(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{n.assign(ve(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{n.assign(ve(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{n.assign(ve(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{n.assign(ve(0,0,-1))}).Else(()=>{const s=i.sample(e.add(ve(-.01,0,0))).r.sub(i.sample(e.add(ve(.01,0,0))).r),o=i.sample(e.add(ve(0,-.01,0))).r.sub(i.sample(e.add(ve(0,.01,0))).r),u=i.sample(e.add(ve(0,0,-.01))).r.sub(i.sample(e.add(ve(0,0,.01))).r);n.assign(ve(s,o,u))}),n.normalize()});class M7 extends Kh{static get type(){return"Texture3DNode"}constructor(e,t=null,n=null){super(e,t,n),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return ve(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(In(ou(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return T7({texture:this,uv:e})}}const E7=sn(M7).setParameterLength(1,3),Hg=new Ue;class A7 extends Kh{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class OC extends A7{static get type(){return"PassMultipleTextureNode"}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}class u0 extends xi{static get type(){return"PassNode"}constructor(e,t,n,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const s=new vr;s.isRenderTargetTexture=!0,s.name="depth";const o=new Mu(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Zn,...r});o.texture.name="output",o.depthTexture=s,this.renderTarget=o,this.overrideMaterial=null,this.transparent=!0,this.opaque=!0,this.contextNode=null,this._contextNodeCache=null,this._textures={output:o.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=bt(0),this._cameraFar=bt(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=Ot.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return Ae("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return Ae("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const n=this._textures[e],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=new OC(this,e),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=new OC(this,e,!0),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const n=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=l3(this.getTextureNode(e),n,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const n=this._cameraNear,r=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=Kd(s,n,r)}return t}async compileAsync(e){const t=e.getRenderTarget(),n=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(n)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getOutputBufferType(),this.scope===u0.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let r,s;const o=t.getOutputRenderTarget();o&&o.isXRRenderTarget===!0?(s=1,r=t.xr.getCamera(),t.xr.updateCamera(r),Hg.set(o.width,o.height)):(r=this.camera,s=t.getPixelRatio(),t.getSize(Hg)),this._pixelRatio=s,this.setSize(Hg.width,Hg.height);const u=t.getRenderTarget(),c=t.getMRT(),h=t.autoClear,d=t.transparent,p=t.opaque,g=r.layers.mask,_=t.contextNode,v=n.overrideMaterial;this._cameraNear.value=r.near,this._cameraFar.value=r.far,this._layers!==null&&(r.layers.mask=this._layers.mask);for(const b in this._previousTextures)this.toggleTexture(b);this.overrideMaterial!==null&&(n.overrideMaterial=this.overrideMaterial),t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0,t.transparent=this.transparent,t.opaque=this.opaque,this.contextNode!==null&&((this._contextNodeCache===null||this._contextNodeCache.version!==this.version)&&(this._contextNodeCache={version:this.version,context:Ru({...t.contextNode.getFlowContextData(),...this.contextNode.getFlowContextData()})}),t.contextNode=this._contextNodeCache.context);const T=n.name;n.name=this.name?this.name:n.name,t.render(n,r),n.name=T,n.overrideMaterial=v,t.setRenderTarget(u),t.setMRT(c),t.autoClear=h,t.transparent=d,t.opaque=p,t.contextNode=_,r.layers.mask=g}setSize(e,t){this._width=e,this._height=t;const n=Math.floor(this._width*this._pixelRatio*this._resolutionScale),r=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(n,r),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,n,r){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new Lt),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,n,r),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,n,r){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new Lt),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,n,r),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}u0.COLOR="color";u0.DEPTH="depth";const w7=Te(([i,e])=>i.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),R7=Te(([i,e])=>(i=i.mul(e),i.div(i.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),C7=Te(([i,e])=>{i=i.mul(e),i=i.sub(.004).max(0);const t=i.mul(i.mul(6.2).add(.5)),n=i.mul(i.mul(6.2).add(1.7)).add(.06);return t.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),N7=Te(([i])=>{const e=i.mul(i.add(.0245786)).sub(90537e-9),t=i.mul(i.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),D7=Te(([i,e])=>{const t=or(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=or(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return i=i.mul(e).div(.6),i=t.mul(i),i=N7(i),i=n.mul(i),i.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),L7=or(ve(1.6605,-.1246,-.0182),ve(-.5876,1.1329,-.1006),ve(-.0728,-.0083,1.1187)),P7=or(ve(.6274,.0691,.0164),ve(.3293,.9195,.088),ve(.0433,.0113,.8956)),U7=Te(([i])=>{const e=ve(i).toVar(),t=ve(e.mul(e)).toVar(),n=ve(t.mul(t)).toVar();return ge(15.5).mul(n.mul(t)).sub(Bt(40.14,n.mul(e))).add(Bt(31.96,n).sub(Bt(6.868,t.mul(e))).add(Bt(.4298,t).add(Bt(.1191,e).sub(.00232))))}),O7=Te(([i,e])=>{const t=ve(i).toVar(),n=or(ve(.856627153315983,.137318972929847,.11189821299995),ve(.0951212405381588,.761241990602591,.0767994186031903),ve(.0482516061458583,.101439036467562,.811302368396859)),r=or(ve(1.1271005818144368,-.1413297634984383,-.14132976349843826),ve(-.11060664309660323,1.157823702216272,-.11060664309660294),ve(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=ge(-12.47393),o=ge(4.026069);return t.mulAssign(e),t.assign(P7.mul(t)),t.assign(n.mul(t)),t.assign(Yi(t,1e-10)),t.assign(ho(t)),t.assign(t.sub(s).div(o.sub(s))),t.assign(fl(t,0,1)),t.assign(U7(t)),t.assign(r.mul(t)),t.assign(i0(Yi(ve(0),t),ve(2.2))),t.assign(L7.mul(t)),t.assign(fl(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),B7=Te(([i,e])=>{const t=ge(.76),n=ge(.15);i=i.mul(e);const r=Uh(i.r,Uh(i.g,i.b)),s=Lr(r.lessThan(.08),r.sub(Bt(6.25,r.mul(r))),.04);i.subAssign(s);const o=Yi(i.r,Yi(i.g,i.b));wn(o.lessThan(t),()=>i);const u=wr(1,t),c=wr(1,u.mul(u).div(o.add(u.sub(t))));i.mulAssign(c.div(o));const h=wr(1,ga(1,n.mul(o.sub(c)).add(1)));return An(i,ve(c),h)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Wi extends ct{static get type(){return"CodeNode"}constructor(e="",t=[],n=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=n}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const r of t)r.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class F7 extends Wi{static get type(){return"FunctionNode"}constructor(e="",t=[],n=""){super(e,t,n)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),r=n.name,s=n.type,o=e.getCodeFromNode(this,s);r!==""&&(o.name=r);const u=e.getPropertyName(o),c=this.getNodeFunction(e).getCode(u);return o.code=c+`
`,t==="property"?u:e.format(`${u}()`,s,t)}}function P3(i){let e;const t=i.context.getViewZ;return t!==void 0&&(e=t(this)),(e||li.z).negate()}const I7=Te(([i,e],t)=>{const n=P3(t);return po(i,e,n)}),z7=Te(([i],e)=>{const t=P3(e);return i.mul(i,t,t).negate().exp().oneMinus()}),BC=Te(([i,e])=>Dt(e.toFloat().mix(qd.rgb,i.toVec3()),qd.a));class G7 extends ct{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}sn(G7);class Sa extends ct{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),n=t.parents,r=this.method,s=this.getNodeType(e),o=this.getInputType(e),u=this.pointerNode,c=this.valueNode,h=[];h.push(`&${u.build(e,o)}`),c!==null&&h.push(c.build(e,o));const d=`${e.getMethod(r,s)}( ${h.join(", ")} )`;if(n?n.length===1&&n[0].isStackNode===!0:!1)e.addLineFlowCode(d,this);else return t.constNode===void 0&&(t.constNode=Oh(d,s).toConst()),t.constNode.build(e)}}Sa.ATOMIC_LOAD="atomicLoad";Sa.ATOMIC_STORE="atomicStore";Sa.ATOMIC_ADD="atomicAdd";Sa.ATOMIC_SUB="atomicSub";Sa.ATOMIC_MAX="atomicMax";Sa.ATOMIC_MIN="atomicMin";Sa.ATOMIC_AND="atomicAnd";Sa.ATOMIC_OR="atomicOr";Sa.ATOMIC_XOR="atomicXor";sn(Sa);class tn extends xi{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,n=null){super(),this.method=e,this.aNode=t,this.bNode=n}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,n=this.bNode?this.bNode.getNodeType(e):null,r=e.isMatrix(t)?0:e.getTypeLength(t),s=e.isMatrix(n)?0:e.getTypeLength(n);return r>s?t:n}getNodeType(e){const t=this.method;return t===tn.SUBGROUP_ELECT?"bool":t===tn.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const n=this.method,r=this.getNodeType(e),s=this.getInputType(e),o=this.aNode,u=this.bNode,c=[];if(n===tn.SUBGROUP_BROADCAST||n===tn.SUBGROUP_SHUFFLE||n===tn.QUAD_BROADCAST){const d=u.getNodeType(e);c.push(o.build(e,r),u.build(e,d==="float"?"int":r))}else n===tn.SUBGROUP_SHUFFLE_XOR||n===tn.SUBGROUP_SHUFFLE_DOWN||n===tn.SUBGROUP_SHUFFLE_UP?c.push(o.build(e,r),u.build(e,"uint")):(o!==null&&c.push(o.build(e,s)),u!==null&&c.push(u.build(e,s)));const h=c.length===0?"()":`( ${c.join(", ")} )`;return e.format(`${e.getMethod(n,r)}${h}`,r,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}tn.SUBGROUP_ELECT="subgroupElect";tn.SUBGROUP_BALLOT="subgroupBallot";tn.SUBGROUP_ADD="subgroupAdd";tn.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";tn.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";tn.SUBGROUP_MUL="subgroupMul";tn.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";tn.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";tn.SUBGROUP_AND="subgroupAnd";tn.SUBGROUP_OR="subgroupOr";tn.SUBGROUP_XOR="subgroupXor";tn.SUBGROUP_MIN="subgroupMin";tn.SUBGROUP_MAX="subgroupMax";tn.SUBGROUP_ALL="subgroupAll";tn.SUBGROUP_ANY="subgroupAny";tn.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";tn.QUAD_SWAP_X="quadSwapX";tn.QUAD_SWAP_Y="quadSwapY";tn.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";tn.SUBGROUP_BROADCAST="subgroupBroadcast";tn.SUBGROUP_SHUFFLE="subgroupShuffle";tn.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";tn.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";tn.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";tn.QUAD_BROADCAST="quadBroadcast";let Wg;function c0(i){Wg=Wg||new WeakMap;let e=Wg.get(i);return e===void 0&&Wg.set(i,e={}),e}function FT(i){const e=c0(i);return e.shadowMatrix||(e.shadowMatrix=bt("mat4").setGroup(yt).onRenderUpdate(t=>((i.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&(i.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(i.shadow.camera.coordinateSystem=t.camera.coordinateSystem,i.shadow.camera.updateProjectionMatrix()),i.shadow.updateMatrices(i)),i.shadow.matrix)))}function k7(i,e=Bh){const t=FT(i).mul(e);return t.xyz.div(t.w)}function U3(i){const e=c0(i);return e.position||(e.position=bt(new k).setGroup(yt).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(i.matrixWorld)))}function V7(i){const e=c0(i);return e.targetPosition||(e.targetPosition=bt(new k).setGroup(yt).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(i.target.matrixWorld)))}function O3(i){const e=c0(i);return e.viewPosition||(e.viewPosition=bt(new k).setGroup(yt).onRenderUpdate(({camera:t},n)=>{n.value=n.value||new k,n.value.setFromMatrixPosition(i.matrixWorld),n.value.applyMatrix4(t.matrixWorldInverse)}))}const B3=i=>_o.transformDirection(U3(i).sub(V7(i))),H7=i=>i.sort((e,t)=>e.id-t.id),W7=(i,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===i)return t;return null},qx=new WeakMap,yd=[];class F3 extends ct{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=cl("vec3","totalDiffuse"),this.totalSpecularNode=cl("vec3","totalSpecular"),this.outgoingLightNode=cl("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let n=0;n<e.length;n++){const r=e[n];if(yd.push(r.id),yd.push(r.castShadow?1:0),r.isSpotLight===!0){const s=r.map!==null?r.map.id:-1,o=r.colorNode?r.colorNode.getCacheKey():-1;yd.push(s,o)}}const t=Up(yd);return yd.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const n of this._lightNodes)t.push(n.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const n of t.nodes)n.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,r=H7(this._lights),s=e.renderer.library;for(const o of r)if(o.isNode)t.push(Ze(o));else{let u=null;if(n!==null&&(u=W7(o.id,n)),u===null){const c=s.getLightNodeClass(o.constructor);if(c===null){Ae(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let h=null;qx.has(o)?h=qx.get(o):(h=new c(o),qx.set(o,h)),t.push(h)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:r,reflectedLight:s}=e.context;r.direct({...n,lightNode:t,reflectedLight:s},e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:r,reflectedLight:s}=e.context;r.directRectArea({...n,lightNode:t,reflectedLight:s},e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const r=e.context,s=r.lightingModel,o=e.getNodeProperties(this);if(s){const{totalDiffuseNode:u,totalSpecularNode:c}=this;r.outgoingLight=n;const h=e.addStack();o.nodes=h.nodes,s.start(e);const{backdrop:d,backdropAlpha:p}=r,{directDiffuse:g,directSpecular:_,indirectDiffuse:v,indirectSpecular:T}=r.reflectedLight;let b=g.add(v);d!==null&&(p!==null?b=ve(p.mix(b,d)):b=ve(d)),u.assign(b),c.assign(_.add(T)),n.assign(u.add(c)),s.finish(e),n=n.bypass(e.removeStack())}else o.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class q7 extends ct{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=Ot.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){I3.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||Bh)}}const I3=cl("vec3","shadowPositionWorld");function $7(i,e={}){return e.toneMapping=i.toneMapping,e.toneMappingExposure=i.toneMappingExposure,e.outputColorSpace=i.outputColorSpace,e.renderTarget=i.getRenderTarget(),e.activeCubeFace=i.getActiveCubeFace(),e.activeMipmapLevel=i.getActiveMipmapLevel(),e.renderObjectFunction=i.getRenderObjectFunction(),e.pixelRatio=i.getPixelRatio(),e.mrt=i.getMRT(),e.clearColor=i.getClearColor(e.clearColor||new dt),e.clearAlpha=i.getClearAlpha(),e.autoClear=i.autoClear,e.scissorTest=i.getScissorTest(),e}function j7(i,e){return e=$7(i,e),i.setMRT(null),i.setRenderObjectFunction(null),i.setClearColor(0,1),i.autoClear=!0,e}function X7(i,e){i.toneMapping=e.toneMapping,i.toneMappingExposure=e.toneMappingExposure,i.outputColorSpace=e.outputColorSpace,i.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),i.setRenderObjectFunction(e.renderObjectFunction),i.setPixelRatio(e.pixelRatio),i.setMRT(e.mrt),i.setClearColor(e.clearColor,e.clearAlpha),i.autoClear=e.autoClear,i.setScissorTest(e.scissorTest)}function Y7(i,e={}){return e.background=i.background,e.backgroundNode=i.backgroundNode,e.overrideMaterial=i.overrideMaterial,e}function K7(i,e){return e=Y7(i,e),i.background=null,i.backgroundNode=null,i.overrideMaterial=null,e}function Q7(i,e){i.background=e.background,i.backgroundNode=e.backgroundNode,i.overrideMaterial=e.overrideMaterial}function Z7(i,e,t){return t=j7(i,t),t=K7(e,t),t}function J7(i,e,t){X7(i,t),Q7(e,t)}const L_=new WeakMap,ej=Te(({depthTexture:i,shadowCoord:e,depthLayer:t})=>{let n=zn(i,e.xy).setName("t_basic");return i.isArrayTexture&&(n=n.depth(t)),n.compare(e.z)}),tj=Te(({depthTexture:i,shadowCoord:e,shadow:t,depthLayer:n})=>{const r=(d,p)=>{let g=zn(i,d);return i.isArrayTexture&&(g=g.depth(n)),g.compare(p)},s=En("mapSize","vec2",t).setGroup(yt),o=En("radius","float",t).setGroup(yt),u=nt(1).div(s),c=o.mul(u.x),h=L3(Qh.xy).mul(6.28318530718);return Br(r(e.xy.add(ua(0,5,h).mul(c)),e.z),r(e.xy.add(ua(1,5,h).mul(c)),e.z),r(e.xy.add(ua(2,5,h).mul(c)),e.z),r(e.xy.add(ua(3,5,h).mul(c)),e.z),r(e.xy.add(ua(4,5,h).mul(c)),e.z)).mul(1/5)}),nj=Te(({depthTexture:i,shadowCoord:e,shadow:t,depthLayer:n})=>{const r=(p,g)=>{let _=zn(i,p);return i.isArrayTexture&&(_=_.depth(n)),_.compare(g)},s=En("mapSize","vec2",t).setGroup(yt),o=nt(1).div(s),u=o.x,c=o.y,h=e.xy,d=_a(h.mul(s).add(.5));return h.subAssign(d.mul(o)),Br(r(h,e.z),r(h.add(nt(u,0)),e.z),r(h.add(nt(0,c)),e.z),r(h.add(o),e.z),An(r(h.add(nt(u.negate(),0)),e.z),r(h.add(nt(u.mul(2),0)),e.z),d.x),An(r(h.add(nt(u.negate(),c)),e.z),r(h.add(nt(u.mul(2),c)),e.z),d.x),An(r(h.add(nt(0,c.negate())),e.z),r(h.add(nt(0,c.mul(2))),e.z),d.y),An(r(h.add(nt(u,c.negate())),e.z),r(h.add(nt(u,c.mul(2))),e.z),d.y),An(An(r(h.add(nt(u.negate(),c.negate())),e.z),r(h.add(nt(u.mul(2),c.negate())),e.z),d.x),An(r(h.add(nt(u.negate(),c.mul(2))),e.z),r(h.add(nt(u.mul(2),c.mul(2))),e.z),d.x),d.y)).mul(1/9)}),ij=Te(({depthTexture:i,shadowCoord:e,depthLayer:t})=>{let n=zn(i).sample(e.xy);i.isArrayTexture&&(n=n.depth(t)),n=n.rg;const r=n.x,s=Yi(1e-7,n.y.mul(n.y)),o=wD(e.z,r);wn(o.equal(1),()=>ge(1));const u=e.z.sub(r);let c=s.div(s.add(u.mul(u)));return c=fl(wr(c,.3).div(.65)),Yi(o,c)}),rj=Te(([i,e,t])=>{let n=Bh.sub(i).length();return n=n.sub(e).div(t.sub(e)),n=n.saturate(),n}),sj=i=>{const e=i.shadow.camera,t=En("near","float",e).setGroup(yt),n=En("far","float",e).setGroup(yt),r=T9(i);return rj(r,t,n)},aj=i=>{let e=L_.get(i);if(e===void 0){const t=i.isPointLight?sj(i):null;e=new hi,e.colorNode=Dt(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,L_.set(i,e)}return e},oj=i=>{const e=L_.get(i);e!==void 0&&(e.dispose(),L_.delete(i))},FC=new Ws,Fc=[],lj=(i,e,t,n)=>{Fc[0]=i,Fc[1]=e;let r=FC.get(Fc);return(r===void 0||r.shadowType!==t||r.useVelocity!==n)&&(r=(s,o,u,c,h,d,...p)=>{(s.castShadow===!0||s.receiveShadow&&t===io)&&(n&&(J2(s).useVelocity=!0),s.onBeforeShadow(i,s,u,e.camera,c,o.overrideMaterial,d),i.renderObject(s,o,u,c,h,d,...p),s.onAfterShadow(i,s,u,e.camera,c,o.overrideMaterial,d))},r.shadowType=t,r.useVelocity=n,FC.set(Fc,r)),Fc[0]=null,Fc[1]=null,r},uj=Te(({samples:i,radius:e,size:t,shadowPass:n,depthLayer:r})=>{const s=ge(0).toVar("meanVertical"),o=ge(0).toVar("squareMeanVertical"),u=i.lessThanEqual(ge(1)).select(ge(0),ge(2).div(i.sub(1))),c=i.lessThanEqual(ge(1)).select(ge(0),ge(-1));_s({start:In(0),end:In(i),type:"int",condition:"<"},({i:d})=>{const p=c.add(ge(d).mul(u));let g=n.sample(Br(Qh.xy,nt(0,p).mul(e)).div(t));n.value.isArrayTexture&&(g=g.depth(r)),g=g.x,s.addAssign(g),o.addAssign(g.mul(g))}),s.divAssign(i),o.divAssign(i);const h=ao(o.sub(s.mul(s)).max(0));return nt(s,h)}),cj=Te(({samples:i,radius:e,size:t,shadowPass:n,depthLayer:r})=>{const s=ge(0).toVar("meanHorizontal"),o=ge(0).toVar("squareMeanHorizontal"),u=i.lessThanEqual(ge(1)).select(ge(0),ge(2).div(i.sub(1))),c=i.lessThanEqual(ge(1)).select(ge(0),ge(-1));_s({start:In(0),end:In(i),type:"int",condition:"<"},({i:d})=>{const p=c.add(ge(d).mul(u));let g=n.sample(Br(Qh.xy,nt(p,0).mul(e)).div(t));n.value.isArrayTexture&&(g=g.depth(r)),s.addAssign(g.x),o.addAssign(Br(g.y.mul(g.y),g.x.mul(g.x)))}),s.divAssign(i),o.divAssign(i);const h=ao(o.sub(s.mul(s)).max(0));return nt(s,h)}),hj=[ej,tj,nj,ij];let $x;const qg=new BT;class z3 extends q7{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:r,shadow:s,depthLayer:o}){const u=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),c=t({depthTexture:n,shadowCoord:r,shadow:s,depthLayer:o});return u.select(c,ge(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:r}=e,s=En("bias","float",n).setGroup(yt);let o=t,u;if(n.camera.isOrthographicCamera||r.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),u=o.z,r.coordinateSystem===ma&&(u=u.mul(2).sub(1));else{const c=o.w;o=o.xy.div(c);const h=En("near","float",n.camera).setGroup(yt),d=En("far","float",n.camera).setGroup(yt);u=u3(c.negate(),h,d)}return o=ve(o.x,o.y.oneMinus(),u.add(s)),o}getShadowFilterFn(e){return hj[e]}setupRenderTarget(e,t){const n=new vr(e.mapSize.width,e.mapSize.height);n.name="ShadowDepthTexture",n.compareFunction=Ep;const r=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return r.texture.name="ShadowMap",r.texture.type=e.mapType,r.depthTexture=n,{shadowMap:r,depthTexture:n}}setupShadow(e){const{renderer:t,camera:n}=e,{light:r,shadow:s}=this,o=t.shadowMap.type,{depthTexture:u,shadowMap:c}=this.setupRenderTarget(s,e);if(s.camera.coordinateSystem=n.coordinateSystem,s.camera.updateProjectionMatrix(),o===io&&s.isPointLightShadow!==!0){u.compareFunction=null,c.depth>1?(c._vsmShadowMapVertical||(c._vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:mr,type:Zn,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=c._vsmShadowMapVertical,c._vsmShadowMapHorizontal||(c._vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:mr,type:Zn,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=c._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:mr,type:Zn,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:mr,type:Zn,depthBuffer:!1}));let E=zn(u);u.isArrayTexture&&(E=E.depth(this.depthLayer));let w=zn(this.vsmShadowMapVertical.texture);u.isArrayTexture&&(w=w.depth(this.depthLayer));const C=En("blurSamples","float",s).setGroup(yt),N=En("radius","float",s).setGroup(yt),D=En("mapSize","vec2",s).setGroup(yt);let U=this.vsmMaterialVertical||(this.vsmMaterialVertical=new hi);U.fragmentNode=uj({samples:C,radius:N,size:D,shadowPass:E,depthLayer:this.depthLayer}).context(e.getSharedContext()),U.name="VSMVertical",U=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new hi),U.fragmentNode=cj({samples:C,radius:N,size:D,shadowPass:w,depthLayer:this.depthLayer}).context(e.getSharedContext()),U.name="VSMHorizontal"}const h=En("intensity","float",s).setGroup(yt),d=En("normalBias","float",s).setGroup(yt),p=FT(r).mul(I3.add(Zh.mul(d))),g=this.setupShadowCoord(e,p),_=s.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(_===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const v=o===io&&s.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:u,T=this.setupShadowFilter(e,{filterFn:_,shadowTexture:c.texture,depthTexture:v,shadowCoord:g,shadow:s,depthLayer:this.depthLayer});let b;c.texture.isCubeTexture?b=Cr(c.texture,g.xyz):(b=zn(c.texture,g),u.isArrayTexture&&(b=b.depth(this.depthLayer)));const x=An(1,T.rgb.mix(b,1),h.mul(b.a)).toVar();this.shadowMap=c,this.shadow.map=c;const M=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return x.toInspector(`${M} / Color`,()=>this.shadowMap.texture.isCubeTexture?Cr(this.shadowMap.texture):zn(this.shadowMap.texture)).toInspector(`${M} / Depth`,()=>this.shadowMap.texture.isCubeTexture?Cr(this.shadowMap.texture).r.oneMinus():ms(this.shadowMap.depthTexture,Yh().mul(ou(zn(this.shadowMap.depthTexture)))).r.oneMinus())}setup(e){if(e.renderer.shadowMap.enabled!==!1)return Te(()=>{const t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let n=this._node;return this.setupShadowPosition(e),n===null&&(this._node=n=this.setupShadow(e),this._currentShadowType=t),e.material.shadowNode&&Ae('NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(n=e.material.receivedShadowNode(n)),n})()}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:s,scene:o}=e;t.updateMatrices(r),n.setSize(t.mapSize.width,t.mapSize.height,n.depth);const u=o.name;o.name=`Shadow Map [ ${r.name||"ID: "+r.id} ]`,s.render(o,t.camera),o.name=u}updateShadow(e){const{shadowMap:t,light:n,shadow:r}=this,{renderer:s,scene:o,camera:u}=e,c=s.shadowMap.type,h=t.depthTexture.version;this._depthVersionCached=h;const d=r.camera.layers.mask;(r.camera.layers.mask&4294967294)===0&&(r.camera.layers.mask=u.layers.mask);const p=s.getRenderObjectFunction(),g=s.getMRT(),_=g?g.has("velocity"):!1;$x=Z7(s,o,$x),o.overrideMaterial=aj(n),s.setRenderObjectFunction(lj(s,r,c,_)),s.setClearColor(0,0),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(p),c===io&&r.isPointLightShadow!==!0&&this.vsmPass(s),r.camera.layers.mask=d,J7(s,o,$x)}vsmPass(e){const{shadow:t}=this,n=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,n),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,n),e.setRenderTarget(this.vsmShadowMapVertical),qg.material=this.vsmMaterialVertical,qg.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),qg.material=this.vsmMaterialHorizontal,qg.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,oj(this.light),this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const fj=(i,e)=>new z3(i,e),dj=new dt,IC=new Ht,xd=new k,jx=new k,pj=[new k(1,0,0),new k(-1,0,0),new k(0,-1,0),new k(0,1,0),new k(0,0,1),new k(0,0,-1)],mj=[new k(0,-1,0),new k(0,-1,0),new k(0,0,-1),new k(0,0,1),new k(0,-1,0),new k(0,-1,0)],gj=[new k(1,0,0),new k(-1,0,0),new k(0,1,0),new k(0,-1,0),new k(0,0,1),new k(0,0,-1)],_j=[new k(0,-1,0),new k(0,-1,0),new k(0,0,1),new k(0,0,-1),new k(0,-1,0),new k(0,-1,0)],vj=Te(({depthTexture:i,bd3D:e,dp:t})=>Cr(i,e).compare(t)),yj=Te(({depthTexture:i,bd3D:e,dp:t,shadow:n})=>{const r=En("radius","float",n).setGroup(yt),s=En("mapSize","vec2",n).setGroup(yt),o=r.div(s.x),u=Zr(e),c=ks(bu(e,u.x.greaterThan(u.z).select(ve(0,1,0),ve(1,0,0)))),h=bu(e,c),d=L3(Qh.xy).mul(6.28318530718),p=ua(0,5,d),g=ua(1,5,d),_=ua(2,5,d),v=ua(3,5,d),T=ua(4,5,d);return Cr(i,e.add(c.mul(p.x).add(h.mul(p.y)).mul(o))).compare(t).add(Cr(i,e.add(c.mul(g.x).add(h.mul(g.y)).mul(o))).compare(t)).add(Cr(i,e.add(c.mul(_.x).add(h.mul(_.y)).mul(o))).compare(t)).add(Cr(i,e.add(c.mul(v.x).add(h.mul(v.y)).mul(o))).compare(t)).add(Cr(i,e.add(c.mul(T.x).add(h.mul(T.y)).mul(o))).compare(t)).mul(1/5)}),xj=Te(({filterFn:i,depthTexture:e,shadowCoord:t,shadow:n})=>{const r=t.xyz.toVar(),s=r.length(),o=bt("float").setGroup(yt).onRenderUpdate(()=>n.camera.near),u=bt("float").setGroup(yt).onRenderUpdate(()=>n.camera.far),c=En("bias","float",n).setGroup(yt),h=ge(1).toVar();return wn(s.sub(u).lessThanEqual(0).and(s.sub(o).greaterThanEqual(0)),()=>{const d=s.sub(o).div(u.sub(o)).toVar();d.addAssign(c);const p=r.normalize();h.assign(i({depthTexture:e,bd3D:p,dp:d,shadow:n}))}),h});class bj extends z3{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===SO?vj:yj}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:r,shadow:s}){return xj({filterFn:t,depthTexture:n,shadowCoord:r,shadow:s})}setupRenderTarget(e,t){const n=new e2(e.mapSize.width);n.name="PointShadowDepthTexture",n.compareFunction=Ep;const r=t.createCubeRenderTarget(e.mapSize.width);return r.texture.name="PointShadowMap",r.depthTexture=n,{shadowMap:r,depthTexture:n}}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:s,scene:o}=e,u=t.camera,c=t.matrix,h=s.coordinateSystem===ma,d=h?pj:gj,p=h?mj:_j;n.setSize(t.mapSize.width,t.mapSize.width);const g=s.autoClear,_=s.getClearColor(dj),v=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha);for(let T=0;T<6;T++){s.setRenderTarget(n,T),s.clear();const b=r.distance||u.far;b!==u.far&&(u.far=b,u.updateProjectionMatrix()),xd.setFromMatrixPosition(r.matrixWorld),u.position.copy(xd),jx.copy(u.position),jx.add(d[T]),u.up.copy(p[T]),u.lookAt(jx),u.updateMatrixWorld(),c.makeTranslation(-xd.x,-xd.y,-xd.z),IC.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),t._frustum.setFromProjectionMatrix(IC,u.coordinateSystem,u.reversedDepth);const x=o.name;o.name=`Point Light Shadow [ ${r.name||"ID: "+r.id} ] - Face ${T+1}`,s.render(o,u),o.name=x}s.autoClear=g,s.setClearColor(_,v)}}const Sj=(i,e)=>new bj(i,e);class Cu extends Jh{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new dt,this.colorNode=e&&e.colorNode||bt(this.color).setGroup(yt),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=Ot.FRAME,e&&e.shadow&&(this._shadowDisposeListener=()=>{this.disposeShadow()},e.addEventListener("dispose",this._shadowDisposeListener))}dispose(){this._shadowDisposeListener&&this.light.removeEventListener("dispose",this._shadowDisposeListener),super.dispose()}disposeShadow(){this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null),this.shadowColorNode=null,this.baseColorNode!==null&&(this.colorNode=this.baseColorNode,this.baseColorNode=null)}getHash(){return this.light.uuid}getLightVector(e){return O3(this.light).sub(e.context.positionView||li)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return fj(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const r=this.light.shadow.shadowNode;let s;r!==void 0?s=Ze(r):s=this.setupShadowNode(),this.shadowNode=s,this.shadowColorNode=n=this.colorNode.mul(s),this.baseColorNode=this.colorNode}e.context.getShadow&&(n=e.context.getShadow(this,e)),this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const G3=Te(({lightDistance:i,cutoffDistance:e,decayExponent:t})=>{const n=i.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(n.mul(i.div(e).pow4().oneMinus().clamp().pow2()),n)}),Tj=({color:i,lightVector:e,cutoffDistance:t,decayExponent:n})=>{const r=e.normalize(),s=e.length(),o=G3({lightDistance:s,cutoffDistance:t,decayExponent:n}),u=i.mul(o);return{lightDirection:r,lightColor:u}};class Mj extends Cu{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=bt(0).setGroup(yt),this.decayExponentNode=bt(2).setGroup(yt)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return Sj(this.light)}setupDirect(e){return Tj({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}Te(([i=Yh()],{renderer:e,material:t})=>{const n=ND(i.mul(2).sub(1));let r;if(t.alphaToCoverage&&e.currentSamples>0){const s=ge(n.fwidth()).toVar();r=po(s.oneMinus(),s.add(1),n).oneMinus()}else r=Lr(n.greaterThan(1),0,1);return r});const Ej=Te(([i,e])=>{const t=i.x,n=i.y,r=i.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(n)),s=s.add(e.element(2).mul(2*.511664).mul(r)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(n)),s=s.add(e.element(5).mul(2*.429043).mul(n).mul(r)),s=s.add(e.element(6).mul(r.mul(r).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(r)),s=s.add(e.element(8).mul(.429043).mul(Bt(t,t).sub(Bt(n,n)))),s}),Ps=new OT;class Aj extends pl{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const r=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(s===null)r._clearColor.getRGB(Ps),Ps.a=r._clearColor.a;else if(s.isColor===!0)s.getRGB(Ps),Ps.a=1,o=!0;else if(s.isNode===!0){const h=this.get(e),d=s;Ps.copy(r._clearColor);let p=h.backgroundMesh;if(p===void 0){let E=function(){s.removeEventListener("dispose",E),p.material.dispose(),p.geometry.dispose()};var c=E;const _=Dt(d).mul(UC).context({getUV:()=>S7.mul(C9),getTextureLevel:()=>b7}),v=Xd.element(3).element(3).equal(1),T=ga(1,Xd.element(1).element(1)).mul(3),b=v.select(Li.mul(T),Li);let x=Xd.mul(Fp.mul(Dt(b,0)));x=x.setZ(x.w);const M=new hi;M.name="Background.material",M.side=Pn,M.depthTest=!1,M.depthWrite=!1,M.allowOverride=!1,M.fog=!1,M.lights=!1,M.vertexNode=x,M.colorNode=_,h.backgroundMeshNode=_,h.backgroundMesh=p=new yi(new Pp(1,32,32),M),p.frustumCulled=!1,p.name="Background.mesh",s.addEventListener("dispose",E)}const g=d.getCacheKey();h.backgroundCacheKey!==g&&(h.backgroundMeshNode.node=Dt(d).mul(UC),h.backgroundMeshNode.needsUpdate=!0,p.material.needsUpdate=!0,h.backgroundCacheKey=g),t.unshift(p,p.geometry,p.material,0,0,null,null)}else Re("Renderer: Unsupported background configuration.",s);const u=r.xr.getEnvironmentBlendMode();if(u==="additive"?Ps.set(0,0,0,1):u==="alpha-blend"&&Ps.set(0,0,0,0),r.autoClear===!0||o===!0){const h=n.clearColorValue;h.r=Ps.r,h.g=Ps.g,h.b=Ps.b,h.a=Ps.a,(r.backend.isWebGLBackend===!0||r.alpha===!0)&&(h.r*=h.a,h.g*=h.a,h.b*=h.a),n.depthClearValue=r._clearDepth,n.stencilClearValue=r._clearStencil,n.clearColor=r.autoClearColor===!0,n.clearDepth=r.autoClearDepth===!0,n.clearStencil=r.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let wj=0;class Zb{constructor(e="",t=[],n=0,r=[]){this.name=e,this.bindings=t,this.index=n,this.bindingsReference=r,this.id=wj++}}class Rj{constructor(e,t,n,r,s,o,u,c,h,d=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=d,this.nodeAttributes=r,this.bindings=s,this.updateNodes=o,this.updateBeforeNodes=u,this.updateAfterNodes=c,this.observer=h,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const r=new Zb(t.name,[],t.index,t.bindingsReference);e.push(r);for(const s of t.bindings)r.bindings.push(s.clone())}else e.push(t);return e}}class zC{constructor(e,t,n=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}}class Cj{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class k3{constructor(e,t,n=!1,r=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=r}}class Nj extends k3{constructor(e,t,n=null,r=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=n,this.interpolationSampling=r}}class Dj{constructor(e,t,n=""){this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let Lj=0;class Xx{constructor(e=null){this.id=Lj++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class Pj{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class ml{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class Uj extends ml{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class Oj extends ml{constructor(e,t=new Ue){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class Bj extends ml{constructor(e,t=new k){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class Fj extends ml{constructor(e,t=new Lt){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class Ij extends ml{constructor(e,t=new dt){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class zj extends ml{constructor(e,t=new $_){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class Gj extends ml{constructor(e,t=new Ct){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class kj extends ml{constructor(e,t=new Ht){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class Vj extends Uj{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Hj extends Oj{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Wj extends Bj{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class qj extends Fj{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class $j extends Ij{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class jj extends zj{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Xj extends Gj{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Yj extends kj{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let Kj=0;const Qj=new WeakMap,GC=new WeakMap,Zj=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),$g=i=>/e/g.test(i)?String(i).replace(/\+/g,""):(i=Number(i),i+(i%1?"":".0"));class V3{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=Vx(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new Xx,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:Kj++})}isOpaque(){const e=this.material;return e.transparent===!1&&e.blending===es&&e.alphaToCoverage===!1}getBindGroupsCache(){let e=GC.get(this.renderer);return e===void 0&&(e=new Ws,GC.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new Mu(e,t,n)}createCubeRenderTarget(e,t){return new d3(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=this.getBindGroupsCache(),r=[];let s=!0;for(const u of t)r.push(u),s=s&&u.groupNode.shared!==!0;let o;return s?(o=n.get(r),o===void 0&&(o=new Zb(e,r,this.bindingsIndexes[e].group,r),n.set(r,o))):o=new Zb(e,r,this.bindingsIndexes[e].group,r),o}getBindGroupArray(e,t){const n=this.bindings[t];let r=n[e];return r===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(e===null){const t={},n=this.bindings;for(const r of LR)for(const s in n[r]){const o=n[r][s];(t[s]||(t[s]=[])).push(...o)}e=[];for(const r in t){const s=t[r],o=this._getBindGroup(r,s);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,n)=>t.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==Ot.NONE&&this.updateNodes.push(e);for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==Ot.NONE&&this.updateBeforeNodes.push(e),n!==Ot.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Gn||e.magFilter===Xc||e.magFilter===ro||e.magFilter===Dr||e.minFilter===Gn||e.minFilter===Xc||e.minFilter===ro||e.minFilter===Dr}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){const t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){const e={...this.context};return delete e.material,delete e.getUV,delete e.getOutput,delete e.getTextureLevel,delete e.getAO,delete e.getShadow,e}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new Xx(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){Ae("Abstract function.")}getInstanceIndex(){Ae("Abstract function.")}getDrawIndex(){Ae("Abstract function.")}getFrontFacing(){Ae("Abstract function.")}getFragCoord(){Ae("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){Ae("Abstract function.")}generateTextureLod(){Ae("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,n=null){let r=this.generateArrayDeclaration(e,t)+"( ";for(let s=0;s<t;s++){const o=n?n[s]:null;o!==null?r+=o.build(this,e):r+=this.generateConst(e),s<t-1&&(r+=", ")}return r+=" )",r}generateStruct(e,t,n=null){const r=[];for(const s of t){const{name:o,type:u}=s;n&&n[o]&&n[o].isNode?r.push(n[o].build(this,u)):r.push(this.generateConst(u))}return e+"( "+r.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new dt:e==="vec2"||e==="uvec2"||e==="ivec2"?t=new Ue:e==="vec3"||e==="uvec3"||e==="ivec3"?t=new k:(e==="vec4"||e==="uvec4"||e==="ivec4")&&(t=new Lt)),e==="float")return $g(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${$g(t.r)}, ${$g(t.g)}, ${$g(t.b)} )`;const n=this.getTypeLength(e),r=this.getComponentType(e),s=o=>this.generateConst(r,o);if(n===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(n===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(n===4&&e!=="mat2")return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const n=this.attributes;for(const s of n)if(s.name===e)return s;const r=new zC(e,t);return this.registerDeclaration(r),n.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Ni)return"int";if(t===yn)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let n=Z2(e);const r=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(n=n.replace("vec","mat")),r+n}getTypeFromArray(e){return Zj.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,r=e.itemSize,s=e.normalized;let o;return!(e instanceof XN)&&s!==!0&&(o=this.getTypeFromArray(n)),this.getTypeFromLength(r,o)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return n!==null?Number(n[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]===e)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=Vx(this.stack);const e=iD();return this.stacks.push(e),w_(this.stack),this.stack}removeStack(){const e=this.stack;for(const t of e.nodes){const n=this.getDataFromNode(t);n.stack=e}return this.stack=e.parent,w_(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let r=n.getData(e);r===void 0&&(r={},n.setData(e,r)),r[t]===void 0&&(r[t]={});let s=r[t];const o=r.any?r.any.subBuilds:null,u=this.getClosestSubBuild(o);return u&&(s.subBuildsCache===void 0&&(s.subBuildsCache={}),s=s.subBuildsCache[u]||(s.subBuildsCache[u]={}),s.subBuilds=o),s}getNodeProperties(e,t="any"){const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e,"vertex");let r=n.bufferAttribute;if(r===void 0){const s=this.uniforms.index++;r=new zC("nodeAttribute"+s,t,e),this.bufferAttributes.push(r),n.bufferAttribute=r}return r}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,n=null,r=this.shaderStage){const s=this.getDataFromNode(e,r,this.globalCache);let o=s.structType;if(o===void 0){const u=this.structs.index++;n===null&&(n="StructType"+u),o=new Pj(n,t),this.structs[r].push(o),this.types[r][n]=e,s.structType=o}return o}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t,n=this.shaderStage,r=null){const s=this.getDataFromNode(e,n,this.globalCache);let o=s.uniform;if(o===void 0){const u=this.uniforms.index++;o=new Cj(r||"nodeUniform"+u,t,e),this.uniforms[n].push(o),this.registerDeclaration(o),s.uniform=o}return o}getVarFromNode(e,t=null,n=e.getNodeType(this),r=this.shaderStage,s=!1){const o=this.getDataFromNode(e,r),u=this.getSubBuildProperty("variable",o.subBuilds);let c=o[u];if(c===void 0){const h=s?"_const":"_var",d=this.vars[r]||(this.vars[r]=[]),p=this.vars[h]||(this.vars[h]=0);t===null&&(t=(s?"nodeConst":"nodeVar")+p,this.vars[h]++),u!=="variable"&&(t=this.getSubBuildProperty(t,o.subBuilds));const g=e.getArrayCount(this);c=new k3(t,n,s,g),s||d.push(c),this.registerDeclaration(c),o[u]=c}return c}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,n=e.getNodeType(this),r=null,s=null){const o=this.getDataFromNode(e,"any"),u=this.getSubBuildProperty("varying",o.subBuilds);let c=o[u];if(c===void 0){const h=this.varyings,d=h.length;t===null&&(t="nodeVarying"+d),u!=="varying"&&(t=this.getSubBuildProperty(t,o.subBuilds)),c=new Nj(t,n,r,s),h.push(c),this.registerDeclaration(c),o[u]=c}return c}registerDeclaration(e){const t=this.shaderStage,n=this.declarations[t]||(this.declarations[t]={}),r=this.getPropertyName(e);let s=1,o=r;for(;n[o]!==void 0;)o=r+"_"+s++;s>1&&(e.name=o,Ae(`TSL: Declaration name '${r}' of '${e.type}' already in use. Renamed to '${o}'.`)),n[o]=e}getCodeFromNode(e,t,n=this.shaderStage){const r=this.getDataFromNode(e);let s=r.code;if(s===void 0){const o=this.codes[n]||(this.codes[n]=[]),u=o.length;s=new Dj("nodeCode"+u,t),o.push(s),r.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:r}=this.getDataFromNode(e);let s=!0,o=t;for(;o;){if(r.get(o)===!0){s=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(s)for(const u of n)this.addLineFlowCode(u)}addLineFlowCodeBlock(e,t,n){const r=this.getDataFromNode(e),s=r.flowCodes||(r.flowCodes=[]),o=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);s.push(t),o.set(n,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new F7,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let o=0;const u=Object.values(this);return{next:()=>({value:u[o],done:o++>=u.length})}}};for(const o of t.inputs)n[o.name]=new p7(o.type,o.name);e.layout=null;const r=e.call(n),s=this.flowStagesNode(r,t.type);return e.layout=t,s}flowBuildStage(e,t,n=null){const r=this.getBuildStage();this.setBuildStage(t);const s=e.build(this,n);return this.setBuildStage(r),s}flowStagesNode(e,t=null){const n=this.flow,r=this.vars,s=this.declarations,o=this.cache,u=this.buildStage,c=this.stack,h={code:""};this.flow=h,this.vars={},this.declarations={},this.cache=new Xx,this.stack=Vx();for(const d of DR)this.setBuildStage(d),h.result=e.build(this,t);return h.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=r,this.declarations=s,this.cache=o,this.stack=c,this.setBuildStage(u),h}getFunctionOperator(){return null}buildFunctionCode(){Ae("Abstract function.")}flowChildNode(e,t=null){const n=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,t),this.flow=n,r}flowNodeFromShaderStage(e,t,n=null,r=null){const s=this.tab,o=this.cache,u=this.shaderStage,c=this.context;this.setShaderStage(e);const h={...this.context};delete h.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=h;let d=null;if(this.buildStage==="generate"){const p=this.flowChildNode(t,n);r!==null&&(p.code+=`${this.tab+r} = ${p.result};
`),this.flowCode[e]=this.flowCode[e]+p.code,d=p}else d=t.build(this);return this.setShaderStage(u),this.cache=o,this.tab=s,this.context=c,d}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){Ae("Abstract function.")}getVaryings(){Ae("Abstract function.")}getVar(e,t,n=null){return`${n!==null?this.generateArrayDeclaration(e,n):this.getType(e)} ${t}`}getVars(e){let t="";const n=this.vars[e];if(n!==void 0)for(const r of n)t+=`${this.getVar(r.type,r.name)}; `;return t}getUniforms(){Ae("Abstract function.")}getCodes(e){const t=this.codes[e];let n="";if(t!==void 0)for(const r of t)n+=r.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){Ae("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const n=this.subBuildLayers;for(let r=t.length-1;r>=0;r--){const s=t[r];if(n.includes(s))return s}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let n;t!==null?n=this.getClosestSubBuild(t):n=this.subBuildFn;let r;return n?r=e?n+"_"+e:n:r=e,r}build(){const{object:e,material:t,renderer:n}=this;if(t!==null){let r=n.library.fromMaterial(t);r===null&&(Re(`NodeMaterial: Material "${t.type}" is not compatible.`),r=new hi),r.build(this)}else this.addFlow("compute",e);for(const r of DR){this.setBuildStage(r),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of LR){this.setShaderStage(s);const o=this.flowNodes[s];for(const u of o)r==="generate"?this.flowNode(u):u.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getSharedDataFromNode(e){let t=Qj.get(e);return t===void 0&&(t={}),t}getNodeUniform(e,t){const n=this.getSharedDataFromNode(e);let r=n.cache;if(r===void 0){if(t==="float"||t==="int"||t==="uint")r=new Vj(e);else if(t==="vec2"||t==="ivec2"||t==="uvec2")r=new Hj(e);else if(t==="vec3"||t==="ivec3"||t==="uvec3")r=new Wj(e);else if(t==="vec4"||t==="ivec4"||t==="uvec4")r=new qj(e);else if(t==="color")r=new $j(e);else if(t==="mat2")r=new jj(e);else if(t==="mat3")r=new Xj(e);else if(t==="mat4")r=new Yj(e);else throw new Error(`Uniform "${t}" not implemented.`);n.cache=r}return r}format(e,t,n){if(t=this.getVectorType(t),n=this.getVectorType(n),t===n||n===null||this.isReference(n))return e;const r=this.getTypeLength(t),s=this.getTypeLength(n);return r===16&&s===9?`${this.getType(n)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:r===9&&s===4?`${this.getType(n)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:r>4||s>4||s===0?e:r===s?`${this.getType(n)}( ${e} )`:r>s?(e=n==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,s)}`,this.format(e,this.getTypeFromLength(s,this.getComponentType(t)),n)):s===4&&r>1?`${this.getType(n)}( ${this.format(e,t,"vec3")}, 1.0 )`:r===2?`${this.getType(n)}( ${this.format(e,t,"vec2")}, 0.0 )`:(r===1&&s>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${Tu} - Node System
`}}class kC{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return n===void 0&&(n={renderId:0,frameId:0},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===Ot.FRAME){const r=this._getMaps(this.updateBeforeMap,n);if(r.frameId!==this.frameId){const s=r.frameId;r.frameId=this.frameId,e.updateBefore(this)===!1&&(r.frameId=s)}}else if(t===Ot.RENDER){const r=this._getMaps(this.updateBeforeMap,n);if(r.renderId!==this.renderId){const s=r.renderId;r.renderId=this.renderId,e.updateBefore(this)===!1&&(r.renderId=s)}}else t===Ot.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===Ot.FRAME){const r=this._getMaps(this.updateAfterMap,n);r.frameId!==this.frameId&&e.updateAfter(this)!==!1&&(r.frameId=this.frameId)}else if(t===Ot.RENDER){const r=this._getMaps(this.updateAfterMap,n);r.renderId!==this.renderId&&e.updateAfter(this)!==!1&&(r.renderId=this.renderId)}else t===Ot.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===Ot.FRAME){const r=this._getMaps(this.updateMap,n);r.frameId!==this.frameId&&e.update(this)!==!1&&(r.frameId=this.frameId)}else if(t===Ot.RENDER){const r=this._getMaps(this.updateMap,n);r.renderId!==this.renderId&&e.update(this)!==!1&&(r.renderId=this.renderId)}else t===Ot.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class IT{constructor(e,t,n=null,r="",s=!1){this.type=e,this.name=t,this.count=n,this.qualifier=r,this.isConst=s}}IT.isNodeFunctionInput=!0;class Jj extends Cu{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:B3(this.light),lightColor:e}}}const Yx=new Ht,jg=new Ht;let bd=null;class eX extends Cu{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=bt(new k).setGroup(yt),this.halfWidth=bt(new k).setGroup(yt),this.updateType=Ot.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;jg.identity(),Yx.copy(t.matrixWorld),Yx.premultiply(n),jg.extractRotation(Yx),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(jg),this.halfHeight.value.applyMatrix4(jg)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=zn(bd.LTC_FLOAT_1),n=zn(bd.LTC_FLOAT_2)):(t=zn(bd.LTC_HALF_1),n=zn(bd.LTC_HALF_2));const{colorNode:r,light:s}=this,o=O3(s);return{lightColor:r,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){bd=e}}class zT extends Cu{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=bt(0).setGroup(yt),this.penumbraCosNode=bt(0).setGroup(yt),this.cutoffDistanceNode=bt(0).setGroup(yt),this.decayExponentNode=bt(0).setGroup(yt),this.colorNode=bt(this.color).setGroup(yt)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:n,penumbraCosNode:r}=this;return po(n,r,t)}getLightCoord(e){const t=e.getNodeProperties(this);let n=t.projectionUV;return n===void 0&&(n=k7(this.light,e.context.positionWorld),t.projectionUV=n),n}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:r,light:s}=this,o=this.getLightVector(e),u=o.normalize(),c=u.dot(B3(s)),h=this.getSpotAttenuation(e,c),d=o.length(),p=G3({lightDistance:d,cutoffDistance:n,decayExponent:r});let g=t.mul(h).mul(p),_,v;return s.colorNode?(v=this.getLightCoord(e),_=s.colorNode(v)):s.map&&(v=this.getLightCoord(e),_=zn(s.map,v.xy).onRenderUpdate(()=>s.map)),_&&(g=v.mul(2).sub(1).abs().lessThan(1).all().select(g.mul(_),g)),{lightColor:g,lightDirection:u}}}class tX extends zT{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const n=this.light.iesMap;let r=null;if(n&&n.isTexture===!0){const s=t.acos().mul(1/Math.PI);r=zn(n,nt(s,0),0).r}else r=super.getSpotAttenuation(t);return r}}const nX=Te(([i,e])=>{const t=i.abs().sub(e);return fo(Yi(t,0)).add(Uh(Yi(t.x,t.y),0))});class iX extends zT{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let n=1;t.map!==null&&(n=t.map.width/t.map.height),t.shadow.aspect=n}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=ge(0),n=this.penumbraCosNode,r=FT(this.light).mul(e.context.positionWorld||Bh);return wn(r.w.greaterThan(0),()=>{const s=r.xyz.div(r.w),o=nX(s.xy.sub(nt(.5)),nt(.5)),u=ga(-1,wr(1,xD(n)).sub(1));t.assign(ET(o.mul(-2).mul(u)))}),t}}class rX extends Cu{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class sX extends Cu{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=U3(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=bt(new dt).setGroup(yt)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:r}=this,o=Zh.dot(r).mul(.5).add(.5),u=An(n,t,o);e.context.irradiance.addAssign(u)}}class aX extends Cu{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let n=0;n<9;n++)t.push(new k);this.lightProbe=Fs(t)}update(e){const{light:t}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(t.sh.coefficients[n]).multiplyScalar(t.intensity)}setup(e){const t=Ej(Zh,this.lightProbe);e.context.irradiance.addAssign(t)}}class H3{parseFunction(){Ae("Abstract function.")}}class GT{constructor(e,t,n="",r=""){this.type=e,this.inputs=t,this.name=n,this.precision=r}getCode(){Ae("Abstract function.")}}GT.isNodeFunction=!0;const oX=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,lX=/[a-z_0-9]+/ig,VC="#pragma main",uX=i=>{i=i.trim();const e=i.indexOf(VC),t=e!==-1?i.slice(e+VC.length):i,n=t.match(oX);if(n!==null&&n.length===5){const r=n[4],s=[];let o=null;for(;(o=lX.exec(r))!==null;)s.push(o);const u=[];let c=0;for(;c<s.length;){const v=s[c][0]==="const";v===!0&&c++;let T=s[c][0];T==="in"||T==="out"||T==="inout"?c++:T="";const b=s[c++][0];let x=Number.parseInt(s[c][0]);Number.isNaN(x)===!1?c++:x=null;const M=s[c++][0];u.push(new IT(b,M,x,T,v))}const h=t.substring(n[0].length),d=n[3]!==void 0?n[3]:"",p=n[2],g=n[1]!==void 0?n[1]:"",_=e!==-1?i.slice(0,e):"";return{type:p,inputs:u,name:d,precision:g,inputsCode:r,blockCode:h,headerCode:_}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class cX extends GT{constructor(e){const{type:t,inputs:n,name:r,precision:s,inputsCode:o,blockCode:u,headerCode:c}=uX(e);super(t,n,r,s),this.inputsCode=o,this.blockCode=u,this.headerCode=c}getCode(e=this.name){let t;const n=this.blockCode;if(n!==""){const{type:r,inputsCode:s,headerCode:o,precision:u}=this;let c=`${r} ${e} ( ${s.trim()} )`;u!==""&&(c=`${u} ${c}`),t=o+c+n}else t="";return t}}class hX extends H3{parseFunction(e){return new cX(e)}}const HC=new WeakMap,ia=[],Qo=[];class fX extends pl{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new kC,this.nodeBuilderCache=new Map,this.callHashCache=new Ws,this.groupsData=new Ws,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===mD.name)return!0;if(n===yt.name){const s=this.get(e),o=this.nodeFrame.renderId;return s.renderId!==o?(s.renderId=o,!0):!1}if(n===C8.name){const s=this.get(e),o=this.nodeFrame.frameId;return s.frameId!==o?(s.frameId=o,!0):!1}ia[0]=t,ia[1]=e;let r=this.groupsData.get(ia);return r===void 0&&this.groupsData.set(ia,r={}),ia.length=0,r.version!==t.version?(r.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:r}=this,s=this.getForRenderCacheKey(e);if(n=r.get(s),n===void 0){const o=c=>{const h=this.backend.createNodeBuilder(e.object,this.renderer);return h.scene=e.scene,h.material=c,h.camera=e.camera,h.context.material=c,h.lightsNode=e.lightsNode,h.environmentNode=this.getEnvironmentNode(e.scene),h.fogNode=this.getFogNode(e.scene),h.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&h.enableMultiview(),h};let u=o(e.material);try{u.build()}catch(c){u=o(new hi),u.build(),Re("TSL: "+c)}n=this._createNodeBuilderState(u),r.set(s,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const r=this.backend.createNodeBuilder(e,this.renderer);r.build(),n=this._createNodeBuilderState(r),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new Rj(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){ia[0]=e,ia[1]=t;const n=this.renderer.info.calls,r=this.callHashCache.get(ia)||{};if(r.callId!==n){const s=this.getEnvironmentNode(e),o=this.getFogNode(e);t&&Qo.push(t.getCacheKey(!0)),s&&Qo.push(s.getCacheKey()),o&&Qo.push(o.getCacheKey()),Qo.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),Qo.push(this.renderer.shadowMap.enabled?1:0),Qo.push(this.renderer.shadowMap.type),r.callId=n,r.cacheKey=Up(Qo),this.callHashCache.set(ia,r),Qo.length=0}return ia.length=0,r.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const r=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==n||r){const s=this.getCacheNode("background",n,()=>{if(n.isCubeTexture===!0||n.mapping===ih||n.mapping===rh||n.mapping===cu){if(e.backgroundBlurriness>0||n.mapping===cu)return M3(n);{let o;return n.isCubeTexture===!0?o=Cr(n):o=zn(n),m3(o)}}else{if(n.isTexture===!0)return zn(n,Jc.flipY()).setUpdateMatrix(!0);n.isColor!==!0&&Re("WebGPUNodes: Unsupported background configuration.",n)}},r);t.backgroundNode=s,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n,r=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=s.get(t);return(o===void 0||r)&&(o=n(),s.set(t,o)),o}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const r=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const s=En("color","color",n).setGroup(yt),o=En("density","float",n).setGroup(yt);return BC(s,z7(o))}else if(n.isFog){const s=En("color","color",n).setGroup(yt),o=En("near","float",n).setGroup(yt),u=En("far","float",n).setGroup(yt);return BC(s,I7(o,u))}else Re("Renderer: Unsupported fog configuration.",n)});t.fogNode=r,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const r=this.getCacheNode("environment",n,()=>{if(n.isCubeTexture===!0)return Cr(n);if(n.isTexture===!0)return zn(n);Re("Nodes: Unsupported environment configuration.",n)});t.environmentNode=r,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,n=null,r=null,s=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=n,o.camera=r,o.material=s,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return HC.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),r=e.isArrayTexture?E7(e,ve(Jc,Bp("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):zn(e,Jc).renderOutput(t.toneMapping,t.currentColorSpace);return HC.set(e,n),r}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const r of n.updateNodes)t.updateNode(r)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const r of n.updateNodes)t.updateNode(r)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new kC,this.nodeBuilderCache=new Map,this.cacheLib={}}}const Kx=new Bs;class P_{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new Ct,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const r=e.length;for(let s=0;s<r;s++){Kx.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=t[n+s],u=Kx.normal;o.x=-u.x,o.y=-u.y,o.z=-u.z,o.w=Kx.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const r=t.clippingPlanes,s=r.length;let o,u;if(this.clipIntersection?(o=this.intersectionPlanes,u=e.intersectionPlanes.length):(o=this.unionPlanes,u=e.unionPlanes.length),o.length!==u+s){o.length=u+s;for(let c=0;c<s;c++)o[u+c]=new Lt;n=!0}this.projectPlanes(r,o,u),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new P_(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class dX{constructor(e,t){this.bundleGroup=e,this.camera=t}}const Sd=[];class pX{constructor(){this.bundles=new Ws}get(e,t){const n=this.bundles;Sd[0]=e,Sd[1]=t;let r=n.get(Sd);return r===void 0&&(r=new dX(e,t),n.set(Sd,r)),Sd.length=0,r}dispose(){this.bundles=new Ws}}class W3{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(n!==null){t=new n;for(const r in e)t[r]=e[r]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t)){Ae(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);n.set(t,e)}addClass(e,t,n){if(n.has(t)){Ae(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);n.set(t,e)}}const mX=new F3,Td=[];class gX extends Ws{constructor(){super()}createNode(e=[]){return new F3().setLights(e)}getNode(e,t){if(e.isQuadMesh)return mX;Td[0]=e,Td[1]=t;let n=this.get(Td);return n===void 0&&(n=this.createNode(),this.set(Td,n)),Td.length=0,n}}class Ud extends Mu{constructor(e=1,t=1,n={}){super(e,t,n),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const WC=new k,qC=new k;class _X extends xa{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new Di,this._cameraL.viewport=new Lt,this._cameraR=new Di,this._cameraR.viewport=new Lt,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new l2,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=TX.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new Ue,this._onSessionEvent=xX.bind(this),this._onSessionEnd=bX.bind(this),this._onInputSourcesChange=SX.bind(this),this._onAnimationFrame=MX.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&Ae("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&Ae("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,n,r,s,o,u,c={}){const h=new Lp(e,t),d=new Ud(s,o,{format:si,type:Hn,depthTexture:new vr(s,o,c.stencil?ts:yn,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?pr:ji),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});d._autoAllocateDepthBuffer=!0;const p=new la({color:16777215,side:Jr});p.map=d.texture,p.map.offset.y=1,p.map.repeat.y=-1;const g=new yi(h,p);g.position.copy(n),g.quaternion.copy(r);const _={type:"quad",width:e,height:t,translation:n,quaternion:r,pixelwidth:s,pixelheight:o,plane:g,material:p,rendercall:u,renderTarget:d};if(this._layers.push(_),this._session!==null){_.plane.material=new la({color:16777215,side:Jr}),_.plane.material.blending=jc,_.plane.material.blendEquation=sr,_.plane.material.blendSrc=Ka,_.plane.material.blendDst=Ka,_.xrlayer=this._createXRLayer(_);const v=this._session.renderState.layers;v.unshift(_.xrlayer),this._session.updateRenderState({layers:v})}else d.isXRRenderTarget=!1;return g}createCylinderLayer(e,t,n,r,s,o,u,c,h={}){const d=new Dp(e,e,e*t/n,64,64,!0,Math.PI-t/2,t),p=new Ud(o,u,{format:si,type:Hn,depthTexture:new vr(o,u,h.stencil?ts:yn,void 0,void 0,void 0,void 0,void 0,void 0,h.stencil?pr:ji),stencilBuffer:h.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});p._autoAllocateDepthBuffer=!0;const g=new la({color:16777215,side:Pn});g.map=p.texture,g.map.offset.y=1,g.map.repeat.y=-1;const _=new yi(d,g);_.position.copy(r),_.quaternion.copy(s);const v={type:"cylinder",radius:e,centralAngle:t,aspectratio:n,translation:r,quaternion:s,pixelwidth:o,pixelheight:u,plane:_,material:g,rendercall:c,renderTarget:p};if(this._layers.push(v),this._session!==null){v.plane.material=new la({color:16777215,side:Pn}),v.plane.material.blending=jc,v.plane.material.blendEquation=sr,v.plane.material.blendSrc=Ka,v.plane.material.blendDst=Ka,v.xrlayer=this._createXRLayer(v);const T=this._session.renderState.layers;T.unshift(v.xrlayer),this._session.updateRenderState({layers:T})}else p.isXRRenderTarget=!1;return _}renderLayers(){const e=new k,t=new Hs,n=this._renderer,r=this.isPresenting,s=n.getOutputRenderTarget(),o=n._frameBufferTarget;this.isPresenting=!1;const u=new Ue;n.getSize(u);const c=n._quad;for(const h of this._layers)if(h.renderTarget.isXRRenderTarget=this._session!==null,h.renderTarget._hasExternalTextures=h.renderTarget.isXRRenderTarget,h.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){h.xrlayer.transform=new XRRigidTransform(h.plane.getWorldPosition(e),h.plane.getWorldQuaternion(t));const d=this._glBinding.getSubImage(h.xrlayer,this._xrFrame);n.backend.setXRRenderTargetTextures(h.renderTarget,d.colorTexture,void 0),n._setXRLayerSize(h.renderTarget.width,h.renderTarget.height),n.setOutputRenderTarget(h.renderTarget),n.setRenderTarget(null),n._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:p,quad:g}=this._frameBufferTargets.get(h.renderTarget)||{frameBufferTarget:null,quad:null};p?(n._frameBufferTarget=p,n._quad=g):(n._quad=new BT(new hi),this._frameBufferTargets.set(h.renderTarget,{frameBufferTarget:n._getFrameBufferTarget(),quad:n._quad})),h.rendercall(),n._frameBufferTarget=null}else n.setRenderTarget(h.renderTarget),h.rendercall();n.setRenderTarget(null),n.setOutputRenderTarget(s),n._frameBufferTarget=o,n._setXRLayerSize(u.x,u.y),n._quad=c,this.isPresenting=r}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend;this._gl=t.getContext();const r=this._gl,s=r.getContextAttributes();if(this._session=e,e!==null){if(n.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let o=null,u=null,c=null;t.depth&&(c=t.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,o=t.stencil?pr:ji,u=t.stencil?ts:yn);const h={colorFormat:r.RGBA8,depthFormat:c,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(h.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const d=this._glBinding.createProjectionLayer(h),p=[d];this._glProjLayer=d,t.setPixelRatio(1),t._setXRLayerSize(d.textureWidth,d.textureHeight);const g=this._useMultiview?2:1,_=new vr(d.textureWidth,d.textureHeight,u,void 0,void 0,void 0,void 0,void 0,void 0,o,g);if(this._xrRenderTarget=new Ud(d.textureWidth,d.textureHeight,{format:si,type:Hn,colorSpace:t.outputColorSpace,depthTexture:_,stencilBuffer:t.stencil,samples:s.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const v of this._layers)v.plane.material=new la({color:16777215,side:v.type==="cylinder"?Pn:Jr}),v.plane.material.blending=jc,v.plane.material.blendEquation=sr,v.plane.material.blendSrc=Ka,v.plane.material.blendDst=Ka,v.xrlayer=this._createXRLayer(v),p.unshift(v.xrlayer);e.updateRenderState({layers:p})}else{const o={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},u=new XRWebGLLayer(e,r,o);this._glBaseLayer=u,e.updateRenderState({baseLayer:u}),t.setPixelRatio(1),t._setXRLayerSize(u.framebufferWidth,u.framebufferHeight),this._xrRenderTarget=new Ud(u.framebufferWidth,u.framebufferHeight,{format:si,type:Hn,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:u.ignoreDepthValues===!1,resolveStencilBuffer:u.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const n=e.near,r=e.far,s=this._cameraXR,o=this._cameraL,u=this._cameraR;s.near=u.near=o.near=n,s.far=u.far=o.far=r,s.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==s.near||this._currentDepthFar!==s.far)&&(t.updateRenderState({depthNear:s.near,depthFar:s.far}),this._currentDepthNear=s.near,this._currentDepthFar=s.far),s.layers.mask=e.layers.mask|6,o.layers.mask=s.layers.mask&3,u.layers.mask=s.layers.mask&5;const c=e.parent,h=s.cameras;$C(s,c);for(let d=0;d<h.length;d++)$C(h[d],c);h.length===2?vX(s,o,u):s.projectionMatrix.copy(o.projectionMatrix),yX(e,s,c)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new a_,this._controllers[e]=t),t}}function vX(i,e,t){WC.setFromMatrixPosition(e.matrixWorld),qC.setFromMatrixPosition(t.matrixWorld);const n=WC.distanceTo(qC),r=e.projectionMatrix.elements,s=t.projectionMatrix.elements,o=r[14]/(r[10]-1),u=r[14]/(r[10]+1),c=(r[9]+1)/r[5],h=(r[9]-1)/r[5],d=(r[8]-1)/r[0],p=(s[8]+1)/s[0],g=o*d,_=o*p,v=n/(-d+p),T=v*-d;if(e.matrixWorld.decompose(i.position,i.quaternion,i.scale),i.translateX(T),i.translateZ(v),i.matrixWorld.compose(i.position,i.quaternion,i.scale),i.matrixWorldInverse.copy(i.matrixWorld).invert(),r[10]===-1)i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const b=o+v,x=u+v,M=g-T,E=_+(n-T),w=c*u/x*b,C=h*u/x*b;i.projectionMatrix.makePerspective(M,E,w,C,b,x),i.projectionMatrixInverse.copy(i.projectionMatrix).invert()}}function $C(i,e){e===null?i.matrixWorld.copy(i.matrix):i.matrixWorld.multiplyMatrices(e.matrixWorld,i.matrix),i.matrixWorldInverse.copy(i.matrixWorld).invert()}function yX(i,e,t){t===null?i.matrix.copy(e.matrixWorld):(i.matrix.copy(t.matrixWorld),i.matrix.invert(),i.matrix.multiply(e.matrixWorld)),i.matrix.decompose(i.position,i.quaternion,i.scale),i.updateMatrixWorld(!0),i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse),i.isPerspectiveCamera&&(i.fov=gu*2*Math.atan(1/i.projectionMatrix.elements[5]),i.zoom=1)}function xX(i){const e=this._controllerInputSources.indexOf(i.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const n=this.getReferenceSpace();t.update(i.inputSource,i.frame,n),t.dispatchEvent({type:i.type,data:i.inputSource})}}function bX(){const i=this._session,e=this._renderer;i.removeEventListener("select",this._onSessionEvent),i.removeEventListener("selectstart",this._onSessionEvent),i.removeEventListener("selectend",this._onSessionEvent),i.removeEventListener("squeeze",this._onSessionEvent),i.removeEventListener("squeezestart",this._onSessionEvent),i.removeEventListener("squeezeend",this._onSessionEvent),i.removeEventListener("end",this._onSessionEnd),i.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const n=this._controllerInputSources[t];n!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(n))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const t of this._layers)t.renderTarget=new Ud(t.pixelwidth,t.pixelheight,{format:si,type:Hn,depthTexture:new vr(t.pixelwidth,t.pixelheight,t.stencilBuffer?ts:yn,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?pr:ji),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function SX(i){const e=this._controllers,t=this._controllerInputSources;for(let n=0;n<i.removed.length;n++){const r=i.removed[n],s=t.indexOf(r);s>=0&&(t[s]=null,e[s].disconnect(r))}for(let n=0;n<i.added.length;n++){const r=i.added[n];let s=t.indexOf(r);if(s===-1){for(let u=0;u<e.length;u++)if(u>=t.length){t.push(r),s=u;break}else if(t[u]===null){t[u]=r,s=u;break}if(s===-1)break}const o=e[s];o&&o.connect(r)}}function TX(i){return i.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(i.translation,i.quaternion),width:i.width/2,height:i.height/2,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(i.translation,i.quaternion),radius:i.radius,centralAngle:i.centralAngle,aspectRatio:i.aspectRatio,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight,clearOnAccess:!1})}function MX(i,e){if(e===void 0)return;const t=this._cameraXR,n=this._renderer,r=n.backend,s=this._glBaseLayer,o=this.getReferenceSpace(),u=e.getViewerPose(o);if(this._xrFrame=e,u!==null){const c=u.views;this._glBaseLayer!==null&&r.setXRTarget(s.framebuffer);let h=!1;c.length!==t.cameras.length&&(t.cameras.length=0,h=!0);for(let d=0;d<c.length;d++){const p=c[d];let g;if(this._supportsLayers===!0){const v=this._glBinding.getViewSubImage(this._glProjLayer,p);g=v.viewport,d===0&&r.setXRRenderTargetTextures(this._xrRenderTarget,v.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:v.depthStencilTexture)}else g=s.getViewport(p);let _=this._cameras[d];_===void 0&&(_=new Di,_.layers.enable(d),_.viewport=new Lt,this._cameras[d]=_),_.matrix.fromArray(p.transform.matrix),_.matrix.decompose(_.position,_.quaternion,_.scale),_.projectionMatrix.fromArray(p.projectionMatrix),_.projectionMatrixInverse.copy(_.projectionMatrix).invert(),_.viewport.set(g.x,g.y,g.width,g.height),d===0&&(t.matrix.copy(_.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),h===!0&&t.cameras.push(_)}n.setOutputRenderTarget(this._xrRenderTarget)}for(let c=0;c<this._controllers.length;c++){const h=this._controllerInputSources[c],d=this._controllers[c];h!==null&&d!==void 0&&d.update(h,e,o)}this._currentAnimationLoop&&this._currentAnimationLoop(i,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}class EX extends xa{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new Lt(0,0,this._width,this._height),this._scissor=new Lt(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new JN,this.depthTexture=new vr}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),n===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,r){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,n,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,r,s=0,o=1){const u=this._viewport;e.isVector4?u.copy(e):u.set(e,t,n,r),u.minDepth=s,u.maxDepth=o}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const jC=new W_,Ic=new Ue,Qx=new Lt,Zx=new Np,Jx=new eT,Xg=new Ht,Xa=new Lt;class AX{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:r=!0,depth:s=!0,stencil:o=!1,antialias:u=!1,samples:c=0,getFallback:h=null,outputBufferType:d=Zn,multiview:p=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=n,this.outputColorSpace=nr,this.toneMapping=$i,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=o,this.info=new Z$,this.contextNode=Ru(),this.library=new W3,this.lighting=new gX,this._samples=c||u===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new EX(e.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new zD,this._inspector.setRenderer(this),this._getFallback=h,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new BT(new hi),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const g=this.alpha===!0?0:1;this._clearColor=new OT(0,0,0,g),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._outputBufferType=d,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:Bd},this.xr=new _X(this,p),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(_,v,T)=>{await this.compileAsync(_,v);const b=this._renderLists.get(_,v),x=this._renderContexts.get(_,v,this._renderTarget,this._mrt),M=_.overrideMaterial||T.material,E=this._objects.get(T,M,_,v,b.lightsNode,x,x.clippingContext),{fragmentShader:w,vertexShader:C}=E.getNodeBuilderState();return{fragmentShader:w,vertexShader:C}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(r){if(this._getFallback!==null)try{this.backend=n=this._getFallback(r),await n.init(this)}catch(s){t(s);return}else{t(r);return}}this._nodes=new fX(this,n),this._animation=new H$(this,this._nodes,this.info),this._attributes=new K$(n),this._background=new Aj(this,this._nodes),this._geometries=new Q$(this._attributes,this.info),this._textures=new d7(this,n,this.info),this._pipelines=new n7(n,this._nodes),this._bindings=new i7(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new j$(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new a7(this.lighting),this._bundles=new pX,this._renderContexts=new h7,this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const r=this._nodes.nodeFrame,s=r.renderId,o=this._currentRenderContext,u=this._currentRenderObjectFunction,c=this._compilationPromises,h=e.isScene===!0?e:jC;n===null&&(n=e);const d=this._renderTarget,p=this._renderContexts.get(n,t,d,this._mrt),g=this._activeMipmapLevel,_=[];this._currentRenderContext=p,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=_,r.renderId++,r.update(),p.depth=this.depth,p.stencil=this.stencil,p.clippingContext||(p.clippingContext=new P_),p.clippingContext.updateGlobal(h,t),h.onBeforeRender(this,e,t,d);const v=this._renderLists.get(e,t);if(v.begin(),this._projectObject(e,t,0,v,p.clippingContext),n!==e&&n.traverseVisible(function(E){E.isLight&&E.layers.test(t.layers)&&v.pushLight(E)}),v.finish(),d!==null){this._textures.updateRenderTarget(d,g);const E=this._textures.get(d);p.textures=E.textures,p.depthTexture=E.depthTexture}else p.textures=null,p.depthTexture=null;this._background.update(h,v,p);const T=v.opaque,b=v.transparent,x=v.transparentDoublePass,M=v.lightsNode;this.opaque===!0&&T.length>0&&this._renderObjects(T,t,h,M),this.transparent===!0&&b.length>0&&this._renderTransparents(b,x,t,h,M),r.renderId=s,this._currentRenderContext=o,this._currentRenderObjectFunction=u,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(_)}async renderAsync(e,t){Vn('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(e,t)}async waitForGPU(){Re("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(e){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){const t=this.contextNode.value;e===!0?(t.modelViewMatrix=$R,t.modelNormalViewMatrix=jR):this.highPrecision&&(delete t.modelViewMatrix,delete t.modelNormalViewMatrix)}get highPrecision(){const e=this.contextNode.value;return e.modelViewMatrix===$R&&e.modelNormalViewMatrix===jR}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getOutputBufferType(){return this._outputBufferType}getColorBufferType(){return Vn('Renderer: ".getColorBufferType()" has been renamed to ".getOutputBufferType()".'),this.getOutputBufferType()}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),Re(t),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:r,camera:s,renderList:o}=e,u=this._currentRenderContext,c=this._bundles.get(r,s),h=this.backend.get(c);h.renderContexts===void 0&&(h.renderContexts=new Set);const d=r.version!==h.version,p=h.renderContexts.has(u)===!1||d;if(h.renderContexts.add(u),p){this.backend.beginBundle(u),(h.renderObjects===void 0||d)&&(h.renderObjects=[]),this._currentRenderBundle=c;const{transparentDoublePass:g,transparent:_,opaque:v}=o;this.opaque===!0&&v.length>0&&this._renderObjects(v,s,t,n),this.transparent===!0&&_.length>0&&this._renderTransparents(_,g,s,t,n),this._currentRenderBundle=null,this.backend.finishBundle(u,c),h.version=r.version}else{const{renderObjects:g}=h;for(let _=0,v=g.length;_<v;_++){const T=g[_];this._nodes.needsRefresh(T)&&(this._nodes.updateBefore(T),this._nodes.updateForRender(T),this._bindings.updateForRender(T),this._nodes.updateAfter(T))}}this.backend.addBundle(u,c)}render(e,t){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,n=e!==$i,r=t!==vt.workingColorSpace;if(n===!1&&r===!1)return null;const{width:s,height:o}=this.getDrawingBufferSize(Ic),{depth:u,stencil:c}=this;let h=this._frameBufferTarget;h===null&&(h=new Mu(s,o,{depthBuffer:u,stencilBuffer:c,type:this._outputBufferType,format:si,colorSpace:vt.workingColorSpace,generateMipmaps:!1,minFilter:Gn,magFilter:Gn,samples:this.samples}),h.isPostProcessingRenderTarget=!0,this._frameBufferTarget=h);const d=this.getOutputRenderTarget();h.depthBuffer=u,h.stencilBuffer=c,d!==null?h.setSize(d.width,d.height,d.depth):h.setSize(s,o,1);const p=this._canvasTarget;return h.viewport.copy(p._viewport),h.scissor.copy(p._scissor),h.viewport.multiplyScalar(p._pixelRatio),h.scissor.multiplyScalar(p._pixelRatio),h.scissorTest=p._scissorTest,h.multiview=d!==null?d.multiview:!1,h.resolveDepthBuffer=d!==null?d.resolveDepthBuffer:!0,h._autoAllocateDepthBuffer=d!==null?d._autoAllocateDepthBuffer:!1,h}_renderScene(e,t,n=!0){if(this._isDeviceLost===!0)return;const r=n?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,o=s.renderId,u=this._currentRenderContext,c=this._currentRenderObjectFunction,h=e.isScene===!0?e:jC,d=this._renderTarget||this._outputRenderTarget,p=this._activeCubeFace,g=this._activeMipmapLevel;let _;r!==null?(_=r,this.setRenderTarget(_)):_=d;const v=this._renderContexts.get(e,t,_,this._mrt);this._currentRenderContext=v,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls,this.backend.updateTimeStampUID(v),this.inspector.beginRender(this.backend.getTimestampUID(v),e,t,_);const T=this.coordinateSystem,b=this.xr;if(t.coordinateSystem!==T&&b.isPresenting===!1&&(t.coordinateSystem=T,t.updateProjectionMatrix(),t.isArrayCamera))for(const J of t.cameras)J.coordinateSystem=T,J.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),b.enabled===!0&&b.isPresenting===!0&&(b.cameraAutoUpdate===!0&&b.updateCamera(t),t=b.getCamera());const x=this._canvasTarget;let M=x._viewport,E=x._scissor,w=x._pixelRatio;_!==null&&(M=_.viewport,E=_.scissor,w=1),this.getDrawingBufferSize(Ic),Qx.set(0,0,Ic.width,Ic.height);const C=M.minDepth===void 0?0:M.minDepth,N=M.maxDepth===void 0?1:M.maxDepth;v.viewportValue.copy(M).multiplyScalar(w).floor(),v.viewportValue.width>>=g,v.viewportValue.height>>=g,v.viewportValue.minDepth=C,v.viewportValue.maxDepth=N,v.viewport=v.viewportValue.equals(Qx)===!1,v.scissorValue.copy(E).multiplyScalar(w).floor(),v.scissor=x._scissorTest&&v.scissorValue.equals(Qx)===!1,v.scissorValue.width>>=g,v.scissorValue.height>>=g,v.clippingContext||(v.clippingContext=new P_),v.clippingContext.updateGlobal(h,t),h.onBeforeRender(this,e,t,_);const D=t.isArrayCamera?Jx:Zx;t.isArrayCamera||(Xg.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),D.setFromProjectionMatrix(Xg,t.coordinateSystem,t.reversedDepth));const U=this._renderLists.get(e,t);if(U.begin(),this._projectObject(e,t,0,U,v.clippingContext),U.finish(),this.sortObjects===!0&&U.sort(this._opaqueSort,this._transparentSort),_!==null){this._textures.updateRenderTarget(_,g);const J=this._textures.get(_);v.textures=J.textures,v.depthTexture=J.depthTexture,v.width=J.width,v.height=J.height,v.renderTarget=_,v.depth=_.depthBuffer,v.stencil=_.stencilBuffer}else v.textures=null,v.depthTexture=null,v.width=Ic.width,v.height=Ic.height,v.depth=this.depth,v.stencil=this.stencil;v.width>>=g,v.height>>=g,v.activeCubeFace=p,v.activeMipmapLevel=g,v.occlusionQueryCount=U.occlusionQueryCount,v.scissorValue.max(Xa.set(0,0,0,0)),v.scissorValue.x+v.scissorValue.width>v.width&&(v.scissorValue.width=Math.max(v.width-v.scissorValue.x,0)),v.scissorValue.y+v.scissorValue.height>v.height&&(v.scissorValue.height=Math.max(v.height-v.scissorValue.y,0)),this._background.update(h,U,v),v.camera=t,this.backend.beginRender(v);const{bundles:R,lightsNode:P,transparentDoublePass:I,transparent:H,opaque:X}=U;return R.length>0&&this._renderBundles(R,h,P),this.opaque===!0&&X.length>0&&this._renderObjects(X,t,h,P),this.transparent===!0&&H.length>0&&this._renderTransparents(H,I,t,h,P),this.backend.finishRender(v),s.renderId=o,this._currentRenderContext=u,this._currentRenderObjectFunction=c,r!==null&&(this.setRenderTarget(d,p,g),this._renderOutput(_)),h.onAfterRender(this,e,t,_),this.inspector.finishRender(this.backend.getTimestampUID(v)),v}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,r=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=r}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,n)}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,n)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,n,r){this._canvasTarget.setScissor(e,t,n,r)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,n,r,s=0,o=1){this._canvasTarget.setViewport(e,t,n,r,s,o)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,n=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const r=this._renderTarget||this._getFrameBufferTarget();let s=null;if(r!==null){this._textures.updateRenderTarget(r);const o=this._textures.get(r);s=this._renderContexts.getForClear(r),s.textures=o.textures,s.depthTexture=o.depthTexture,s.width=o.width,s.height=o.height,s.renderTarget=r,s.depth=r.depthBuffer,s.stencil=r.stencilBuffer,s.clearColorValue=this.backend.getClearColor(),s.activeCubeFace=this.getActiveCubeFace(),s.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,n,s),r!==null&&this._renderTarget===null&&this._renderOutput(r)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,n=!0){Vn('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(e,t,n)}async clearColorAsync(){Vn('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){Vn('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){Vn('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const e=this.currentToneMapping!==$i,t=this.currentColorSpace!==vt.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return this._renderTarget!==null?e=this._renderTarget.samples:this.needsFrameBufferTarget&&(e=0),e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:$i}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:vt.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,n=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return Ae("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e,t);const n=this._nodes.nodeFrame,r=n.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,n.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);const s=this.backend,o=this._pipelines,u=this._bindings,c=this._nodes,h=Array.isArray(e)?e:[e];if(h[0]===void 0||h[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");s.beginCompute(e);for(const d of h){if(o.has(d)===!1){const _=()=>{d.removeEventListener("dispose",_),o.delete(d),u.deleteForCompute(d),c.delete(d)};d.addEventListener("dispose",_);const v=d.onInitFunction;v!==null&&v.call(d,{renderer:this})}c.updateForCompute(d),u.updateForCompute(d);const p=u.getForCompute(d),g=o.getForCompute(d,p);s.compute(e,d,p,g,t)}s.finishCompute(e),n.renderId=r,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return Vn('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){Vn('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(e)}initTexture(e){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=Xa.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=Xa.copy(t).floor();else{Re("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=Xa.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,r;n!==null?r=n.renderTarget:(r=this._renderTarget||this._getFrameBufferTarget(),r!==null&&(this._textures.updateRenderTarget(r),n=this._textures.get(r))),this._textures.updateTexture(e,{renderTarget:r}),this.backend.copyFramebufferToTexture(e,n,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,r,s,o),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,n,r,s,o=0,u=0){return this.backend.copyTextureToBuffer(e.textures[o],t,n,r,s,u)}_projectObject(e,t,n,r,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){const c=t.isArrayCamera?Jx:Zx;if(!e.frustumCulled||c.intersectsSprite(e,t)){this.sortObjects===!0&&Xa.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Xg);const{geometry:h,material:d}=e;d.visible&&r.push(e,h,d,n,Xa.z,null,s)}}else if(e.isLineLoop)Re("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const c=t.isArrayCamera?Jx:Zx;if(!e.frustumCulled||c.intersectsObject(e,t)){const{geometry:h,material:d}=e;if(this.sortObjects===!0&&(h.boundingSphere===null&&h.computeBoundingSphere(),Xa.copy(h.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(Xg)),Array.isArray(d)){const p=h.groups;for(let g=0,_=p.length;g<_;g++){const v=p[g],T=d[v.materialIndex];T&&T.visible&&r.push(e,h,T,n,Xa.z,v,s)}}else d.visible&&r.push(e,h,d,n,Xa.z,null,s)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const c=r;r=this._renderLists.get(e,t),r.begin(),c.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}const u=e.children;for(let c=0,h=u.length;c<h;c++)this._projectObject(u[c],t,n,r,s)}_renderBundles(e,t,n){for(const r of e)this._renderBundle(r,t,n)}_renderTransparents(e,t,n,r,s){if(t.length>0){for(const{material:o}of t)o.side=Pn;this._renderObjects(t,n,r,s,"backSide");for(const{material:o}of t)o.side=Jr;this._renderObjects(e,n,r,s);for(const{material:o}of t)o.side=rr}else this._renderObjects(e,n,r,s)}_renderObjects(e,t,n,r,s=null){for(let o=0,u=e.length;o<u;o++){const{object:c,geometry:h,material:d,group:p,clippingContext:g}=e[o];this._currentRenderObjectFunction(c,n,t,h,d,p,r,g,s)}}_getShadowNodes(e){const t=e.version;let n=this._cacheShadowNodes.get(e);if(n===void 0||n.version!==t){const r=e.map!==null,s=e.colorNode&&e.colorNode.isNode,o=e.castShadowNode&&e.castShadowNode.isNode;let u=null,c=null,h=null;if(r||s||o){let d,p;o?(d=e.castShadowNode.rgb,p=e.castShadowNode.a):(d=ve(0),p=ge(1)),r&&(p=p.mul(En("map","texture",e).a)),s&&(p=p.mul(e.colorNode.a)),c=Dt(d,p)}e.depthNode&&e.depthNode.isNode&&(h=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?u=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(u=e.positionNode),n={version:t,colorNode:c,depthNode:h,positionNode:u},this._cacheShadowNodes.set(e,n)}return n}renderObject(e,t,n,r,s,o,u,c=null,h=null){let d=!1,p,g,_,v;if(e.onBeforeRender(this,t,n,r,s,o),s.allowOverride===!0&&t.overrideMaterial!==null){const T=t.overrideMaterial;if(d=!0,p=t.overrideMaterial.colorNode,g=t.overrideMaterial.depthNode,_=t.overrideMaterial.positionNode,v=t.overrideMaterial.side,s.positionNode&&s.positionNode.isNode&&(T.positionNode=s.positionNode),T.alphaTest=s.alphaTest,T.alphaMap=s.alphaMap,T.transparent=s.transparent||s.transmission>0||s.transmissionNode&&s.transmissionNode.isNode||s.backdropNode&&s.backdropNode.isNode,T.isShadowPassMaterial){const{colorNode:b,depthNode:x,positionNode:M}=this._getShadowNodes(s);T.side=s.shadowSide===null?s.side:s.shadowSide,b!==null&&(T.colorNode=b),x!==null&&(T.depthNode=x),M!==null&&(T.positionNode=M)}s=T}s.transparent===!0&&s.side===rr&&s.forceSinglePass===!1?(s.side=Pn,this._handleObjectFunction(e,s,t,n,u,o,c,"backSide"),s.side=Jr,this._handleObjectFunction(e,s,t,n,u,o,c,h),s.side=rr):this._handleObjectFunction(e,s,t,n,u,o,c,h),d&&(t.overrideMaterial.colorNode=p,t.overrideMaterial.depthNode=g,t.overrideMaterial.positionNode=_,t.overrideMaterial.side=v),e.onAfterRender(this,t,n,r,s,o)}_renderObjectDirect(e,t,n,r,s,o,u,c){const h=this._objects.get(e,t,n,r,s,this._currentRenderContext,u,c);h.drawRange=e.geometry.drawRange,h.group=o;const d=this._nodes.needsRefresh(h);d&&(this._nodes.updateBefore(h),this._geometries.updateForRender(h),this._nodes.updateForRender(h),this._bindings.updateForRender(h)),this._pipelines.updateForRender(h),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(h),h.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(h,this.info),d&&this._nodes.updateAfter(h)}_createObjectPipeline(e,t,n,r,s,o,u,c){const h=this._objects.get(e,t,n,r,s,this._currentRenderContext,u,c);h.drawRange=e.geometry.drawRange,h.group=o,this._nodes.updateBefore(h),this._geometries.updateForRender(h),this._nodes.updateForRender(h),this._bindings.updateForRender(h),this._pipelines.getForRender(h,this._compilationPromises),this._nodes.updateAfter(h)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class q3{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}getVisibility(){return this.visibility}clone(){return Object.assign(new this.constructor,this)}}function wX(i){return i+(tl-i%tl)%tl}class $3 extends q3{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t,this._updateRanges=[]}get updateRanges(){return this._updateRanges}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}get byteLength(){return wX(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class j3 extends $3{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let RX=0;class X3 extends j3{constructor(e,t){super("UniformBuffer_"+RX++,e?e.value:null),this.nodeUniform=e,this.groupNode=t,this.isNodeUniformBuffer=!0}set updateRanges(e){this.nodeUniform.updateRanges=e}get updateRanges(){return this.nodeUniform.updateRanges}addUpdateRange(e,t){this.nodeUniform.addUpdateRange(e,t)}clearUpdateRanges(){this.nodeUniform.clearUpdateRanges()}get buffer(){return this.nodeUniform.value}}class CX extends j3{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let n=0,r=this.uniforms.length;n<r;n++){const s=this.uniforms[n],o=s.boundary,u=s.itemSize*e,c=t%tl,h=c%o,d=c+h;t+=h,d!==0&&tl-d<u&&(t+=tl-d),s.offset=t/e,t+=u}return Math.ceil(t/tl)*tl}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);Re("WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s]!==r){const u=this._getBufferForType(o);u[s]=n[s]=r,t=!0}return t}updateVector2(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y){const u=this._getBufferForType(o);u[s+0]=n[s+0]=r.x,u[s+1]=n[s+1]=r.y,t=!0}return t}updateVector3(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y||n[s+2]!==r.z){const u=this._getBufferForType(o);u[s+0]=n[s+0]=r.x,u[s+1]=n[s+1]=r.y,u[s+2]=n[s+2]=r.z,t=!0}return t}updateVector4(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y||n[s+2]!==r.z||n[s+4]!==r.w){const u=this._getBufferForType(o);u[s+0]=n[s+0]=r.x,u[s+1]=n[s+1]=r.y,u[s+2]=n[s+2]=r.z,u[s+3]=n[s+3]=r.w,t=!0}return t}updateColor(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset;if(n[s+0]!==r.r||n[s+1]!==r.g||n[s+2]!==r.b){const o=this.buffer;o[s+0]=n[s+0]=r.r,o[s+1]=n[s+1]=r.g,o[s+2]=n[s+2]=r.b,t=!0}return t}updateMatrix3(e){let t=!1;const n=this.values,r=e.getValue().elements,s=e.offset;if(n[s+0]!==r[0]||n[s+1]!==r[1]||n[s+2]!==r[2]||n[s+4]!==r[3]||n[s+5]!==r[4]||n[s+6]!==r[5]||n[s+8]!==r[6]||n[s+9]!==r[7]||n[s+10]!==r[8]){const o=this.buffer;o[s+0]=n[s+0]=r[0],o[s+1]=n[s+1]=r[1],o[s+2]=n[s+2]=r[2],o[s+4]=n[s+4]=r[3],o[s+5]=n[s+5]=r[4],o[s+6]=n[s+6]=r[5],o[s+8]=n[s+8]=r[6],o[s+9]=n[s+9]=r[7],o[s+10]=n[s+10]=r[8],t=!0}return t}updateMatrix4(e){let t=!1;const n=this.values,r=e.getValue().elements,s=e.offset;return DX(n,r,s)===!1&&(this.buffer.set(r,s),NX(n,r,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function NX(i,e,t){for(let n=0,r=e.length;n<r;n++)i[t+n]=e[n]}function DX(i,e,t){for(let n=0,r=e.length;n<r;n++)if(i[t+n]!==e[n])return!1;return!0}let LX=0;class Y3 extends CX{constructor(e,t){super(e),this.id=LX++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class K3 extends q3{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=t,this.version=t?t.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=e,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}clone(){const e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=0},e.texture=this.texture,e}}let PX=0;class UX extends K3{constructor(e,t){super(e,t),this.id=PX++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class h0 extends UX{constructor(e,t,n,r=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=r}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class Q3 extends h0{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledCubeTexture=!0}}class Jb extends h0{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledTexture3D=!0}}const XC={bitcast_int_uint:new Wi("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }"),bitcast_uint_int:new Wi("uint tsl_bitcast_uint_to_int ( uint x ) { return floatBitsToInt( uintBitsToFloat ( x ) ); }")},OX={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint",floatpack_snorm_2x16:"packSnorm2x16",floatpack_unorm_2x16:"packUnorm2x16",floatpack_float16_2x16:"packHalf2x16",floatunpack_snorm_2x16:"unpackSnorm2x16",floatunpack_unorm_2x16:"unpackUnorm2x16",floatunpack_float16_2x16:"unpackHalf2x16"},BX={low:"lowp",medium:"mediump",high:"highp"},YC={swizzleAssign:!0,storageBuffer:!1},KC={perspective:"smooth",linear:"noperspective"},QC={centroid:"centroid"},ZC=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class FX extends V3{constructor(e,t){super(e,t,new hX),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Rr}_include(e){const t=XC[e];return t.build(this),this.addInclude(t),t}getMethod(e){return XC[e]!==void 0&&this._include(e),OX[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,n){return`${e} ? ${t} : ${n}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${r.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const n=t.array,r=t.count*t.itemSize,{itemSize:s}=t,o=t.array.constructor.name.toLowerCase().includes("int");let u=o?kh:Mp;s===2?u=o?Vh:mr:s===3?u=o?RO:Tp:s===4&&(u=o?Hh:si);const c={Float32Array:ri,Uint8Array:Hn,Uint16Array:Is,Uint32Array:yn,Int8Array:iu,Int16Array:ru,Int32Array:Ni,Uint8ClampedArray:Hn},h=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(r/s))));let d=Math.ceil(r/s/h);h*d*s<r&&d++;const p=h*d*s,g=new n.constructor(p);g.set(n,0),t.array=g;const _=new JS(t.array,h,d,u,c[t.array.constructor.name]||ri);_.needsUpdate=!0,_.isPBOTexture=!0;const v=new Kh(_,null,null);v.setPrecision("high"),t.pboNode=v,t.pbo=v.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,r=t.value;if(this.renderer.backend.has(r)){const d=this.renderer.backend.get(r);d.pbo=r.pbo}const s=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.nodeName),o=this.getPropertyName(s);this.increaseUsage(n);const u=n.build(this,"uint"),c=this.getDataFromNode(e);let h=c.propertyName;if(h===void 0){const d=this.getVarFromNode(e);h=this.getPropertyName(d);const p=this.getDataFromNode(t);let g=p.propertySizeName;g===void 0&&(g=h+"Size",this.getVarFromNode(t,g,"uint"),this.addLineFlowCode(`${g} = uint( textureSize( ${o}, 0 ).x )`,e),p.propertySizeName=g);const{itemSize:_}=r,v="."+jh.join("").slice(0,_),T=`ivec2(${u} % ${g}, ${u} / ${g})`,b=this.generateTextureLoad(null,o,T,"0",null,null);let x="vec4";r.pbo.type===yn?x="uvec4":r.pbo.type===Ni&&(x="ivec4"),this.addLineFlowCode(`${h} = ${x}(${b})${v}`,e),c.propertyName=h}return h}generateTextureLoad(e,t,n,r,s,o){r===null&&(r="0");let u;return s?o?u=`texelFetchOffset( ${t}, ivec3( ${n}, ${s} ), ${r}, ${o} )`:u=`texelFetch( ${t}, ivec3( ${n}, ${s} ), ${r} )`:o?u=`texelFetchOffset( ${t}, ${n}, ${r}, ${o} )`:u=`texelFetch( ${t}, ${n}, ${r} )`,e!==null&&e.isDepthTexture&&(u+=".x"),u}generateTexture(e,t,n,r,s){return r&&(n=`vec3( ${n}, ${r} )`),e.isDepthTexture?s?`textureOffset( ${t}, ${n}, ${s} ).x`:`texture( ${t}, ${n} ).x`:s?`textureOffset( ${t}, ${n}, ${s} )`:`texture( ${t}, ${n} )`}generateTextureLevel(e,t,n,r,s){return s?`textureLodOffset( ${t}, ${n}, ${r}, ${s} )`:`textureLod( ${t}, ${n}, ${r} )`}generateTextureBias(e,t,n,r,s){return s?`textureOffset( ${t}, ${n}, ${s}, ${r} )`:`texture( ${t}, ${n}, ${r} )`}generateTextureGrad(e,t,n,r,s){return s?`textureGradOffset( ${t}, ${n}, ${r[0]}, ${r[1]}, ${s} )`:`textureGrad( ${t}, ${n}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,n,r,s,o,u=this.shaderStage){if(u==="fragment")return e.isCubeTexture?`texture( ${t}, vec4( ${n}, ${r} ) )`:s?o?`textureOffset( ${t}, vec4( ${n}, ${s}, ${r} ), ${o} )`:`texture( ${t}, vec4( ${n}, ${s}, ${r} ) )`:o?`textureOffset( ${t}, vec3( ${n}, ${r} ), ${o} )`:`texture( ${t}, vec3( ${n}, ${r} ) )`;Re(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${u} shader.`)}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const r of n)t.push(`${this.getVar(r.type,r.name,r.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],n=[],r={};for(const o of t){let u=null,c=!1;if(o.type==="texture"||o.type==="texture3D"){const d=o.node.value;let p="";(d.isDataTexture===!0||d.isData3DTexture===!0)&&(d.type===yn?p="u":d.type===Ni&&(p="i")),o.type==="texture3D"&&d.isArrayTexture===!1?u=`${p}sampler3D ${o.name};`:d.compareFunction?d.isArrayTexture===!0?u=`sampler2DArrayShadow ${o.name};`:u=`sampler2DShadow ${o.name};`:d.isArrayTexture===!0||d.isDataArrayTexture===!0||d.isCompressedArrayTexture===!0?u=`${p}sampler2DArray ${o.name};`:u=`${p}sampler2D ${o.name};`}else if(o.type==="cubeTexture")u=`samplerCube ${o.name};`;else if(o.type==="cubeDepthTexture")u=`samplerCubeShadow ${o.name};`;else if(o.type==="buffer"){const d=o.node,p=this.getType(d.bufferType),g=d.bufferCount,_=g>0?g:"";u=`${d.name} {
	${p} ${o.name}[${_}];
};
`}else u=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,c=!0;const h=o.node.precision;if(h!==null&&(u=BX[h]+" "+u),c){u="	"+u;const d=o.groupNode.name;(r[d]||(r[d]=[])).push(u)}else u="uniform "+u,n.push(u)}let s="";for(const o in r){const u=r[o];s+=this._getGLSLUniformStruct(e+"_"+o,u.join(`
`))+`
`}return s+=n.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Ni){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const r=n.array;r instanceof Uint32Array||r instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const n=this.getAttributesArray();let r=0;for(const s of n)t+=`layout( location = ${r++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push(`	${n.type} ${n.name};`);return t.join(`
`)}getStructs(e){const t=[],n=this.structs[e],r=[];for(const s of n)if(s.output)for(const o of s.members)r.push(`layout( location = ${o.index} ) out ${o.type} ${o.name};`);else{let o="struct "+s.name+` {
`;o+=this.getStructMembers(s),o+=`
};
`,t.push(o)}return r.length===0&&r.push("layout( location = 0 ) out vec4 fragColor;"),`
`+r.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const n=this.varyings;if(e==="vertex"||e==="compute")for(const r of n){e==="compute"&&(r.needsInterpolation=!0);const s=this.getType(r.type);if(r.needsInterpolation)if(r.interpolationType){const o=KC[r.interpolationType]||r.interpolationType,u=QC[r.interpolationSampling]||"";t+=`${o} ${u} out ${s} ${r.name};
`}else{const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}out ${s} ${r.name};
`}else t+=`${s} ${r.name};
`}else if(e==="fragment"){for(const r of n)if(r.needsInterpolation){const s=this.getType(r.type);if(r.interpolationType){const o=KC[r.interpolationType]||r.interpolationType,u=QC[r.interpolationSampling]||"";t+=`${o} ${u} in ${s} ${r.name};
`}else{const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}in ${s} ${r.name};
`}}}for(const r of this.builtins[e])t+=`${r};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((n,r)=>n*r,1)}u`}getSubgroupSize(){Re("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){Re("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){Re("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,n=this.shaderStage){const r=this.extensions[n]||(this.extensions[n]=new Map);r.has(e)===!1&&r.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const r=this.renderer.backend.extensions;this.object.isBatchedMesh&&r.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(n!==void 0)for(const{name:r,behavior:s}of n.values())t.push(`#extension ${r} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=YC[e];if(t===void 0){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance";break}if(n!==void 0){const r=this.renderer.backend.extensions;r.has(n)&&(r.get(n),t=!0)}YC[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const r=e[n],s=this.getPropertyName(r.attributeNode);s&&(t+=`${r.varyingName} = ${s};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${ZC}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${ZC}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n=`// code

`;n+=this.flowCode[t];const r=this.flowNodes[t],s=r[r.length-1];for(const u of r){const c=this.getFlowData(u),h=u.name;h&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${h}
	`),n+=`${c.code}
	`,u===s&&t!=="compute"&&(n+=`// result
	`,t==="vertex"?(n+="gl_Position = ",n+=`${c.result};`):t==="fragment"&&(u.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${c.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n,r=null){const s=super.getUniformFromNode(e,t,n,r),o=this.getDataFromNode(e,n,this.globalCache);let u=o.uniformGPU;if(u===void 0){const c=e.groupNode,h=c.name,d=this.getBindGroupArray(h,n);if(t==="texture")u=new h0(s.name,s.node,c),d.push(u);else if(t==="cubeTexture"||t==="cubeDepthTexture")u=new Q3(s.name,s.node,c),d.push(u);else if(t==="texture3D")u=new Jb(s.name,s.node,c),d.push(u);else if(t==="buffer"){s.name=`buffer${e.id}`;const p=this.getSharedDataFromNode(e);let g=p.buffer;g===void 0&&(e.name=`NodeBuffer_${e.id}`,g=new X3(e,c),g.name=e.name,p.buffer=g),d.push(g),u=g}else{const p=this.uniformGroups[n]||(this.uniformGroups[n]={});let g=p[h];g===void 0&&(g=new Y3(n+"_"+h,c),p[h]=g,d.push(g)),u=this.getNodeUniform(s,t),g.addUniform(u)}o.uniformGPU=u}return s}}let eb=null,zc=null;class Z3{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[ca.RENDER]:null,[ca.COMPUTE]:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){const t=this.get(e),n=this.renderer.info.frame;let r;e.isComputeNode===!0?r="c:"+this.renderer.info.compute.frameCalls:r="r:"+this.renderer.info.render.frameCalls,t.timestampUID=r+":"+e.id+":f"+n}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){const t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){const t=e.startsWith("c:")?ca.COMPUTE:ca.RENDER;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){Vn("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t)return;const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return eb=eb||new Ue,this.renderer.getDrawingBufferSize(eb)}setScissorTest(){}getClearColor(){const e=this.renderer;return zc=zc||new OT,e.getClearColor(zc),zc.getRGB(zc),zc}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:$N(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Tu} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}deleteBindGroupData(){}dispose(){}}let IX=0;class zX{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class GX{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:r}=n,s=e.array,o=e.usage||r.STATIC_DRAW,u=e.isInterleavedBufferAttribute?e.data:e,c=n.get(u);let h=c.bufferGPU;h===void 0&&(h=this._createBuffer(r,t,s,o),c.bufferGPU=h,c.bufferType=t,c.version=u.version);let d;if(s instanceof Float32Array)d=r.FLOAT;else if(typeof Float16Array<"u"&&s instanceof Float16Array)d=r.HALF_FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?d=r.HALF_FLOAT:d=r.UNSIGNED_SHORT;else if(s instanceof Int16Array)d=r.SHORT;else if(s instanceof Uint32Array)d=r.UNSIGNED_INT;else if(s instanceof Int32Array)d=r.INT;else if(s instanceof Int8Array)d=r.BYTE;else if(s instanceof Uint8Array)d=r.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)d=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let p={bufferGPU:h,bufferType:t,type:d,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:d===r.INT||d===r.UNSIGNED_INT||e.gpuType===Ni,id:IX++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const g=this._createBuffer(r,t,s,o);p=new zX(p,g)}n.set(e,p)}updateAttribute(e){const t=this.backend,{gl:n}=t,r=e.array,s=e.isInterleavedBufferAttribute?e.data:e,o=t.get(s),u=o.bufferType,c=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(u,o.bufferGPU),c.length===0)n.bufferSubData(u,0,r);else{for(let h=0,d=c.length;h<d;h++){const p=c[h];n.bufferSubData(u,p.start*r.BYTES_PER_ELEMENT,r,p.start,p.count)}s.clearUpdateRanges()}n.bindBuffer(u,null),o.version=s.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const r=t.get(e);n.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(r),o=e.array,u=o.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,s);const c=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.bufferData(n.COPY_WRITE_BUFFER,u,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,u),await t.utils._clientWaitAsync();const h=new e.array.constructor(o.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,h),n.deleteBuffer(c),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),h.buffer}_createBuffer(e,t,n,r){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,n,r),e.bindBuffer(t,null),s}}let tb,Md;class kX{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;tb={[sr]:e.FUNC_ADD,[vS]:e.FUNC_SUBTRACT,[yS]:e.FUNC_REVERSE_SUBTRACT},Md={[Ka]:e.ZERO,[xS]:e.ONE,[bS]:e.SRC_COLOR,[Jd]:e.SRC_ALPHA,[wS]:e.SRC_ALPHA_SATURATE,[ES]:e.DST_COLOR,[TS]:e.DST_ALPHA,[SS]:e.ONE_MINUS_SRC_COLOR,[ep]:e.ONE_MINUS_SRC_ALPHA,[AS]:e.ONE_MINUS_DST_COLOR,[MS]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=new Lt().fromArray(t),this.currentViewport=new Lt().fromArray(n),this._tempVec4=new Lt}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==FN?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===yb?t.cullFace(t.BACK):e===IN?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setMRTBlending(e){const t=this.gl,n=this.backend.drawBuffersIndexedExt;if(n)for(let r=1;r<e.length;r++)n.blendFuncSeparateiOES(r,t.ONE,t.ZERO,t.ONE,t.ZERO)}setBlending(e,t,n,r,s,o,u,c){const{gl:h}=this;if(e===_r){this.currentBlendingEnabled===!0&&(this.disable(h.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(h.BLEND),this.currentBlendingEnabled=!0),e!==jc){if(e!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==sr||this.currentBlendEquationAlpha!==sr)&&(h.blendEquation(h.FUNC_ADD),this.currentBlendEquation=sr,this.currentBlendEquationAlpha=sr),c)switch(e){case es:h.blendFuncSeparate(h.ONE,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);break;case eh:h.blendFunc(h.ONE,h.ONE);break;case th:h.blendFuncSeparate(h.ZERO,h.ONE_MINUS_SRC_COLOR,h.ZERO,h.ONE);break;case nh:h.blendFuncSeparate(h.DST_COLOR,h.ONE_MINUS_SRC_ALPHA,h.ZERO,h.ONE);break;default:Re("WebGLState: Invalid blending: ",e);break}else switch(e){case es:h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);break;case eh:h.blendFuncSeparate(h.SRC_ALPHA,h.ONE,h.ONE,h.ONE);break;case th:Re("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case nh:Re("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Re("WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=c}return}s=s||t,o=o||n,u=u||r,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(h.blendEquationSeparate(tb[t],tb[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(n!==this.currentBlendSrc||r!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||u!==this.currentBlendDstAlpha)&&(h.blendFuncSeparate(Md[n],Md[r],Md[o],Md[u]),this.currentBlendSrc=n,this.currentBlendDst=r,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=u),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case tp:t.depthFunc(t.NEVER);break;case np:t.depthFunc(t.ALWAYS);break;case ip:t.depthFunc(t.LESS);break;case hl:t.depthFunc(t.LEQUAL);break;case rp:t.depthFunc(t.EQUAL);break;case sp:t.depthFunc(t.GEQUAL);break;case ap:t.depthFunc(t.GREATER);break;case op:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,r){const s=this._tempVec4.set(e,t,n,r);if(this.currentScissor.equals(s)===!1){const{gl:o}=this;o.scissor(s.x,s.y,s.z,s.w),this.currentScissor.copy(s)}}viewport(e,t,n,r){const s=this._tempVec4.set(e,t,n,r);if(this.currentViewport.equals(s)===!1){const{gl:o}=this;o.viewport(s.x,s.y,s.z,s.w),this.currentViewport.copy(s)}}setScissorTest(e){const t=this.gl;e?this.enable(t.SCISSOR_TEST):this.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:r}=this;e.side===rr?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let s=e.side===Pn;t&&(s=!s),this.setFlipSided(s),e.blending===es&&e.transparent===!1?this.setBlending(_r):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n)for(let c=0;c<8;c++)c<n?this.enable(12288+c):this.disable(12288+c)}setPolygonOffset(e,t,n){const{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==n)&&(r.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const n=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(n.bindVertexArray(e),t!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:r}=this;return r[e]!==t?(n.bindFramebuffer(e,t),r[e]=t,e===n.DRAW_FRAMEBUFFER&&(r[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(r[n.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:n}=this;let r=[],s=!1;if(e.textures!==null){r=this.currentDrawbuffers.get(t),r===void 0&&(r=[],this.currentDrawbuffers.set(t,r));const o=e.textures;if(r.length!==o.length||r[0]!==n.COLOR_ATTACHMENT0){for(let u=0,c=o.length;u<c;u++)r[u]=n.COLOR_ATTACHMENT0+u;r.length=o.length,s=!0}}else r[0]!==n.BACK&&(r[0]=n.BACK,s=!0);s&&n.drawBuffers(r)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:r}=this;e===void 0&&(e=t.TEXTURE0+r-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:r,currentTextureSlot:s,currentBoundTextures:o,maxTextures:u}=this;n===void 0&&(s===null?n=r.TEXTURE0+u-1:n=s);let c=o[n];c===void 0&&(c={type:void 0,texture:void 0},o[n]=c),(c.type!==e||c.texture!==t)&&(s!==n&&(r.activeTexture(n),this.currentTextureSlot=n),r.bindTexture(e,t),c.type=e,c.texture=t)}bindBufferBase(e,t,n){const{gl:r}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==n?(r.bindBufferBase(e,t,n),this.currentBoundBufferBases[s]=n,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,r=n[t];r!==void 0&&r.type!==void 0&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class VX{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Rr){const{gl:n,extensions:r}=this;let s;const o=vt.getTransfer(t);if(e===Hn)return n.UNSIGNED_BYTE;if(e===z_)return n.UNSIGNED_SHORT_4_4_4_4;if(e===G_)return n.UNSIGNED_SHORT_5_5_5_1;if(e===k_)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===V_)return n.UNSIGNED_INT_10F_11F_11F_REV;if(e===iu)return n.BYTE;if(e===ru)return n.SHORT;if(e===Is)return n.UNSIGNED_SHORT;if(e===Ni)return n.INT;if(e===yn)return n.UNSIGNED_INT;if(e===ri)return n.FLOAT;if(e===Zn)return n.HALF_FLOAT;if(e===BS)return n.ALPHA;if(e===Tp)return n.RGB;if(e===si)return n.RGBA;if(e===ji)return n.DEPTH_COMPONENT;if(e===pr)return n.DEPTH_STENCIL;if(e===Mp)return n.RED;if(e===kh)return n.RED_INTEGER;if(e===mr)return n.RG;if(e===Vh)return n.RG_INTEGER;if(e===Hh)return n.RGBA_INTEGER;if(e===sl||e===al||e===ol||e===ll)if(o===Ye)if(s=r.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===sl)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===al)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===ol)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===ll)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=r.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===sl)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===al)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===ol)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===ll)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===lp||e===up||e===cp||e===hp)if(s=r.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===lp)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===up)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===cp)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===hp)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===sh||e===ah||e===oh||e===lh||e===uh||e===du||e===ch)if(s=r.get("WEBGL_compressed_texture_etc"),s!==null){if(e===sh||e===ah)return o===Ye?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===oh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC;if(e===lh)return s.COMPRESSED_R11_EAC;if(e===uh)return s.COMPRESSED_SIGNED_R11_EAC;if(e===du)return s.COMPRESSED_RG11_EAC;if(e===ch)return s.COMPRESSED_SIGNED_RG11_EAC}else return null;if(e===hh||e===fh||e===dh||e===ph||e===mh||e===gh||e===_h||e===vh||e===yh||e===xh||e===bh||e===Sh||e===Th||e===Mh)if(s=r.get("WEBGL_compressed_texture_astc"),s!==null){if(e===hh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===fh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===dh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===ph)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===mh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===gh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===_h)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===vh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===yh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===xh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===bh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Sh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===Th)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===Mh)return o===Ye?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===Eh)if(s=r.get("EXT_texture_compression_bptc"),s!==null){if(e===Eh)return o===Ye?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===Ah||e===wh||e===pu||e===Rh)if(s=r.get("EXT_texture_compression_rgtc"),s!==null){if(e===Ah)return s.COMPRESSED_RED_RGTC1_EXT;if(e===wh)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===pu)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===Rh)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===ts?n.UNSIGNED_INT_24_8:n[e]!==void 0?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,r)=>{function s(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(t),r();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),n()}s()})}}let JC=!1,Yg,nb,eN;class HX{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,JC===!1&&(this._init(),JC=!0)}_init(){const e=this.gl;Yg={[hu]:e.REPEAT,[Nr]:e.CLAMP_TO_EDGE,[fu]:e.MIRRORED_REPEAT},nb={[xn]:e.NEAREST,[OS]:e.NEAREST_MIPMAP_NEAREST,[ro]:e.NEAREST_MIPMAP_LINEAR,[Gn]:e.LINEAR,[Xc]:e.LINEAR_MIPMAP_NEAREST,[Dr]:e.LINEAR_MIPMAP_LINEAR},eN={[FS]:e.NEVER,[kS]:e.ALWAYS,[Ep]:e.LESS,[Ap]:e.LEQUAL,[IS]:e.EQUAL,[wp]:e.GEQUAL,[zS]:e.GREATER,[GS]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return e.isCubeTexture===!0?n=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?n=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?n=t.TEXTURE_3D:n=t.TEXTURE_2D,n}getInternalFormat(e,t,n,r,s=!1){const{gl:o,extensions:u}=this;if(e!==null){if(o[e]!==void 0)return o[e];Ae("WebGLBackend: Attempt to use non-existing WebGL internal format '"+e+"'")}let c=t;if(t===o.RED&&(n===o.FLOAT&&(c=o.R32F),n===o.HALF_FLOAT&&(c=o.R16F),n===o.UNSIGNED_BYTE&&(c=o.R8),n===o.UNSIGNED_SHORT&&(c=o.R16),n===o.UNSIGNED_INT&&(c=o.R32UI),n===o.BYTE&&(c=o.R8I),n===o.SHORT&&(c=o.R16I),n===o.INT&&(c=o.R32I)),t===o.RED_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.R8UI),n===o.UNSIGNED_SHORT&&(c=o.R16UI),n===o.UNSIGNED_INT&&(c=o.R32UI),n===o.BYTE&&(c=o.R8I),n===o.SHORT&&(c=o.R16I),n===o.INT&&(c=o.R32I)),t===o.RG&&(n===o.FLOAT&&(c=o.RG32F),n===o.HALF_FLOAT&&(c=o.RG16F),n===o.UNSIGNED_BYTE&&(c=o.RG8),n===o.UNSIGNED_SHORT&&(c=o.RG16),n===o.UNSIGNED_INT&&(c=o.RG32UI),n===o.BYTE&&(c=o.RG8I),n===o.SHORT&&(c=o.RG16I),n===o.INT&&(c=o.RG32I)),t===o.RG_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RG8UI),n===o.UNSIGNED_SHORT&&(c=o.RG16UI),n===o.UNSIGNED_INT&&(c=o.RG32UI),n===o.BYTE&&(c=o.RG8I),n===o.SHORT&&(c=o.RG16I),n===o.INT&&(c=o.RG32I)),t===o.RGB){const h=s?Ch:vt.getTransfer(r);n===o.FLOAT&&(c=o.RGB32F),n===o.HALF_FLOAT&&(c=o.RGB16F),n===o.UNSIGNED_BYTE&&(c=o.RGB8),n===o.UNSIGNED_SHORT&&(c=o.RGB16),n===o.UNSIGNED_INT&&(c=o.RGB32UI),n===o.BYTE&&(c=o.RGB8I),n===o.SHORT&&(c=o.RGB16I),n===o.INT&&(c=o.RGB32I),n===o.UNSIGNED_BYTE&&(c=h===Ye?o.SRGB8:o.RGB8),n===o.UNSIGNED_SHORT_5_6_5&&(c=o.RGB565),n===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1),n===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGB4),n===o.UNSIGNED_INT_5_9_9_9_REV&&(c=o.RGB9_E5),n===o.UNSIGNED_INT_10F_11F_11F_REV&&(c=o.R11F_G11F_B10F)}if(t===o.RGB_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RGB8UI),n===o.UNSIGNED_SHORT&&(c=o.RGB16UI),n===o.UNSIGNED_INT&&(c=o.RGB32UI),n===o.BYTE&&(c=o.RGB8I),n===o.SHORT&&(c=o.RGB16I),n===o.INT&&(c=o.RGB32I)),t===o.RGBA){const h=s?Ch:vt.getTransfer(r);n===o.FLOAT&&(c=o.RGBA32F),n===o.HALF_FLOAT&&(c=o.RGBA16F),n===o.UNSIGNED_BYTE&&(c=o.RGBA8),n===o.UNSIGNED_SHORT&&(c=o.RGBA16),n===o.UNSIGNED_INT&&(c=o.RGBA32UI),n===o.BYTE&&(c=o.RGBA8I),n===o.SHORT&&(c=o.RGBA16I),n===o.INT&&(c=o.RGBA32I),n===o.UNSIGNED_BYTE&&(c=h===Ye?o.SRGB8_ALPHA8:o.RGBA8),n===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGBA4),n===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1)}return t===o.RGBA_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RGBA8UI),n===o.UNSIGNED_SHORT&&(c=o.RGBA16UI),n===o.UNSIGNED_INT&&(c=o.RGBA32UI),n===o.BYTE&&(c=o.RGBA8I),n===o.SHORT&&(c=o.RGBA16I),n===o.INT&&(c=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(n===o.UNSIGNED_SHORT&&(c=o.DEPTH_COMPONENT16),n===o.UNSIGNED_INT&&(c=o.DEPTH_COMPONENT24),n===o.FLOAT&&(c=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&n===o.UNSIGNED_INT_24_8&&(c=o.DEPTH24_STENCIL8),(c===o.R16F||c===o.R32F||c===o.RG16F||c===o.RG32F||c===o.RGBA16F||c===o.RGBA32F)&&u.get("EXT_color_buffer_float"),c}setTextureParameters(e,t){const{gl:n,extensions:r,backend:s}=this,o=vt.getPrimaries(vt.workingColorSpace),u=t.colorSpace===Rr?null:vt.getPrimaries(t.colorSpace),c=t.colorSpace===Rr||o===u?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,c),n.texParameteri(e,n.TEXTURE_WRAP_S,Yg[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,Yg[t.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||n.texParameteri(e,n.TEXTURE_WRAP_R,Yg[t.wrapR])),n.texParameteri(e,n.TEXTURE_MAG_FILTER,nb[t.magFilter]);const h=t.mipmaps!==void 0&&t.mipmaps.length>0,d=t.minFilter===Gn&&h?Dr:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,nb[d]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,eN[t.compareFunction])),r.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===xn||t.minFilter!==ro&&t.minFilter!==Dr||t.type===ri&&r.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const p=r.get("EXT_texture_filter_anisotropic");n.texParameterf(e,p.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:r}=this,s=this.getGLTextureType(e);let o=r[s];o===void 0&&(o=t.createTexture(),n.state.bindTexture(s,o),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),r[s]=o),n.set(e,{textureGPU:o,glTextureType:s})}createTexture(e,t){const{gl:n,backend:r}=this,{levels:s,width:o,height:u,depth:c}=t,h=r.utils.convert(e.format,e.colorSpace),d=r.utils.convert(e.type),p=this.getInternalFormat(e.internalFormat,h,d,e.colorSpace,e.isVideoTexture),g=n.createTexture(),_=this.getGLTextureType(e);r.state.bindTexture(_,g),this.setTextureParameters(_,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,s,p,o,u,c):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,s,p,o,u,c):e.isVideoTexture||n.texStorage2D(_,s,p,o,u),r.set(e,{textureGPU:g,glTextureType:_,glFormat:h,glType:d,glInternalFormat:p})}copyBufferToTexture(e,t){const{gl:n,backend:r}=this,{textureGPU:s,glTextureType:o,glFormat:u,glType:c}=r.get(t),{width:h,height:d}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(o,s),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(o,0,0,0,h,d,u,c,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:r,height:s}=t,{textureGPU:o,glTextureType:u,glFormat:c,glType:h,glInternalFormat:d}=this.backend.get(e);if(!(e.isRenderTargetTexture||o===void 0))if(this.backend.state.bindTexture(u,o),this.setTextureParameters(u,e),e.isCompressedTexture){const p=e.mipmaps,g=t.image;for(let _=0;_<p.length;_++){const v=p[_];e.isCompressedArrayTexture?e.format!==n.RGBA?c!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,_,0,0,0,v.width,v.height,g.depth,c,v.data):Ae("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,_,0,0,0,v.width,v.height,g.depth,c,h,v.data):c!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,_,0,0,v.width,v.height,c,v.data):Ae("WebGLBackend: Unsupported compressed texture format")}}else if(e.isCubeTexture){const p=t.images,g=e.mipmaps;for(let _=0;_<6;_++){const v=Kg(p[_]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+_,0,0,0,r,s,c,h,v);for(let T=0;T<g.length;T++){const b=g[T],x=Kg(b.images[_]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+_,T+1,0,0,x.width,x.height,c,h,x)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const p=t.image;if(e.layerUpdates.size>0){const g=Mb(p.width,p.height,e.format,e.type);for(const _ of e.layerUpdates){const v=p.data.subarray(_*g/p.data.BYTES_PER_ELEMENT,(_+1)*g/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,_,p.width,p.height,1,c,h,v)}e.clearLayerUpdates()}else n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,c,h,p.data)}else if(e.isData3DTexture){const p=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,c,h,p.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(u,0,d,c,h,t.image);else{const p=e.mipmaps;if(p.length>0)for(let g=0,_=p.length;g<_;g++){const v=p[g],T=Kg(v);n.texSubImage2D(u,g,0,0,v.width,v.height,c,h,T)}else{const g=Kg(t.image);n.texSubImage2D(u,0,0,0,r,s,c,h,g)}}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:r,glTextureType:s}=n.get(e);n.state.bindTexture(s,r),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const r=n.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const s in r.framebuffers)t.deleteFramebuffer(r.framebuffers[s]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let s=0;s<r.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(r.msaaRenderbuffers[s]);delete r.msaaRenderbuffers}}}destroyTexture(e,t=!1){const{gl:n,backend:r}=this,{textureGPU:s,renderTarget:o}=r.get(e);this.deallocateRenderBuffers(o),t===!1&&n.deleteTexture(s),r.delete(e)}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){const{gl:u,backend:c}=this,{state:h}=this.backend,{textureGPU:d,glTextureType:p,glType:g,glFormat:_}=c.get(t);h.bindTexture(p,d);let v,T,b,x,M,E,w,C,N;const D=e.isCompressedTexture?e.mipmaps[o]:e.image;if(n!==null)v=n.max.x-n.min.x,T=n.max.y-n.min.y,b=n.isBox3?n.max.z-n.min.z:1,x=n.min.x,M=n.min.y,E=n.isBox3?n.min.z:0;else{const ne=Math.pow(2,-s);v=Math.floor(D.width*ne),T=Math.floor(D.height*ne),e.isDataArrayTexture||e.isArrayTexture?b=D.depth:e.isData3DTexture?b=Math.floor(D.depth*ne):b=1,x=0,M=0,E=0}r!==null?(w=r.x,C=r.y,N=r.z):(w=0,C=0,N=0),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,t.flipY),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),u.pixelStorei(u.UNPACK_ALIGNMENT,t.unpackAlignment);const U=u.getParameter(u.UNPACK_ROW_LENGTH),R=u.getParameter(u.UNPACK_IMAGE_HEIGHT),P=u.getParameter(u.UNPACK_SKIP_PIXELS),I=u.getParameter(u.UNPACK_SKIP_ROWS),H=u.getParameter(u.UNPACK_SKIP_IMAGES);u.pixelStorei(u.UNPACK_ROW_LENGTH,D.width),u.pixelStorei(u.UNPACK_IMAGE_HEIGHT,D.height),u.pixelStorei(u.UNPACK_SKIP_PIXELS,x),u.pixelStorei(u.UNPACK_SKIP_ROWS,M),u.pixelStorei(u.UNPACK_SKIP_IMAGES,E);const X=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,J=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){const ne=c.get(e),G=c.get(t),z=c.get(ne.renderTarget),q=c.get(G.renderTarget),ce=z.framebuffers[ne.cacheKey],xe=q.framebuffers[G.cacheKey];h.bindFramebuffer(u.READ_FRAMEBUFFER,ce),h.bindFramebuffer(u.DRAW_FRAMEBUFFER,xe);for(let O=0;O<b;O++)X&&(u.framebufferTextureLayer(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,ne.textureGPU,s,E+O),u.framebufferTextureLayer(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0,d,o,N+O)),u.blitFramebuffer(x,M,v,T,w,C,v,T,u.DEPTH_BUFFER_BIT,u.NEAREST);h.bindFramebuffer(u.READ_FRAMEBUFFER,null),h.bindFramebuffer(u.DRAW_FRAMEBUFFER,null)}else if(s!==0||e.isRenderTargetTexture||c.has(e)){const ne=c.get(e);this._srcFramebuffer===null&&(this._srcFramebuffer=u.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=u.createFramebuffer()),h.bindFramebuffer(u.READ_FRAMEBUFFER,this._srcFramebuffer),h.bindFramebuffer(u.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let G=0;G<b;G++)X?u.framebufferTextureLayer(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,ne.textureGPU,s,E+G):u.framebufferTexture2D(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,ne.textureGPU,s),J?u.framebufferTextureLayer(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0,d,o,N+G):u.framebufferTexture2D(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,d,o),s!==0?u.blitFramebuffer(x,M,v,T,w,C,v,T,u.COLOR_BUFFER_BIT,u.NEAREST):J?u.copyTexSubImage3D(p,o,w,C,N+G,x,M,v,T):u.copyTexSubImage2D(p,o,w,C,x,M,v,T);h.bindFramebuffer(u.READ_FRAMEBUFFER,null),h.bindFramebuffer(u.DRAW_FRAMEBUFFER,null)}else J?e.isDataTexture||e.isData3DTexture?u.texSubImage3D(p,o,w,C,N,v,T,b,_,g,D.data):t.isCompressedArrayTexture?u.compressedTexSubImage3D(p,o,w,C,N,v,T,b,_,D.data):u.texSubImage3D(p,o,w,C,N,v,T,b,_,g,D):e.isDataTexture?u.texSubImage2D(u.TEXTURE_2D,o,w,C,v,T,_,g,D.data):e.isCompressedTexture?u.compressedTexSubImage2D(u.TEXTURE_2D,o,w,C,D.width,D.height,_,D.data):u.texSubImage2D(u.TEXTURE_2D,o,w,C,v,T,_,g,D);u.pixelStorei(u.UNPACK_ROW_LENGTH,U),u.pixelStorei(u.UNPACK_IMAGE_HEIGHT,R),u.pixelStorei(u.UNPACK_SKIP_PIXELS,P),u.pixelStorei(u.UNPACK_SKIP_ROWS,I),u.pixelStorei(u.UNPACK_SKIP_IMAGES,H),o===0&&t.generateMipmaps&&u.generateMipmap(p),h.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:r}=this,{state:s}=this.backend,{textureGPU:o}=this.backend.get(e),{x:u,y:c,z:h,w:d}=n,p=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,g=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(p){const _=u!==0||c!==0;let v,T;if(e.isDepthTexture===!0?(v=r.DEPTH_BUFFER_BIT,T=r.DEPTH_ATTACHMENT,t.stencil&&(v|=r.STENCIL_BUFFER_BIT)):(v=r.COLOR_BUFFER_BIT,T=r.COLOR_ATTACHMENT0),_){const b=this.backend.get(t.renderTarget),x=b.framebuffers[t.getCacheKey()],M=b.msaaFrameBuffer;s.bindFramebuffer(r.DRAW_FRAMEBUFFER,x),s.bindFramebuffer(r.READ_FRAMEBUFFER,M);const E=g-c-d;r.blitFramebuffer(u,E,u+h,E+d,u,E,u+h,E+d,v,r.NEAREST),s.bindFramebuffer(r.READ_FRAMEBUFFER,x),s.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,u,E,h,d),s.unbindTexture()}else{const b=r.createFramebuffer();s.bindFramebuffer(r.DRAW_FRAMEBUFFER,b),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,T,r.TEXTURE_2D,o,0),r.blitFramebuffer(0,0,h,d,0,0,h,d,v,r.NEAREST),r.deleteFramebuffer(b)}}else s.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,u,g-d-c,h,d),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n,r=!1){const{gl:s}=this,o=t.renderTarget,{depthTexture:u,depthBuffer:c,stencilBuffer:h,width:d,height:p}=o;if(s.bindRenderbuffer(s.RENDERBUFFER,e),c&&!h){let g=s.DEPTH_COMPONENT24;r===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(s.RENDERBUFFER,o.samples,g,d,p):n>0?(u&&u.isDepthTexture&&u.type===s.FLOAT&&(g=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,n,g,d,p)):s.renderbufferStorage(s.RENDERBUFFER,g,d,p),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e)}else c&&h&&(n>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.DEPTH24_STENCIL8,d,p):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,d,p),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e));s.bindRenderbuffer(s.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,n,r,s,o){const{backend:u,gl:c}=this,{textureGPU:h,glFormat:d,glType:p}=this.backend.get(e),g=c.createFramebuffer();u.state.bindFramebuffer(c.READ_FRAMEBUFFER,g);const _=e.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+o:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,_,h,0);const v=this._getTypedArrayType(p),T=this._getBytesPerTexel(p,d),x=r*s*T,M=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,M),c.bufferData(c.PIXEL_PACK_BUFFER,x,c.STREAM_READ),c.readPixels(t,n,r,s,d,p,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await u.utils._clientWaitAsync();const E=new v(x/v.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,M),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,E),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),u.state.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.deleteFramebuffer(g),E}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:n}=this;let r=0;if(e===n.UNSIGNED_BYTE&&(r=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(r=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(r=4),t===n.RGBA)return r*4;if(t===n.RGB)return r*3;if(t===n.ALPHA)return r}dispose(){const{gl:e}=this;this._srcFramebuffer!==null&&e.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&e.deleteFramebuffer(this._dstFramebuffer)}}function Kg(i){return i.isDataTexture?i.image.data:typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?i:i.data}class WX{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class qX{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const tN={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class $X{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:r,object:s,type:o,info:u,index:c}=this;c!==0?n.drawElements(r,t,o,e):n.drawArrays(r,e,t),u.update(s,t,1)}renderInstances(e,t,n){const{gl:r,mode:s,type:o,index:u,object:c,info:h}=this;n!==0&&(u!==0?r.drawElementsInstanced(s,t,o,e,n):r.drawArraysInstanced(s,e,t,n),h.update(c,t,n))}renderMultiDraw(e,t,n){const{extensions:r,mode:s,object:o,info:u}=this;if(n===0)return;const c=r.get("WEBGL_multi_draw");if(c===null)for(let h=0;h<n;h++)this.render(e[h],t[h]);else{this.index!==0?c.multiDrawElementsWEBGL(s,t,0,this.type,e,0,n):c.multiDrawArraysWEBGL(s,e,0,t,0,n);let h=0;for(let d=0;d<n;d++)h+=t[d];u.update(o,h,1)}}renderMultiDrawInstances(e,t,n,r){const{extensions:s,mode:o,object:u,info:c}=this;if(n===0)return;const h=s.get("WEBGL_multi_draw");if(h===null)for(let d=0;d<n;d++)this.renderInstances(e[d],t[d],r[d]);else{this.index!==0?h.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,r,0,n):h.multiDrawArraysInstancedWEBGL(o,e,0,t,0,r,0,n);let d=0;for(let p=0;p<n;p++)d+=t[p]*r[p];c.update(u,d,1)}}}class J3{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return t===void 0&&(Ae(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class jX extends J3{constructor(e,t,n=2048){if(super(n),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){Ae("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let r=0;r<this.maxQueries;r++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return Vn(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;const n=this.queries[t];if(n)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(r){Re("Error in beginQuery:",r),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(n){Re("Error in endQuery:",n),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=new Map;for(const[s,o]of this.queryOffsets)if(this.queryStates.get(o)==="ended"){const c=this.queries[o];e.set(s,this.resolveQuery(c))}if(e.size===0)return this.lastValue;const t={},n=[];for(const[s,o]of e){const u=s.match(/^(.*):f(\d+)$/),c=parseInt(u[2]);n.includes(c)===!1&&n.push(c),t[c]===void 0&&(t[c]=0);const h=await o;this.timestamps.set(s,h),t[c]+=h}const r=t[n[n.length-1]];return this.lastValue=r,this.frames=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,r}catch(e){return Re("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let n,r=!1;const s=()=>{n&&(clearTimeout(n),n=null)},o=c=>{r||(r=!0,s(),t(c))},u=()=>{if(this.isDisposed){o(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){o(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){n=setTimeout(u,1);return}const d=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(d)/1e6)}catch(c){Re("Error checking query:",c),t(this.lastValue)}};u()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class nN extends Z3{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},r=t.context!==void 0?t.context:e.domElement.getContext("webgl2",n);function s(o){o.preventDefault();const u={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(u)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=r,this.extensions=new WX(this),this.capabilities=new qX(this),this.attributeUtils=new GX(this),this.textureUtils=new HX(this),this.bufferRenderer=new $X(this),this.state=new kX(this),this.utils=new VX(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this.drawBuffersIndexedExt=this.extensions.get("OES_draw_buffers_indexed")}get coordinateSystem(){return gr}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,n=null){const r=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:r.RGBA8}),n!==null){const s=e.stencilBuffer?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:s}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&Ae("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new jX(this.gl,e,2048));const n=this.timestampQueryPool[e];n.allocateQueriesForContext(t)!==null&&n.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,n=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:s,height:o}=this.getDrawingBufferSize();t.viewport(0,0,s,o)}if(e.scissor){const{x:s,y:o,width:u,height:c}=e.scissorValue;t.scissor(s,e.height-c-o,u,c)}this.initTimestampQuery(ca.RENDER,this.getTimestampUID(e)),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const r=e.occlusionQueryCount;r>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(r),n.occlusionQueryObjects=new Array(r),n.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,r=this.get(e),s=r.previousContext;n.resetVertexState();const o=e.occlusionQueryCount;o>0&&(o>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const u=e.textures;if(u!==null)for(let c=0;c<u.length;c++){const h=u[c];h.generateMipmaps&&this.generateMipmaps(h)}if(this._currentContext=s,this._resolveRenderTarget(e),s!==null)if(this._setFramebuffer(s),s.viewport)this.updateViewport(s);else{const{width:c,height:h}=this.getDrawingBufferSize();n.viewport(0,0,c,h)}this.prepareTimestampBuffer(ca.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const s=new WeakSet,{gl:o}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const u=()=>{let c=0;for(let h=0;h<n.length;h++){const d=n[h];d!==null&&o.getQueryParameter(d,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(d,o.QUERY_RESULT)===0&&s.add(r[h]),n[h]=null,o.deleteQuery(d),c++)}c<n.length?requestAnimationFrame(u):t.occluded=s};u()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:r,width:s,height:o}=e.viewportValue;t.viewport(n,e.height-o-r,s,o)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n,r=null,s=!0,o=!0){const{gl:u,renderer:c}=this;r===null&&(r={textures:null,clearColorValue:this.getClearColor()});let h=0;if(e&&(h|=u.COLOR_BUFFER_BIT),t&&(h|=u.DEPTH_BUFFER_BIT),n&&(h|=u.STENCIL_BUFFER_BIT),h!==0){let d;r.clearColorValue?d=r.clearColorValue:d=this.getClearColor();const p=c.getClearDepth(),g=c.getClearStencil();if(t&&this.state.setDepthMask(!0),r.textures===null)u.clearColor(d.r,d.g,d.b,d.a),u.clear(h);else{if(s&&this._setFramebuffer(r),e)for(let _=0;_<r.textures.length;_++)_===0?u.clearBufferfv(u.COLOR,_,[d.r,d.g,d.b,d.a]):u.clearBufferfv(u.COLOR,_,[0,0,0,1]);t&&n?u.clearBufferfi(u.DEPTH_STENCIL,0,p,g):t?u.clearBufferfv(u.DEPTH,0,[p]):n&&u.clearBufferiv(u.STENCIL,0,[g]),s&&o&&this._resolveRenderTarget(r)}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(ca.COMPUTE,this.getTimestampUID(e))}compute(e,t,n,r,s=null){const{state:o,gl:u}=this;this.discard===!1&&(o.enable(u.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:c,transformBuffers:h,attributes:d}=this.get(r),p=this._getVaoKey(d),g=this.vaoCache[p];g===void 0?this.vaoCache[p]=this._createVao(d):o.setVertexState(g),o.useProgram(c),this._bindUniforms(n);const _=this._getTransformFeedback(h);u.bindTransformFeedback(u.TRANSFORM_FEEDBACK,_),u.beginTransformFeedback(u.POINTS),s=s!==null?s:t.count,Array.isArray(s)?(Vn("WebGLBackend.compute(): The count parameter must be a single number, not an array."),s=s[0]):s&&typeof s=="object"&&s.isIndirectStorageBufferAttribute&&(Vn("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),s=t.count),d[0].isStorageInstancedBufferAttribute?u.drawArraysInstanced(u.POINTS,0,1,s):u.drawArrays(u.POINTS,0,s),u.endTransformFeedback(),u.bindTransformFeedback(u.TRANSFORM_FEEDBACK,null);for(let v=0;v<h.length;v++){const T=h[v];T.pbo&&this.has(T.pbo)&&this.textureUtils.copyBufferToTexture(T.transformBuffer,T.pbo),T.switchBuffers()}}finishCompute(e){const{state:t,gl:n}=this;this.discard=!1,t.disable(n.RASTERIZER_DISCARD),this.prepareTimestampBuffer(ca.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:n,material:r,context:s,hardwareClippingPlanes:o}=e,{programGPU:u}=this.get(n),{gl:c,state:h}=this,d=this.get(s),p=e.getDrawParameters();if(p===null)return;this._bindUniforms(e.getBindings());const g=t.isMesh&&t.matrixWorld.determinant()<0;h.setMaterial(r,g,o),s.textures!==null&&s.textures.length>1&&h.setMRTBlending(s.textures),h.useProgram(u);const _=e.getAttributes(),v=this.get(_);let T=v.vaoGPU;if(T===void 0){const U=this._getVaoKey(_);T=this.vaoCache[U],T===void 0&&(T=this._createVao(_),this.vaoCache[U]=T,v.vaoGPU=T)}const b=e.getIndex(),x=b!==null?this.get(b).bufferGPU:null;h.setVertexState(T,x);const M=d.lastOcclusionObject;if(M!==t&&M!==void 0){if(M!==null&&M.occlusionTest===!0&&(c.endQuery(c.ANY_SAMPLES_PASSED),d.occlusionQueryIndex++),t.occlusionTest===!0){const U=c.createQuery();c.beginQuery(c.ANY_SAMPLES_PASSED,U),d.occlusionQueries[d.occlusionQueryIndex]=U,d.occlusionQueryObjects[d.occlusionQueryIndex]=t}d.lastOcclusionObject=t}const E=this.bufferRenderer;t.isPoints?E.mode=c.POINTS:t.isLineSegments?E.mode=c.LINES:t.isLine?E.mode=c.LINE_STRIP:t.isLineLoop?E.mode=c.LINE_LOOP:r.wireframe===!0?(h.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),E.mode=c.LINES):E.mode=c.TRIANGLES;const{vertexCount:w,instanceCount:C}=p;let{firstVertex:N}=p;if(E.object=t,b!==null){N*=b.array.BYTES_PER_ELEMENT;const U=this.get(b);E.index=b.count,E.type=U.type}else E.index=0;const D=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(Vn("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),E.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?E.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):Vn("WebGLBackend: WEBGL_multi_draw not supported."):C>1?E.renderInstances(N,w,C):E.render(N,w)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const U=this.get(e.camera),R=e.camera.cameras,P=e.getBindingGroup("cameraIndex").bindings[0];if(U.indexesGPU===void 0||U.indexesGPU.length!==R.length){const G=new Uint32Array([0,0,0,0]),z=[];for(let q=0,ce=R.length;q<ce;q++){const xe=c.createBuffer();G[0]=q,c.bindBuffer(c.UNIFORM_BUFFER,xe),c.bufferData(c.UNIFORM_BUFFER,G,c.STATIC_DRAW),z.push(xe)}U.indexesGPU=z}const I=this.get(P),H=this.renderer.getPixelRatio(),X=this._currentContext.renderTarget,J=this._isRenderCameraDepthArray(this._currentContext),ne=this._currentContext.activeCubeFace;if(J){const G=this.get(X.depthTexture);if(G.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){G.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:z}=X;for(let q=0,ce=R.length;q<ce;q++)this.renderer._activeCubeFace=q,this._currentContext.activeCubeFace=q,this._setFramebuffer(this._currentContext),this.clear(!1,!0,z,this._currentContext,!1,!1);this.renderer._activeCubeFace=ne,this._currentContext.activeCubeFace=ne}}for(let G=0,z=R.length;G<z;G++){const q=R[G];if(t.layers.test(q.layers)){J&&(this.renderer._activeCubeFace=G,this._currentContext.activeCubeFace=G,this._setFramebuffer(this._currentContext));const ce=q.viewport;if(ce!==void 0){const xe=ce.x*H,O=ce.y*H,Y=ce.width*H,ue=ce.height*H;h.viewport(Math.floor(xe),Math.floor(e.context.height-ue-O),Math.floor(Y),Math.floor(ue))}h.bindBufferBase(c.UNIFORM_BUFFER,I.index,U.indexesGPU[G]),D()}this._currentContext.activeCubeFace=ne,this.renderer._activeCubeFace=ne}}else D()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,n,r,s,o){return this.textureUtils.copyTextureToBuffer(e,t,n,r,s,o)}updateSampler(){return""}createNodeBuilder(e,t){return new FX(e,t)}createProgram(e){const t=this.gl,{stage:n,code:r}=e,s=n==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,r),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,r=e.pipeline,{fragmentProgram:s,vertexProgram:o}=r,u=n.createProgram(),c=this.get(s).shaderGPU,h=this.get(o).shaderGPU;if(n.attachShader(u,c),n.attachShader(u,h),n.linkProgram(u),this.set(r,{programGPU:u,fragmentShader:c,vertexShader:h}),t!==null&&this.parallel){const d=new Promise(p=>{const g=this.parallel,_=()=>{n.getProgramParameter(u,g.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),p()):requestAnimationFrame(_)};_()});t.push(d);return}this._completeCompile(e,r)}_handleSource(e,t){const n=e.split(`
`),r=[],s=Math.max(t-6,0),o=Math.min(t+6,n.length);for(let u=s;u<o;u++){const c=u+1;r.push(`${c===t?">":" "} ${c}: ${n[u]}`)}return r.join(`
`)}_getShaderErrors(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),o=(e.getShaderInfoLog(t)||"").trim();if(r&&o==="")return"";const u=/ERROR: 0:(\d+)/.exec(o);if(u){const c=parseInt(u[1]);return n.toUpperCase()+`

`+o+`

`+this._handleSource(e.getShaderSource(t),c)}else return o}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const r=this.gl,o=(r.getProgramInfoLog(e)||"").trim();if(r.getProgramParameter(e,r.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(r,e,n,t);else{const u=this._getShaderErrors(r,n,"vertex"),c=this._getShaderErrors(r,t,"fragment");Re("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(e,r.VALIDATE_STATUS)+`

Program Info Log: `+o+`
`+u+`
`+c)}else o!==""&&Ae("WebGLProgram: Program Info Log:",o)}}_completeCompile(e,t){const{state:n,gl:r}=this,s=this.get(t),{programGPU:o,fragmentShader:u,vertexShader:c}=s;r.getProgramParameter(o,r.LINK_STATUS)===!1&&this._logProgramError(o,u,c),n.useProgram(o);const h=e.getBindings();this._setupBindings(h,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:n,gl:r}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:o}=e,u=r.createProgram(),c=this.get(s).shaderGPU,h=this.get(o).shaderGPU,d=o.transforms,p=[],g=[];for(let b=0;b<d.length;b++){const x=d[b];p.push(x.varyingName),g.push(x.attributeNode)}r.attachShader(u,c),r.attachShader(u,h),r.transformFeedbackVaryings(u,p,r.SEPARATE_ATTRIBS),r.linkProgram(u),r.getProgramParameter(u,r.LINK_STATUS)===!1&&this._logProgramError(u,c,h),n.useProgram(u),this._setupBindings(t,u);const _=o.attributes,v=[],T=[];for(let b=0;b<_.length;b++){const x=_[b].node.attribute;v.push(x),this.has(x)||this.attributeUtils.createAttribute(x,r.ARRAY_BUFFER)}for(let b=0;b<g.length;b++){const x=g[b].attribute;this.has(x)||this.attributeUtils.createAttribute(x,r.ARRAY_BUFFER);const M=this.get(x);T.push(M)}this.set(e,{programGPU:u,transformBuffers:T,attributes:v})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let n=0,r=0;for(const s of t){this.set(s,{textures:r,uniformBuffers:n});for(const o of s.bindings)o.isUniformBuffer&&n++,o.isSampledTexture&&r++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let r=n.uniformBuffers,s=n.textures;for(const o of e.bindings){const u=this.get(o);if(o.isUniformsGroup||o.isUniformBuffer){const c=o.buffer;let{bufferGPU:h}=this.get(c);h===void 0?(h=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,h),t.bufferData(t.UNIFORM_BUFFER,c.byteLength,t.DYNAMIC_DRAW),this.set(c,{bufferGPU:h})):t.bindBuffer(t.UNIFORM_BUFFER,h);const d=o.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,h),d.length===0)t.bufferData(t.UNIFORM_BUFFER,c,t.DYNAMIC_DRAW);else{const p=__(c),g=p?1:c.BYTES_PER_ELEMENT;for(let _=0,v=d.length;_<v;_++){const T=d[_],b=T.start*g,x=T.count*g,M=b*(p?c.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,M,c,b,x)}}u.index=r++,u.bufferGPU=h,this.set(o,u)}else if(o.isSampledTexture){const{textureGPU:c,glTextureType:h}=this.get(o.texture);u.index=s++,u.textureGPU=c,u.glTextureType=h,this.set(o,u)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const r=this.get(e).bufferGPU,s=e.buffer,o=e.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,r),o.length===0)t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW);else{const u=__(s),c=u?1:s.BYTES_PER_ELEMENT;for(let h=0,d=o.length;h<d;h++){const p=o[h],g=p.start*c,_=p.count*c,v=g*(u?s.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,v,s,g,_)}}}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(tN).filter(r=>tN[r]===e),n=this.extensions;for(let r=0;r<t.length;r++)if(n.has(t[r]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){this.textureUtils.copyTextureToTexture(e,t,n,r,s,o)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){const{gl:t,state:n}=this;let r=null;if(e.textures!==null){const s=e.renderTarget,o=this.get(s),{samples:u,depthBuffer:c,stencilBuffer:h}=s,d=s.isWebGLCubeRenderTarget===!0,p=s.isRenderTarget3D===!0,g=s.depth>1,_=s.isXRRenderTarget===!0,v=_===!0&&s._hasExternalTextures===!0;let T=o.msaaFrameBuffer,b=o.depthRenderbuffer;const x=this.extensions.get("WEBGL_multisampled_render_to_texture"),M=this.extensions.get("OVR_multiview2"),E=this._useMultisampledExtension(s),w=N3(e);let C;if(d?(o.cubeFramebuffers||(o.cubeFramebuffers={}),C=o.cubeFramebuffers[w]):_&&v===!1?C=this._xrFramebuffer:(o.framebuffers||(o.framebuffers={}),C=o.framebuffers[w]),C===void 0){C=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,C);const N=e.textures,D=[];if(d){o.cubeFramebuffers[w]=C;const{textureGPU:R}=this.get(N[0]),P=this.renderer._activeCubeFace,I=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+P,R,I)}else{o.framebuffers[w]=C;for(let R=0;R<N.length;R++){const P=N[R],I=this.get(P);I.renderTarget=e.renderTarget,I.cacheKey=w;const H=t.COLOR_ATTACHMENT0+R;if(s.multiview)M.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,H,I.textureGPU,0,u,0,2);else if(p||g){const X=this.renderer._activeCubeFace,J=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,H,I.textureGPU,J,X)}else if(E)x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,H,t.TEXTURE_2D,I.textureGPU,0,u);else{const X=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,H,t.TEXTURE_2D,I.textureGPU,X)}}}const U=h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const R=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(R,e,0,E),o.xrDepthRenderbuffer=R,D.push(h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,R),t.framebufferRenderbuffer(t.FRAMEBUFFER,U,t.RENDERBUFFER,R)}else if(e.depthTexture!==null){D.push(h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const R=this.get(e.depthTexture);if(R.renderTarget=e.renderTarget,R.cacheKey=w,s.multiview)M.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,U,R.textureGPU,0,u,0,2);else if(v&&E)x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,U,t.TEXTURE_2D,R.textureGPU,0,u);else if(e.depthTexture.isArrayTexture){const P=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,U,R.textureGPU,0,P)}else if(e.depthTexture.isCubeTexture){const P=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,U,t.TEXTURE_CUBE_MAP_POSITIVE_X+P,R.textureGPU,0)}else t.framebufferTexture2D(t.FRAMEBUFFER,U,t.TEXTURE_2D,R.textureGPU,0)}o.depthInvalidationArray=D}else{if(this._isRenderCameraDepthArray(e)){n.bindFramebuffer(t.FRAMEBUFFER,C);const D=this.renderer._activeCubeFace,U=this.get(e.depthTexture),R=h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,R,U.textureGPU,0,D)}if((_||E||s.multiview)&&s._isOpaqueFramebuffer!==!0){n.bindFramebuffer(t.FRAMEBUFFER,C);const D=this.get(e.textures[0]);s.multiview?M.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,D.textureGPU,0,u,0,2):E?x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,D.textureGPU,0,u):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,D.textureGPU,0);const U=h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const R=o.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,R),t.framebufferRenderbuffer(t.FRAMEBUFFER,U,t.RENDERBUFFER,R)}else{const R=this.get(e.depthTexture);s.multiview?M.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,U,R.textureGPU,0,u,0,2):E?x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,U,t.TEXTURE_2D,R.textureGPU,0,u):t.framebufferTexture2D(t.FRAMEBUFFER,U,t.TEXTURE_2D,R.textureGPU,0)}}}if(u>0&&E===!1&&!s.multiview){if(T===void 0){const N=[];T=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,T);const D=[],U=e.textures;for(let R=0;R<U.length;R++){D[R]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,D[R]),N.push(t.COLOR_ATTACHMENT0+R);const P=e.textures[R],I=this.get(P);t.renderbufferStorageMultisample(t.RENDERBUFFER,u,I.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+R,t.RENDERBUFFER,D[R])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),o.msaaFrameBuffer=T,o.msaaRenderbuffers=D,c&&b===void 0){b=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(b,e,u),o.depthRenderbuffer=b;const R=h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;N.push(R)}o.invalidationArray=N}r=o.msaaFrameBuffer}else r=C;n.drawBuffers(e,C)}n.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){const r=this.get(e[n]);t+=":"+r.id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();t.bindVertexArray(n);for(let r=0;r<e.length;r++){const s=e[r],o=this.get(s);t.bindBuffer(t.ARRAY_BUFFER,o.bufferGPU),t.enableVertexAttribArray(r);let u,c;s.isInterleavedBufferAttribute===!0?(u=s.data.stride*o.bytesPerElement,c=s.offset*o.bytesPerElement):(u=0,c=0),o.isInteger?t.vertexAttribIPointer(r,s.itemSize,o.type,u,c):t.vertexAttribPointer(r,s.itemSize,o.type,s.normalized,u,c),s.isInstancedBufferAttribute&&!s.isInterleavedBufferAttribute?t.vertexAttribDivisor(r,s.meshPerAttribute):s.isInterleavedBufferAttribute&&s.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(r,s.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),n}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let n=this.transformFeedbackCache[t];if(n!==void 0)return n;const{gl:r}=this;n=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n);for(let s=0;s<e.length;s++){const o=e[s];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,s,o.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const r of e)for(const s of r.bindings){const u=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const c=n.getUniformBlockIndex(t,s.name);n.uniformBlockBinding(t,c,u)}else if(s.isSampledTexture){const c=n.getUniformLocation(t,s.name);n.uniform1i(c,u)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const r of e)for(const s of r.bindings){const o=this.get(s),u=o.index;s.isUniformsGroup||s.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,u,o.bufferGPU):s.isSampledTexture&&n.bindTexture(o.glTextureType,o.textureGPU,t.TEXTURE0+u)}}_resolveRenderTarget(e){const{gl:t,state:n}=this,r=e.renderTarget;if(e.textures!==null&&r){const s=this.get(r);if(r.samples>0&&this._useMultisampledExtension(r)===!1){const o=s.framebuffers[e.getCacheKey()];let u=t.COLOR_BUFFER_BIT;r.resolveDepthBuffer&&(r.depthBuffer&&(u|=t.DEPTH_BUFFER_BIT),r.stencilBuffer&&r.resolveStencilBuffer&&(u|=t.STENCIL_BUFFER_BIT));const c=s.msaaFrameBuffer,h=s.msaaRenderbuffers,d=e.textures,p=d.length>1;if(n.bindFramebuffer(t.READ_FRAMEBUFFER,c),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),p)for(let g=0;g<d.length;g++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+g,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+g,t.TEXTURE_2D,null,0);for(let g=0;g<d.length;g++){if(p){const{textureGPU:_}=this.get(d[g]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,h[g]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,_,0)}if(e.scissor){const{x:_,y:v,width:T,height:b}=e.scissorValue,x=e.height-b-v;t.blitFramebuffer(_,x,_+T,x+b,_,x,_+T,x+b,u,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,u,t.NEAREST)}if(p)for(let g=0;g<d.length;g++){const{textureGPU:_}=this.get(d[g]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+g,t.RENDERBUFFER,h[g]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+g,t.TEXTURE_2D,_,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,s.invalidationArray)}else if(r.resolveDepthBuffer===!1&&s.framebuffers){const o=s.framebuffers[e.getCacheKey()];n.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,s.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const $c={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},nu=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},Hi={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},hr={Store:"store"},dn={Load:"load",Clear:"clear"},iN={CCW:"ccw",CW:"cw"},rN={None:"none",Back:"back"},Ih={Uint16:"uint16",Uint32:"uint32"},j={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},ib={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},eu={Linear:"linear",Nearest:"nearest"},Xt={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Hl={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},sN={None:0,All:15},Zo={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},rb={Storage:"storage",ReadOnlyStorage:"read-only-storage"},sb={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},aN={NonFiltering:"non-filtering",Comparison:"comparison"},Wl={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},oN={TwoD:"2d",ThreeD:"3d"},vi={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},XX={All:"all"},Qg={Vertex:"vertex",Instance:"instance"},eS={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},lN={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class YX extends K3{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class KX extends $3{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let QX=0;class ZX extends KX{constructor(e,t){super("StorageBuffer_"+QX++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:vs.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class JX extends pl{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,n=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:eu.Linear}),this.flipYSampler=e.createSampler({minFilter:eu.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:n}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:r})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:$c.TriangleStrip,stripIndexFormat:Ih.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:$c.TriangleStrip,stripIndexFormat:Ih.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,n=0){const r=t.format,{width:s,height:o}=t.size,u=this.getTransferPipeline(r),c=this.getFlipYPipeline(r),h=this.device.createTexture({size:{width:s,height:o,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),d=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:vi.TwoD,baseArrayLayer:n}),p=h.createView({baseMipLevel:0,mipLevelCount:1,dimension:vi.TwoD,baseArrayLayer:0}),g=this.device.createCommandEncoder({}),_=(v,T,b)=>{const x=v.getBindGroupLayout(0),M=this.device.createBindGroup({layout:x,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:T}]}),E=g.beginRenderPass({colorAttachments:[{view:b,loadOp:dn.Clear,storeOp:hr.Store,clearValue:[0,0,0,0]}]});E.setPipeline(v),E.setBindGroup(0,M),E.draw(4,1,0,0),E.end()};_(u,d,p),_(c,p,d),this.device.queue.submit([g.finish()]),h.destroy()}generateMipmaps(e,t,n=0,r=null){const s=this.get(e);s.layers===void 0&&(s.layers=[]);const o=s.layers[n]||this._mipmapCreateBundles(e,t,n),u=r||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(u,o),r===null&&this.device.queue.submit([u.finish()]),s.layers[n]=o}_mipmapCreateBundles(e,t,n){const r=this.getTransferPipeline(t.format),s=r.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:vi.TwoD,baseArrayLayer:n});const u=[];for(let c=1;c<t.mipLevelCount;c++){const h=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),d=e.createView({baseMipLevel:c,mipLevelCount:1,dimension:vi.TwoD,baseArrayLayer:n}),p={colorAttachments:[{view:d,loadOp:dn.Clear,storeOp:hr.Store,clearValue:[0,0,0,0]}]},g=this.device.createRenderBundleEncoder({colorFormats:[t.format]});g.setPipeline(r),g.setBindGroup(0,h),g.draw(4,1,0,0),u.push({renderBundles:[g.finish()],passDescriptor:p}),o=d}return u}_mipmapRunBundles(e,t){const n=t.length;for(let r=0;r<n;r++){const s=t[r],o=e.beginRenderPass(s.passDescriptor);o.executeBundles(s.renderBundles),o.end()}}}const eY={[FS]:"never",[Ep]:"less",[IS]:"equal",[Ap]:"less-equal",[zS]:"greater",[wp]:"greater-equal",[kS]:"always",[GS]:"not-equal"},tY=[0,1,3,2,4,5];class nY{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){const t=this.backend,n=e.minFilter+"-"+e.magFilter+"-"+e.wrapS+"-"+e.wrapT+"-"+(e.wrapR||"0")+"-"+e.anisotropy+"-"+(e.compareFunction||0);let r=this._samplerCache.get(n);if(r===void 0){const o={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};o.magFilter===eu.Linear&&o.minFilter===eu.Linear&&o.mipmapFilter===eu.Linear&&(o.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(o.compare=eY[e.compareFunction]),r={sampler:t.device.createSampler(o),usedTimes:0},this._samplerCache.set(n,r)}const s=t.get(e);if(s.sampler!==r.sampler){if(s.sampler!==void 0){const o=this._samplerCache.get(s.samplerKey);o.usedTimes--,o.usedTimes===0&&this._samplerCache.delete(s.samplerKey)}s.samplerKey=n,s.sampler=r.sampler,r.usedTimes++}return n}createDefaultTexture(e){let t;const n=tS(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(n):t=this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e,t={}){const n=this.backend,r=n.get(e);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture){r.texture=e.sourceTexture,r.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:o,depth:u,levels:c}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const h=this._getDimension(e),d=e.internalFormat||t.format||tS(e,n.device);r.format=d;const{samples:p,primarySamples:g,isMSAA:_}=n.utils.getTextureSampleData(e);let v=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(v|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&d!==j.RGB9E5UFloat&&(v|=GPUTextureUsage.RENDER_ATTACHMENT);const T={label:e.name,size:{width:s,height:o,depthOrArrayLayers:u},mipLevelCount:c,sampleCount:g,dimension:h,format:d,usage:v};if(d===void 0){Ae("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}if(e.isCubeTexture&&(T.textureBindingViewDimension=vi.Cube),r.texture=n.device.createTexture(T),_){const b=Object.assign({},T);b.label=b.label+"-msaa",b.sampleCount=p,b.mipLevelCount=1,r.msaaTexture=n.device.createTexture(b)}r.initialized=!0,r.textureDescriptorGPU=T}destroyTexture(e,t=!1){const n=this.backend,r=n.get(e);r.texture!==void 0&&t===!1&&r.texture.destroy(),r.msaaTexture!==void 0&&r.msaaTexture.destroy(),n.delete(e)}generateMipmaps(e,t=null){const n=this.backend.get(e);if(e.isCubeTexture)for(let r=0;r<6;r++)this._generateMipmaps(n.texture,n.textureDescriptorGPU,r,t);else{const r=e.image.depth||1;for(let s=0;s<r;s++)this._generateMipmaps(n.texture,n.textureDescriptorGPU,s,t)}}getColorBuffer(){const e=this.backend,t=e.renderer.getCanvasTarget(),{width:n,height:r}=e.getDrawingBufferSize(),s=e.renderer.currentSamples,o=t.colorTexture,u=e.get(o);if(o.width===n&&o.height===r&&o.samples===s)return u.texture;let c=u.texture;return c&&c.destroy(),c=e.device.createTexture({label:"colorBuffer",size:{width:n,height:r,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),o.source.width=n,o.source.height=r,o.samples=s,u.texture=c,c}getDepthBuffer(e=!0,t=!1){const n=this.backend,r=n.renderer.getCanvasTarget(),{width:s,height:o}=n.getDrawingBufferSize(),u=n.renderer.currentSamples,c=r.depthTexture;if(c.width===s&&c.height===o&&c.samples===u&&c.depth===e&&c.stencil===t)return n.get(c).texture;const h=n.get(c).texture;let d,p;if(t?(d=pr,p=ts):e&&(d=ji,p=yn),h!==void 0){if(c.image.width===s&&c.image.height===o&&c.format===d&&c.type===p&&c.samples===u)return h;this.destroyTexture(c)}return c.name="depthBuffer",c.format=d,c.type=p,c.image.width=s,c.image.height=o,c.samples=u,this.createTexture(c,{width:s,height:o}),n.get(c).texture}updateTexture(e,t){const n=this.backend.get(e),r=e.mipmaps,{textureDescriptorGPU:s}=n;if(!(e.isRenderTargetTexture||s===void 0)){if(e.isDataTexture)if(r.length>0)for(let o=0,u=r.length;o<u;o++){const c=r[o];this._copyBufferToTexture(c,n.texture,s,0,e.flipY,0,o)}else this._copyBufferToTexture(t.image,n.texture,s,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let o=0;o<t.image.depth;o++)this._copyBufferToTexture(t.image,n.texture,s,o,e.flipY,o);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,s);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,n.texture,s);else if(r.length>0)for(let o=0,u=r.length;o<u;o++){const c=r[o];this._copyImageToTexture(c,n.texture,s,0,e.flipY,e.premultiplyAlpha,o)}else this._copyImageToTexture(t.image,n.texture,s,0,e.flipY,e.premultiplyAlpha);n.version=e.version}}async copyTextureToBuffer(e,t,n,r,s,o){const u=this.backend.device,c=this.backend.get(e),h=c.texture,d=c.textureDescriptorGPU.format,p=this._getBytesPerTexel(d);let g=r*p;g=Math.ceil(g/256)*256;const _=u.createBuffer({size:(s-1)*g+r*p,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),v=u.createCommandEncoder();v.copyTextureToBuffer({texture:h,origin:{x:t,y:n,z:o}},{buffer:_,bytesPerRow:g},{width:r,height:s});const T=this._getTypedArrayType(d);u.queue.submit([v.finish()]),await _.mapAsync(GPUMapMode.READ);const b=_.getMappedRange();return new T(b)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new ui;n.minFilter=xn,n.magFilter=xn,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultCubeTexture[e];if(t===void 0){const n=new Cp;n.minFilter=xn,n.magFilter=xn,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,n){const r=e.images,s=e.mipmaps;for(let o=0;o<6;o++){const u=r[o],c=e.flipY===!0?tY[o]:o;u.isDataTexture?this._copyBufferToTexture(u.image,t,n,c,e.flipY):this._copyImageToTexture(u,t,n,c,e.flipY,e.premultiplyAlpha);for(let h=0;h<s.length;h++){const p=s[h].images[o];p.isDataTexture?this._copyBufferToTexture(p.image,t,n,c,e.flipY,0,h+1):this._copyImageToTexture(p,t,n,c,e.flipY,e.premultiplyAlpha,h+1)}}}_copyImageToTexture(e,t,n,r,s,o,u=0){const c=this.backend.device,h=u>0?e.width:n.size.width,d=u>0?e.height:n.size.height;try{c.queue.copyExternalImageToTexture({source:e,flipY:s},{texture:t,mipLevel:u,origin:{x:0,y:0,z:r},premultipliedAlpha:o},{width:h,height:d,depthOrArrayLayers:1})}catch{}}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new JX(this.backend.device)),e}_generateMipmaps(e,t,n=0,r=null){this._getPassUtils().generateMipmaps(e,t,n,r)}_flipY(e,t,n=0){this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,r,s,o=0,u=0){const c=this.backend.device,h=e.data,d=this._getBytesPerTexel(n.format),p=e.width*d;c.queue.writeTexture({texture:t,mipLevel:u,origin:{x:0,y:0,z:r}},h,{offset:e.width*e.height*d*o,bytesPerRow:p},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,n,r)}_copyCompressedBufferToTexture(e,t,n){const r=this.backend.device,s=this._getBlockData(n.format),o=n.size.depthOrArrayLayers>1;for(let u=0;u<e.length;u++){const c=e[u],h=c.width,d=c.height,p=o?n.size.depthOrArrayLayers:1,g=Math.ceil(h/s.width)*s.byteLength,_=g*Math.ceil(d/s.height);for(let v=0;v<p;v++)r.queue.writeTexture({texture:t,mipLevel:u,origin:{x:0,y:0,z:v}},c.data,{offset:v*_,bytesPerRow:g,rowsPerImage:Math.ceil(d/s.height)},{width:Math.ceil(h/s.width)*s.width,height:Math.ceil(d/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===j.BC1RGBAUnorm||e===j.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===j.BC2RGBAUnorm||e===j.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===j.BC3RGBAUnorm||e===j.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===j.BC4RUnorm||e===j.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===j.BC5RGUnorm||e===j.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===j.BC6HRGBUFloat||e===j.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===j.BC7RGBAUnorm||e===j.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===j.ETC2RGB8Unorm||e===j.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===j.ETC2RGB8A1Unorm||e===j.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===j.ETC2RGBA8Unorm||e===j.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===j.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===j.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===j.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===j.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===j.ASTC4x4Unorm||e===j.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===j.ASTC5x4Unorm||e===j.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===j.ASTC5x5Unorm||e===j.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===j.ASTC6x5Unorm||e===j.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===j.ASTC6x6Unorm||e===j.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===j.ASTC8x5Unorm||e===j.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===j.ASTC8x6Unorm||e===j.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===j.ASTC8x8Unorm||e===j.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===j.ASTC10x5Unorm||e===j.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===j.ASTC10x6Unorm||e===j.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===j.ASTC10x8Unorm||e===j.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===j.ASTC10x10Unorm||e===j.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===j.ASTC12x10Unorm||e===j.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===j.ASTC12x12Unorm||e===j.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=ib.ClampToEdge;return e===hu?t=ib.Repeat:e===fu&&(t=ib.MirrorRepeat),t}_convertFilterMode(e){let t=eu.Linear;return(e===xn||e===OS||e===ro)&&(t=eu.Nearest),t}_getBytesPerTexel(e){if(e===j.R8Unorm||e===j.R8Snorm||e===j.R8Uint||e===j.R8Sint)return 1;if(e===j.R16Uint||e===j.R16Sint||e===j.R16Float||e===j.RG8Unorm||e===j.RG8Snorm||e===j.RG8Uint||e===j.RG8Sint)return 2;if(e===j.R32Uint||e===j.R32Sint||e===j.R32Float||e===j.RG16Uint||e===j.RG16Sint||e===j.RG16Float||e===j.RGBA8Unorm||e===j.RGBA8UnormSRGB||e===j.RGBA8Snorm||e===j.RGBA8Uint||e===j.RGBA8Sint||e===j.BGRA8Unorm||e===j.BGRA8UnormSRGB||e===j.RGB9E5UFloat||e===j.RGB10A2Unorm||e===j.RG11B10UFloat||e===j.Depth32Float||e===j.Depth24Plus||e===j.Depth24PlusStencil8||e===j.Depth32FloatStencil8)return 4;if(e===j.RG32Uint||e===j.RG32Sint||e===j.RG32Float||e===j.RGBA16Uint||e===j.RGBA16Sint||e===j.RGBA16Float)return 8;if(e===j.RGBA32Uint||e===j.RGBA32Sint||e===j.RGBA32Float)return 16}_getTypedArrayType(e){if(e===j.R8Uint)return Uint8Array;if(e===j.R8Sint)return Int8Array;if(e===j.R8Unorm)return Uint8Array;if(e===j.R8Snorm)return Int8Array;if(e===j.RG8Uint)return Uint8Array;if(e===j.RG8Sint)return Int8Array;if(e===j.RG8Unorm)return Uint8Array;if(e===j.RG8Snorm)return Int8Array;if(e===j.RGBA8Uint)return Uint8Array;if(e===j.RGBA8Sint)return Int8Array;if(e===j.RGBA8Unorm||e===j.RGBA8UnormSRGB)return Uint8Array;if(e===j.RGBA8Snorm)return Int8Array;if(e===j.R16Uint)return Uint16Array;if(e===j.R16Sint)return Int16Array;if(e===j.RG16Uint)return Uint16Array;if(e===j.RG16Sint)return Int16Array;if(e===j.RGBA16Uint)return Uint16Array;if(e===j.RGBA16Sint)return Int16Array;if(e===j.R16Float||e===j.RG16Float||e===j.RGBA16Float)return Uint16Array;if(e===j.R32Uint)return Uint32Array;if(e===j.R32Sint)return Int32Array;if(e===j.R32Float)return Float32Array;if(e===j.RG32Uint)return Uint32Array;if(e===j.RG32Sint)return Int32Array;if(e===j.RG32Float)return Float32Array;if(e===j.RGBA32Uint)return Uint32Array;if(e===j.RGBA32Sint)return Int32Array;if(e===j.RGBA32Float)return Float32Array;if(e===j.BGRA8Unorm||e===j.BGRA8UnormSRGB)return Uint8Array;if(e===j.RGB10A2Unorm||e===j.RGB9E5UFloat||e===j.RG11B10UFloat)return Uint32Array;if(e===j.Depth32Float)return Float32Array;if(e===j.Depth24Plus||e===j.Depth24PlusStencil8)return Uint32Array;if(e===j.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=oN.ThreeD:t=oN.TwoD,t}}function tS(i,e=null){const t=i.format,n=i.type,r=i.colorSpace,s=vt.getTransfer(r);let o;if(i.isCompressedTexture===!0||i.isCompressedArrayTexture===!0)switch(t){case sl:case al:o=s===Ye?j.BC1RGBAUnormSRGB:j.BC1RGBAUnorm;break;case ol:o=s===Ye?j.BC2RGBAUnormSRGB:j.BC2RGBAUnorm;break;case ll:o=s===Ye?j.BC3RGBAUnormSRGB:j.BC3RGBAUnorm;break;case Ah:o=j.BC4RUnorm;break;case wh:o=j.BC4RSnorm;break;case pu:o=j.BC5RGUnorm;break;case Rh:o=j.BC5RGSnorm;break;case Eh:o=s===Ye?j.BC7RGBAUnormSRGB:j.BC7RGBAUnorm;break;case ah:case sh:o=s===Ye?j.ETC2RGB8UnormSRGB:j.ETC2RGB8Unorm;break;case oh:o=s===Ye?j.ETC2RGBA8UnormSRGB:j.ETC2RGBA8Unorm;break;case lh:o=j.EACR11Unorm;break;case uh:o=j.EACR11Snorm;break;case du:o=j.EACRG11Unorm;break;case ch:o=j.EACRG11Snorm;break;case hh:o=s===Ye?j.ASTC4x4UnormSRGB:j.ASTC4x4Unorm;break;case fh:o=s===Ye?j.ASTC5x4UnormSRGB:j.ASTC5x4Unorm;break;case dh:o=s===Ye?j.ASTC5x5UnormSRGB:j.ASTC5x5Unorm;break;case ph:o=s===Ye?j.ASTC6x5UnormSRGB:j.ASTC6x5Unorm;break;case mh:o=s===Ye?j.ASTC6x6UnormSRGB:j.ASTC6x6Unorm;break;case gh:o=s===Ye?j.ASTC8x5UnormSRGB:j.ASTC8x5Unorm;break;case _h:o=s===Ye?j.ASTC8x6UnormSRGB:j.ASTC8x6Unorm;break;case vh:o=s===Ye?j.ASTC8x8UnormSRGB:j.ASTC8x8Unorm;break;case yh:o=s===Ye?j.ASTC10x5UnormSRGB:j.ASTC10x5Unorm;break;case xh:o=s===Ye?j.ASTC10x6UnormSRGB:j.ASTC10x6Unorm;break;case bh:o=s===Ye?j.ASTC10x8UnormSRGB:j.ASTC10x8Unorm;break;case Sh:o=s===Ye?j.ASTC10x10UnormSRGB:j.ASTC10x10Unorm;break;case Th:o=s===Ye?j.ASTC12x10UnormSRGB:j.ASTC12x10Unorm;break;case Mh:o=s===Ye?j.ASTC12x12UnormSRGB:j.ASTC12x12Unorm;break;case si:o=s===Ye?j.RGBA8UnormSRGB:j.RGBA8Unorm;break;default:Re("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case si:switch(n){case iu:o=j.RGBA8Snorm;break;case ru:o=j.RGBA16Sint;break;case Is:o=j.RGBA16Uint;break;case yn:o=j.RGBA32Uint;break;case Ni:o=j.RGBA32Sint;break;case Hn:o=s===Ye?j.RGBA8UnormSRGB:j.RGBA8Unorm;break;case Zn:o=j.RGBA16Float;break;case ri:o=j.RGBA32Float;break;default:Re("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case Tp:switch(n){case k_:o=j.RGB9E5UFloat;break;case V_:o=j.RG11B10UFloat;break;default:Re("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case Mp:switch(n){case iu:o=j.R8Snorm;break;case ru:o=j.R16Sint;break;case Is:o=j.R16Uint;break;case yn:o=j.R32Uint;break;case Ni:o=j.R32Sint;break;case Hn:o=j.R8Unorm;break;case Zn:o=j.R16Float;break;case ri:o=j.R32Float;break;default:Re("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case mr:switch(n){case iu:o=j.RG8Snorm;break;case ru:o=j.RG16Sint;break;case Is:o=j.RG16Uint;break;case yn:o=j.RG32Uint;break;case Ni:o=j.RG32Sint;break;case Hn:o=j.RG8Unorm;break;case Zn:o=j.RG16Float;break;case ri:o=j.RG32Float;break;default:Re("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case ji:switch(n){case Is:o=j.Depth16Unorm;break;case yn:o=j.Depth24Plus;break;case ri:o=j.Depth32Float;break;default:Re("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case pr:switch(n){case ts:o=j.Depth24PlusStencil8;break;case ri:e&&e.features.has(eS.Depth32FloatStencil8)===!1&&Re('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=j.Depth32FloatStencil8;break;default:Re("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case kh:switch(n){case Ni:o=j.R32Sint;break;case yn:o=j.R32Uint;break;default:Re("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case Vh:switch(n){case Ni:o=j.RG32Sint;break;case yn:o=j.RG32Uint;break;default:Re("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case Hh:switch(n){case Ni:o=j.RGBA32Sint;break;case yn:o=j.RGBA32Uint;break;default:Re("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:Re("WebGPURenderer: Unsupported texture format.",t)}return o}const iY=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,rY=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,uN={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},sY=i=>{i=i.trim();const e=i.match(iY);if(e!==null&&e.length===4){const t=e[2],n=[];let r=null;for(;(r=rY.exec(t))!==null;)n.push({name:r[1],type:r[2]});const s=[];for(let d=0;d<n.length;d++){const{name:p,type:g}=n[d];let _=g;_.startsWith("ptr")?_="pointer":(_.startsWith("texture")&&(_=g.split("<")[0]),_=uN[_]),s.push(new IT(_,p))}const o=i.substring(e[0].length),u=e[3]||"void",c=e[1]!==void 0?e[1]:"";return{type:uN[u]||u,inputs:s,name:c,inputsCode:t,blockCode:o,outputType:u}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class aY extends GT{constructor(e){const{type:t,inputs:n,name:r,inputsCode:s,blockCode:o,outputType:u}=sY(e);super(t,n,r),this.inputsCode=s,this.blockCode=o,this.outputType=u}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class oY extends H3{parseFunction(e){return new aY(e)}}const lY={[vs.READ_ONLY]:"read",[vs.WRITE_ONLY]:"write",[vs.READ_WRITE]:"read_write"},cN={[hu]:"repeat",[Nr]:"clamp",[fu]:"mirror"},Zg={vertex:nu.VERTEX,fragment:nu.FRAGMENT,compute:nu.COMPUTE},hN={instance:!0,swizzleAssign:!1,storageBuffer:!0},uY={"^^":"tsl_xor"},cY={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},fN={},Ed={tsl_xor:new Wi("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Wi("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Wi("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Wi("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Wi("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Wi("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Wi("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Wi("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Wi("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Wi("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Wi("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Wi("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Wi(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},hY={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>",floatpack_snorm_2x16:"pack2x16snorm",floatpack_unorm_2x16:"pack2x16unorm",floatpack_float16_2x16:"pack2x16float",floatunpack_snorm_2x16:"unpack2x16snorm",floatunpack_unorm_2x16:"unpack2x16unorm",floatunpack_float16_2x16:"unpack2x16float"};let eL="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(eL+=`diagnostic( off, derivative_uniformity );
`);class fY extends V3{constructor(e,t){super(e,t,new oY),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,n,r,s,o=this.shaderStage){return o==="fragment"?r?s?`textureSample( ${t}, ${t}_sampler, ${n}, ${r}, ${s} )`:`textureSample( ${t}, ${t}_sampler, ${n}, ${r} )`:s?`textureSample( ${t}, ${t}_sampler, ${n}, ${s} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this.generateTextureSampleLevel(e,t,n,"0",r)}generateTextureSampleLevel(e,t,n,r,s,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,o,r):this.generateTextureLod(e,t,n,s,o,r)}generateWrapFunction(e){const t=`tsl_coord_${cN[e.wrapS]}S_${cN[e.wrapT]}_${e.is3DTexture||e.isData3DTexture?"3d":"2d"}T`;let n=fN[t];if(n===void 0){const r=[],s=e.is3DTexture||e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const u=(c,h)=>{c===hu?(r.push(Ed.repeatWrapping_float),o+=`		tsl_repeatWrapping_float( coord.${h} )`):c===Nr?(r.push(Ed.clampWrapping_float),o+=`		tsl_clampWrapping_float( coord.${h} )`):c===fu?(r.push(Ed.mirrorWrapping_float),o+=`		tsl_mirrorWrapping_float( coord.${h} )`):(o+=`		coord.${h}`,Ae(`WebGPURenderer: Unsupported texture wrap type "${c}" for vertex shader.`))};u(e.wrapS,"x"),o+=`,
`,u(e.wrapT,"y"),(e.is3DTexture||e.isData3DTexture)&&(o+=`,
`,u(e.wrapR,"z")),o+=`
	);

}
`,fN[t]=n=new Wi(o,r)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){const r=this.getDataFromNode(e,this.shaderStage,this.globalCache);r.dimensionsSnippet===void 0&&(r.dimensionsSnippet={});let s=r.dimensionsSnippet[n];if(r.dimensionsSnippet[n]===void 0){let o,u;const{primarySamples:c}=this.renderer.backend.utils.getTextureSampleData(e),h=c>1;e.is3DTexture||e.isData3DTexture?u="vec3<u32>":u="vec2<u32>",h||e.isStorageTexture?o=t:o=`${t}${n?`, u32( ${n} )`:""}`,s=new f_(new d_(`textureDimensions( ${o} )`,u)),r.dimensionsSnippet[n]=s,(e.isArrayTexture||e.isDataArrayTexture||e.is3DTexture||e.isData3DTexture)&&(r.arrayLayerCount=new f_(new d_(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(r.cubeFaceCount=new f_(new d_("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,n,r,s="0u"){this._include("biquadraticTexture");const o=this.generateWrapFunction(e),u=this.generateTextureDimension(e,t,s);return r&&(n=`${n} + vec2<f32>(${r}) / ${u}`),`tsl_biquadraticTexture( ${t}, ${o}( ${n} ), ${u}, u32( ${s} ) )`}generateTextureLod(e,t,n,r,s,o="0u"){const u=this.generateWrapFunction(e),c=this.generateTextureDimension(e,t,o),h=e.is3DTexture||e.isData3DTexture?"vec3":"vec2";s&&(n=`${n} + ${h}<f32>(${s}) / ${h}<f32>( ${c} )`);const d=`${h}<u32>( ${u}( ${n} ) * ${h}<f32>( ${c} ) )`;return this.generateTextureLoad(e,t,d,o,r,null)}generateTextureLoad(e,t,n,r,s,o){r===null&&(r="0u"),o&&(n=`${n} + ${o}`);let u;return s?u=`textureLoad( ${t}, ${n}, ${s}, u32( ${r} ) )`:(u=`textureLoad( ${t}, ${n}, u32( ${r} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(u+=".x")),u}generateTextureStore(e,t,n,r,s){let o;return r?o=`textureStore( ${t}, ${n}, ${r}, ${s} )`:o=`textureStore( ${t}, ${n}, ${s} )`,o}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===ri||this.isSampleCompare(e)===!1&&e.minFilter===xn&&e.magFilter===xn||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,r,s,o=this.shaderStage){let u=null;return this.isUnfilterable(e)?u=this.generateTextureLod(e,t,n,r,s,"0",o):u=this._generateTextureSample(e,t,n,r,s,o),u}generateTextureGrad(e,t,n,r,s,o,u=this.shaderStage){if(u==="fragment")return o?`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${r[0]}, ${r[1]}, ${o} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${r[0]}, ${r[1]} )`;Re(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${u} shader.`)}generateTextureCompare(e,t,n,r,s,o,u=this.shaderStage){if(u==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?o?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${s}, ${r}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${s}, ${r} )`:o?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r} )`;Re(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${u} shader.`)}generateTextureLevel(e,t,n,r,s,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,o,r):this.generateTextureLod(e,t,n,s,o,r)}generateTextureBias(e,t,n,r,s,o,u=this.shaderStage){if(u==="fragment")return o?`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${r}, ${o} )`:`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${r} )`;Re(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${u} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const n=e.name,r=e.type;return r==="texture"||r==="cubeTexture"||r==="cubeDepthTexture"||r==="storageTexture"||r==="texture3D"?n:r==="buffer"||r==="storageBuffer"||r==="indirectStorageBuffer"?this.isCustomStruct(e)?n:n+".value":e.groupNode.name+"."+n}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=uY[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?e.isAtomic===!0?(Ae("WebGPURenderer: Atomic operations are only supported in compute shaders."),vs.READ_WRITE):vs.READ_ONLY:e.access}getStorageAccess(e,t){return lY[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n,r=null){const s=super.getUniformFromNode(e,t,n,r),o=this.getDataFromNode(e,n,this.globalCache);if(o.uniformGPU===void 0){let u;const c=e.groupNode,h=c.name,d=this.getBindGroupArray(h,n);if(t==="texture"||t==="cubeTexture"||t==="cubeDepthTexture"||t==="storageTexture"||t==="texture3D"){let p=null;const g=this.getNodeAccess(e,n);if(t==="texture"||t==="storageTexture"?e.value.is3DTexture===!0?p=new Jb(s.name,s.node,c,g):p=new h0(s.name,s.node,c,g):t==="cubeTexture"||t==="cubeDepthTexture"?p=new Q3(s.name,s.node,c,g):t==="texture3D"&&(p=new Jb(s.name,s.node,c,g)),p.store=e.isStorageTextureNode===!0,p.mipLevel=p.store?e.mipLevel:0,p.setVisibility(Zg[n]),this.isUnfilterable(e.value)===!1&&p.store===!1){const _=new YX(`${s.name}_sampler`,s.node,c);_.setVisibility(Zg[n]),d.push(_,p),u=[_,p]}else d.push(p),u=[p]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const p=this.getSharedDataFromNode(e);let g=p.buffer;if(g===void 0){const _=t==="buffer"?X3:ZX;g=new _(e,c),p.buffer=g}g.setVisibility(g.getVisibility()|Zg[n]),d.push(g),u=g,s.name=r||"NodeBuffer_"+s.id}else{const p=this.uniformGroups[n]||(this.uniformGroups[n]={});let g=p[h];g===void 0&&(g=new Y3(h,c),g.setVisibility(Zg[n]),p[h]=g,d.push(g)),u=this.getNodeUniform(s,t),g.addUniform(u)}o.uniformGPU=u}return s}getBuiltin(e,t,n,r=this.shaderStage){const s=this.builtins[r]||(this.builtins[r]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(o.name+" : "+this.getType(o.type));let s=`fn ${t.name}( ${r.join(", ")} ) -> ${this.getType(t.type)} {
${n.vars}
${n.code}
`;return n.result&&(s+=`	return ${n.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(n!==void 0)for(const r of n)t.push(`enable ${r};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(n!==void 0)for(const{name:r,property:s,type:o}of n.values())t.push(`@builtin( ${r} ) ${s} : ${o}`);return t.join(`,
	`)}getScopedArray(e,t,n,r){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:r}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:n,scope:r,bufferType:s,bufferCount:o}of this.scopedArrays.values()){const u=this.getType(s);t.push(`var<${r}> ${n}: array< ${u}, ${o} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const n=this.getBuiltins("attribute");n&&t.push(n);const r=this.getAttributesArray();for(let s=0,o=r.length;s<o;s++){const u=r[s],c=u.name,h=this.getType(u.type);t.push(`@location( ${s} ) ${c} : ${h}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const n of e.members){const r=e.output?"@location( "+n.index+" ) ":"";let s=this.getType(n.type);n.atomic&&(s="atomic< "+s+" >"),t.push(`	${r+n.name} : ${s}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const r=[];for(const s of n){let o=`struct ${s.name} {
`;o+=this.getStructMembers(s),o+=`
};`,r.push(o)}t=`
`+r.join(`

`)+`
`}return t}getVar(e,t,n=null){let r=`var ${t} : `;return n!==null?r+=this.generateArrayDeclaration(e,n):r+=this.getType(e),r}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const r of n)t.push(`	${this.getVar(r.type,r.name,r.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,o=this.vars[e];for(let u=0;u<s.length;u++){const c=s[u];if(c.needsInterpolation){let h=`@location( ${u} )`;if(c.interpolationType){const d=c.interpolationSampling!==null?`, ${c.interpolationSampling} )`:" )";h+=` @interpolate( ${c.interpolationType}${d}`}else/^(int|uint|ivec|uvec)/.test(c.type)&&(h+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${h} ${c.name} : ${this.getType(c.type)}`)}else e==="vertex"&&o.includes(c)===!1&&o.push(c)}}const n=this.getBuiltins(e);n&&t.push(n);const r=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+r):r}isCustomStruct(e){const t=e.value,n=e.node,r=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&n.structTypeNode!==null,s=n.value&&n.value.array&&typeof n.value.itemSize=="number"&&n.value.array.length>n.value.itemSize;return r&&!s}getUniforms(e){const t=this.uniforms[e],n=[],r=[],s=[],o={};for(const c of t){const h=c.groupNode.name,d=this.bindingsIndexes[h];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="cubeDepthTexture"||c.type==="storageTexture"||c.type==="texture3D"){const p=c.node.value;this.isUnfilterable(p)===!1&&c.node.isStorageTextureNode!==!0&&(this.isSampleCompare(p)?n.push(`@binding( ${d.binding++} ) @group( ${d.group} ) var ${c.name}_sampler : sampler_comparison;`):n.push(`@binding( ${d.binding++} ) @group( ${d.group} ) var ${c.name}_sampler : sampler;`));let g,_="";const{primarySamples:v}=this.renderer.backend.utils.getTextureSampleData(p);if(v>1&&(_="_multisampled"),p.isCubeTexture===!0&&p.isDepthTexture===!0)g="texture_depth_cube";else if(p.isCubeTexture===!0)g="texture_cube<f32>";else if(p.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&p.compareFunction===null?g=`texture${_}_2d<f32>`:g=`texture_depth${_}_2d${p.isArrayTexture===!0?"_array":""}`;else if(c.node.isStorageTextureNode===!0){const T=tS(p),b=this.getStorageAccess(c.node,e),x=c.node.value.is3DTexture,M=c.node.value.isArrayTexture;g=`texture_storage_${x?"3d":`2d${M?"_array":""}`}<${T}, ${b}>`}else if(p.isArrayTexture===!0||p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0)g="texture_2d_array<f32>";else if(p.is3DTexture===!0||p.isData3DTexture===!0)g="texture_3d<f32>";else{const T=this.getComponentTypeFromTexture(p).charAt(0);g=`texture${_}_2d<${T}32>`}n.push(`@binding( ${d.binding++} ) @group( ${d.group} ) var ${c.name} : ${g};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const p=c.node,g=this.getType(p.getNodeType(this)),_=p.bufferCount,v=_>0&&c.type==="buffer"?", "+_:"",T=p.isStorageBufferNode?`storage, ${this.getStorageAccess(p,e)}`:"uniform";if(this.isCustomStruct(c))r.push(`@binding( ${d.binding++} ) @group( ${d.group} ) var<${T}> ${c.name} : ${g};`);else{const x=`	value : array< ${p.isAtomic?`atomic<${g}>`:`${g}`}${v} >`;r.push(this._getWGSLStructBinding(c.name,x,T,d.binding++,d.group))}}else{const p=this.getType(this.getVectorType(c.type)),g=c.groupNode.name;(o[g]||(o[g]={index:d.binding++,id:d.group,snippets:[]})).snippets.push(`	${c.name} : ${p}`)}}for(const c in o){const h=o[c];s.push(this._getWGSLStructBinding(c,h.snippets.join(`,
`),"uniform",h.index,h.id))}return[...n,...r,...s].join(`
`)}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let r=`// code

`;r+=this.flowCode[t];const s=this.flowNodes[t],o=s[s.length-1],u=o.outputNode,c=u!==void 0&&u.isOutputStructNode===!0;for(const h of s){const d=this.getFlowData(h),p=h.name;if(p&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${p}
`),r+=`${d.code}
	`,h===o&&t!=="compute"){if(r+=`// result

	`,t==="vertex")r+=`varyings.Vertex = ${d.result};`;else if(t==="fragment")if(c)n.returnType=u.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",r+=`return ${d.result};`;else{let g="	@location(0) color: vec4<f32>";const _=this.getBuiltins("output");_&&(g+=`,
	`+_),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",g),n.structs+=`
var<private> output : OutputStruct;`,r+=`output.color = ${d.result};

	return output;`}}}n.flow=r}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let n;return t!==null&&(n=this._getWGSLMethod(e+"_"+t)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,n){return`select( ${n}, ${t}, ${e} )`}getType(e){return cY[e]||e}isAvailable(e){let t=hN[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),hN[e]=t),t}_getWGSLMethod(e){return Ed[e]!==void 0&&this._include(e),hY[e]}_include(e){const t=Ed[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${eL}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){const[n,r,s]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${n}, ${r}, ${s} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${n} * numWorkgroups.x )
		+ globalId.z * ( ${n} * numWorkgroups.x ) * ( ${r} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,n,r=0,s=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}
@binding( ${r} ) @group( ${s} )
var<${n}> ${e} : ${o};`}}class dY{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=j.Depth24PlusStencil8:e.depth&&(t=j.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,o=s.getRenderTarget();t=o?o.samples:s.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorFormats(e){return e.textures!==null?e.textures.map(t=>this.getTextureFormatGPU(t)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return $c.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return $c.LineList;if(e.isLine)return $c.LineStrip;if(e.isMesh)return $c.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const t=this.backend.parameters.outputType;if(t===void 0)return navigator.gpu.getPreferredCanvasFormat();if(t===Hn)return j.BGRA8Unorm;if(t===Zn)return j.RGBA16Float;throw new Error("Unsupported output buffer type.")}}const tL=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&tL.set(Float16Array,["float16"]);const pY=new Map([[XN,["float16"]]]),mY=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class gY{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),r=this.backend,s=r.get(n);let o=s.buffer;if(o===void 0){const u=r.device;let c=n.array;if(e.normalized===!1){if(c.constructor===Int16Array||c.constructor===Int8Array)c=new Int32Array(c);else if((c.constructor===Uint16Array||c.constructor===Uint8Array)&&(c=new Uint32Array(c),t&GPUBufferUsage.INDEX))for(let p=0;p<c.length;p++)c[p]===65535&&(c[p]=4294967295)}if(n.array=c,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){c=new c.constructor(n.count*4);for(let p=0;p<n.count;p++)c.set(n.array.subarray(p*3,p*3+3),p*4);n.itemSize=4,n.array=c,s._force3to4BytesAlignment=!0}const h=c.byteLength,d=h+(4-h%4)%4;o=u.createBuffer({label:n.name,size:d,usage:t,mappedAtCreation:!0}),new c.constructor(o.getMappedRange()).set(c),o.unmap(),s.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,r=n.device,s=n.get(t),o=n.get(t).buffer;let u=t.array;if(s._force3to4BytesAlignment===!0){u=new u.constructor(t.count*4);for(let h=0;h<t.count;h++)u.set(t.array.subarray(h*3,h*3+3),h*4);t.array=u}const c=t.updateRanges;if(c.length===0)r.queue.writeBuffer(o,0,u,0);else{const h=__(u),d=h?1:u.BYTES_PER_ELEMENT;for(let p=0,g=c.length;p<g;p++){const _=c[p];let v,T;if(s._force3to4BytesAlignment===!0){const x=Math.floor(_.start/3),M=Math.ceil(_.count/3);v=x*4*d,T=M*4*d}else v=_.start*d,T=_.count*d;const b=v*(h?u.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(o,b,u,v,T)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let r=0;r<t.length;r++){const s=t[r],o=s.array.BYTES_PER_ELEMENT,u=this._getBufferAttribute(s);let c=n.get(u);if(c===void 0){let p,g;s.isInterleavedBufferAttribute===!0?(p=s.data.stride*o,g=s.data.isInstancedInterleavedBuffer?Qg.Instance:Qg.Vertex):(p=s.itemSize*o,g=s.isInstancedBufferAttribute?Qg.Instance:Qg.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(p=4),c={arrayStride:p,attributes:[],stepMode:g},n.set(u,c)}const h=this._getVertexFormat(s),d=s.isInterleavedBufferAttribute===!0?s.offset*o:0;c.attributes.push({shaderLocation:r,offset:d,format:h})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,s=t.get(this._getBufferAttribute(e)).buffer,o=s.size,u=n.createBuffer({label:`${e.name}_readback`,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),c=n.createCommandEncoder({label:`readback_encoder_${e.name}`});c.copyBufferToBuffer(s,0,u,0,o);const h=c.finish();n.queue.submit([h]),await u.mapAsync(GPUMapMode.READ);const d=u.getMappedRange(),p=new e.array.constructor(d.slice(0));return u.unmap(),p.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,r=e.array.constructor,s=e.constructor;let o;if(t===1)o=mY.get(r);else{const c=(pY.get(s)||tL.get(r))[n?1:0];if(c){const h=r.BYTES_PER_ELEMENT*t,p=Math.floor((h+3)/4)*4/r.BYTES_PER_ELEMENT;if(p%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${c}x${p}`}}return o||Re("WebGPUAttributeUtils: Vertex format not supported yet."),o}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class _Y{constructor(e){this.layoutGPU=e,this.usedTimes=0}}class vY{constructor(e){this.backend=e,this._bindGroupLayoutCache=new Map}createBindingsLayout(e){const t=this.backend,n=t.device,r=t.get(e);if(r.layout)return r.layout.layoutGPU;const s=this._createLayoutEntries(e),o=JSON.stringify(s);let u=this._bindGroupLayoutCache.get(o);return u===void 0&&(u=new _Y(n.createBindGroupLayout({entries:s})),this._bindGroupLayoutCache.set(o,u)),u.usedTimes++,r.layout=u,r.layoutKey=o,u.layoutGPU}createBindings(e,t,n,r=0){const{backend:s}=this,o=s.get(e),u=this.createBindingsLayout(e);let c;n>0&&(o.groups===void 0&&(o.groups=[],o.versions=[]),o.versions[n]===r&&(c=o.groups[n])),c===void 0&&(c=this.createBindGroup(e,u),n>0&&(o.groups[n]=c,o.versions[n]=r)),o.group=c}updateBinding(e){const t=this.backend,n=t.device,r=e.buffer,s=t.get(e).buffer,o=e.updateRanges;if(o.length===0)n.queue.writeBuffer(s,0,r,0);else{const u=__(r),c=u?1:r.BYTES_PER_ELEMENT;for(let h=0,d=o.length;h<d;h++){const p=o[h],g=p.start*c,_=p.count*c,v=g*(u?r.BYTES_PER_ELEMENT:1);n.queue.writeBuffer(s,v,r,g,_)}e.clearUpdateRanges()}}createBindGroupIndex(e,t){const r=this.backend.device,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,o=e[0],u=r.createBuffer({label:"bindingCameraIndex_"+o,size:16,usage:s});r.queue.writeBuffer(u,0,e,0);const c=[{binding:0,resource:{buffer:u}}];return r.createBindGroup({label:"bindGroupCameraIndex_"+o,layout:t,entries:c})}createBindGroup(e,t){const n=this.backend,r=n.device;let s=0;const o=[];for(const u of e.bindings){if(u.isUniformBuffer){const c=n.get(u);if(c.buffer===void 0){const h=u.byteLength,d=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,p=[];u.visibility&nu.VERTEX&&p.push("vertex"),u.visibility&nu.FRAGMENT&&p.push("fragment"),u.visibility&nu.COMPUTE&&p.push("compute");const g=`(${p.join(",")})`,_=r.createBuffer({label:`bindingBuffer${u.id}_${u.name}_${g}`,size:h,usage:d});c.buffer=_}o.push({binding:s,resource:{buffer:c.buffer}})}else if(u.isStorageBuffer){const c=n.get(u);if(c.buffer===void 0){const h=u.attribute;c.buffer=n.get(h).buffer}o.push({binding:s,resource:{buffer:c.buffer}})}else if(u.isSampledTexture){const c=n.get(u.texture);let h;if(c.externalTexture!==void 0)h=r.importExternalTexture({source:c.externalTexture});else{const d=u.store?1:c.texture.mipLevelCount,p=u.store?u.mipLevel:0;let g=`view-${c.texture.width}-${c.texture.height}`;if(c.texture.depthOrArrayLayers>1&&(g+=`-${c.texture.depthOrArrayLayers}`),g+=`-${d}-${p}`,h=c[g],h===void 0){const _=XX.All;let v;u.isSampledCubeTexture?v=vi.Cube:u.isSampledTexture3D?v=vi.ThreeD:u.texture.isArrayTexture||u.texture.isDataArrayTexture||u.texture.isCompressedArrayTexture?v=vi.TwoDArray:v=vi.TwoD,h=c[g]=c.texture.createView({aspect:_,dimension:v,mipLevelCount:d,baseMipLevel:p})}}o.push({binding:s,resource:h})}else if(u.isSampler){const c=n.get(u.texture);o.push({binding:s,resource:c.sampler})}s++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}_createLayoutEntries(e){const t=[];let n=0;for(const r of e.bindings){const s=this.backend,o={binding:n,visibility:r.visibility};if(r.isUniformBuffer||r.isStorageBuffer){const u={};r.isStorageBuffer&&(r.visibility&nu.COMPUTE&&(r.access===vs.READ_WRITE||r.access===vs.WRITE_ONLY)?u.type=rb.Storage:u.type=rb.ReadOnlyStorage),o.buffer=u}else if(r.isSampledTexture&&r.store){const u={};u.format=this.backend.get(r.texture).texture.format;const c=r.access;c===vs.READ_WRITE?u.access=sb.ReadWrite:c===vs.WRITE_ONLY?u.access=sb.WriteOnly:u.access=sb.ReadOnly,r.texture.isArrayTexture?u.viewDimension=vi.TwoDArray:r.texture.is3DTexture&&(u.viewDimension=vi.ThreeD),o.storageTexture=u}else if(r.isSampledTexture){const u={},{primarySamples:c}=s.utils.getTextureSampleData(r.texture);if(c>1&&(u.multisampled=!0,r.texture.isDepthTexture||(u.sampleType=Wl.UnfilterableFloat)),r.texture.isDepthTexture)s.compatibilityMode&&r.texture.compareFunction===null?u.sampleType=Wl.UnfilterableFloat:u.sampleType=Wl.Depth;else if(r.texture.isDataTexture||r.texture.isDataArrayTexture||r.texture.isData3DTexture){const h=r.texture.type;h===Ni?u.sampleType=Wl.SInt:h===yn?u.sampleType=Wl.UInt:h===ri&&(this.backend.hasFeature("float32-filterable")?u.sampleType=Wl.Float:u.sampleType=Wl.UnfilterableFloat)}r.isSampledCubeTexture?u.viewDimension=vi.Cube:r.texture.isArrayTexture||r.texture.isDataArrayTexture||r.texture.isCompressedArrayTexture?u.viewDimension=vi.TwoDArray:r.isSampledTexture3D&&(u.viewDimension=vi.ThreeD),o.texture=u}else if(r.isSampler){const u={};r.texture.isDepthTexture&&(r.texture.compareFunction!==null?u.type=aN.Comparison:s.compatibilityMode&&(u.type=aN.NonFiltering)),o.sampler=u}else Re(`WebGPUBindingUtils: Unsupported binding "${r}".`);t.push(o),n++}return t}deleteBindGroupData(e){const{backend:t}=this,n=t.get(e);n.layout&&(n.layout.usedTimes--,n.layout.usedTimes===0&&this._bindGroupLayoutCache.delete(n.layoutKey),n.layout=void 0,n.layoutKey=void 0)}dispose(){this._bindGroupLayoutCache.clear()}}class yY{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:r,geometry:s,pipeline:o}=e,{vertexProgram:u,fragmentProgram:c}=o,h=this.backend,d=h.device,p=h.utils,g=h.get(o),_=[];for(const X of e.getBindings()){const J=h.get(X),{layoutGPU:ne}=J.layout;_.push(ne)}const v=h.attributeUtils.createShaderVertexBuffers(e);let T;r.blending!==_r&&(r.blending!==es||r.transparent!==!1)&&(T=this._getBlending(r));let b={};r.stencilWrite===!0&&(b={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const x=this._getColorWriteMask(r),M=[];if(e.context.textures!==null){const X=e.context.textures;for(let J=0;J<X.length;J++){const ne=p.getTextureFormatGPU(X[J]);J===0?M.push({format:ne,blend:T,writeMask:x}):M.push({format:ne,writeMask:x})}}else{const X=p.getCurrentColorFormat(e.context);M.push({format:X,blend:T,writeMask:x})}const E=h.get(u).module,w=h.get(c).module,C=this._getPrimitiveState(n,s,r),N=this._getDepthCompare(r),D=p.getCurrentDepthStencilFormat(e.context),U=this._getSampleCount(e.context),R={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},E,{buffers:v}),fragment:Object.assign({},w,{targets:M}),primitive:C,multisample:{count:U,alphaToCoverageEnabled:r.alphaToCoverage&&U>1},layout:d.createPipelineLayout({bindGroupLayouts:_})},P={},I=e.context.depth,H=e.context.stencil;if((I===!0||H===!0)&&(I===!0&&(P.format=D,P.depthWriteEnabled=r.depthWrite,P.depthCompare=N),H===!0&&(P.stencilFront=b,P.stencilBack={},P.stencilReadMask=r.stencilFuncMask,P.stencilWriteMask=r.stencilWriteMask),r.polygonOffset===!0&&(P.depthBias=r.polygonOffsetUnits,P.depthBiasSlopeScale=r.polygonOffsetFactor,P.depthBiasClamp=0),R.depthStencil=P),d.pushErrorScope("validation"),t===null)g.pipeline=d.createRenderPipeline(R),d.popErrorScope().then(X=>{X!==null&&(g.error=!0,Re(X.message))});else{const X=new Promise(async J=>{try{g.pipeline=await d.createRenderPipelineAsync(R)}catch{}const ne=await d.popErrorScope();ne!==null&&(g.error=!0,Re(ne.message)),J()});t.push(X)}}createBundleEncoder(e,t="renderBundleEncoder"){const n=this.backend,{utils:r,device:s}=n,o=r.getCurrentDepthStencilFormat(e),u=r.getCurrentColorFormats(e),c=this._getSampleCount(e),h={label:t,colorFormats:u,depthStencilFormat:o,sampleCount:c};return s.createRenderBundleEncoder(h)}createComputePipeline(e,t){const n=this.backend,r=n.device,s=n.get(e.computeProgram).module,o=n.get(e),u=[];for(const c of t){const h=n.get(c),{layoutGPU:d}=h.layout;u.push(d)}o.pipeline=r.createComputePipeline({compute:s,layout:r.createPipelineLayout({bindGroupLayouts:u})})}_getBlending(e){let t,n;const r=e.blending,s=e.blendSrc,o=e.blendDst,u=e.blendEquation;if(r===jc){const c=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,h=e.blendDstAlpha!==null?e.blendDstAlpha:o,d=e.blendEquationAlpha!==null?e.blendEquationAlpha:u;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(u)},n={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(h),operation:this._getBlendOperation(d)}}else{const c=e.premultipliedAlpha,h=(d,p,g,_)=>{t={srcFactor:d,dstFactor:p,operation:Hl.Add},n={srcFactor:g,dstFactor:_,operation:Hl.Add}};if(c)switch(r){case es:h(Xt.One,Xt.OneMinusSrcAlpha,Xt.One,Xt.OneMinusSrcAlpha);break;case eh:h(Xt.One,Xt.One,Xt.One,Xt.One);break;case th:h(Xt.Zero,Xt.OneMinusSrc,Xt.Zero,Xt.One);break;case nh:h(Xt.Dst,Xt.OneMinusSrcAlpha,Xt.Zero,Xt.One);break}else switch(r){case es:h(Xt.SrcAlpha,Xt.OneMinusSrcAlpha,Xt.One,Xt.OneMinusSrcAlpha);break;case eh:h(Xt.SrcAlpha,Xt.One,Xt.One,Xt.One);break;case th:Re("WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case nh:Re("WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true");break}}if(t!==void 0&&n!==void 0)return{color:t,alpha:n};Re("WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(e){let t;switch(e){case Ka:t=Xt.Zero;break;case xS:t=Xt.One;break;case bS:t=Xt.Src;break;case SS:t=Xt.OneMinusSrc;break;case Jd:t=Xt.SrcAlpha;break;case ep:t=Xt.OneMinusSrcAlpha;break;case ES:t=Xt.Dst;break;case AS:t=Xt.OneMinusDst;break;case TS:t=Xt.DstAlpha;break;case MS:t=Xt.OneMinusDstAlpha;break;case wS:t=Xt.SrcAlphaSaturated;break;case X$:t=Xt.Constant;break;case Y$:t=Xt.OneMinusConstant;break;default:Re("WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const n=e.stencilFunc;switch(n){case IO:t=Hi.Never;break;case Sb:t=Hi.Always;break;case zO:t=Hi.Less;break;case kO:t=Hi.LessEqual;break;case GO:t=Hi.Equal;break;case WO:t=Hi.GreaterEqual;break;case VO:t=Hi.Greater;break;case HO:t=Hi.NotEqual;break;default:Re("WebGPURenderer: Invalid stencil function.",n)}return t}_getStencilOperation(e){let t;switch(e){case $l:t=Zo.Keep;break;case DO:t=Zo.Zero;break;case LO:t=Zo.Replace;break;case FO:t=Zo.Invert;break;case PO:t=Zo.IncrementClamp;break;case UO:t=Zo.DecrementClamp;break;case OO:t=Zo.IncrementWrap;break;case BO:t=Zo.DecrementWrap;break;default:Re("WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case sr:t=Hl.Add;break;case vS:t=Hl.Subtract;break;case yS:t=Hl.ReverseSubtract;break;case zN:t=Hl.Min;break;case GN:t=Hl.Max;break;default:Re("WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,n){const r={},s=this.backend.utils;r.topology=s.getPrimitiveTopology(e,n),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?Ih.Uint16:Ih.Uint32);let o=n.side===Pn;return e.isMesh&&e.matrixWorld.determinant()<0&&(o=!o),r.frontFace=o===!0?iN.CW:iN.CCW,r.cullMode=n.side===rr?rN.None:rN.Back,r}_getColorWriteMask(e){return e.colorWrite===!0?sN.All:sN.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=Hi.Always;else{const n=e.depthFunc;switch(n){case tp:t=Hi.Never;break;case np:t=Hi.Always;break;case ip:t=Hi.Less;break;case hl:t=Hi.LessEqual;break;case rp:t=Hi.Equal;break;case sp:t=Hi.GreaterEqual;break;case ap:t=Hi.Greater;break;case op:t=Hi.NotEqual;break;default:Re("WebGPUPipelineUtils: Invalid depth function.",n)}}return t}}class xY extends J3{constructor(e,t,n=2048){super(n),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const r=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return Vn(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const r=this.device.createCommandEncoder();r.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),r.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const s=r.finish();if(this.device.queue.submit([s]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const o=new BigUint64Array(this.resultBuffer.getMappedRange(0,n)),u={},c=[];for(const[d,p]of e){const g=d.match(/^(.*):f(\d+)$/),_=parseInt(g[2]);c.includes(_)===!1&&c.push(_),u[_]===void 0&&(u[_]=0);const v=o[p],T=o[p+1],b=Number(T-v)/1e6;this.timestamps.set(d,b),u[_]+=b}const h=u[c[c.length-1]];return this.resultBuffer.unmap(),this.lastValue=h,this.frames=c,h}catch(e){return Re("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){Re("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){Re("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class bY extends Z3{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new dY(this),this.attributeUtils=new gY(this),this.bindingUtils=new vY(this),this.pipelineUtils=new yY(this),this.textureUtils=new nY(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let n;if(t.device===void 0){const r={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},s=typeof navigator<"u"?await navigator.gpu.requestAdapter(r):null;if(s===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const o=Object.values(eS),u=[];for(const h of o)s.features.has(h)&&u.push(h);const c={requiredFeatures:u,requiredLimits:t.requiredLimits};n=await s.requestDevice(c)}else n=t.device;n.lost.then(r=>{if(r.reason==="destroyed")return;const s={api:"WebGPU",message:r.message||"Unknown reason",reason:r.reason||null,originalEvent:r};e.onDeviceLost(s)}),this.device=n,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(eS.TimestampQuery),this.updateSize()}get context(){const e=this.renderer.getCanvasTarget(),t=this.get(e);let n=t.context;if(n===void 0){const r=this.parameters;e.isDefaultCanvasTarget===!0&&r.context!==void 0?n=r.context:n=e.domElement.getContext("webgpu"),"setAttribute"in e.domElement&&e.domElement.setAttribute("data-engine",`three.js r${Tu} webgpu`);const s=r.alpha?"premultiplied":"opaque",o=r.outputType===Zn?"extended":"standard";n.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s,toneMapping:{mode:o}}),t.context=n}return n}get coordinateSystem(){return ma}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const e=this.renderer,t=e.getCanvasTarget(),n=this.get(t),r=e.currentSamples;let s=n.descriptor;if(s===void 0||n.samples!==r){s={colorAttachments:[{view:null}]},(e.depth===!0||e.stencil===!0)&&(s.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const u=s.colorAttachments[0];r>0?u.view=this.textureUtils.getColorBuffer().createView():u.resolveTarget=void 0,n.descriptor=s,n.samples=r}const o=s.colorAttachments[0];return r>0?o.resolveTarget=this.context.getCurrentTexture().createView():o.view=this.context.getCurrentTexture().createView(),s}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const n=e.renderTarget,r=this.get(n);let s=r.descriptors;(s===void 0||r.width!==n.width||r.height!==n.height||r.samples!==n.samples)&&(s={},r.descriptors=s);const o=e.getCacheKey();let u=s[o];if(u===void 0){const h=e.textures,d=[];let p;const g=this._isRenderCameraDepthArray(e);for(let _=0;_<h.length;_++){const v=this.get(h[_]),T={label:`colorAttachment_${_}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:vi.TwoD};if(n.isRenderTarget3D)p=e.activeCubeFace,T.baseArrayLayer=0,T.dimension=vi.ThreeD,T.depthOrArrayLayers=h[_].image.depth;else if(n.isRenderTarget&&h[_].image.depth>1)if(g===!0){const b=e.camera.cameras;for(let x=0;x<b.length;x++){const M={...T,baseArrayLayer:x,arrayLayerCount:1,dimension:vi.TwoD},E=v.texture.createView(M);d.push({view:E,resolveTarget:void 0,depthSlice:void 0})}}else T.dimension=vi.TwoDArray,T.depthOrArrayLayers=h[_].image.depth;if(g!==!0){const b=v.texture.createView(T);let x,M;v.msaaTexture!==void 0?(x=v.msaaTexture.createView(),M=b):(x=b,M=void 0),d.push({view:x,resolveTarget:M,depthSlice:p})}}if(u={textureViews:d},e.depth){const _=this.get(e.depthTexture),v={};(e.depthTexture.isArrayTexture||e.depthTexture.isCubeTexture)&&(v.dimension=vi.TwoD,v.arrayLayerCount=1,v.baseArrayLayer=e.activeCubeFace),u.depthStencilView=_.texture.createView(v)}s[o]=u,r.width=n.width,r.height=n.height,r.samples=n.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace}const c={colorAttachments:[]};for(let h=0;h<u.textureViews.length;h++){const d=u.textureViews[h];let p={r:0,g:0,b:0,a:1};h===0&&t.clearValue&&(p=t.clearValue),c.colorAttachments.push({view:d.view,depthSlice:d.depthSlice,resolveTarget:d.resolveTarget,loadOp:t.loadOp||dn.Load,storeOp:t.storeOp||hr.Store,clearValue:p})}return u.depthStencilView&&(c.depthStencilAttachment={view:u.depthStencilView}),c}beginRender(e){const t=this.get(e),n=this.device,r=e.occlusionQueryCount;let s;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=n.createQuerySet({type:"occlusion",count:r,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(r),t.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e,{loadOp:dn.Load}),this.initTimestampQuery(ca.RENDER,this.getTimestampUID(e),o),o.occlusionQuerySet=s;const u=o.depthStencilAttachment;if(e.textures!==null){const h=o.colorAttachments;for(let d=0;d<h.length;d++){const p=h[d];e.clearColor?(p.clearValue=d===0?e.clearColorValue:{r:0,g:0,b:0,a:1},p.loadOp=dn.Clear):p.loadOp=dn.Load,p.storeOp=hr.Store}}else{const h=o.colorAttachments[0];e.clearColor?(h.clearValue=e.clearColorValue,h.loadOp=dn.Clear):h.loadOp=dn.Load,h.storeOp=hr.Store}e.depth&&(e.clearDepth?(u.depthClearValue=e.clearDepthValue,u.depthLoadOp=dn.Clear):u.depthLoadOp=dn.Load,u.depthStoreOp=hr.Store),e.stencil&&(e.clearStencil?(u.stencilClearValue=e.clearStencilValue,u.stencilLoadOp=dn.Clear):u.stencilLoadOp=dn.Load,u.stencilStoreOp=hr.Store);const c=n.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const h=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==h.length?this._createDepthLayerDescriptors(e,t,o,h):this._updateDepthLayerDescriptors(e,t,h),t.bundleEncoders=[],t.bundleSets=[];for(let d=0;d<h.length;d++){const p=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+d),g={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(p),t.bundleSets.push(g)}t.currentPass=null}else{const h=c.beginRenderPass(o);t.currentPass=h,e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}t.descriptor=o,t.encoder=c,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,n,r){const s=n.depthStencilAttachment;t.layerDescriptors=[];const o=this.get(e.depthTexture);o.viewCache||(o.viewCache=[]);for(let u=0;u<r.length;u++){const c={...n,colorAttachments:[{...n.colorAttachments[0],view:n.colorAttachments[u].view}]};if(n.depthStencilAttachment){const h=u;o.viewCache[h]||(o.viewCache[h]=o.texture.createView({dimension:vi.TwoD,baseArrayLayer:u,arrayLayerCount:1})),c.depthStencilAttachment={view:o.viewCache[h],depthLoadOp:s.depthLoadOp||dn.Clear,depthStoreOp:s.depthStoreOp||hr.Store,depthClearValue:s.depthClearValue||1},e.stencil&&(c.depthStencilAttachment.stencilLoadOp=s.stencilLoadOp,c.depthStencilAttachment.stencilStoreOp=s.stencilStoreOp,c.depthStencilAttachment.stencilClearValue=s.stencilClearValue)}else c.depthStencilAttachment={...s};t.layerDescriptors.push(c)}}_updateDepthLayerDescriptors(e,t,n){for(let r=0;r<n.length;r++){const s=t.layerDescriptors[r];if(s.depthStencilAttachment){const o=s.depthStencilAttachment;e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=dn.Clear):o.depthLoadOp=dn.Load),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=dn.Clear):o.stencilLoadOp=dn.Load)}}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const r=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const s=[];for(let o=0;o<t.bundleEncoders.length;o++){const u=t.bundleEncoders[o];s.push(u.finish())}for(let o=0;o<t.layerDescriptors.length;o++)if(o<s.length){const u=t.layerDescriptors[o],c=r.beginRenderPass(u);if(e.viewport){const{x:h,y:d,width:p,height:g,minDepth:_,maxDepth:v}=e.viewportValue;c.setViewport(h,d,p,g,_,v)}if(e.scissor){const{x:h,y:d,width:p,height:g}=e.scissorValue;c.setScissorRect(h,d,p,g)}c.executeBundles([s[o]]),c.end()}}else t.currentPass&&t.currentPass.end();if(n>0){const s=n*8;let o=this.occludedResolveCache.get(s);o===void 0&&(o=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,o));const u=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,o,0),t.encoder.copyBufferToBuffer(o,0,u,0,s),t.occlusionQueryBuffer=u,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const s=e.textures;for(let o=0;o<s.length;o++){const u=s[o];u.generateMipmaps===!0&&this.textureUtils.generateMipmaps(u)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const o=n.getMappedRange(),u=new BigUint64Array(o);for(let c=0;c<r.length;c++)u[c]===BigInt(0)&&s.add(r[c]);n.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:r,width:s,height:o,minDepth:u,maxDepth:c}=e.viewportValue;t.setViewport(n,r,s,o,u,c)}updateScissor(e){const{currentPass:t}=this.get(e),{x:n,y:r,width:s,height:o}=e.scissorValue;t.setScissorRect(n,r,s,o)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n,r=null){const s=this.device,o=this.renderer;let u=[],c,h,d,p;if(e){const v=this.getClearColor();h={r:v.r,g:v.g,b:v.b,a:v.a}}if(r===null){d=o.depth,p=o.stencil;const v=this._getDefaultRenderPassDescriptor();if(e){u=v.colorAttachments;const T=u[0];T.clearValue=h,T.loadOp=dn.Clear,T.storeOp=hr.Store}(d||p)&&(c=v.depthStencilAttachment)}else{d=r.depth,p=r.stencil;const v={loadOp:e?dn.Clear:dn.Load,clearValue:e?h:void 0};d&&(v.depthLoadOp=t?dn.Clear:dn.Load,v.depthClearValue=t?o.getClearDepth():void 0,v.depthStoreOp=hr.Store),p&&(v.stencilLoadOp=n?dn.Clear:dn.Load,v.stencilClearValue=n?o.getClearStencil():void 0,v.stencilStoreOp=hr.Store);const T=this._getRenderPassDescriptor(r,v);u=T.colorAttachments,c=T.depthStencilAttachment}d&&c&&(t?(c.depthLoadOp=dn.Clear,c.depthClearValue=o.getClearDepth(),c.depthStoreOp=hr.Store):(c.depthLoadOp=dn.Load,c.depthStoreOp=hr.Store)),p&&c&&(n?(c.stencilLoadOp=dn.Clear,c.stencilClearValue=o.getClearStencil(),c.stencilStoreOp=hr.Store):(c.stencilLoadOp=dn.Load,c.stencilStoreOp=hr.Store));const g=s.createCommandEncoder({label:"clear"});g.beginRenderPass({colorAttachments:u,depthStencilAttachment:c}).end(),s.queue.submit([g.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(ca.COMPUTE,this.getTimestampUID(e),n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,r,s=null){const o=this.get(t),{passEncoderGPU:u}=this.get(e),c=this.get(r).pipeline;this.pipelineUtils.setPipeline(u,c);for(let h=0,d=n.length;h<d;h++){const p=n[h],g=this.get(p);u.setBindGroup(h,g.group)}if(s===null&&(s=t.count),s&&typeof s=="object"&&s.isIndirectStorageBufferAttribute){const h=this.get(s).buffer;u.dispatchWorkgroupsIndirect(h,0);return}if(typeof s=="number"){const h=s;if(o.dispatchSize===void 0||o.count!==h){o.dispatchSize=[0,1,1],o.count=h;const d=t.workgroupSize;let p=d[0];for(let v=1;v<d.length;v++)p*=d[v];const g=Math.ceil(h/p),_=this.device.limits.maxComputeWorkgroupsPerDimension;s=[g,1,1],g>_&&(s[0]=Math.min(g,_),s[1]=Math.ceil(g/_)),o.dispatchSize=s}s=o.dispatchSize}u.dispatchWorkgroups(s[0],s[1]||1,s[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){const{object:n,material:r,context:s,pipeline:o}=e,u=e.getBindings(),c=this.get(s),h=this.get(o),d=h.pipeline;if(h.error===!0)return;const p=e.getIndex(),g=p!==null,_=e.getDrawParameters();if(_===null)return;const v=(b,x)=>{this.pipelineUtils.setPipeline(b,d),x.pipeline=d;const M=x.bindingGroups;for(let w=0,C=u.length;w<C;w++){const N=u[w],D=this.get(N);M[N.index]!==N.id&&(b.setBindGroup(N.index,D.group),M[N.index]=N.id)}if(g===!0&&x.index!==p){const w=this.get(p).buffer,C=p.array instanceof Uint16Array?Ih.Uint16:Ih.Uint32;b.setIndexBuffer(w,C),x.index=p}const E=e.getVertexBuffers();for(let w=0,C=E.length;w<C;w++){const N=E[w];if(x.attributes[w]!==N){const D=this.get(N).buffer;b.setVertexBuffer(w,D),x.attributes[w]=N}}s.stencil===!0&&r.stencilWrite===!0&&c.currentStencilRef!==r.stencilRef&&(b.setStencilReference(r.stencilRef),c.currentStencilRef=r.stencilRef)},T=(b,x)=>{if(v(b,x),n.isBatchedMesh===!0){const M=n._multiDrawStarts,E=n._multiDrawCounts,w=n._multiDrawCount,C=n._multiDrawInstances;C!==null&&Vn("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let N=0;N<w;N++){const D=C?C[N]:1,U=D>1?0:N;g===!0?b.drawIndexed(E[N],D,M[N]/p.array.BYTES_PER_ELEMENT,0,U):b.draw(E[N],D,M[N],U),t.update(n,E[N],D)}}else if(g===!0){const{vertexCount:M,instanceCount:E,firstVertex:w}=_,C=e.getIndirect();if(C!==null){const N=this.get(C).buffer,D=e.getIndirectOffset(),U=Array.isArray(D)?D:[D];for(let R=0;R<U.length;R++)b.drawIndexedIndirect(N,U[R])}else b.drawIndexed(M,E,w,0,0);t.update(n,M,E)}else{const{vertexCount:M,instanceCount:E,firstVertex:w}=_,C=e.getIndirect();if(C!==null){const N=this.get(C).buffer,D=e.getIndirectOffset(),U=Array.isArray(D)?D:[D];for(let R=0;R<U.length;R++)b.drawIndirect(N,U[R])}else b.draw(M,E,w,0);t.update(n,M,E)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const b=this.get(e.camera),x=e.camera.cameras,M=e.getBindingGroup("cameraIndex");if(b.indexesGPU===void 0||b.indexesGPU.length!==x.length){const w=this.get(M),C=[],N=new Uint32Array([0,0,0,0]);for(let D=0,U=x.length;D<U;D++){N[0]=D;const{layoutGPU:R}=w.layout,P=this.bindingUtils.createBindGroupIndex(N,R);C.push(P)}b.indexesGPU=C}const E=this.renderer.getPixelRatio();for(let w=0,C=x.length;w<C;w++){const N=x[w];if(n.layers.test(N.layers)){const D=N.viewport;let U=c.currentPass,R=c.currentSets;if(c.bundleEncoders){const P=c.bundleEncoders[w],I=c.bundleSets[w];U=P,R=I}D&&U.setViewport(Math.floor(D.x*E),Math.floor(D.y*E),Math.floor(D.width*E),Math.floor(D.height*E),s.viewportValue.minDepth,s.viewportValue.maxDepth),M&&b.indexesGPU&&(U.setBindGroup(M.index,b.indexesGPU[w]),R.bindingGroups[M.index]=M.id),T(U,R)}}}else if(c.currentPass){if(c.occlusionQuerySet!==void 0){const b=c.lastOcclusionObject;b!==n&&(b!==null&&b.occlusionTest===!0&&(c.currentPass.endOcclusionQuery(),c.occlusionQueryIndex++),n.occlusionTest===!0&&(c.currentPass.beginOcclusionQuery(c.occlusionQueryIndex),c.occlusionQueryObjects[c.occlusionQueryIndex]=n),c.lastOcclusionObject=n)}T(c.currentPass,c.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:n,material:r}=e,s=this.utils,o=s.getSampleCountRenderContext(e.context),u=s.getCurrentColorSpace(e.context),c=s.getCurrentColorFormat(e.context),h=s.getCurrentDepthStencilFormat(e.context),d=s.getPrimitiveTopology(n,r);let p=!1;return(t.material!==r||t.materialVersion!==r.version||t.transparent!==r.transparent||t.blending!==r.blending||t.premultipliedAlpha!==r.premultipliedAlpha||t.blendSrc!==r.blendSrc||t.blendDst!==r.blendDst||t.blendEquation!==r.blendEquation||t.blendSrcAlpha!==r.blendSrcAlpha||t.blendDstAlpha!==r.blendDstAlpha||t.blendEquationAlpha!==r.blendEquationAlpha||t.colorWrite!==r.colorWrite||t.depthWrite!==r.depthWrite||t.depthTest!==r.depthTest||t.depthFunc!==r.depthFunc||t.stencilWrite!==r.stencilWrite||t.stencilFunc!==r.stencilFunc||t.stencilFail!==r.stencilFail||t.stencilZFail!==r.stencilZFail||t.stencilZPass!==r.stencilZPass||t.stencilFuncMask!==r.stencilFuncMask||t.stencilWriteMask!==r.stencilWriteMask||t.side!==r.side||t.alphaToCoverage!==r.alphaToCoverage||t.sampleCount!==o||t.colorSpace!==u||t.colorFormat!==c||t.depthStencilFormat!==h||t.primitiveTopology!==d||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=o,t.colorSpace=u,t.colorFormat=c,t.depthStencilFormat=h,t.primitiveTopology=d,t.clippingContextCacheKey=e.clippingContextCacheKey,p=!0),p}getRenderCacheKey(e){const{object:t,material:n}=e,r=this.utils,s=e.context,o=t.isMesh&&t.matrixWorld.determinant()<0;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,o,r.getSampleCountRenderContext(s),r.getCurrentColorSpace(s),r.getCurrentColorFormat(s),r.getCurrentDepthStencilFormat(s),r.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,n,r,s,o){return this.textureUtils.copyTextureToBuffer(e,t,n,r,s,o)}initTimestampQuery(e,t,n){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new xY(this.device,e,2048));const r=this.timestampQueryPool[e],s=r.allocateQueriesForContext(t);n.timestampWrites={querySet:r.querySet,beginningOfPassWriteIndex:s,endOfPassWriteIndex:s+1}}createNodeBuilder(e,t){return new fY(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),s=n.currentPass.finish();this.get(t).bundleGPU=s,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}deleteBindGroupData(e){this.bindingUtils.deleteBindGroupData(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return lN[e]!==void 0&&(e=lN[e]),this.device.features.has(e)}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){let u=0,c=0,h=0,d=0,p=0,g=0,_=e.image.width,v=e.image.height,T=1;n!==null&&(n.isBox3===!0?(d=n.min.x,p=n.min.y,g=n.min.z,_=n.max.x-n.min.x,v=n.max.y-n.min.y,T=n.max.z-n.min.z):(d=n.min.x,p=n.min.y,_=n.max.x-n.min.x,v=n.max.y-n.min.y,T=1)),r!==null&&(u=r.x,c=r.y,h=r.z||0);const b=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),x=this.get(e).texture,M=this.get(t).texture;b.copyTextureToTexture({texture:x,mipLevel:s,origin:{x:d,y:p,z:g}},{texture:M,mipLevel:o,origin:{x:u,y:c,z:h}},[_,v,T]),this.device.queue.submit([b.finish()]),o===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,n){const r=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const o=this.get(e).texture;if(s.format!==o.format){Re("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,o.format);return}let u;if(r.currentPass?(r.currentPass.end(),u=r.encoder):u=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),u.copyTextureToTexture({texture:s,origin:[n.x,n.y,0]},{texture:o},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,u),r.currentPass){const{descriptor:c}=r;for(let h=0;h<c.colorAttachments.length;h++)c.colorAttachments[h].loadOp=dn.Load;t.depth&&(c.depthStencilAttachment.depthLoadOp=dn.Load),t.stencil&&(c.depthStencilAttachment.stencilLoadOp=dn.Load),r.currentPass=u.beginRenderPass(c),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([u.finish()])}dispose(){if(this.bindingUtils.dispose(),this.textureUtils.dispose(),this.occludedResolveCache){for(const e of this.occludedResolveCache.values())e.destroy();this.occludedResolveCache.clear()}if(this.timestampQueryPool)for(const e of Object.values(this.timestampQueryPool))e!==null&&e.dispose();this.parameters.device===void 0&&this.device!==null&&this.device.destroy()}}class SY extends oT{constructor(e,t,n,r,s,o){super(e,t,n,r,s,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class TY extends oT{constructor(e,t,n,r,s,o){super(e,t,n,r,s,o),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class MY extends W3{constructor(){super(),this.addMaterial(Rq,"MeshPhongMaterial"),this.addMaterial(E3,"MeshStandardMaterial"),this.addMaterial(A$,"MeshPhysicalMaterial"),this.addMaterial(N$,"MeshToonMaterial"),this.addMaterial(bq,"MeshBasicMaterial"),this.addMaterial(Aq,"MeshLambertMaterial"),this.addMaterial(gq,"MeshNormalMaterial"),this.addMaterial(P$,"MeshMatcapMaterial"),this.addMaterial(fq,"LineBasicMaterial"),this.addMaterial(pq,"LineDashedMaterial"),this.addMaterial(I$,"PointsMaterial"),this.addMaterial(w3,"SpriteMaterial"),this.addMaterial(V$,"ShadowMaterial"),this.addLight(Mj,mF),this.addLight(Jj,a2),this.addLight(eX,_F),this.addLight(zT,oT),this.addLight(rX,o2),this.addLight(sX,fF),this.addLight(aX,yF),this.addLight(tX,SY),this.addLight(iX,TY),this.addToneMapping(w7,RS),this.addToneMapping(R7,CS),this.addToneMapping(C7,NS),this.addToneMapping(D7,DS),this.addToneMapping(O7,LS),this.addToneMapping(B7,PS)}}class EY extends AX{constructor(e={}){let t;e.forceWebGL?t=nN:(t=bY,e.getFallback=()=>(Ae("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new nN(e)));const n=new t(e);super(n,e),this.library=new MY,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}const ab={type:"change"},kT={type:"start"},VT={type:"end"},dN=1e-6,pn={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},Jg=new Ue,Jo=new Ue,AY=new k,e_=new k,ob=new k,Gc=new Hs,pN=new k,t_=new k,lb=new k,n_=new k;class wY extends j_{constructor(e,t=null){super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:qi.ROTATE,MIDDLE:qi.DOLLY,RIGHT:qi.PAN},this.target=new k,this.state=pn.NONE,this.keyState=pn.NONE,this._lastPosition=new k,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new k,this._movePrev=new Ue,this._moveCurr=new Ue,this._lastAxis=new k,this._zoomStart=new Ue,this._zoomEnd=new Ue,this._panStart=new Ue,this._panEnd=new Ue,this._pointers=[],this._pointerPositions={},this._onPointerMove=CY.bind(this),this._onPointerDown=RY.bind(this),this._onPointerUp=NY.bind(this),this._onPointerCancel=DY.bind(this),this._onContextMenu=IY.bind(this),this._onMouseWheel=FY.bind(this),this._onKeyDown=PY.bind(this),this._onKeyUp=LY.bind(this),this._onTouchStart=zY.bind(this),this._onTouchMove=GY.bind(this),this._onTouchEnd=kY.bind(this),this._onMouseDown=UY.bind(this),this._onMouseMove=OY.bind(this),this._onMouseUp=BY.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>dN&&(this.dispatchEvent(ab),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>dN||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(ab),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=pn.NONE,this.keyState=pn.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(ab),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Jo.copy(this._panEnd).sub(this._panStart),Jo.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Jo.x*=e,Jo.y*=t}Jo.multiplyScalar(this._eye.length()*this.panSpeed),e_.copy(this._eye).cross(this.object.up).setLength(Jo.x),e_.add(AY.copy(this.object.up).setLength(Jo.y)),this.object.position.add(e_),this.target.add(e_),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Jo.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){n_.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=n_.length();e?(this._eye.copy(this.object.position).sub(this.target),pN.copy(this._eye).normalize(),t_.copy(this.object.up).normalize(),lb.crossVectors(t_,pN).normalize(),t_.setLength(this._moveCurr.y-this._movePrev.y),lb.setLength(this._moveCurr.x-this._movePrev.x),n_.copy(t_.add(lb)),ob.crossVectors(n_,this._eye).normalize(),e*=this.rotateSpeed,Gc.setFromAxisAngle(ob,e),this._eye.applyQuaternion(Gc),this.object.up.applyQuaternion(Gc),this._lastAxis.copy(ob),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),Gc.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(Gc),this.object.up.applyQuaternion(Gc)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===pn.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=v_.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=v_.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return Jg.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),Jg}_getMouseOnCircle(e,t){return Jg.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),Jg}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Ue,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function RY(i){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(i.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),this._addPointer(i),i.pointerType==="touch"?this._onTouchStart(i):this._onMouseDown(i))}function CY(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchMove(i):this._onMouseMove(i))}function NY(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchEnd(i):this._onMouseUp(),this._removePointer(i),this._pointers.length===0&&(this.domElement.releasePointerCapture(i.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp)))}function DY(i){this._removePointer(i)}function LY(){this.enabled!==!1&&(this.keyState=pn.NONE,window.addEventListener("keydown",this._onKeyDown))}function PY(i){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===pn.NONE&&(i.code===this.keys[pn.ROTATE]&&!this.noRotate?this.keyState=pn.ROTATE:i.code===this.keys[pn.ZOOM]&&!this.noZoom?this.keyState=pn.ZOOM:i.code===this.keys[pn.PAN]&&!this.noPan&&(this.keyState=pn.PAN)))}function UY(i){let e;switch(i.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case qi.DOLLY:this.state=pn.ZOOM;break;case qi.ROTATE:this.state=pn.ROTATE;break;case qi.PAN:this.state=pn.PAN;break;default:this.state=pn.NONE}const t=this.keyState!==pn.NONE?this.keyState:this.state;t===pn.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY)),this._movePrev.copy(this._moveCurr)):t===pn.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(i.pageX,i.pageY)),this._zoomEnd.copy(this._zoomStart)):t===pn.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(i.pageX,i.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(kT)}function OY(i){const e=this.keyState!==pn.NONE?this.keyState:this.state;e===pn.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY))):e===pn.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(i.pageX,i.pageY)):e===pn.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(i.pageX,i.pageY))}function BY(){this.state=pn.NONE,this.dispatchEvent(VT)}function FY(i){if(this.enabled!==!1&&this.noZoom!==!0){switch(i.preventDefault(),i.deltaMode){case 2:this._zoomStart.y-=i.deltaY*.025;break;case 1:this._zoomStart.y-=i.deltaY*.01;break;default:this._zoomStart.y-=i.deltaY*25e-5;break}this.dispatchEvent(kT),this.dispatchEvent(VT)}}function IY(i){this.enabled!==!1&&i.preventDefault()}function zY(i){if(this._trackPointer(i),this._pointers.length===1)this.state=pn.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);else{this.state=pn.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const n=(this._pointers[0].pageX+this._pointers[1].pageX)/2,r=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(n,r)),this._panEnd.copy(this._panStart)}this.dispatchEvent(kT)}function GY(i){if(this._trackPointer(i),this._pointers.length===1)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY));else{const e=this._getSecondPointerPosition(i),t=i.pageX-e.x,n=i.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+n*n);const r=(i.pageX+e.x)/2,s=(i.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(r,s))}}function kY(i){switch(this._pointers.length){case 0:this.state=pn.NONE;break;case 1:this.state=pn.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=pn.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==i.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(VT)}const mN={type:"change"},HT={type:"start"},nL={type:"end"},i_=new H_,gN=new Bs,VY=Math.cos(70*v_.DEG2RAD),Mi=new k,Ar=2*Math.PI,Ln={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},ub=1e-6;class HY extends j_{constructor(e,t=null){super(e,t),this.state=Ln.NONE,this.target=new k,this.cursor=new k,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:qi.ROTATE,MIDDLE:qi.DOLLY,RIGHT:qi.PAN},this.touches={ONE:no.ROTATE,TWO:no.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new k,this._lastQuaternion=new Hs,this._lastTargetPosition=new k,this._quat=new Hs().setFromUnitVectors(e.up,new k(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new gw,this._sphericalDelta=new gw,this._scale=1,this._panOffset=new k,this._rotateStart=new Ue,this._rotateEnd=new Ue,this._rotateDelta=new Ue,this._panStart=new Ue,this._panEnd=new Ue,this._panDelta=new Ue,this._dollyStart=new Ue,this._dollyEnd=new Ue,this._dollyDelta=new Ue,this._dollyDirection=new k,this._mouse=new Ue,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=qY.bind(this),this._onPointerDown=WY.bind(this),this._onPointerUp=$Y.bind(this),this._onContextMenu=JY.bind(this),this._onMouseWheel=YY.bind(this),this._onKeyDown=KY.bind(this),this._onTouchStart=QY.bind(this),this._onTouchMove=ZY.bind(this),this._onMouseDown=jY.bind(this),this._onMouseMove=XY.bind(this),this._interceptControlDown=eK.bind(this),this._interceptControlUp=tK.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(mN),this.update(),this.state=Ln.NONE}update(e=null){const t=this.object.position;Mi.copy(t).sub(this.target),Mi.applyQuaternion(this._quat),this._spherical.setFromVector3(Mi),this.autoRotate&&this.state===Ln.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(n)&&isFinite(r)&&(n<-Math.PI?n+=Ar:n>Math.PI&&(n-=Ar),r<-Math.PI?r+=Ar:r>Math.PI&&(r-=Ar),n<=r?this._spherical.theta=Math.max(n,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+r)/2?Math.max(n,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(Mi.setFromSpherical(this._spherical),Mi.applyQuaternion(this._quatInverse),t.copy(this.target).add(Mi),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const u=Mi.length();o=this._clampDistance(u*this._scale);const c=u-o;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),s=!!c}else if(this.object.isOrthographicCamera){const u=new k(this._mouse.x,this._mouse.y,0);u.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=c!==this.object.zoom;const h=new k(this._mouse.x,this._mouse.y,0);h.unproject(this.object),this.object.position.sub(h).add(u),this.object.updateMatrixWorld(),o=Mi.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(i_.origin.copy(this.object.position),i_.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(i_.direction))<VY?this.object.lookAt(this.target):(gN.setFromNormalAndCoplanarPoint(this.object.up,this.target),i_.intersectPlane(gN,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>ub||8*(1-this._lastQuaternion.dot(this.object.quaternion))>ub||this._lastTargetPosition.distanceToSquared(this.target)>ub?(this.dispatchEvent(mN),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Ar/60*this.autoRotateSpeed*e:Ar/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){Mi.setFromMatrixColumn(t,0),Mi.multiplyScalar(-e),this._panOffset.add(Mi)}_panUp(e,t){this.screenSpacePanning===!0?Mi.setFromMatrixColumn(t,1):(Mi.setFromMatrixColumn(t,0),Mi.crossVectors(this.object.up,Mi)),Mi.multiplyScalar(e),this._panOffset.add(Mi)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;Mi.copy(r).sub(this.target);let s=Mi.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/n.clientHeight,this.object.matrix),this._panUp(2*t*s/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),r=e-n.left,s=t-n.top,o=n.width,u=n.height;this._mouse.x=r/o*2-1,this._mouse.y=-(s/u)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Ar*this._rotateDelta.x/t.clientHeight),this._rotateUp(Ar*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Ar*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Ar*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Ar*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Ar*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._rotateStart.set(n,r)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panStart.set(n,r)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(n*n+r*r);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),r=.5*(e.pageX+n.x),s=.5*(e.pageY+n.y);this._rotateEnd.set(r,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Ar*this._rotateDelta.x/t.clientHeight),this._rotateUp(Ar*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panEnd.set(n,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(n*n+r*r);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,u=(e.pageY+t.y)*.5;this._updateZoomParameters(o,u)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Ue,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function WY(i){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(i.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(i)&&(this._addPointer(i),i.pointerType==="touch"?this._onTouchStart(i):this._onMouseDown(i)))}function qY(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchMove(i):this._onMouseMove(i))}function $Y(i){switch(this._removePointer(i),this._pointers.length){case 0:this.domElement.releasePointerCapture(i.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(nL),this.state=Ln.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function jY(i){let e;switch(i.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case qi.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(i),this.state=Ln.DOLLY;break;case qi.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=Ln.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=Ln.ROTATE}break;case qi.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=Ln.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=Ln.PAN}break;default:this.state=Ln.NONE}this.state!==Ln.NONE&&this.dispatchEvent(HT)}function XY(i){switch(this.state){case Ln.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(i);break;case Ln.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(i);break;case Ln.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(i);break}}function YY(i){this.enabled===!1||this.enableZoom===!1||this.state!==Ln.NONE||(i.preventDefault(),this.dispatchEvent(HT),this._handleMouseWheel(this._customWheelEvent(i)),this.dispatchEvent(nL))}function KY(i){this.enabled!==!1&&this._handleKeyDown(i)}function QY(i){switch(this._trackPointer(i),this._pointers.length){case 1:switch(this.touches.ONE){case no.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(i),this.state=Ln.TOUCH_ROTATE;break;case no.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(i),this.state=Ln.TOUCH_PAN;break;default:this.state=Ln.NONE}break;case 2:switch(this.touches.TWO){case no.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(i),this.state=Ln.TOUCH_DOLLY_PAN;break;case no.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(i),this.state=Ln.TOUCH_DOLLY_ROTATE;break;default:this.state=Ln.NONE}break;default:this.state=Ln.NONE}this.state!==Ln.NONE&&this.dispatchEvent(HT)}function ZY(i){switch(this._trackPointer(i),this.state){case Ln.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(i),this.update();break;case Ln.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(i),this.update();break;case Ln.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(i),this.update();break;case Ln.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(i),this.update();break;default:this.state=Ln.NONE}}function JY(i){this.enabled!==!1&&i.preventDefault()}function eK(i){i.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function tK(i){i.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const nK={type:"change"},_N=1e-6,vN=new Hs;class iK extends j_{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new k(0,0,0),this._rotationVector=new k(0,0,0),this._lastQuaternion=new Hs,this._lastPosition=new k,this._status=0,this._onKeyDown=rK.bind(this),this._onKeyUp=sK.bind(this),this._onPointerMove=oK.bind(this),this._onPointerDown=aK.bind(this),this._onPointerUp=lK.bind(this),this._onPointerCancel=uK.bind(this),this._onContextMenu=cK.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,n=e*this.movementSpeed,r=e*this.rollSpeed;t.translateX(this._moveVector.x*n),t.translateY(this._moveVector.y*n),t.translateZ(this._moveVector.z*n),vN.set(this._rotationVector.x*r,this._rotationVector.y*r,this._rotationVector.z*r,1).normalize(),t.quaternion.multiply(vN),(this._lastPosition.distanceToSquared(t.position)>_N||8*(1-this._lastQuaternion.dot(t.quaternion))>_N)&&(this.dispatchEvent(nK),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function rK(i){if(!(i.altKey||this.enabled===!1)){switch(i.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function sK(i){if(this.enabled!==!1){switch(i.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function aK(i){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(i.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function oK(i){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,n=e.size[1]/2;this._moveState.yawLeft=-(i.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(i.pageY-e.offset[1]-n)/n,this._updateRotationVector()}}function lK(i){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(i.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function uK(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function cK(i){this.enabled!==!1&&i.preventDefault()}const hK={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class f0{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const fK=new Wh(-1,1,1,-1,0,1);class dK extends wi{constructor(){super(),this.setAttribute("position",new ti([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ti([0,2,0,0,2,0],2))}}const pK=new dK;class mK{constructor(e){this._mesh=new yi(pK,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,fK)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class gK extends f0{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof bs?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=KN.clone(e.uniforms),this.material=new bs({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new mK(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class yN extends f0{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let o,u;this.inverse?(o=0,u=1):(o=1,u=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),s.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),s.buffers.stencil.setClear(u),s.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(r.EQUAL,1,4294967295),s.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),s.buffers.stencil.setLocked(!0)}}class _K extends f0{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class vK{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const n=e.getSize(new Ue);this._width=n.width,this._height=n.height,t=new Gs(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Zn}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new gK(hK),this.copyPass.material.blending=_r,this.clock=new u2}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let r=0,s=this.passes.length;r<s;r++){const o=this.passes[r];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),o.needsSwap){if(n){const u=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(u.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(u.EQUAL,1,4294967295)}this.swapBuffers()}yN!==void 0&&(o instanceof yN?n=!0:o instanceof _K&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Ue);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class yK extends f0{constructor(e,t,n=null,r=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this.isRenderPass=!0,this._oldClearColor=new dt}render(e,t,n){const r=e.autoClear;e.autoClear=!1;let s,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=r}}function Fr(){return Fr=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Fr.apply(null,arguments)}function xK(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function xp(i,e){return xp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},xp(i,e)}function bK(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,xp(i,e)}function nS(i){return nS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},nS(i)}function SK(i){try{return Function.toString.call(i).indexOf("[native code]")!==-1}catch{return typeof i=="function"}}function iL(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(iL=function(){return!!i})()}function TK(i,e,t){if(iL())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var r=new(i.bind.apply(i,n));return t&&xp(r,t.prototype),r}function iS(i){var e=typeof Map=="function"?new Map:void 0;return iS=function(n){if(n===null||!SK(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(n))return e.get(n);e.set(n,r)}function r(){return TK(n,arguments,nS(this).constructor)}return r.prototype=Object.create(n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),xp(r,n)},iS(i)}var ha=(function(i){bK(e,i);function e(t){var n;return n=i.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this,xK(n)}return e})(iS(Error));function cb(i){return Math.round(i*255)}function MK(i,e,t){return cb(i)+","+cb(e)+","+cb(t)}function U_(i,e,t,n){if(n===void 0&&(n=MK),e===0)return n(t,t,t);var r=(i%360+360)%360/60,s=(1-Math.abs(2*t-1))*e,o=s*(1-Math.abs(r%2-1)),u=0,c=0,h=0;r>=0&&r<1?(u=s,c=o):r>=1&&r<2?(u=o,c=s):r>=2&&r<3?(c=s,h=o):r>=3&&r<4?(c=o,h=s):r>=4&&r<5?(u=o,h=s):r>=5&&r<6&&(u=s,h=o);var d=t-s/2,p=u+d,g=c+d,_=h+d;return n(p,g,_)}var xN={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function EK(i){if(typeof i!="string")return i;var e=i.toLowerCase();return xN[e]?"#"+xN[e]:i}var AK=/^#[a-fA-F0-9]{6}$/,wK=/^#[a-fA-F0-9]{8}$/,RK=/^#[a-fA-F0-9]{3}$/,CK=/^#[a-fA-F0-9]{4}$/,hb=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,NK=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,DK=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,LK=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function zh(i){if(typeof i!="string")throw new ha(3);var e=EK(i);if(e.match(AK))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(wK)){var t=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:t}}if(e.match(RK))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(CK)){var n=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:n}}var r=hb.exec(e);if(r)return{red:parseInt(""+r[1],10),green:parseInt(""+r[2],10),blue:parseInt(""+r[3],10)};var s=NK.exec(e.substring(0,50));if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10),alpha:parseFloat(""+s[4])>1?parseFloat(""+s[4])/100:parseFloat(""+s[4])};var o=DK.exec(e);if(o){var u=parseInt(""+o[1],10),c=parseInt(""+o[2],10)/100,h=parseInt(""+o[3],10)/100,d="rgb("+U_(u,c,h)+")",p=hb.exec(d);if(!p)throw new ha(4,e,d);return{red:parseInt(""+p[1],10),green:parseInt(""+p[2],10),blue:parseInt(""+p[3],10)}}var g=LK.exec(e.substring(0,50));if(g){var _=parseInt(""+g[1],10),v=parseInt(""+g[2],10)/100,T=parseInt(""+g[3],10)/100,b="rgb("+U_(_,v,T)+")",x=hb.exec(b);if(!x)throw new ha(4,e,b);return{red:parseInt(""+x[1],10),green:parseInt(""+x[2],10),blue:parseInt(""+x[3],10),alpha:parseFloat(""+g[4])>1?parseFloat(""+g[4])/100:parseFloat(""+g[4])}}throw new ha(5)}function PK(i){var e=i.red/255,t=i.green/255,n=i.blue/255,r=Math.max(e,t,n),s=Math.min(e,t,n),o=(r+s)/2;if(r===s)return i.alpha!==void 0?{hue:0,saturation:0,lightness:o,alpha:i.alpha}:{hue:0,saturation:0,lightness:o};var u,c=r-s,h=o>.5?c/(2-r-s):c/(r+s);switch(r){case e:u=(t-n)/c+(t<n?6:0);break;case t:u=(n-e)/c+2;break;default:u=(e-t)/c+4;break}return u*=60,i.alpha!==void 0?{hue:u,saturation:h,lightness:o,alpha:i.alpha}:{hue:u,saturation:h,lightness:o}}function gl(i){return PK(zh(i))}var UK=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},rS=UK;function Xl(i){var e=i.toString(16);return e.length===1?"0"+e:e}function fb(i){return Xl(Math.round(i*255))}function OK(i,e,t){return rS("#"+fb(i)+fb(e)+fb(t))}function rL(i,e,t){return U_(i,e,t,OK)}function BK(i,e,t){if(typeof i=="object"&&e===void 0&&t===void 0)return rL(i.hue,i.saturation,i.lightness);throw new ha(1)}function FK(i,e,t,n){if(typeof i=="object"&&e===void 0&&t===void 0&&n===void 0)return i.alpha>=1?rL(i.hue,i.saturation,i.lightness):"rgba("+U_(i.hue,i.saturation,i.lightness)+","+i.alpha+")";throw new ha(2)}function sL(i,e,t){if(typeof i=="number"&&typeof e=="number"&&typeof t=="number")return rS("#"+Xl(i)+Xl(e)+Xl(t));if(typeof i=="object"&&e===void 0&&t===void 0)return rS("#"+Xl(i.red)+Xl(i.green)+Xl(i.blue));throw new ha(6)}function d0(i,e,t,n){if(typeof i=="object"&&e===void 0&&t===void 0&&n===void 0)return i.alpha>=1?sL(i.red,i.green,i.blue):"rgba("+i.red+","+i.green+","+i.blue+","+i.alpha+")";throw new ha(7)}var IK=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},zK=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},GK=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},kK=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function _l(i){if(typeof i!="object")throw new ha(8);if(zK(i))return d0(i);if(IK(i))return sL(i);if(kK(i))return FK(i);if(GK(i))return BK(i);throw new ha(8)}function aL(i,e,t){return function(){var r=t.concat(Array.prototype.slice.call(arguments));return r.length>=e?i.apply(this,r):aL(i,e,r)}}function ns(i){return aL(i,i.length,[])}function VK(i,e){if(e==="transparent")return e;var t=gl(e);return _l(Fr({},t,{hue:t.hue+parseFloat(i)}))}ns(VK);function ef(i,e,t){return Math.max(i,Math.min(e,t))}function HK(i,e){if(e==="transparent")return e;var t=gl(e);return _l(Fr({},t,{lightness:ef(0,1,t.lightness-parseFloat(i))}))}ns(HK);function WK(i,e){if(e==="transparent")return e;var t=gl(e);return _l(Fr({},t,{saturation:ef(0,1,t.saturation-parseFloat(i))}))}ns(WK);function qK(i,e){if(e==="transparent")return e;var t=gl(e);return _l(Fr({},t,{lightness:ef(0,1,t.lightness+parseFloat(i))}))}ns(qK);function $K(i,e,t){if(e==="transparent")return t;if(t==="transparent")return e;if(i===0)return t;var n=zh(e),r=Fr({},n,{alpha:typeof n.alpha=="number"?n.alpha:1}),s=zh(t),o=Fr({},s,{alpha:typeof s.alpha=="number"?s.alpha:1}),u=r.alpha-o.alpha,c=parseFloat(i)*2-1,h=c*u===-1?c:c+u,d=1+c*u,p=(h/d+1)/2,g=1-p,_={red:Math.floor(r.red*p+o.red*g),green:Math.floor(r.green*p+o.green*g),blue:Math.floor(r.blue*p+o.blue*g),alpha:r.alpha*parseFloat(i)+o.alpha*(1-parseFloat(i))};return d0(_)}var jK=ns($K),oL=jK;function XK(i,e){if(e==="transparent")return e;var t=zh(e),n=typeof t.alpha=="number"?t.alpha:1,r=Fr({},t,{alpha:ef(0,1,(n*100+parseFloat(i)*100)/100)});return d0(r)}var YK=ns(XK),KK=YK;function QK(i,e){if(e==="transparent")return e;var t=gl(e);return _l(Fr({},t,{saturation:ef(0,1,t.saturation+parseFloat(i))}))}ns(QK);function ZK(i,e){return e==="transparent"?e:_l(Fr({},gl(e),{hue:parseFloat(i)}))}ns(ZK);function JK(i,e){return e==="transparent"?e:_l(Fr({},gl(e),{lightness:parseFloat(i)}))}ns(JK);function eQ(i,e){return e==="transparent"?e:_l(Fr({},gl(e),{saturation:parseFloat(i)}))}ns(eQ);function tQ(i,e){return e==="transparent"?e:oL(parseFloat(i),"rgb(0, 0, 0)",e)}ns(tQ);function nQ(i,e){return e==="transparent"?e:oL(parseFloat(i),"rgb(255, 255, 255)",e)}ns(nQ);function iQ(i,e){if(e==="transparent")return e;var t=zh(e),n=typeof t.alpha=="number"?t.alpha:1,r=Fr({},t,{alpha:ef(0,1,+(n*100-parseFloat(i)*100).toFixed(2)/100)});return d0(r)}ns(iQ);var uu=Object.freeze({Linear:Object.freeze({None:function(i){return i},In:function(i){return i},Out:function(i){return i},InOut:function(i){return i}}),Quadratic:Object.freeze({In:function(i){return i*i},Out:function(i){return i*(2-i)},InOut:function(i){return(i*=2)<1?.5*i*i:-.5*(--i*(i-2)-1)}}),Cubic:Object.freeze({In:function(i){return i*i*i},Out:function(i){return--i*i*i+1},InOut:function(i){return(i*=2)<1?.5*i*i*i:.5*((i-=2)*i*i+2)}}),Quartic:Object.freeze({In:function(i){return i*i*i*i},Out:function(i){return 1- --i*i*i*i},InOut:function(i){return(i*=2)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2)}}),Quintic:Object.freeze({In:function(i){return i*i*i*i*i},Out:function(i){return--i*i*i*i*i+1},InOut:function(i){return(i*=2)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2)}}),Sinusoidal:Object.freeze({In:function(i){return 1-Math.sin((1-i)*Math.PI/2)},Out:function(i){return Math.sin(i*Math.PI/2)},InOut:function(i){return .5*(1-Math.sin(Math.PI*(.5-i)))}}),Exponential:Object.freeze({In:function(i){return i===0?0:Math.pow(1024,i-1)},Out:function(i){return i===1?1:1-Math.pow(2,-10*i)},InOut:function(i){return i===0?0:i===1?1:(i*=2)<1?.5*Math.pow(1024,i-1):.5*(-Math.pow(2,-10*(i-1))+2)}}),Circular:Object.freeze({In:function(i){return 1-Math.sqrt(1-i*i)},Out:function(i){return Math.sqrt(1- --i*i)},InOut:function(i){return(i*=2)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1)}}),Elastic:Object.freeze({In:function(i){return i===0?0:i===1?1:-Math.pow(2,10*(i-1))*Math.sin((i-1.1)*5*Math.PI)},Out:function(i){return i===0?0:i===1?1:Math.pow(2,-10*i)*Math.sin((i-.1)*5*Math.PI)+1},InOut:function(i){return i===0?0:i===1?1:(i*=2,i<1?-.5*Math.pow(2,10*(i-1))*Math.sin((i-1.1)*5*Math.PI):.5*Math.pow(2,-10*(i-1))*Math.sin((i-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(i){var e=1.70158;return i===1?1:i*i*((e+1)*i-e)},Out:function(i){var e=1.70158;return i===0?0:--i*i*((e+1)*i+e)+1},InOut:function(i){var e=2.5949095;return(i*=2)<1?.5*(i*i*((e+1)*i-e)):.5*((i-=2)*i*((e+1)*i+e)+2)}}),Bounce:Object.freeze({In:function(i){return 1-uu.Bounce.Out(1-i)},Out:function(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},InOut:function(i){return i<.5?uu.Bounce.In(i*2)*.5:uu.Bounce.Out(i*2-1)*.5+.5}}),generatePow:function(i){return i===void 0&&(i=4),i=i<Number.EPSILON?Number.EPSILON:i,i=i>1e4?1e4:i,{In:function(e){return Math.pow(e,i)},Out:function(e){return 1-Math.pow(1-e,i)},InOut:function(e){return e<.5?Math.pow(e*2,i)/2:(1-Math.pow(2-e*2,i))/2+.5}}}}),Od=function(){return performance.now()},lL=(function(){function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return i.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},i.prototype.removeAll=function(){this._tweens={}},i.prototype.add=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=0,s=t;r<s.length;r++){var o=s[r];(e=o._group)===null||e===void 0||e.remove(o),o._group=this,this._tweens[o.getId()]=o,this._tweensAddedDuringUpdate[o.getId()]=o}},i.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,r=e;n<r.length;n++){var s=r[n];s._group=void 0,delete this._tweens[s.getId()],delete this._tweensAddedDuringUpdate[s.getId()]}},i.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},i.prototype.update=function(e,t){e===void 0&&(e=Od()),t===void 0&&(t=!0);var n=Object.keys(this._tweens);if(n.length!==0)for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var s=this._tweens[n[r]],o=!t;s&&s.update(e,o)===!1&&!t&&this.remove(s)}n=Object.keys(this._tweensAddedDuringUpdate)}},i})(),sS={Linear:function(i,e){var t=i.length-1,n=t*e,r=Math.floor(n),s=sS.Utils.Linear;return e<0?s(i[0],i[1],n):e>1?s(i[t],i[t-1],t-n):s(i[r],i[r+1>t?t:r+1],n-r)},Utils:{Linear:function(i,e,t){return(e-i)*t+i}}},uL=(function(){function i(){}return i.nextId=function(){return i._nextId++},i._nextId=0,i})(),aS=new lL,bN=(function(){function i(e,t){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=uu.Linear.None,this._interpolationFunction=sS.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=uL.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof t=="object"?(this._group=t,t.add(this)):t===!0&&(this._group=aS,aS.add(this))}return i.prototype.getId=function(){return this._id},i.prototype.isPlaying=function(){return this._isPlaying},i.prototype.isPaused=function(){return this._isPaused},i.prototype.getDuration=function(){return this._duration},i.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},i.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},i.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},i.prototype.start=function(e,t){if(e===void 0&&(e=Od()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var n in this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var s in this._valuesEnd)r[s]=this._valuesEnd[s];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},i.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},i.prototype._setupProperties=function(e,t,n,r,s){for(var o in n){var u=e[o],c=Array.isArray(u),h=c?"array":typeof u,d=!c&&Array.isArray(n[o]);if(!(h==="undefined"||h==="function")){if(d){var p=n[o];if(p.length===0)continue;for(var g=[u],_=0,v=p.length;_<v;_+=1){var T=this._handleRelativeValue(u,p[_]);if(isNaN(T)){d=!1,console.warn("Found invalid interpolation list. Skipping.");break}g.push(T)}d&&(n[o]=g)}if((h==="object"||c)&&u&&!d){t[o]=c?[]:{};var b=u;for(var x in b)t[o][x]=b[x];r[o]=c?[]:{};var p=n[o];if(!this._isDynamic){var M={};for(var x in p)M[x]=p[x];n[o]=p=M}this._setupProperties(b,t[o],p,r[o],s)}else(typeof t[o]>"u"||s)&&(t[o]=u),c||(t[o]*=1),d?r[o]=n[o].slice().reverse():r[o]=t[o]||0}}},i.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},i.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},i.prototype.pause=function(e){return e===void 0&&(e=Od()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},i.prototype.resume=function(e){return e===void 0&&(e=Od()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},i.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},i.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},i.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},i.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},i.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},i.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},i.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},i.prototype.easing=function(e){return e===void 0&&(e=uu.Linear.None),this._easingFunction=e,this},i.prototype.interpolation=function(e){return e===void 0&&(e=sS.Linear),this._interpolationFunction=e,this},i.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},i.prototype.onStart=function(e){return this._onStartCallback=e,this},i.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},i.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},i.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},i.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},i.prototype.onStop=function(e){return this._onStopCallback=e,this},i.prototype.update=function(e,t){var n=this,r;if(e===void 0&&(e=Od()),t===void 0&&(t=i.autoStartOnUpdate),this._isPaused)return!0;var s;if(!this._goToEnd&&!this._isPlaying)if(t)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=e-this._startTime,u=this._duration+((r=this._repeatDelayTime)!==null&&r!==void 0?r:this._delayTime),c=this._duration+this._repeat*u,h=function(){if(n._duration===0||o>c)return 1;var T=Math.trunc(o/u),b=o-T*u,x=Math.min(b/n._duration,1);return x===0&&o===n._duration?1:x},d=h(),p=this._easingFunction(d);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,p),this._onUpdateCallback&&this._onUpdateCallback(this._object,d),this._duration===0||o>=this._duration)if(this._repeat>0){var g=Math.min(Math.trunc((o-this._duration)/u)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=g);for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=u*g,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var _=0,v=this._chainedTweens.length;_<v;_++)this._chainedTweens[_].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},i.prototype._updateProperties=function(e,t,n,r){for(var s in n)if(t[s]!==void 0){var o=t[s]||0,u=n[s],c=Array.isArray(e[s]),h=Array.isArray(u),d=!c&&h;d?e[s]=this._interpolationFunction(u,r):typeof u=="object"&&u?this._updateProperties(e[s],o,u,r):(u=this._handleRelativeValue(o,u),typeof u=="number"&&(e[s]=o+(u-o)*r))}},i.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},i.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],n=this._valuesEnd[e];typeof n=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(n):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},i.autoStartOnUpdate=!1,i})();uL.nextId;var ya=aS;ya.getAll.bind(ya);ya.removeAll.bind(ya);ya.add.bind(ya);ya.remove.bind(ya);ya.update.bind(ya);var oS="http://www.w3.org/1999/xhtml";const SN={svg:"http://www.w3.org/2000/svg",xhtml:oS,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function cL(i){var e=i+="",t=e.indexOf(":");return t>=0&&(e=i.slice(0,t))!=="xmlns"&&(i=i.slice(t+1)),SN.hasOwnProperty(e)?{space:SN[e],local:i}:i}function rQ(i){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===oS&&e.documentElement.namespaceURI===oS?e.createElement(i):e.createElementNS(t,i)}}function sQ(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function hL(i){var e=cL(i);return(e.local?sQ:rQ)(e)}function aQ(){}function fL(i){return i==null?aQ:function(){return this.querySelector(i)}}function oQ(i){typeof i!="function"&&(i=fL(i));for(var e=this._groups,t=e.length,n=new Array(t),r=0;r<t;++r)for(var s=e[r],o=s.length,u=n[r]=new Array(o),c,h,d=0;d<o;++d)(c=s[d])&&(h=i.call(c,c.__data__,d,s))&&("__data__"in c&&(h.__data__=c.__data__),u[d]=h);return new Ts(n,this._parents)}function lQ(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function uQ(){return[]}function cQ(i){return i==null?uQ:function(){return this.querySelectorAll(i)}}function hQ(i){return function(){return lQ(i.apply(this,arguments))}}function fQ(i){typeof i=="function"?i=hQ(i):i=cQ(i);for(var e=this._groups,t=e.length,n=[],r=[],s=0;s<t;++s)for(var o=e[s],u=o.length,c,h=0;h<u;++h)(c=o[h])&&(n.push(i.call(c,c.__data__,h,o)),r.push(c));return new Ts(n,r)}function dQ(i){return function(){return this.matches(i)}}function dL(i){return function(e){return e.matches(i)}}var pQ=Array.prototype.find;function mQ(i){return function(){return pQ.call(this.children,i)}}function gQ(){return this.firstElementChild}function _Q(i){return this.select(i==null?gQ:mQ(typeof i=="function"?i:dL(i)))}var vQ=Array.prototype.filter;function yQ(){return Array.from(this.children)}function xQ(i){return function(){return vQ.call(this.children,i)}}function bQ(i){return this.selectAll(i==null?yQ:xQ(typeof i=="function"?i:dL(i)))}function SQ(i){typeof i!="function"&&(i=dQ(i));for(var e=this._groups,t=e.length,n=new Array(t),r=0;r<t;++r)for(var s=e[r],o=s.length,u=n[r]=[],c,h=0;h<o;++h)(c=s[h])&&i.call(c,c.__data__,h,s)&&u.push(c);return new Ts(n,this._parents)}function pL(i){return new Array(i.length)}function TQ(){return new Ts(this._enter||this._groups.map(pL),this._parents)}function O_(i,e){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=e}O_.prototype={constructor:O_,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,e){return this._parent.insertBefore(i,e)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function MQ(i){return function(){return i}}function EQ(i,e,t,n,r,s){for(var o=0,u,c=e.length,h=s.length;o<h;++o)(u=e[o])?(u.__data__=s[o],n[o]=u):t[o]=new O_(i,s[o]);for(;o<c;++o)(u=e[o])&&(r[o]=u)}function AQ(i,e,t,n,r,s,o){var u,c,h=new Map,d=e.length,p=s.length,g=new Array(d),_;for(u=0;u<d;++u)(c=e[u])&&(g[u]=_=o.call(c,c.__data__,u,e)+"",h.has(_)?r[u]=c:h.set(_,c));for(u=0;u<p;++u)_=o.call(i,s[u],u,s)+"",(c=h.get(_))?(n[u]=c,c.__data__=s[u],h.delete(_)):t[u]=new O_(i,s[u]);for(u=0;u<d;++u)(c=e[u])&&h.get(g[u])===c&&(r[u]=c)}function wQ(i){return i.__data__}function RQ(i,e){if(!arguments.length)return Array.from(this,wQ);var t=e?AQ:EQ,n=this._parents,r=this._groups;typeof i!="function"&&(i=MQ(i));for(var s=r.length,o=new Array(s),u=new Array(s),c=new Array(s),h=0;h<s;++h){var d=n[h],p=r[h],g=p.length,_=CQ(i.call(d,d&&d.__data__,h,n)),v=_.length,T=u[h]=new Array(v),b=o[h]=new Array(v),x=c[h]=new Array(g);t(d,p,T,b,x,_,e);for(var M=0,E=0,w,C;M<v;++M)if(w=T[M]){for(M>=E&&(E=M+1);!(C=b[E])&&++E<v;);w._next=C||null}}return o=new Ts(o,n),o._enter=u,o._exit=c,o}function CQ(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function NQ(){return new Ts(this._exit||this._groups.map(pL),this._parents)}function DQ(i,e,t){var n=this.enter(),r=this,s=this.exit();return typeof i=="function"?(n=i(n),n&&(n=n.selection())):n=n.append(i+""),e!=null&&(r=e(r),r&&(r=r.selection())),t==null?s.remove():t(s),n&&r?n.merge(r).order():r}function LQ(i){for(var e=i.selection?i.selection():i,t=this._groups,n=e._groups,r=t.length,s=n.length,o=Math.min(r,s),u=new Array(r),c=0;c<o;++c)for(var h=t[c],d=n[c],p=h.length,g=u[c]=new Array(p),_,v=0;v<p;++v)(_=h[v]||d[v])&&(g[v]=_);for(;c<r;++c)u[c]=t[c];return new Ts(u,this._parents)}function PQ(){for(var i=this._groups,e=-1,t=i.length;++e<t;)for(var n=i[e],r=n.length-1,s=n[r],o;--r>=0;)(o=n[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function UQ(i){i||(i=OQ);function e(p,g){return p&&g?i(p.__data__,g.__data__):!p-!g}for(var t=this._groups,n=t.length,r=new Array(n),s=0;s<n;++s){for(var o=t[s],u=o.length,c=r[s]=new Array(u),h,d=0;d<u;++d)(h=o[d])&&(c[d]=h);c.sort(e)}return new Ts(r,this._parents).order()}function OQ(i,e){return i<e?-1:i>e?1:i>=e?0:NaN}function BQ(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function FQ(){return Array.from(this)}function IQ(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var n=i[e],r=0,s=n.length;r<s;++r){var o=n[r];if(o)return o}return null}function zQ(){let i=0;for(const e of this)++i;return i}function GQ(){return!this.node()}function kQ(i){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],s=0,o=r.length,u;s<o;++s)(u=r[s])&&i.call(u,u.__data__,s,r);return this}function VQ(i){return function(){this.removeAttribute(i)}}function HQ(i){return function(){this.removeAttributeNS(i.space,i.local)}}function WQ(i,e){return function(){this.setAttribute(i,e)}}function qQ(i,e){return function(){this.setAttributeNS(i.space,i.local,e)}}function $Q(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(i):this.setAttribute(i,t)}}function jQ(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,t)}}function XQ(i,e){var t=cL(i);if(arguments.length<2){var n=this.node();return t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}return this.each((e==null?t.local?HQ:VQ:typeof e=="function"?t.local?jQ:$Q:t.local?qQ:WQ)(t,e))}function mL(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function YQ(i){return function(){this.style.removeProperty(i)}}function KQ(i,e,t){return function(){this.style.setProperty(i,e,t)}}function QQ(i,e,t){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(i):this.style.setProperty(i,n,t)}}function ZQ(i,e,t){return arguments.length>1?this.each((e==null?YQ:typeof e=="function"?QQ:KQ)(i,e,t??"")):JQ(this.node(),i)}function JQ(i,e){return i.style.getPropertyValue(e)||mL(i).getComputedStyle(i,null).getPropertyValue(e)}function eZ(i){return function(){delete this[i]}}function tZ(i,e){return function(){this[i]=e}}function nZ(i,e){return function(){var t=e.apply(this,arguments);t==null?delete this[i]:this[i]=t}}function iZ(i,e){return arguments.length>1?this.each((e==null?eZ:typeof e=="function"?nZ:tZ)(i,e)):this.node()[i]}function gL(i){return i.trim().split(/^|\s+/)}function WT(i){return i.classList||new _L(i)}function _L(i){this._node=i,this._names=gL(i.getAttribute("class")||"")}_L.prototype={add:function(i){var e=this._names.indexOf(i);e<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var e=this._names.indexOf(i);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function vL(i,e){for(var t=WT(i),n=-1,r=e.length;++n<r;)t.add(e[n])}function yL(i,e){for(var t=WT(i),n=-1,r=e.length;++n<r;)t.remove(e[n])}function rZ(i){return function(){vL(this,i)}}function sZ(i){return function(){yL(this,i)}}function aZ(i,e){return function(){(e.apply(this,arguments)?vL:yL)(this,i)}}function oZ(i,e){var t=gL(i+"");if(arguments.length<2){for(var n=WT(this.node()),r=-1,s=t.length;++r<s;)if(!n.contains(t[r]))return!1;return!0}return this.each((typeof e=="function"?aZ:e?rZ:sZ)(t,e))}function lZ(){this.textContent=""}function uZ(i){return function(){this.textContent=i}}function cZ(i){return function(){var e=i.apply(this,arguments);this.textContent=e??""}}function hZ(i){return arguments.length?this.each(i==null?lZ:(typeof i=="function"?cZ:uZ)(i)):this.node().textContent}function fZ(){this.innerHTML=""}function dZ(i){return function(){this.innerHTML=i}}function pZ(i){return function(){var e=i.apply(this,arguments);this.innerHTML=e??""}}function mZ(i){return arguments.length?this.each(i==null?fZ:(typeof i=="function"?pZ:dZ)(i)):this.node().innerHTML}function gZ(){this.nextSibling&&this.parentNode.appendChild(this)}function _Z(){return this.each(gZ)}function vZ(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function yZ(){return this.each(vZ)}function xZ(i){var e=typeof i=="function"?i:hL(i);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function bZ(){return null}function SZ(i,e){var t=typeof i=="function"?i:hL(i),n=e==null?bZ:typeof e=="function"?e:fL(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),n.apply(this,arguments)||null)})}function TZ(){var i=this.parentNode;i&&i.removeChild(this)}function MZ(){return this.each(TZ)}function EZ(){var i=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function AZ(){var i=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function wZ(i){return this.select(i?AZ:EZ)}function RZ(i){return arguments.length?this.property("__data__",i):this.node().__data__}function CZ(i){return function(e){i.call(this,e,this.__data__)}}function NZ(i){return i.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function DZ(i){return function(){var e=this.__on;if(e){for(var t=0,n=-1,r=e.length,s;t<r;++t)s=e[t],(!i.type||s.type===i.type)&&s.name===i.name?this.removeEventListener(s.type,s.listener,s.options):e[++n]=s;++n?e.length=n:delete this.__on}}}function LZ(i,e,t){return function(){var n=this.__on,r,s=CZ(e);if(n){for(var o=0,u=n.length;o<u;++o)if((r=n[o]).type===i.type&&r.name===i.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=t),r.value=e;return}}this.addEventListener(i.type,s,t),r={type:i.type,name:i.name,value:e,listener:s,options:t},n?n.push(r):this.__on=[r]}}function PZ(i,e,t){var n=NZ(i+""),r,s=n.length,o;if(arguments.length<2){var u=this.node().__on;if(u){for(var c=0,h=u.length,d;c<h;++c)for(r=0,d=u[c];r<s;++r)if((o=n[r]).type===d.type&&o.name===d.name)return d.value}return}for(u=e?LZ:DZ,r=0;r<s;++r)this.each(u(n[r],e,t));return this}function xL(i,e,t){var n=mL(i),r=n.CustomEvent;typeof r=="function"?r=new r(e,t):(r=n.document.createEvent("Event"),t?(r.initEvent(e,t.bubbles,t.cancelable),r.detail=t.detail):r.initEvent(e,!1,!1)),i.dispatchEvent(r)}function UZ(i,e){return function(){return xL(this,i,e)}}function OZ(i,e){return function(){return xL(this,i,e.apply(this,arguments))}}function BZ(i,e){return this.each((typeof e=="function"?OZ:UZ)(i,e))}function*FZ(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var n=i[e],r=0,s=n.length,o;r<s;++r)(o=n[r])&&(yield o)}var IZ=[null];function Ts(i,e){this._groups=i,this._parents=e}function zZ(){return this}Ts.prototype={constructor:Ts,select:oQ,selectAll:fQ,selectChild:_Q,selectChildren:bQ,filter:SQ,data:RQ,enter:TQ,exit:NQ,join:DQ,merge:LQ,selection:zZ,order:PQ,sort:UQ,call:BQ,nodes:FQ,node:IQ,size:zQ,empty:GQ,each:kQ,attr:XQ,style:ZQ,property:iZ,classed:oZ,text:hZ,html:mZ,raise:_Z,lower:yZ,append:xZ,insert:SZ,remove:MZ,clone:wZ,datum:RZ,on:PZ,dispatch:BZ,[Symbol.iterator]:FZ};function GZ(i){return typeof i=="string"?new Ts([[document.querySelector(i)]],[document.documentElement]):new Ts([[i]],IZ)}function kZ(i){let e;for(;e=i.sourceEvent;)i=e;return i}function VZ(i,e){if(i=kZ(i),e===void 0&&(e=i.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var n=t.createSVGPoint();return n.x=i.clientX,n.y=i.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[i.clientX-r.left-e.clientLeft,i.clientY-r.top-e.clientTop]}}return[i.pageX,i.pageY]}var zp,Jn,bL,SL,tu,TN,TL,ML,EL,qT,lS,uS,bp={},AL=[],HZ=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,p0=Array.isArray;function fa(i,e){for(var t in e)i[t]=e[t];return i}function $T(i){i&&i.parentNode&&i.parentNode.removeChild(i)}function WZ(i,e,t){var n,r,s,o={};for(s in e)s=="key"?n=e[s]:s=="ref"?r=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?zp.call(arguments,2):t),typeof i=="function"&&i.defaultProps!=null)for(s in i.defaultProps)o[s]===void 0&&(o[s]=i.defaultProps[s]);return Zd(i,o,n,r,null)}function Zd(i,e,t,n,r){var s={type:i,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++bL,__i:-1,__u:0};return r==null&&Jn.vnode!=null&&Jn.vnode(s),s}function m0(i){return i.children}function m_(i,e){this.props=i,this.context=e}function Gh(i,e){if(e==null)return i.__?Gh(i.__,i.__i+1):null;for(var t;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null)return t.__e;return typeof i.type=="function"?Gh(i):null}function wL(i){var e,t;if((i=i.__)!=null&&i.__c!=null){for(i.__e=i.__c.base=null,e=0;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null){i.__e=i.__c.base=t.__e;break}return wL(i)}}function MN(i){(!i.__d&&(i.__d=!0)&&tu.push(i)&&!B_.__r++||TN!=Jn.debounceRendering)&&((TN=Jn.debounceRendering)||TL)(B_)}function B_(){for(var i,e,t,n,r,s,o,u=1;tu.length;)tu.length>u&&tu.sort(ML),i=tu.shift(),u=tu.length,i.__d&&(t=void 0,n=void 0,r=(n=(e=i).__v).__e,s=[],o=[],e.__P&&((t=fa({},n)).__v=n.__v+1,Jn.vnode&&Jn.vnode(t),jT(e.__P,t,n,e.__n,e.__P.namespaceURI,32&n.__u?[r]:null,s,r??Gh(n),!!(32&n.__u),o),t.__v=n.__v,t.__.__k[t.__i]=t,NL(s,t,o),n.__e=n.__=null,t.__e!=r&&wL(t)));B_.__r=0}function RL(i,e,t,n,r,s,o,u,c,h,d){var p,g,_,v,T,b,x,M=n&&n.__k||AL,E=e.length;for(c=qZ(t,e,M,c,E),p=0;p<E;p++)(_=t.__k[p])!=null&&(g=_.__i==-1?bp:M[_.__i]||bp,_.__i=p,b=jT(i,_,g,r,s,o,u,c,h,d),v=_.__e,_.ref&&g.ref!=_.ref&&(g.ref&&XT(g.ref,null,_),d.push(_.ref,_.__c||v,_)),T==null&&v!=null&&(T=v),(x=!!(4&_.__u))||g.__k===_.__k?c=CL(_,c,i,x):typeof _.type=="function"&&b!==void 0?c=b:v&&(c=v.nextSibling),_.__u&=-7);return t.__e=T,c}function qZ(i,e,t,n,r){var s,o,u,c,h,d=t.length,p=d,g=0;for(i.__k=new Array(r),s=0;s<r;s++)(o=e[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=i.__k[s]=Zd(null,o,null,null,null):p0(o)?o=i.__k[s]=Zd(m0,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?o=i.__k[s]=Zd(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):i.__k[s]=o,c=s+g,o.__=i,o.__b=i.__b+1,u=null,(h=o.__i=$Z(o,t,c,p))!=-1&&(p--,(u=t[h])&&(u.__u|=2)),u==null||u.__v==null?(h==-1&&(r>d?g--:r<d&&g++),typeof o.type!="function"&&(o.__u|=4)):h!=c&&(h==c-1?g--:h==c+1?g++:(h>c?g--:g++,o.__u|=4))):i.__k[s]=null;if(p)for(s=0;s<d;s++)(u=t[s])!=null&&(2&u.__u)==0&&(u.__e==n&&(n=Gh(u)),LL(u,u));return n}function CL(i,e,t,n){var r,s;if(typeof i.type=="function"){for(r=i.__k,s=0;r&&s<r.length;s++)r[s]&&(r[s].__=i,e=CL(r[s],e,t,n));return e}i.__e!=e&&(n&&(e&&i.type&&!e.parentNode&&(e=Gh(i)),t.insertBefore(i.__e,e||null)),e=i.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function $Z(i,e,t,n){var r,s,o,u=i.key,c=i.type,h=e[t],d=h!=null&&(2&h.__u)==0;if(h===null&&u==null||d&&u==h.key&&c==h.type)return t;if(n>(d?1:0)){for(r=t-1,s=t+1;r>=0||s<e.length;)if((h=e[o=r>=0?r--:s++])!=null&&(2&h.__u)==0&&u==h.key&&c==h.type)return o}return-1}function EN(i,e,t){e[0]=="-"?i.setProperty(e,t??""):i[e]=t==null?"":typeof t!="number"||HZ.test(e)?t:t+"px"}function r_(i,e,t,n,r){var s,o;e:if(e=="style")if(typeof t=="string")i.style.cssText=t;else{if(typeof n=="string"&&(i.style.cssText=n=""),n)for(e in n)t&&e in t||EN(i.style,e,"");if(t)for(e in t)n&&t[e]==n[e]||EN(i.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(EL,"$1")),o=e.toLowerCase(),e=o in i||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),i.l||(i.l={}),i.l[e+s]=t,t?n?t.u=n.u:(t.u=qT,i.addEventListener(e,s?uS:lS,s)):i.removeEventListener(e,s?uS:lS,s);else{if(r=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in i)try{i[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?i.removeAttribute(e):i.setAttribute(e,e=="popover"&&t==1?"":t))}}function AN(i){return function(e){if(this.l){var t=this.l[e.type+i];if(e.t==null)e.t=qT++;else if(e.t<t.u)return;return t(Jn.event?Jn.event(e):e)}}}function jT(i,e,t,n,r,s,o,u,c,h){var d,p,g,_,v,T,b,x,M,E,w,C,N,D,U,R,P,I=e.type;if(e.constructor!==void 0)return null;128&t.__u&&(c=!!(32&t.__u),s=[u=e.__e=t.__e]),(d=Jn.__b)&&d(e);e:if(typeof I=="function")try{if(x=e.props,M="prototype"in I&&I.prototype.render,E=(d=I.contextType)&&n[d.__c],w=d?E?E.props.value:d.__:n,t.__c?b=(p=e.__c=t.__c).__=p.__E:(M?e.__c=p=new I(x,w):(e.__c=p=new m_(x,w),p.constructor=I,p.render=XZ),E&&E.sub(p),p.state||(p.state={}),p.__n=n,g=p.__d=!0,p.__h=[],p._sb=[]),M&&p.__s==null&&(p.__s=p.state),M&&I.getDerivedStateFromProps!=null&&(p.__s==p.state&&(p.__s=fa({},p.__s)),fa(p.__s,I.getDerivedStateFromProps(x,p.__s))),_=p.props,v=p.state,p.__v=e,g)M&&I.getDerivedStateFromProps==null&&p.componentWillMount!=null&&p.componentWillMount(),M&&p.componentDidMount!=null&&p.__h.push(p.componentDidMount);else{if(M&&I.getDerivedStateFromProps==null&&x!==_&&p.componentWillReceiveProps!=null&&p.componentWillReceiveProps(x,w),e.__v==t.__v||!p.__e&&p.shouldComponentUpdate!=null&&p.shouldComponentUpdate(x,p.__s,w)===!1){for(e.__v!=t.__v&&(p.props=x,p.state=p.__s,p.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(H){H&&(H.__=e)}),C=0;C<p._sb.length;C++)p.__h.push(p._sb[C]);p._sb=[],p.__h.length&&o.push(p);break e}p.componentWillUpdate!=null&&p.componentWillUpdate(x,p.__s,w),M&&p.componentDidUpdate!=null&&p.__h.push(function(){p.componentDidUpdate(_,v,T)})}if(p.context=w,p.props=x,p.__P=i,p.__e=!1,N=Jn.__r,D=0,M){for(p.state=p.__s,p.__d=!1,N&&N(e),d=p.render(p.props,p.state,p.context),U=0;U<p._sb.length;U++)p.__h.push(p._sb[U]);p._sb=[]}else do p.__d=!1,N&&N(e),d=p.render(p.props,p.state,p.context),p.state=p.__s;while(p.__d&&++D<25);p.state=p.__s,p.getChildContext!=null&&(n=fa(fa({},n),p.getChildContext())),M&&!g&&p.getSnapshotBeforeUpdate!=null&&(T=p.getSnapshotBeforeUpdate(_,v)),R=d,d!=null&&d.type===m0&&d.key==null&&(R=DL(d.props.children)),u=RL(i,p0(R)?R:[R],e,t,n,r,s,o,u,c,h),p.base=e.__e,e.__u&=-161,p.__h.length&&o.push(p),b&&(p.__E=p.__=null)}catch(H){if(e.__v=null,c||s!=null)if(H.then){for(e.__u|=c?160:128;u&&u.nodeType==8&&u.nextSibling;)u=u.nextSibling;s[s.indexOf(u)]=null,e.__e=u}else{for(P=s.length;P--;)$T(s[P]);cS(e)}else e.__e=t.__e,e.__k=t.__k,H.then||cS(e);Jn.__e(H,e,t)}else s==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):u=e.__e=jZ(t.__e,e,t,n,r,s,o,c,h);return(d=Jn.diffed)&&d(e),128&e.__u?void 0:u}function cS(i){i&&i.__c&&(i.__c.__e=!0),i&&i.__k&&i.__k.forEach(cS)}function NL(i,e,t){for(var n=0;n<t.length;n++)XT(t[n],t[++n],t[++n]);Jn.__c&&Jn.__c(e,i),i.some(function(r){try{i=r.__h,r.__h=[],i.some(function(s){s.call(r)})}catch(s){Jn.__e(s,r.__v)}})}function DL(i){return typeof i!="object"||i==null||i.__b&&i.__b>0?i:p0(i)?i.map(DL):fa({},i)}function jZ(i,e,t,n,r,s,o,u,c){var h,d,p,g,_,v,T,b=t.props||bp,x=e.props,M=e.type;if(M=="svg"?r="http://www.w3.org/2000/svg":M=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),s!=null){for(h=0;h<s.length;h++)if((_=s[h])&&"setAttribute"in _==!!M&&(M?_.localName==M:_.nodeType==3)){i=_,s[h]=null;break}}if(i==null){if(M==null)return document.createTextNode(x);i=document.createElementNS(r,M,x.is&&x),u&&(Jn.__m&&Jn.__m(e,s),u=!1),s=null}if(M==null)b===x||u&&i.data==x||(i.data=x);else{if(s=s&&zp.call(i.childNodes),!u&&s!=null)for(b={},h=0;h<i.attributes.length;h++)b[(_=i.attributes[h]).name]=_.value;for(h in b)if(_=b[h],h!="children"){if(h=="dangerouslySetInnerHTML")p=_;else if(!(h in x)){if(h=="value"&&"defaultValue"in x||h=="checked"&&"defaultChecked"in x)continue;r_(i,h,null,_,r)}}for(h in x)_=x[h],h=="children"?g=_:h=="dangerouslySetInnerHTML"?d=_:h=="value"?v=_:h=="checked"?T=_:u&&typeof _!="function"||b[h]===_||r_(i,h,_,b[h],r);if(d)u||p&&(d.__html==p.__html||d.__html==i.innerHTML)||(i.innerHTML=d.__html),e.__k=[];else if(p&&(i.innerHTML=""),RL(e.type=="template"?i.content:i,p0(g)?g:[g],e,t,n,M=="foreignObject"?"http://www.w3.org/1999/xhtml":r,s,o,s?s[0]:t.__k&&Gh(t,0),u,c),s!=null)for(h=s.length;h--;)$T(s[h]);u||(h="value",M=="progress"&&v==null?i.removeAttribute("value"):v!=null&&(v!==i[h]||M=="progress"&&!v||M=="option"&&v!=b[h])&&r_(i,h,v,b[h],r),h="checked",T!=null&&T!=i[h]&&r_(i,h,T,b[h],r))}return i}function XT(i,e,t){try{if(typeof i=="function"){var n=typeof i.__u=="function";n&&i.__u(),n&&e==null||(i.__u=i(e))}else i.current=e}catch(r){Jn.__e(r,t)}}function LL(i,e,t){var n,r;if(Jn.unmount&&Jn.unmount(i),(n=i.ref)&&(n.current&&n.current!=i.__e||XT(n,null,e)),(n=i.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(s){Jn.__e(s,e)}n.base=n.__P=null}if(n=i.__k)for(r=0;r<n.length;r++)n[r]&&LL(n[r],e,t||typeof i.type!="function");t||$T(i.__e),i.__c=i.__=i.__e=void 0}function XZ(i,e,t){return this.constructor(i,t)}function YZ(i,e,t){var n,r,s,o;e==document&&(e=document.documentElement),Jn.__&&Jn.__(i,e),r=(n=!1)?null:e.__k,s=[],o=[],jT(e,i=e.__k=WZ(m0,null,[i]),r||bp,bp,e.namespaceURI,r?null:e.firstChild?zp.call(e.childNodes):null,s,r?r.__e:e.firstChild,n,o),NL(s,i,o)}function PL(i,e,t){var n,r,s,o,u=fa({},i.props);for(s in i.type&&i.type.defaultProps&&(o=i.type.defaultProps),e)s=="key"?n=e[s]:s=="ref"?r=e[s]:u[s]=e[s]===void 0&&o!=null?o[s]:e[s];return arguments.length>2&&(u.children=arguments.length>3?zp.call(arguments,2):t),Zd(i.type,u,n||i.key,r||i.ref,null)}zp=AL.slice,Jn={__e:function(i,e,t,n){for(var r,s,o;e=e.__;)if((r=e.__c)&&!r.__)try{if((s=r.constructor)&&s.getDerivedStateFromError!=null&&(r.setState(s.getDerivedStateFromError(i)),o=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(i,n||{}),o=r.__d),o)return r.__E=r}catch(u){i=u}throw i}},bL=0,SL=function(i){return i!=null&&i.constructor===void 0},m_.prototype.setState=function(i,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=fa({},this.state),typeof i=="function"&&(i=i(fa({},t),this.props)),i&&fa(t,i),i!=null&&this.__v&&(e&&this._sb.push(e),MN(this))},m_.prototype.forceUpdate=function(i){this.__v&&(this.__e=!0,i&&this.__h.push(i),MN(this))},m_.prototype.render=m0,tu=[],TL=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ML=function(i,e){return i.__v.__b-e.__v.__b},B_.__r=0,EL=/(PointerCapture)$|Capture$/i,qT=0,lS=AN(!1),uS=AN(!0);function wN(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function KZ(i){if(Array.isArray(i))return i}function QZ(i,e,t){return(e=iJ(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ZZ(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,h=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){h=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(h)throw r}}return u}}function JZ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RN(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function eJ(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?RN(Object(t),!0).forEach(function(n){QZ(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):RN(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function tJ(i,e){return KZ(i)||ZZ(i,e)||rJ(i,e)||JZ()}function nJ(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function iJ(i){var e=nJ(i,"string");return typeof e=="symbol"?e:e+""}function F_(i){"@babel/helpers - typeof";return F_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F_(i)}function rJ(i,e){if(i){if(typeof i=="string")return wN(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?wN(i,e):void 0}}var hS=function(e){if(F_(e)!=="object")return e;var t=PL(e);if(t.props){var n;t.props=eJ({},t.props),t!=null&&(n=t.props)!==null&&n!==void 0&&n.children&&(t.props.children=Array.isArray(t.props.children)?t.props.children.map(hS):hS(t.props.children))}return t},sJ=function(e){return SL(PL(e))},aJ=function(e,t){delete t.__k,YZ(hS(e),t)};function oJ(i,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=i:r.appendChild(document.createTextNode(i))}}var lJ=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;oJ(lJ);var uJ=Q_({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=n.style,s=r===void 0?{}:r,o=!!e&&F_(e)==="object"&&!!e.node&&typeof e.node=="function",u=GZ(o?e.node():e);u.style("position")==="static"&&u.style("position","relative"),t.tooltipEl=u.append("div").attr("class","float-tooltip-kap"),Object.entries(s).forEach(function(h){var d=tJ(h,2),p=d[0],g=d[1];return t.tooltipEl.style(p,g)}),t.tooltipEl.style("left","-10000px").style("display","none");var c="tooltip-".concat(Math.round(Math.random()*1e12));t.mouseInside=!1,u.on("mousemove.".concat(c),function(h){t.mouseInside=!0;var d=VZ(h),p=u.node(),g=p.offsetWidth,_=p.offsetHeight,v=[t.offsetX===null||t.offsetX===void 0?"-".concat(d[0]/g*100,"%"):typeof t.offsetX=="number"?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,t.offsetY===null||t.offsetY===void 0?_>130&&_-d[1]<100?"calc(-100% - 6px)":"21px":typeof t.offsetY=="number"?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",d[0]+"px").style("top",d[1]+"px").style("transform","translate(".concat(v.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),u.on("mouseover.".concat(c),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),u.on("mouseout.".concat(c),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):sJ(e.content)?(e.tooltipEl.text(""),aJ(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function cJ(i,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=i:r.appendChild(document.createTextNode(i))}}var hJ=`.scene-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;cJ(hJ);function fS(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function fJ(i){if(Array.isArray(i))return i}function dJ(i){if(Array.isArray(i))return fS(i)}function pJ(i,e,t){return(e=bJ(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function mJ(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function gJ(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,h=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){h=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(h)throw r}}return u}}function _J(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vJ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yJ(i,e){return fJ(i)||gJ(i,e)||UL(i,e)||_J()}function ql(i){return dJ(i)||mJ(i)||UL(i)||vJ()}function xJ(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function bJ(i){var e=xJ(i,"string");return typeof e=="symbol"?e:e+""}function UL(i,e){if(i){if(typeof i=="string")return fS(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?fS(i,e):void 0}}var Kn=window.THREE?window.THREE:{WebGLRenderer:g4,Scene:W_,PerspectiveCamera:Di,Raycaster:c2,SRGBColorSpace:nr,TextureLoader:hF,Vector2:Ue,Vector3:k,Box3:Eu,Color:dt,Mesh:yi,SphereGeometry:Pp,MeshBasicMaterial:la,BackSide:Pn,Clock:u2},OL=Q_({props:{width:{default:window.innerWidth,onChange:function(e,t,n){isNaN(e)&&(t.width=n)}},height:{default:window.innerHeight,onChange:function(e,t,n){isNaN(e)&&(t.height=n)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.enabled&&e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(o){return o.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var n=null;if(e.hoverDuringDrag||!e.isPointerDragging){var r=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&r.sort(function(o,u){return e.hoverOrderComparator(o.object,u.object)});var s=r.find(function(o){return e.hoverFilter(o.object)})||null;n=s?s.object:null,e.intersection=s||null}n!==e.hoverObj&&(e.onHover(n,e.hoverObj,e.intersection),e.tooltip.content(n&&Yt(e.tooltipContent)(n,e.intersection)||null),e.hoverObj=n)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos,n=t.x,r=t.y;return{x:n,y:r}},cameraPosition:function(e,t,n,r){var s=e.camera;if(t&&e.initialised){var o=t,u=n||{x:0,y:0,z:0};if(!r)d(o),p(u);else{var c=Object.assign({},s.position),h=g();e.tweenGroup.add(new bN(c).to(o,r).easing(uu.Quadratic.Out).onUpdate(d).start()),e.tweenGroup.add(new bN(h).to(u,r/3).easing(uu.Quadratic.Out).onUpdate(p).start())}return this}return Object.assign({},s.position,{lookAt:g()});function d(_){var v=_.x,T=_.y,b=_.z;v!==void 0&&(s.position.x=v),T!==void 0&&(s.position.y=T),b!==void 0&&(s.position.z=b)}function p(_){var v=new Kn.Vector3(_.x,_.y,_.z);e.controls.enabled&&e.controls.target?e.controls.target=v:s.lookAt(v)}function g(){return Object.assign(new Kn.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,r=arguments.length,s=new Array(r>3?r-3:0),o=3;o<r;o++)s[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,s),t,n)},fitToBbox:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=e.camera;if(t){var o=new Kn.Vector3(0,0,0),u=Math.max.apply(Math,ql(Object.entries(t).map(function(_){var v=yJ(_,2),T=v[0],b=v[1];return Math.max.apply(Math,ql(b.map(function(x){return Math.abs(o[T]-x)})))})))*2,c=(1-r*2/e.height)*s.fov,h=u/Math.atan(c*Math.PI/180),d=h/s.aspect,p=Math.max(h,d);if(p>0){var g=o.clone().sub(s.position).normalize().multiplyScalar(-p);this.cameraPosition(g,o,n)}}return this},getBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},n=new Kn.Box3(new Kn.Vector3(0,0,0),new Kn.Vector3(0,0,0)),r=e.objects.filter(t);return r.length?(r.forEach(function(s){return n.expandByObject(s)}),Object.assign.apply(Object,ql(["x","y","z"].map(function(s){return pJ({},s,[n.min[s],n.max[s]])})))):null},getScreenCoords:function(e,t,n,r){var s=new Kn.Vector3(t,n,r);return s.project(this.camera()),{x:(s.x+1)*e.width/2,y:-(s.y-1)*e.height/2}},getSceneCoords:function(e,t,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=new Kn.Vector2(t/e.width*2-1,-(n/e.height)*2+1),o=new Kn.Raycaster;return o.setFromCamera(s,e.camera),Object.assign({},o.ray.at(r,new Kn.Vector3))},intersectingObjects:function(e,t,n){var r=new Kn.Vector2(t/e.width*2-1,-(n/e.height)*2+1),s=new Kn.Raycaster;return s.params.Line.threshold=e.lineHoverPrecision,s.params.Points.threshold=e.pointsHoverPrecision,s.setFromCamera(r,e.camera),s.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new Kn.Scene,camera:new Kn.PerspectiveCamera,clock:new Kn.Clock,tweenGroup:new lL,lastRaycasterCheck:0}},init:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=n.controlType,s=r===void 0?"trackball":r,o=n.useWebGPU,u=o===void 0?!1:o,c=n.rendererConfig,h=c===void 0?{}:c,d=n.extraRenderers,p=d===void 0?[]:d,g=n.waitForLoadComplete,_=g===void 0?!0:g;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[s]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new uJ(t.container),t.pointerPos=new Kn.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(v){return t.container.addEventListener(v,function(T){if(v==="pointerdown"&&(t.isPointerPressed=!0),!t.isPointerDragging&&T.type==="pointermove"&&(T.pressure>0||t.isPointerPressed)&&(T.pointerType==="mouse"||T.movementX===void 0||[T.movementX,T.movementY].some(function(M){return Math.abs(M)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var b=x(t.container);t.pointerPos.x=T.pageX-b.left,t.pointerPos.y=T.pageY-b.top}function x(M){var E=M.getBoundingClientRect(),w=window.pageXOffset||document.documentElement.scrollLeft,C=window.pageYOffset||document.documentElement.scrollTop;return{top:E.top+C,left:E.left+w}}},{passive:!0})}),t.container.addEventListener("pointerup",function(v){t.isPointerPressed&&(t.isPointerPressed=!1,!(t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag))&&requestAnimationFrame(function(){v.button===0&&t.onClick(t.hoverObj||null,v,t.intersection),v.button===2&&t.onRightClick&&t.onRightClick(t.hoverObj||null,v,t.intersection)}))},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(v){t.onRightClick&&v.preventDefault()}),t.renderer=new(u?EY:Kn.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},h)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=p,t.extraRenderers.forEach(function(v){v.domElement.style.position="absolute",v.domElement.style.top="0px",v.domElement.style.pointerEvents="none",t.container.appendChild(v.domElement)}),t.postProcessingComposer=new vK(t.renderer),t.postProcessingComposer.addPass(new yK(t.scene,t.camera)),t.controls=new{trackball:wY,orbit:HY,fly:iK}[s](t.camera,t.renderer.domElement),s==="fly"&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),(s==="trackball"||s==="orbit")&&(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(ql(t.extraRenderers)).forEach(function(v){return v.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new Kn.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!_,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var n,r=e.width,s=e.height;e.container.style.width="".concat(r,"px"),e.container.style.height="".concat(s,"px"),[e.renderer,e.postProcessingComposer].concat(ql(e.extraRenderers)).forEach(function(_){return _.setSize(r,s)}),e.camera.aspect=r/s;var o=e.viewOffset.slice(0,2);o.some(function(_){return _})&&(n=e.camera).setViewOffset.apply(n,[r,s].concat(ql(o),[r,s])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var u,c=e.width,h=e.height,d=e.viewOffset.slice(0,2);d.some(function(_){return _})?(u=e.camera).setViewOffset.apply(u,[c,h].concat(ql(d),[c,h])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=e.skyRadius*2.5,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new Kn.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var p=zh(e.backgroundColor).alpha;p===void 0&&(p=1),e.renderer.setClearColor(new Kn.Color(KK(1,e.backgroundColor)),p)}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new Kn.TextureLoader().load(e.backgroundImageUrl,function(_){_.colorSpace=Kn.SRGBColorSpace,e.skysphere.material=new Kn.MeshBasicMaterial({map:_,side:Kn.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&g()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&g())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(_){return e.scene.remove(_)}),e.lights.forEach(function(_){return e.scene.add(_)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(_){return e.scene.remove(_)}),e.objects.forEach(function(_){return e.scene.add(_)}));function g(){e.loadComplete=e.scene.visible=!0}}});function SJ(i,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=i:r.appendChild(document.createTextNode(i))}}var TJ=`.graph-info-msg {
  top: 50%;
  width: 100%;
  text-align: center;
  color: lavender;
  opacity: 0.7;
  font-size: 22px;
  position: absolute;
  font-family: Sans-serif;
}

.scene-container .clickable {
  cursor: pointer;
}

.scene-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.scene-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}`;SJ(TJ);function dS(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function MJ(i){if(Array.isArray(i))return dS(i)}function Gp(i,e,t){return(e=RJ(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function EJ(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function AJ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CN(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function s_(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?CN(Object(t),!0).forEach(function(n){Gp(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):CN(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function g0(i){return MJ(i)||EJ(i)||CJ(i)||AJ()}function wJ(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function RJ(i){var e=wJ(i,"string");return typeof e=="symbol"?e:e+""}function CJ(i,e){if(i){if(typeof i=="string")return dS(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?dS(i,e):void 0}}function BL(i,e){var t=new e;return t._destructor&&t._destructor(),{linkProp:function(r){return{default:t[r](),onChange:function(o,u){u[i][r](o)},triggerUpdate:!1}},linkMethod:function(r){return function(s){for(var o=s[i],u=arguments.length,c=new Array(u>1?u-1:0),h=1;h<u;h++)c[h-1]=arguments[h];var d=o[r].apply(o,c);return d===o?this:d}}}}var db=window.THREE?window.THREE:{AmbientLight:o2,DirectionalLight:a2,REVISION:Tu},NJ=170,FL=BL("forceGraph",Q2),DJ=Object.assign.apply(Object,g0(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","nodePositionUpdate","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleOffset","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","linkDirectionalParticleThreeObject","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(i){return Gp({},i,FL.linkProp(i))}))),LJ=Object.assign.apply(Object,g0(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(i){return Gp({},i,FL.linkMethod(i))}))),g_=BL("renderObjs",OL),PJ=Object.assign.apply(Object,g0(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(i){return Gp({},i,g_.linkProp(i))}))),UJ=Object.assign.apply(Object,g0(["lights","cameraPosition","postProcessingComposer"].map(function(i){return Gp({},i,g_.linkMethod(i))})).concat([{graph2ScreenCoords:g_.linkMethod("getScreenCoords"),screen2GraphCoords:g_.linkMethod("getSceneCoords")}])),OJ=Q_({props:s_(s_({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(e,t){return t.renderObjs.lineHoverPrecision(e)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(e,t){var n=t.renderObjs.controls();n&&(n.enabled=e,e&&n.domElement&&n.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1},showPointerCursor:{default:!0,triggerUpdate:!1}},DJ),PJ),methods:s_(s_({zoomToFit:function(e,t,n){for(var r,s=arguments.length,o=new Array(s>3?s-3:0),u=3;u<s;u++)o[u-3]=arguments[u];return e.renderObjs.fitToBbox((r=e.forceGraph).getGraphBbox.apply(r,o),t,n),this},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),this},_animationCycle:function(e){e.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),e.forceGraph.tickFrame(),e.renderObjs.tick(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},tbControls:function(e){return e.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},LJ),UJ),stateInit:function(e){var t=e.controlType,n=e.rendererConfig,r=e.extraRenderers,s=new Q2;return{forceGraph:s,renderObjs:OL({controlType:t,rendererConfig:n,extraRenderers:r}).objects([s]).lights([new db.AmbientLight(13421772,Math.PI),new db.DirectionalLight(16777215,.6*Math.PI)])}},init:function(e,t){e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var n=document.createElement("div");t.container.appendChild(n),t.renderObjs(n);var r=t.renderObjs.camera(),s=t.renderObjs.renderer(),o=t.renderObjs.controls();o.enabled=!!t.enableNavigationControls,t.lastSetCameraZ=r.position.z;var u;t.container.appendChild(u=document.createElement("div")),u.className="graph-info-msg",u.textContent="",t.forceGraph.onLoading(function(){u.textContent="Loading..."}).onFinishLoading(function(){u.textContent=""}).onUpdate(function(){t.graphData=t.forceGraph.graphData(),r.position.x===0&&r.position.y===0&&r.position.z===t.lastSetCameraZ&&t.graphData.nodes.length&&(r.lookAt(t.forceGraph.position),t.lastSetCameraZ=r.position.z=Math.cbrt(t.graphData.nodes.length)*NJ)}).onFinishUpdate(function(){if(t._dragControls){var c=t.graphData.nodes.find(function(d){return d.__initialFixedPos&&!d.__disposeControlsAfterDrag});c?c.__disposeControlsAfterDrag=!0:t._dragControls.dispose(),t._dragControls=void 0}if(t.enableNodeDrag&&t.enablePointerInteraction&&t.forceEngine==="d3"){var h=t._dragControls=new _4(t.graphData.nodes.map(function(d){return d.__threeObj}).filter(function(d){return d}),r,s.domElement);h.addEventListener("dragstart",function(d){var p=Ya(d.object);if(p){o.enabled=!1,d.object.__initialPos=d.object.position.clone(),d.object.__prevPos=d.object.position.clone();var g=p.__data;!g.__initialFixedPos&&(g.__initialFixedPos={fx:g.fx,fy:g.fy,fz:g.fz}),!g.__initialPos&&(g.__initialPos={x:g.x,y:g.y,z:g.z}),["x","y","z"].forEach(function(_){return g["f".concat(_)]=g[_]}),s.domElement.classList.add("grabbable")}}),h.addEventListener("drag",function(d){var p=Ya(d.object);if(p){if(!d.object.hasOwnProperty("__graphObjType")){var g=d.object.__initialPos,_=d.object.__prevPos,v=d.object.position;p.position.add(v.clone().sub(_)),_.copy(v),v.copy(g)}var T=p.__data,b=p.position,x={x:b.x-T.x,y:b.y-T.y,z:b.z-T.z};["x","y","z"].forEach(function(M){return T["f".concat(M)]=T[M]=b[M]}),t.forceGraph.d3AlphaTarget(.3).resetCountdown(),T.__dragged=!0,t.onNodeDrag(T,x)}}),h.addEventListener("dragend",function(d){var p=Ya(d.object);if(p){delete d.object.__initialPos,delete d.object.__prevPos;var g=p.__data;g.__disposeControlsAfterDrag&&(h.dispose(),delete g.__disposeControlsAfterDrag);var _=g.__initialFixedPos,v=g.__initialPos,T={x:v.x-g.x,y:v.y-g.y,z:v.z-g.z};if(_&&(["x","y","z"].forEach(function(x){var M="f".concat(x);_[M]===void 0&&delete g[M]}),delete g.__initialFixedPos,delete g.__initialPos,g.__dragged&&(delete g.__dragged,t.onNodeDragEnd(g,T))),t.forceGraph.d3AlphaTarget(0).resetCountdown(),t.enableNavigationControls){var b;o.enabled=!0,o._status&&((b=o._onPointerCancel)===null||b===void 0||b.call(o)),o.domElement&&o.domElement.ownerDocument&&o.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))}s.domElement.classList.remove("grabbable")}})}}),db.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverOrderComparator(function(c,h){var d=Ya(c);if(!d)return 1;var p=Ya(h);if(!p)return-1;var g=function(v){return v.__graphObjType==="node"};return g(p)-g(d)}).tooltipContent(function(c){var h=Ya(c);return h&&Yt(t["".concat(h.__graphObjType,"Label")])(h.__data)||""}).hoverDuringDrag(!1).onHover(function(c){var h=Ya(c);if(h!==t.hoverObj){var d=t.hoverObj?t.hoverObj.__graphObjType:null,p=t.hoverObj?t.hoverObj.__data:null,g=h?h.__graphObjType:null,_=h?h.__data:null;if(d&&d!==g){var v=t["on".concat(d==="node"?"Node":"Link","Hover")];v&&v(null,p)}if(g){var T=t["on".concat(g==="node"?"Node":"Link","Hover")];T&&T(_,d===g?p:null)}s.domElement.classList[(h&&t["on".concat(g==="node"?"Node":"Link","Click")]||!h&&t.onBackgroundClick)&&Yt(t.showPointerCursor)(_)?"add":"remove"]("clickable"),t.hoverObj=h}}).clickAfterDrag(!1).onClick(function(c,h){var d=Ya(c);if(d){var p=t["on".concat(d.__graphObjType==="node"?"Node":"Link","Click")];p&&p(d.__data,h)}else t.onBackgroundClick&&t.onBackgroundClick(h)}).onRightClick(function(c,h){var d=Ya(c);if(d){var p=t["on".concat(d.__graphObjType==="node"?"Node":"Link","RightClick")];p&&p(d.__data,h)}else t.onBackgroundRightClick&&t.onBackgroundRightClick(h)}),this._animationCycle()}});function Ya(i){for(var e=i;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}var pb={exports:{}},mb,NN;function BJ(){if(NN)return mb;NN=1;var i="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return mb=i,mb}var gb,DN;function FJ(){if(DN)return gb;DN=1;var i=BJ();function e(){}function t(){}return t.resetWarningCache=e,gb=function(){function n(o,u,c,h,d,p){if(p!==i){var g=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw g.name="Invariant Violation",g}}n.isRequired=n;function r(){return n}var s={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:r,element:n,elementType:n,instanceOf:r,node:n,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:t,resetWarningCache:e};return s.PropTypes=s,s},gb}var LN;function IJ(){return LN||(LN=1,pb.exports=FJ()()),pb.exports}var zJ=IJ();const ee=gS(zJ),_0={width:ee.number,height:ee.number,graphData:ee.shape({nodes:ee.arrayOf(ee.object).isRequired,links:ee.arrayOf(ee.object).isRequired}),backgroundColor:ee.string,nodeRelSize:ee.number,nodeId:ee.string,nodeLabel:ee.oneOfType([ee.string,ee.func]),nodeVal:ee.oneOfType([ee.number,ee.string,ee.func]),nodeVisibility:ee.oneOfType([ee.bool,ee.string,ee.func]),nodeColor:ee.oneOfType([ee.string,ee.func]),nodeAutoColorBy:ee.oneOfType([ee.string,ee.func]),onNodeHover:ee.func,onNodeClick:ee.func,linkSource:ee.string,linkTarget:ee.string,linkLabel:ee.oneOfType([ee.string,ee.func]),linkVisibility:ee.oneOfType([ee.bool,ee.string,ee.func]),linkColor:ee.oneOfType([ee.string,ee.func]),linkAutoColorBy:ee.oneOfType([ee.string,ee.func]),linkWidth:ee.oneOfType([ee.number,ee.string,ee.func]),linkCurvature:ee.oneOfType([ee.number,ee.string,ee.func]),linkDirectionalArrowLength:ee.oneOfType([ee.number,ee.string,ee.func]),linkDirectionalArrowColor:ee.oneOfType([ee.string,ee.func]),linkDirectionalArrowRelPos:ee.oneOfType([ee.number,ee.string,ee.func]),linkDirectionalParticles:ee.oneOfType([ee.number,ee.string,ee.func]),linkDirectionalParticleSpeed:ee.oneOfType([ee.number,ee.string,ee.func]),linkDirectionalParticleOffset:ee.oneOfType([ee.number,ee.string,ee.func]),linkDirectionalParticleWidth:ee.oneOfType([ee.number,ee.string,ee.func]),linkDirectionalParticleColor:ee.oneOfType([ee.string,ee.func]),onLinkHover:ee.func,onLinkClick:ee.func,dagMode:ee.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:ee.number,dagNodeFilter:ee.func,onDagError:ee.func,d3AlphaMin:ee.number,d3AlphaDecay:ee.number,d3VelocityDecay:ee.number,warmupTicks:ee.number,cooldownTicks:ee.number,cooldownTime:ee.number,onEngineTick:ee.func,onEngineStop:ee.func,getGraphBbox:ee.func},IL={zoomToFit:ee.func,onNodeRightClick:ee.func,onNodeDrag:ee.func,onNodeDragEnd:ee.func,onLinkRightClick:ee.func,linkHoverPrecision:ee.number,onBackgroundClick:ee.func,onBackgroundRightClick:ee.func,showPointerCursor:ee.oneOfType([ee.bool,ee.func]),enablePointerInteraction:ee.bool,enableNodeDrag:ee.bool},YT={showNavInfo:ee.bool,nodeOpacity:ee.number,nodeResolution:ee.number,nodeThreeObject:ee.oneOfType([ee.object,ee.string,ee.func]),nodeThreeObjectExtend:ee.oneOfType([ee.bool,ee.string,ee.func]),nodePositionUpdate:ee.func,linkOpacity:ee.number,linkResolution:ee.number,linkCurveRotation:ee.oneOfType([ee.number,ee.string,ee.func]),linkMaterial:ee.oneOfType([ee.object,ee.string,ee.func]),linkThreeObject:ee.oneOfType([ee.object,ee.string,ee.func]),linkThreeObjectExtend:ee.oneOfType([ee.bool,ee.string,ee.func]),linkPositionUpdate:ee.func,linkDirectionalArrowResolution:ee.number,linkDirectionalParticleResolution:ee.number,linkDirectionalParticleThreeObject:ee.oneOfType([ee.object,ee.string,ee.func]),forceEngine:ee.oneOf(["d3","ngraph"]),ngraphPhysics:ee.object,numDimensions:ee.oneOf([1,2,3])};Object.assign({},_0,IL,{linkLineDash:ee.oneOfType([ee.arrayOf(ee.number),ee.string,ee.func]),nodeCanvasObjectMode:ee.oneOfType([ee.string,ee.func]),nodeCanvasObject:ee.func,nodePointerAreaPaint:ee.func,linkCanvasObjectMode:ee.oneOfType([ee.string,ee.func]),linkCanvasObject:ee.func,linkPointerAreaPaint:ee.func,linkDirectionalParticleCanvasObject:ee.func,autoPauseRedraw:ee.bool,minZoom:ee.number,maxZoom:ee.number,enableZoomInteraction:ee.oneOfType([ee.bool,ee.func]),enablePanInteraction:ee.oneOfType([ee.bool,ee.func]),onZoom:ee.func,onZoomEnd:ee.func,onRenderFramePre:ee.func,onRenderFramePost:ee.func});const GJ=Object.assign({},_0,IL,YT,{enableNavigationControls:ee.bool,controlType:ee.oneOf(["trackball","orbit","fly"]),rendererConfig:ee.object,extraRenderers:ee.arrayOf(ee.shape({render:ee.func.isRequired}))});Object.assign({},_0,YT,{nodeDesc:ee.oneOfType([ee.string,ee.func]),linkDesc:ee.oneOfType([ee.string,ee.func])});Object.assign({},_0,YT,{markerAttrs:ee.object,yOffset:ee.number,glScale:ee.number});const KT=bO(OJ,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","lights","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});KT.displayName="ForceGraph3D";KT.propTypes=GJ;function pS(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function kJ(i){if(Array.isArray(i))return i}function VJ(i){if(Array.isArray(i))return pS(i)}function HJ(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function WJ(i,e,t){return e=I_(e),JJ(i,zL()?Reflect.construct(e,t||[],I_(i).constructor):e.apply(i,t))}function qJ(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function $J(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,tee(n.key),n)}}function jJ(i,e,t){return e&&$J(i.prototype,e),Object.defineProperty(i,"prototype",{writable:!1}),i}function I_(i){return I_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},I_(i)}function XJ(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),e&&mS(i,e)}function zL(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(zL=function(){return!!i})()}function YJ(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function KJ(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,h=!1;try{if(s=(t=t.call(i)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){h=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(h)throw r}}return u}}function QJ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZJ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JJ(i,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return HJ(i)}function mS(i,e){return mS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},mS(i,e)}function PN(i,e){return kJ(i)||KJ(i,e)||GL(i,e)||QJ()}function Ad(i){return VJ(i)||YJ(i)||GL(i)||ZJ()}function eee(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function tee(i){var e=eee(i,"string");return typeof e=="symbol"?e:e+""}function GL(i,e){if(i){if(typeof i=="string")return pS(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?pS(i,e):void 0}}var wd=typeof window<"u"&&window.THREE?window.THREE:{CanvasTexture:BB,Sprite:CB,SpriteMaterial:ZS,SRGBColorSpace:nr},nee=(function(i){function e(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"rgba(255, 255, 255, 1)";return qJ(this,e),t=WJ(this,e,[new wd.SpriteMaterial]),t._text="".concat(n),t._textHeight=r,t._color=s,t._backgroundColor=!1,t._padding=0,t._borderWidth=0,t._borderRadius=0,t._borderColor="white",t._offsetX=0,t._offsetY=0,t._strokeWidth=0,t._strokeColor="white",t._fontFace="system-ui",t._fontSize=90,t._fontWeight="normal",t._canvas=document.createElement("canvas"),t._genCanvas(),t}return XJ(e,i),jJ(e,[{key:"text",get:function(){return this._text},set:function(n){this._text=n,this._genCanvas()}},{key:"textHeight",get:function(){return this._textHeight},set:function(n){this._textHeight=n,this._genCanvas()}},{key:"color",get:function(){return this._color},set:function(n){this._color=n,this._genCanvas()}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(n){this._backgroundColor=n,this._genCanvas()}},{key:"padding",get:function(){return this._padding},set:function(n){this._padding=n,this._genCanvas()}},{key:"borderWidth",get:function(){return this._borderWidth},set:function(n){this._borderWidth=n,this._genCanvas()}},{key:"borderRadius",get:function(){return this._borderRadius},set:function(n){this._borderRadius=n,this._genCanvas()}},{key:"borderColor",get:function(){return this._borderColor},set:function(n){this._borderColor=n,this._genCanvas()}},{key:"offsetX",get:function(){return this._offsetX},set:function(n){this._offsetX=n,this._genCanvas()}},{key:"offsetY",get:function(){return this._offsetY},set:function(n){this._offsetY=n,this._genCanvas()}},{key:"fontFace",get:function(){return this._fontFace},set:function(n){this._fontFace=n,this._genCanvas()}},{key:"fontSize",get:function(){return this._fontSize},set:function(n){this._fontSize=n,this._genCanvas()}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(n){this._fontWeight=n,this._genCanvas()}},{key:"strokeWidth",get:function(){return this._strokeWidth},set:function(n){this._strokeWidth=n,this._genCanvas()}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(n){this._strokeColor=n,this._genCanvas()}},{key:"_genCanvas",value:function(){var n=this,r=this._canvas,s=r.getContext("2d"),o=1/this.textHeight,u=Array.isArray(this.borderWidth)?this.borderWidth:[this.borderWidth,this.borderWidth],c=u.map(function(I){return I*n.fontSize*o}),h=Array.isArray(this.borderRadius)?this.borderRadius:[this.borderRadius,this.borderRadius,this.borderRadius,this.borderRadius],d=h.map(function(I){return I*n.fontSize*o}),p=Array.isArray(this.padding)?this.padding:[this.padding,this.padding],g=p.map(function(I){return I*n.fontSize*o}),_=[this.offsetX,this.offsetY].map(function(I){return I*n.fontSize*o}),v=this.text.split(`
`),T="".concat(this.fontWeight," ").concat(this.fontSize,"px ").concat(this.fontFace);s.font=T;var b=Math.max.apply(Math,Ad(v.map(function(I){return s.measureText(I).width}))),x=this.fontSize*v.length,M=b+c[0]*2+g[0]*2,E=x+c[1]*2+g[1]*2;if(r.width=M+Math.abs(_[0]),r.height=E+Math.abs(_[1]),s.translate.apply(s,Ad(_.map(function(I){return Math.max(0,I)}))),this.borderWidth){if(s.strokeStyle=this.borderColor,c[0]){var w=c[0]/2;s.lineWidth=c[0],s.beginPath(),s.moveTo(w,d[0]),s.lineTo(w,E-d[3]),s.moveTo(M-w,d[1]),s.lineTo(M-w,E-d[2]),s.stroke()}if(c[1]){var C=c[1]/2;s.lineWidth=c[1],s.beginPath(),s.moveTo(Math.max(c[0],d[0]),C),s.lineTo(M-Math.max(c[0],d[1]),C),s.moveTo(Math.max(c[0],d[3]),E-C),s.lineTo(M-Math.max(c[0],d[2]),E-C),s.stroke()}if(this.borderRadius){var N=Math.max.apply(Math,Ad(c)),D=N/2;s.lineWidth=N,s.beginPath(),[!!d[0]&&[d[0],D,D,d[0]],!!d[1]&&[M-d[1],M-D,D,d[1]],!!d[2]&&[M-d[2],M-D,E-D,E-d[2]],!!d[3]&&[d[3],D,E-D,E-d[3]]].filter(function(I){return I}).forEach(function(I){var H=PN(I,4),X=H[0],J=H[1],ne=H[2],G=H[3];s.moveTo(X,ne),s.quadraticCurveTo(J,ne,J,G)}),s.stroke()}}this.backgroundColor&&(s.fillStyle=this.backgroundColor,this.borderRadius?(s.beginPath(),s.moveTo(c[0],d[0]),[[c[0],d[0],M-d[1],c[1],c[1],c[1]],[M-c[0],M-c[0],M-c[0],c[1],d[1],E-d[2]],[M-c[0],M-d[2],d[3],E-c[1],E-c[1],E-c[1]],[c[0],c[0],c[0],E-c[1],E-d[3],d[0]]].forEach(function(I){var H=PN(I,6),X=H[0],J=H[1],ne=H[2],G=H[3],z=H[4],q=H[5];s.quadraticCurveTo(X,G,J,z),s.lineTo(ne,q)}),s.closePath(),s.fill()):s.fillRect(c[0],c[1],M-c[0]*2,E-c[1]*2)),s.translate.apply(s,Ad(c)),s.translate.apply(s,Ad(g)),s.font=T,s.fillStyle=this.color,s.textBaseline="bottom";var U=this.strokeWidth>0;U&&(s.lineWidth=this.strokeWidth*this.fontSize/10,s.strokeStyle=this.strokeColor),v.forEach(function(I,H){var X=(b-s.measureText(I).width)/2,J=(H+1)*n.fontSize;U&&s.strokeText(I,X,J),s.fillText(I,X,J)}),this.material.map&&this.material.map.dispose();var R=this.material.map=new wd.CanvasTexture(r);R.colorSpace=wd.SRGBColorSpace;var P=this.textHeight*v.length+u[1]*2+p[1]*2+Math.abs(this.offsetY);this.scale.set(P*r.width/r.height,P,0)}},{key:"clone",value:function(){return new this.constructor(this.text,this.textHeight,this.color).copy(this)}},{key:"copy",value:function(n){return wd.Sprite.prototype.copy.call(this,n),this.color=n.color,this.backgroundColor=n.backgroundColor,this.padding=n.padding,this.borderWidth=n.borderWidth,this.borderColor=n.borderColor,this.offsetX=n.offsetX,this.offsetY=n.offsetY,this.fontFace=n.fontFace,this.fontSize=n.fontSize,this.fontWeight=n.fontWeight,this.strokeWidth=n.strokeWidth,this.strokeColor=n.strokeColor,this}}])})(wd.Sprite);const iee=({data:i,onNodeClick:e})=>{const t=vn.useRef(),[n,r]=vn.useState({width:window.innerWidth,height:window.innerHeight});vn.useEffect(()=>{const o=()=>{r({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]);const s=o=>o.cluster?`hsl(${parseInt(o.cluster)*137.508%360}, 70%, 60%)`:"#4a90e2";return _t.jsx("div",{className:"w-full h-full absolute inset-0 -z-10 bg-black",children:_t.jsx(KT,{ref:t,graphData:i,nodeLabel:"name",nodeColor:s,nodeRelSize:6,linkOpacity:.2,linkWidth:1,nodeResolution:16,nodeThreeObject:o=>{const u=new nee(o.name);return u.color=o.cluster?"#fff":"#aaa",u.textHeight=4,u},nodeThreeObjectExtend:!1,onNodeClick:o=>{const c=1+40/Math.hypot(o.x,o.y,o.z);t.current.cameraPosition({x:o.x*c,y:o.y*c,z:o.z*c},o,3e3),e(o)},backgroundColor:"#000000",showNavInfo:!1})})};const kL=(...i)=>i.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim();const ree=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const see=i=>i.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase());const UN=i=>{const e=see(i);return e.charAt(0).toUpperCase()+e.slice(1)};var aee={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const oee=i=>{for(const e in i)if(e.startsWith("aria-")||e==="role"||e==="title")return!0;return!1};const lee=vn.forwardRef(({color:i="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:r="",children:s,iconNode:o,...u},c)=>vn.createElement("svg",{ref:c,...aee,width:e,height:e,stroke:i,strokeWidth:n?Number(t)*24/Number(e):t,className:kL("lucide",r),...!s&&!oee(u)&&{"aria-hidden":"true"},...u},[...o.map(([h,d])=>vn.createElement(h,d)),...Array.isArray(s)?s:[s]]));const kp=(i,e)=>{const t=vn.forwardRef(({className:n,...r},s)=>vn.createElement(lee,{ref:s,iconNode:e,className:kL(`lucide-${ree(UN(i))}`,`lucide-${i}`,n),...r}));return t.displayName=UN(i),t};const uee=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],cee=kp("activity",uee);const hee=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],fee=kp("code",hee);const dee=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],pee=kp("layers",dee);const mee=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],gee=kp("send",mee);const _ee=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],vee=kp("sparkles",_ee),yee=({onQuery:i})=>{const[e,t]=vn.useState(""),[n,r]=vn.useState([{role:"system",content:"Welcome to Code Archaeologist. Ask me about the codebase!"}]),[s,o]=vn.useState(!1),u=async c=>{if(c.preventDefault(),!e.trim())return;const h={role:"user",content:e};r(d=>[...d,h]),t(""),o(!0);try{const d=await i(e);r(p=>[...p,{role:"system",content:d}])}catch{r(p=>[...p,{role:"system",content:"Error connecting to the Archaeologist Mind."}])}finally{o(!1)}};return _t.jsx("div",{className:"absolute top-0 left-0 h-full w-96 p-4 z-10 pointer-events-none flex flex-col justify-end",children:_t.jsxs("div",{className:"bg-black/40 backdrop-blur-2xl border border-white/10 shadow-2xl w-full h-[85%] rounded-[2rem] pointer-events-auto flex flex-col overflow-hidden transition-all hover:bg-black/50",children:[_t.jsxs("div",{className:"p-4 border-b border-white/10 bg-black/20 backdrop-blur-md flex items-center gap-2",children:[_t.jsx(vee,{className:"w-5 h-5 text-blue-400"}),_t.jsx("h2",{className:"font-semibold text-white/90",children:"Archaeologist AI"})]}),_t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[n.map((c,h)=>_t.jsx("div",{className:`flex ${c.role==="user"?"justify-end":"justify-start"}`,children:_t.jsx("div",{className:`max-w-[80%] p-3 rounded-2xl text-sm leading-relaxed ${c.role==="user"?"bg-blue-600/90 text-white rounded-2xl rounded-tr-sm shadow-lg backdrop-blur-sm":"bg-white/10 text-white rounded-2xl rounded-tl-sm border border-white/5 shadow-lg backdrop-blur-md"}`,children:c.content})},h)),s&&_t.jsx("div",{className:"flex justify-start",children:_t.jsx("div",{className:"bg-white/10 p-3 rounded-2xl rounded-tl-sm text-xs text-zinc-400 animate-pulse border border-white/5",children:"Analyze ripple effects..."})})]}),_t.jsxs("form",{onSubmit:u,className:"p-3 bg-black/20 backdrop-blur-md border-t border-white/10 flex gap-2",children:[_t.jsx("input",{type:"text",className:"flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-sm text-white placeholder-zinc-500 focus:outline-none focus:border-blue-500/50 transition-colors",placeholder:"Ask a question...",value:e,onChange:c=>t(c.target.value)}),_t.jsx("button",{type:"submit",className:"p-2 bg-blue-600 hover:bg-blue-500 rounded-xl transition-colors disabled:opacity-50",disabled:s,children:_t.jsx(gee,{className:"w-5 h-5 text-white"})})]})]})})};function xee(){const[i,e]=vn.useState({nodes:[],links:[]}),[t,n]=vn.useState(null),[r,s]=vn.useState([]),[o,u]=vn.useState(!1);vn.useEffect(()=>{const h=async()=>{try{const g=await(await fetch("http://localhost:8005/graph")).json();e(g);const v=await(await fetch("http://localhost:8005/clusters")).json();s(v)}catch(p){console.error("Backend not ready",p)}},d=setInterval(h,5e3);return h(),()=>clearInterval(d)},[]);const c=async h=>(await(await fetch(`http://localhost:8005/query?q=${encodeURIComponent(h)}`,{method:"POST"})).json()).response;return _t.jsxs("div",{className:"relative w-screen h-screen overflow-hidden bg-gradient-to-br from-gray-900 via-black to-zinc-900 text-white font-sans selection:bg-blue-500/30",children:[_t.jsx(iee,{data:i,onNodeClick:n}),_t.jsxs("div",{className:"absolute inset-0 pointer-events-none flex",children:[_t.jsx(yee,{onQuery:c}),_t.jsxs("div",{className:"absolute top-0 right-0 h-full w-80 p-4 flex flex-col pointer-events-none",children:[_t.jsxs("div",{className:"bg-black/40 backdrop-blur-2xl border border-white/10 shadow-2xl w-full p-5 rounded-[2rem] mb-4 pointer-events-auto transition-all hover:bg-black/50",children:[_t.jsxs("div",{className:"flex items-center gap-2 mb-2 border-b border-white/10 pb-2",children:[_t.jsx(pee,{className:"w-5 h-5 text-purple-400"}),_t.jsx("h3",{className:"font-semibold",children:"System Overview"})]}),_t.jsxs("div",{className:"space-y-2 text-sm text-gray-300",children:[_t.jsxs("div",{className:"flex justify-between",children:[_t.jsx("span",{children:"Nodes"}),_t.jsx("span",{className:"text-white font-mono",children:i.nodes.length})]}),_t.jsxs("div",{className:"flex justify-between",children:[_t.jsx("span",{children:"Clusters"}),_t.jsx("span",{className:"text-white font-mono",children:r.length})]})]})]}),_t.jsx("div",{className:`bg-black/40 backdrop-blur-2xl border border-white/10 shadow-2xl w-full flex-1 rounded-[2rem] p-5 pointer-events-auto transition-all duration-500 cubic-bezier(0.32, 0.72, 0, 1) transform ${t?"translate-x-0 opacity-100":"translate-x-[120%] opacity-0"}`,children:t?_t.jsxs(_t.Fragment,{children:[_t.jsxs("div",{className:"flex items-center gap-2 mb-4 border-b border-white/10 pb-2",children:[_t.jsx(fee,{className:"w-5 h-5 text-green-400"}),_t.jsx("h3",{className:"font-semibold truncate",title:t.name,children:t.name})]}),_t.jsxs("div",{className:"space-y-4",children:[_t.jsxs("div",{children:[_t.jsx("label",{className:"text-xs text-zinc-500 uppercase tracking-wider",children:"File"}),_t.jsx("p",{className:"text-xs text-zinc-300 break-all font-mono bg-black/20 p-2 rounded-lg mt-1",children:t.file})]}),_t.jsxs("div",{children:[_t.jsx("label",{className:"text-xs text-zinc-500 uppercase tracking-wider",children:"Cluster"}),_t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[_t.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`hsl(${parseInt(t.cluster||0)*137%360}, 70%, 60%)`}}),_t.jsxs("span",{className:"text-sm",children:["Cluster ",t.cluster||"N/A"]})]})]}),_t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 p-3 rounded-xl mt-4",children:[_t.jsxs("div",{className:"flex items-center gap-2 mb-1 text-red-400",children:[_t.jsx(cee,{className:"w-4 h-4"}),_t.jsx("span",{className:"text-xs font-bold",children:"Ripple Risk"})]}),_t.jsxs("p",{className:"text-xs text-red-200",children:["Modifying this function may impact ",t.upstream_count||"?"," upstream callers."]})]})]})]}):_t.jsx("div",{className:"h-full flex items-center justify-center text-zinc-500 text-sm",children:"Select a node to view details"})})]})]})]})}nO.createRoot(document.getElementById("root")).render(_t.jsx(vn.StrictMode,{children:_t.jsx(xee,{})}));
